function GestionCommandeTemplate(){this.dialogAjoutProduitAjoutMarche='<div id="dialog-ajout-pro" title="Produit"><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Le Produit</div><div id="pro-idFerme" class="com-float-left"><select name="ferme"><option value="0" >== Choisir une ferme ==</option><!-- BEGIN listeFerme --><option value="{listeFerme.ferId}" >{listeFerme.ferNom}</option><!-- END listeFerme --></select></div><div id="pro-idCategorie" class="com-float-left"><select name="categorie" disabled="disabled"><option value="0" >== Choisir une catégorie ==</option></select></div><div id="pro-idProduit"><select name="produit" disabled="disabled"><option value="0" >== Choisir un produit ==</option></select></div></div><div id="prix-stock-produit"></div></div>';this.ajoutProduitSelectCategorie='<div id="pro-idCategorie" class="com-float-left"><select name="categorie"><option value="0" >== Choisir une catégorie ==</option><!-- BEGIN listeCategorie --><option value="{listeCategorie.cproId}" >{listeCategorie.cproNom}</option><!-- END listeCategorie --></select></div>';this.ajoutProduitSelectProduit='<div id="pro-idProduit"><select name="produit"><option value="0" >== Choisir un produit ==</option><!-- BEGIN listeProduit --><option value="{listeProduit.nproId}" >{listeProduit.nproNom}</option><!-- END listeProduit --></select></div>';this.dialogAjoutAchatProduit='<div id="dialog-ajout-pro" title="Produit"><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Le Produit</div><div id="pro-idFerme" class="com-float-left"><select name="ferme"><option value="0" >== Choisir une ferme ==</option><!-- BEGIN listeFerme --><option value="{listeFerme.ferId}" >{listeFerme.ferNom}</option><!-- END listeFerme --></select></div><div id="pro-idCategorie" class="com-float-left"><select name="categorie" disabled="disabled"><option value="0" >== Choisir une catégorie ==</option></select></div><div id="pro-idProduit"><select name="produit" disabled="disabled"><option value="0" >== Choisir un produit ==</option></select></div></div><div id="detail-achat"></div></div>';this.detailProduitAjoutAchatProduit='<div id="detail-achat"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Achat</div><input type="hidden" id="pro-id" value="{idProduit}"/><div id="choixTypeAchat"><input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitNormal" value="0" checked="checked"/> Achat<input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitSolidaire" value="1" /> Achat Solidaire</div><table class="com-table-form"><tr><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-quantite" maxlength="13" id="pro-quantite"/> {unite}</td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-prix" maxlength="13" id="pro-prix"/> {sigleMonetaire}</td></tr></table></div>';this.prixAjoutProduit='<div id="div-lot"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-form" id="table-pro-prix"><tr><td class="catalogue-entete-lot">Quantité</td><td class="catalogue-entete-lot">Unité</td><td>Prix</td><td></td><td></td></tr><tr class="btn-lot"><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-quantite" maxlength="13" id="pro-lot-quantite"/></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all" type="text" name="lot-unite" maxlength="20" id="pro-lot-unite"/></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-prix" maxlength="13" id="pro-lot-prix"/> {sigleMonetaire}</td><td colspan="2"><button type="button" id="btn-ajout-lot" class="ui-state-default ui-corner-all com-button com-center">Ajouter un prix de vente</button></td></tr></table><table class="com-table" id="lot-liste"><!-- BEGIN modelesLot --><tr class="ligne-lot" id="ligne-lot-{modelesLot.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLot.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{modelesLot.id}" name="pro-lot" id="pro-lot-{modelesLot.id}-id" class="modele-lot"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLot.id} lot-quantite" id="lot-{modelesLot.id}-quantite">{modelesLot.quantite}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLot.id}-quantite" maxlength="13" id="pro-lot-{modelesLot.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLot.id} lot-unite" id="lot-{modelesLot.id}-unite">{modelesLot.unite}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLot.id}-unite" maxlength="20" id="pro-lot-{modelesLot.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLot.id} lot-prix" id="lot-{modelesLot.id}-prix">{modelesLot.prix}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLot.id}-prix" maxlength="13" id="pro-lot-{modelesLot.id}-prix"/> {modelesLot.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot" id="btn-valider-lot-{modelesLot.id}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot" id="btn-annuler-lot-{modelesLot.id}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLot --></table></div>';this.prixAbonnementAjoutProduit='<div id="div-lot-abonnement"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-form" id="table-pro-abonnement-prix"><tr><td class="catalogue-entete-lot">Quantité</td><td class="catalogue-entete-lot">Unité</td><td>Prix</td><td></td><td></td></tr><tr class="btn-lot-abonnement"><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-abo-quantite" maxlength="13" id="pro-abo-lot-quantite"/></td><td><span id="pro-abo-lot-unite">{uniteAbonnement}</span></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-abo-prix" maxlength="13" id="pro-abo-lot-prix"/> {sigleMonetaire}</td><td colspan="2"><button type="button" id="btn-ajout-lot-abonnement" class="ui-state-default ui-corner-all com-button com-center">Ajouter un prix de vente</button></td></tr></table><table class="com-table" id="lot-liste-abonnement"><!-- BEGIN modelesLotAbonnementReservation --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnementReservation.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnementReservation.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" checked="checked" disabled="disabled" value="{modelesLotAbonnementReservation.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnementReservation.id}-id" class="modele-lot-reservation"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnementReservation.id}-quantite-abonnement">{modelesLotAbonnementReservation.quantite}</span></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-unite" id="lot-{modelesLotAbonnementReservation.id}-unite-abonnement">{modelesLotAbonnementReservation.unite}</span></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-prix" id="lot-{modelesLotAbonnementReservation.id}-prix-abonnement">{modelesLotAbonnementReservation.prix}</span> {modelesLotAbonnementReservation.sigleMonetaire}</td><td class="com-table-td-med td-edt"></td><td class="com-table-td-fin td-edt"></td></tr><!-- END modelesLotAbonnementReservation --><!-- BEGIN modelesLotAbonnement --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnement.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnement.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{modelesLotAbonnement.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnement.id}-id" class="modele-lot"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnement.id}-quantite-abonnement">{modelesLotAbonnement.quantite}</span><input class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-quantite" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnement.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-unite" id="lot-{modelesLotAbonnement.id}-unite-abonnement">{modelesLotAbonnement.unite}</span><input disabled="disabled" class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-unite" maxlength="20" id="pro-lot-abonnement{modelesLotAbonnement.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-prix" id="lot-{modelesLotAbonnement.id}-prix-abonnement">{modelesLotAbonnement.prix}</span><input class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-prix" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnement.id}-prix"/> {modelesLotAbonnement.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot-abonnement" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot-abonnement" id="btn-valider-lot-{modelesLotAbonnement.id}-abonnement" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot-abonnement" id="btn-annuler-lot-{modelesLotAbonnement.id}-abonnement" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot-abonnement" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLotAbonnement --></table></div>';this.stockAjoutProduit='<div id="id-stock" class="{visibleSolidaire} pro-detail"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Stock</div><table class="com-table-form"><tr><th class="com-table-form-th">Limite de stock : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-stock-choix" value="0" checked="checked"/>Pas de limite</td></tr><tr><th class="com-table-form-th"></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-stock-choix" value="1"/><input disabled="disabled" class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="pro-stock" maxlength="13" id="pro-qteRestante"/> <span class="unite-stock">{unite}</span></td></tr><tr><th class="com-table-form-th">Quantité max par adhérent : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-qte-max-choix" value="0" checked="checked"/>Pas de limite</td></tr><tr><th class="com-table-form-th"></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-qte-max-choix" value="1" /><input disabled="disabled" class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="pro-qte-max" maxlength="13" id="pro-qteMaxCommande"/> <span class="unite-stock">{unite}</span></td></tr></table></div>';this.stockAbonnementAjoutProduit='<div id="id-stock-abonnement"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Stock</div><table class="com-table-form"><tr><th class="com-table-form-th">Limite de stock : </th><td class="com-table-form-td"><span id="stock-abonnement">{stockInitialAbonnement}</span> {uniteAbonnement}</td></tr><tr><th class="com-table-form-th">Quantité max par adhérent : </th><td class="com-table-form-td"><span>{qMaxAbonnement}</span><span id="max-abonnement" class="ui-helper-hidden">{qMaxAbonnementValue}</span></td></tr></table></div>';this.typeProduitAjoutProduit='<div id="pro-typeProduit"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Type de produit</div><input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitNormal" value="0" {typeNormalSelected} /> Normal<input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitSolidaire" value="1" {typeSolidaireSelected}/> Solidaire{typeProduitAbonnement}</div>';this.typeProduitAbonnementAjoutProduit='<input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitAbonnement" value="2" {typeAbonnementSelected} /> Abonnement';this.prixEtStockAjoutProduit='<div id="prix-stock-produit">{divTypeProduit}<div id="pro-normal" class="{visibleNormal} pro-detail">{divLot}{divStock}</div><div id="pro-abonnement" class="{visibleAbonnement} pro-detail">{divLotAbonnement}{divStockAbonnement}</div></div>';this.modeleLot='<tr class="ligne-lot" id="ligne-lot-{id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{id}" name="pro-lot" id="pro-lot-{id}-id"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{id} lot-quantite" id="lot-{id}-quantite">{quantite}</span><input class="champ-lot-{id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-quantite" maxlength="13" id="pro-lot-{id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{id} lot-unite" id="lot-{id}-unite">{unite}</span><input class="champ-lot-{id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{id}-unite" maxlength="20" id="pro-lot-{id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{id} lot-prix" id="lot-{id}-prix">{prix}</span><input class="champ-lot-{id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-prix" maxlength="13" id="pro-lot-{id}-prix"/> {sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot" id="btn-valider-lot-{id}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot" id="btn-annuler-lot-{id}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot" id="btn-supprimer-lot-abonnement-{id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr>';this.modeleLotAbonnement='<tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{id}" name="pro-lot" id="pro-lot-{id}-id"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{id}-abonnement lot-quantite" id="lot-{id}-quantite-abonnement">{quantite}</span><input class="champ-lot-{id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-quantite" maxlength="13" id="pro-lot-abonnement{id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{id}-abonnement lot-unite" id="lot-{id}-unite-abonnement">{unite}</span><input disabled="disabled" class="champ-lot-{id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{id}-unite" maxlength="20" id="pro-lot-abonnement{id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{id}-abonnement lot-prix" id="lot-{id}-prix-abonnement">{prix}</span><input class="champ-lot-{id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-prix" maxlength="13" id="pro-lot-abonnement{id}-prix"/> {sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot-abonnement" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot-abonnement" id="btn-valider-lot-{id}-abonnement" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot-abonnement" id="btn-annuler-lot-{id}-abonnement" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot-abonnement" id="btn-supprimer-lot-abonnement-{id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr>';this.btnValiderAjoutMarche='<div id="btn-gestion-marche" class="com-widget-window ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-modifier-creation-commande" class="com-btn-edt-multiples ui-helper-hidden ui-state-default ui-corner-all com-button com-center">Modifier</button><button type="button" id="btn-creer-marche" class="ui-state-default ui-corner-all com-button com-center">Valider</button></div>';this.ajoutMarcheListeProduit='<div id="liste-ferme"><!-- BEGIN fermes --><div class="com-widget-window ui-widget ui-widget-content ui-corner-all" id="ferme-{fermes.ferId}"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">{fermes.ferNom}</div><!-- BEGIN fermes.categories --><table class="com-table"><tr class="ui-widget-header" ><td class="com-table-td-debut">{fermes.categories.cproNom}</td><td class="com-table-td-med"></td><td class="com-table-td-med"></td><td class="com-table-td-fin"></td></tr><!-- BEGIN fermes.categories.produits --><tr><td class="com-table-td-debut">{fermes.categories.produits.nproNom}</td><td class="com-table-td-med edt-marche-pro-unite">{fermes.categories.produits.abonnement}</td><td class="com-table-td-med td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-produit" title="Modifier" id-produit="{fermes.categories.produits.nproId}" typeProduit="{fermes.categories.produits.type}"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-produit" title="Supprimer" id-produit="{fermes.categories.produits.nproId}" typeProduit="{fermes.categories.produits.type}"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END fermes.categories.produits --></table><!-- END fermes.categories --></div><!-- END fermes --></div>';this.flagAbonnement='<span class="com-widget-header ui-widget ui-widget-header ui-corner-all">Abonnement</span>';this.flagSolidaire='<span class="com-widget-header ui-widget ui-widget-header ui-corner-all">Solidaire</span>';this.dialogModifProduitAjoutMarche='<div id="dialog-modif-pro" title="Produit"><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Le Produit</div><div id="pro-idFerme" class="com-float-left" id-ferme="{ferId}">{ferNom}</div><div id="pro-idCategorie" class="com-float-left" id-categorie="{cproId}">{cproNom}</div><div id="pro-idProduit" class="com-float-left" id-produit="{nproId}">{nproNom}</div></div><div id="prix-stock-produit"><div id="pro-typeProduit">{typeProduitLabel}</div>{divLot}{divStock}</div></div>';this.typeProduitLabelNormal='<div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Type de produit</div>Normal';this.typeProduitLabelSolidaire='<div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Type de produit</div>Solidaire';this.typeProduitLabelAbonnement='<div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Type de produit</div>Abonnement';this.typeProduitLabelFormulaire='<div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Type de produit</div><input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitNormal" value="0" {typeNormalSelected} /> Normal<input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitSolidaire" value="1" {typeSolidaireSelected}/> Solidaire';this.prixModifProduit='<div id="div-lot"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-form" id="table-pro-prix"><tr><td class="catalogue-entete-lot">Quantité</td><td class="catalogue-entete-lot">Unité</td><td>Prix</td><td></td><td></td></tr><tr class="btn-lot"><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-quantite" maxlength="13" id="pro-lot-quantite"/></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all" type="text" name="lot-unite" maxlength="20" id="pro-lot-unite"/></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-prix" maxlength="13" id="pro-lot-prix"/> {sigleMonetaire}</td><td colspan="2"><button type="button" id="btn-ajout-lot" class="ui-state-default ui-corner-all com-button com-center">Ajouter un prix de vente</button></td></tr></table><table class="com-table" id="lot-liste"><!-- BEGIN modelesLotReservation --><tr class="ligne-lot" id="ligne-lot-{modelesLotReservation.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotReservation.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" checked="checked" disabled="disabled" value="{modelesLotReservation.id}" name="pro-lot" id="pro-lot-{modelesLotReservation.id}-id" {modelesLotReservation.checked} class="{modelesLotReservation.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotReservation.id} lot-quantite" id="lot-{modelesLotReservation.id}-quantite">{modelesLotReservation.quantite}</span><input class="champ-lot-{modelesLotReservation.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotReservation.id}-quantite" maxlength="13" id="pro-lot-{modelesLotReservation.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotReservation.id} lot-unite" id="lot-{modelesLotReservation.id}-unite">{modelesLotReservation.unite}</span><input class="champ-lot-{modelesLotReservation.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLotReservation.id}-unite" maxlength="20" id="pro-lot-{modelesLotReservation.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotReservation.id} lot-prix" id="lot-{modelesLotReservation.id}-prix">{modelesLotReservation.prix}</span><input class="champ-lot-{modelesLotReservation.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotReservation.id}-prix" maxlength="13" id="pro-lot-{modelesLotReservation.id}-prix"/> {modelesLotReservation.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot" id="btn-valider-lot-{modelesLotReservation.id}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot" id="btn-annuler-lot-{modelesLotReservation.id}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot"  id="btn-supprimer-lot-{modelesLotReservation.id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLotReservation --><!-- BEGIN modelesLot --><tr class="ligne-lot" id="ligne-lot-{modelesLot.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLot.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{modelesLot.id}" name="pro-lot" id="pro-lot-{modelesLot.id}-id" {modelesLot.checked} class="{modelesLot.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLot.id} lot-quantite" id="lot-{modelesLot.id}-quantite">{modelesLot.quantite}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLot.id}-quantite" maxlength="13" id="pro-lot-{modelesLot.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLot.id} lot-unite" id="lot-{modelesLot.id}-unite">{modelesLot.unite}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLot.id}-unite" maxlength="20" id="pro-lot-{modelesLot.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLot.id} lot-prix" id="lot-{modelesLot.id}-prix">{modelesLot.prix}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLot.id}-prix" maxlength="13" id="pro-lot-{modelesLot.id}-prix"/> {modelesLot.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot" id="btn-valider-lot-{modelesLot.id}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot" id="btn-annuler-lot-{modelesLot.id}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot"  id="btn-supprimer-lot-{modelesLot.id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLot --><!-- BEGIN listeModelesLot --><tr class="ligne-lot" id="ligne-lot-modele-{listeModelesLot.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{listeModelesLot.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{listeModelesLot.id}" name="pro-lot" id="pro-lot-{listeModelesLot.id}-id" {listeModelesLot.checked} class="{listeModelesLot.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{listeModelesLot.id} lot-quantite" id="lot-{listeModelesLot.id}-quantite">{listeModelesLot.quantite}</span><input class="champ-lot-{listeModelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{listeModelesLot.id}-quantite" maxlength="13" id="pro-lot-{listeModelesLot.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{listeModelesLot.id} lot-unite" id="lot-{listeModelesLot.id}-unite">{listeModelesLot.unite}</span><input class="champ-lot-{listeModelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{listeModelesLot.id}-unite" maxlength="20" id="pro-lot-{listeModelesLot.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{listeModelesLot.id} lot-prix" id="lot-{listeModelesLot.id}-prix">{listeModelesLot.prix}</span><input class="champ-lot-{listeModelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{listeModelesLot.id}-prix" maxlength="13" id="pro-lot-{listeModelesLot.id}-prix"/> {listeModelesLot.sigleMonetaire}</td><td class="com-table-td-med td-edt"></td><td class="com-table-td-fin td-edt"></td></tr><!-- END listeModelesLot --></table></div>';this.prixAbonnementModifProduit='<div id="div-lot-abonnement"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-form" id="table-pro-abonnement-prix"><tr><td class="catalogue-entete-lot">Quantité</td><td class="catalogue-entete-lot">Unité</td><td>Prix</td><td></td><td></td></tr><tr class="btn-lot-abonnement"><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-abo-quantite" maxlength="13" id="pro-abo-lot-quantite"/></td><td><span id="pro-abo-lot-unite">{uniteAbonnement}</span></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-abo-prix" maxlength="13" id="pro-abo-lot-prix"/> {sigleMonetaire}</td><td colspan="2"><button type="button" id="btn-ajout-lot-abonnement" class="ui-state-default ui-corner-all com-button com-center">Ajouter un prix de vente</button></td></tr></table><table class="com-table" id="lot-liste-abonnement"><!-- BEGIN modelesLotAbonnementReservation --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnementReservation.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnementReservation.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" checked="checked" disabled="disabled" value="{modelesLotAbonnementReservation.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnementReservation.id}-id" class="modele-lot-reservation"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnementReservation.id}-quantite-abonnement">{modelesLotAbonnementReservation.quantite}</span></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-unite" id="lot-{modelesLotAbonnementReservation.id}-unite-abonnement">{modelesLotAbonnementReservation.unite}</span></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-prix" id="lot-{modelesLotAbonnementReservation.id}-prix-abonnement">{modelesLotAbonnementReservation.prix}</span> {modelesLotAbonnementReservation.sigleMonetaire}</td><td class="com-table-td-med td-edt"></td><td class="com-table-td-fin td-edt"></td></tr><!-- END modelesLotAbonnementReservation --><!-- BEGIN modelesLotAbonnementReservationModif --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnementReservationModif.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnementReservationModif.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" checked="checked" disabled="disabled" value="{modelesLotAbonnementReservationModif.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnementReservationModif.id}-id" {modelesLotAbonnementReservationModif.checked} class="{modelesLotAbonnementReservationModif.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnementReservationModif.id}-quantite-abonnement">{modelesLotAbonnementReservationModif.quantite}</span><input class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnementReservationModif.id}-quantite" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnementReservationModif.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement lot-unite" id="lot-{modelesLotAbonnementReservationModif.id}-unite-abonnement">{modelesLotAbonnementReservationModif.unite}</span><input disabled="disabled" class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLotAbonnementReservationModif.id}-unite" maxlength="20" id="pro-lot-abonnement{modelesLotAbonnementReservationModif.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement lot-prix" id="lot-{modelesLotAbonnementReservationModif.id}-prix-abonnement">{modelesLotAbonnementReservationModif.prix}</span><input class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnementReservationModif.id}-prix" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnementReservationModif.id}-prix"/> {modelesLotAbonnementReservationModif.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot-abonnement" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot-abonnement" id="btn-valider-lot-{modelesLotAbonnementReservationModif.id}-abonnement" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot-abonnement" id="btn-annuler-lot-{modelesLotAbonnementReservationModif.id}-abonnement" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot-abonnement" id="btn-supprimer-lot-abonnement-{modelesLotAbonnementReservationModif.id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLotAbonnementReservationModif --><!-- BEGIN modelesLotAbonnement --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnement.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnement.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{modelesLotAbonnement.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnement.id}-id" {modelesLotAbonnement.checked} class="{modelesLotAbonnement.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnement.id}-quantite-abonnement">{modelesLotAbonnement.quantite}</span><input class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-quantite" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnement.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-unite" id="lot-{modelesLotAbonnement.id}-unite-abonnement">{modelesLotAbonnement.unite}</span><input disabled="disabled" class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-unite" maxlength="20" id="pro-lot-abonnement{modelesLotAbonnement.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-prix" id="lot-{modelesLotAbonnement.id}-prix-abonnement">{modelesLotAbonnement.prix}</span><input class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-prix" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnement.id}-prix"/> {modelesLotAbonnement.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot-abonnement" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot-abonnement" id="btn-valider-lot-{modelesLotAbonnement.id}-abonnement" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot-abonnement" id="btn-annuler-lot-{modelesLotAbonnement.id}-abonnement" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot-abonnement" id="btn-supprimer-lot-abonnement-{modelesLotAbonnement.id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLotAbonnement --><!-- BEGIN listeModelesLotAbonnement --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-modele-{listeModelesLotAbonnement.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{listeModelesLotAbonnement.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{listeModelesLotAbonnement.id}" name="pro-lot" id="pro-lot-{listeModelesLotAbonnement.id}-id" {listeModelesLotAbonnement.checked} class="{listeModelesLotAbonnement.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{listeModelesLotAbonnement.id}-abonnement lot-quantite" id="lot-{listeModelesLotAbonnement.id}-quantite-abonnement">{listeModelesLotAbonnement.quantite}</span><input class="champ-lot-{listeModelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{listeModelesLotAbonnement.id}-quantite" maxlength="13" id="pro-lot-abonnement{listeModelesLotAbonnement.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{listeModelesLotAbonnement.id}-abonnement lot-unite" id="lot-{listeModelesLotAbonnement.id}-unite-abonnement">{listeModelesLotAbonnement.unite}</span><input disabled="disabled" class="champ-lot-{listeModelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{listeModelesLotAbonnement.id}-unite" maxlength="20" id="pro-lot-abonnement{listeModelesLotAbonnement.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{listeModelesLotAbonnement.id}-abonnement lot-prix" id="lot-{listeModelesLotAbonnement.id}-prix-abonnement">{listeModelesLotAbonnement.prix}</span><input class="champ-lot-{listeModelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{listeModelesLotAbonnement.id}-prix" maxlength="13" id="pro-lot-abonnement{listeModelesLotAbonnement.id}-prix"/> {listeModelesLotAbonnement.sigleMonetaire}</td><td class="com-table-td-med td-edt"></td><td class="com-table-td-fin td-edt"></td></tr><!-- END listeModelesLotAbonnement --></table></div>';this.stockModifProduit='<div id="id-stock" class="{visibleSolidaire} pro-detail"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Stock</div><table class="com-table-form"><tr><th class="com-table-form-th">Limite de stock : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-stock-choix" value="0" {nproStockCheckedNoLimit} />Pas de limite</td></tr><tr><th class="com-table-form-th"></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-stock-choix" value="1" {nproStockCheckedLimit} /><input {nproStockDisabled} class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" value="{nproStock}" name="pro-stock" maxlength="13" id="pro-qteRestante"/> <span class="unite-stock">{unite}</span></td></tr><tr><th class="com-table-form-th">Quantité max par adhérent : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-qte-max-choix" value="0" {nproQteMaxCheckedNoLimit} />Pas de limite</td></tr><tr><th class="com-table-form-th"></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-qte-max-choix" value="1" {nproQteMaxCheckedLimit} /><input {nproQteMaxDisabled} class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" value="{nproQteMax}" name="pro-qte-max" maxlength="13" id="pro-qteMaxCommande"/> <span class="unite-stock">{unite}</span></td></tr></table></div>';this.dialogSupprimerLotModifierMarche='<div id="dialog-supp-lot" title="Supprimer le prix de vente"><div id="information-detail-producteur">Des réservations sont positionnées sur ce prix de vente.<br/>Veuillez préciser le nouveau prix de vente sur lequel se baseront ces réservations.</div><div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-100" id="lot-liste"><!-- BEGIN modelesLot --><tr class="ligne-lot" id="ligne-lot-{modelesLot.id}"><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="radio" value="{modelesLot.id}" name="pro-lot" id="pro-lot-{modelesLot.id}-id"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLot.id} lot-quantite" id="lot-{modelesLot.id}-quantite">{modelesLot.quantite}</span></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLot.id} lot-unite" id="lot-{modelesLot.id}-unite">{modelesLot.unite}</span></td><td class="com-table-td-fin">à <span class="champ-lot-{modelesLot.id} lot-prix" id="lot-{modelesLot.id}-prix">{modelesLot.prix}</span> {modelesLot.sigleMonetaire}</td></tr><!-- END modelesLot --></table></div></div>';this.formulaireAjoutMarche='<div id="contenu"><div id="formulaire_ajout_commande_ext"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Nouveau Marché</div><div class="com-widget-content"><form id="formulaire-information-creation-commande"><table class="com-table-form"><tr><th class="com-table-form-th">Nom du Marché : </th><td class="com-table-form-td"><span id="nom-marche-span" class="ui-helper-hidden informations-marche"></span><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="nom" id="marche-nom" maxlength="100" /></td></tr><tr><th class="com-table-form-th">Début des Réservations * : </th><td class="com-table-form-td"><span id="date-debut-reservation-marche-span" class="ui-helper-hidden informations-marche"></span><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-debut-reservation" id="marche-dateDebutReservation" /></td><td class="com-table-form-td">à <span id="time-debut-reservation-marche-span" class="ui-helper-hidden informations-marche"></span><select name="heure-debut-reservation" id="marche-timeDebutReservation" class="informations-marche" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><span class="informations-marche">H</span> <select name="minute-debut-reservation" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Fin des Réservations * : </th><td class="com-table-form-td"><span id="date-fin-reservation-marche-span" class="ui-helper-hidden informations-marche"></span><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-fin-reservation" id="marche-dateFinReservation" /></td><td class="com-table-form-td">à <span id="time-fin-reservation-marche-span" class="ui-helper-hidden informations-marche"></span><select name="heure-fin-reservation" id="marche-timeFinReservation" class="informations-marche" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><span class="informations-marche">H</span> <select name="minute-fin-reservation" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Jour du marché * : </th><td class="com-table-form-td"><span id="date-debut-marche-span" class="ui-helper-hidden informations-marche"></span><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-debut" id="marche-dateMarcheDebut"/></td><td class="com-table-form-td">de <span id="time-debut-marche-span" class="ui-helper-hidden informations-marche"></span><select name="heure-debut" id="marche-timeMarcheDebut" class="informations-marche"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option selected="selected" value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><span class="informations-marche">H</span> <select name="minute-debut" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option selected="selected" value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td><td class="com-table-form-td">à <span id="time-fin-marche-span" class="ui-helper-hidden informations-marche"></span><select name="heure-fin" id="marche-timeMarcheFin" class="informations-marche"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option selected="selected" value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><span class="informations-marche">H</span> <select name="minute-fin" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option selected="selected" value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Description : </th><td class="com-table-form-td"><span id="description-marche-span" class="ui-helper-hidden informations-marche"></span><textarea class="com-input-text ui-widget-content ui-corner-all informations-marche" name="description" id="marche-description" ></textarea></td></tr></table></form></div></div><div id="btn-ajout-produit-div" class="com-widget-window ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-ajout-produit" class="ui-state-default ui-corner-all com-button com-center">Ajouter un produit</button></div><div id="liste-ferme"></div></div></div>';this.listeCommandePage='<div id="contenu"><div id="liste_commande_int"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-archive"><span class="com-float-left">Les Marchés cloturés</span><span class="com-float-left ui-icon ui-icon-arrowthick-1-e"></span></button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés en cours<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-nv-marche" title="Ajouter un marché"><span class="ui-icon ui-icon-plusthick"></span></span></div><table class="com-table"><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-center" colspan="2">N°</th><th class="com-table-th-med">Marché</th>	<th class="com-table-th-med">Date de cloture des Réservations</th><th class="com-table-th-fin"></th></tr><!-- BEGIN commande --><tr class="com-cursor-pointer btn-marche" id="{commande.id}"><td class="com-table-td-debut lst-resa-th-num com-text-align-right">{commande.numero} :</td><td class="com-table-td-med lst-resa-td-nom ">{commande.nom}</td><td class="com-table-td-med">Le {commande.jourMarcheDebut} {commande.dateMarcheDebut} de {commande.heureMarcheDebut}H{commande.minuteMarcheDebut} à {commande.heureMarcheFin}H{commande.minuteMarcheFin}</td><td class="com-table-td-med">Le {commande.jourFinReservation} {commande.dateFinReservation} à {commande.heureFinReservation}H{commande.minuteFinReservation}</td><td class="com-table-td-fin"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END commande --></table></div></div></div></div>';this.listeCommandeArchivePage='<div id="contenu"><div id="liste_commande_int"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-encours"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Les Marchés en cours</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés cloturés</div><div id="content-nav-liste-operation" class="ui-helper-clearfix ui-state-default ui-corner-all"><form>	<span id="icone-nav-liste-operation-w" class="prev ui-helper-hidden ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-w"></span></span>	<span id="page-compteur">Page : <span type="text" class="pagedisplay"></span></span>	<span id="icone-nav-liste-operation-e" class="next ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-e"></span></span>	<input type="hidden" class="pagesize" value="15"></form></div><table class="com-table" id="table-marche-archive"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-underline-hover com-cursor-pointer com-center" colspan="2"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th-med com-underline-hover com-cursor-pointer" ><span class="ui-icon span-icon"></span>Date de cloture des Réservations</th><th class="com-table-th-med com-underline-hover com-cursor-pointer" ><span class="ui-icon span-icon"></span>Marché</th>	<th class="com-table-th-fin"></th>	</tr></thead><tbody><!-- BEGIN commande --><tr class="com-cursor-pointer detail-commande-ligne" id-marche="{commande.id}"><td class="com-table-td-debut lst-resa-th-num com-text-align-right">{commande.numero} : </td><td class="com-table-td-med lst-resa-td-nom">{commande.nom}</td><td class="com-table-td-med"><span class="ui-helper-hidden">{commande.dateTimeFinResa}</span>Le {commande.jourFinReservation} {commande.dateFinReservation} à {commande.heureFinReservation}H{commande.minuteFinReservation}</td><td class="com-table-td-med"><span class="ui-helper-hidden">{commande.dateTimeMarche}</span>Le {commande.jourMarcheDebut} {commande.dateMarcheDebut} de {commande.heureMarcheDebut}H{commande.minuteMarcheDebut} à {commande.heureMarcheFin}H{commande.minuteMarcheFin}</td><td class="com-table-td-fin"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END commande --></tbody></table></div></div></div></div>';this.lotUnique='<input type="hidden" id="lot-{IdPdt}" value="{valeur}" /><span>{text}</span>';this.dialogClotureCommande='<div id="dialog-cloturer-com" title="Cloture du Marché n°{comNumero}"><p>Vous allez cloturer le Marché n°{comNumero}</p></div>';this.dialogExportListeAchatEtReservation='<div id="dialog-cloturer-com" title="Export des Achats et Réservations du marché n°{comNumero}"><p>Vous allez exporter les Achats et Réservations du Marché n°{comNumero}.<br/>Cette action peut être longue.</p></div>';this.dialogExportListeReservation='<div id="dialog-export-liste-reservation" title="Export des réservations en cours."><form><table><tr><td>Format de sortie : </td><td><input type="radio" name="format" value="1" checked="checked" />CSV</td><td><input type="radio" name="format" value="0" />Pdf</td></tr></table><div>Sélectionner les produits : </div><table class="com-table-100"><!-- BEGIN fermes --><tr class="ui-widget-header" ><td colspan="3" class="com-table-td">{fermes.ferNom}</td></tr><!-- BEGIN fermes.categories --><tr><td colspan="3" class="com-table-td">{fermes.categories.cproNom}</td></tr><!-- BEGIN fermes.categories.produits --><tr><td class="com-table-td-debut td-edt"><input type="checkbox" value="{fermes.categories.produits.id}" name="id_produits"/></td><td class="com-table-td-med">{fermes.categories.produits.nproNom}</td><td class="com-table-td-fin">{fermes.categories.produits.abonnement}</td></tr><!-- END fermes.categories.produits --><!-- END fermes.categories --><!-- END fermes --></table></form></div>';this.editerMarcheMenu='<div id="edt-com-nav-resa-achat"><span class="{infoMarcheSelected} com-cursor-pointer ui-widget-header ui-corner-tl com-btn-hover" id="btn-information-marche">Information</span><span class="{listeReservationSelected} com-cursor-pointer ui-widget-header com-btn-hover" id="btn-liste-resa">Reservations</span><span class="{listeAchatSelected} com-cursor-pointer ui-widget-header com-btn-hover" id="btn-liste-achat-resa">Achats</span><span class="{resumeMarcheSelected} com-cursor-pointer ui-widget-header ui-corner-tr com-btn-hover" id="btn-resume-marche">Resumé</span></div>';this.editerCommandePage='<div id="contenu">{editerMenu}<div id="edt-com-liste"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero} : {nom}<span class="ui-helper-hidden marche-archive-1 com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-cloture-com" title="Cloturer"><span class="ui-icon ui-icon-locked"></span></span><span class="ui-helper-hidden marche-archive-1 com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-play-com" title="Ouvrir les ventes et réservations"><span class="ui-icon ui-icon-play"></span></span><span class="ui-helper-hidden marche-archive-0  com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-pause-com" title="Arrêter les ventes et réservations"><span class="ui-icon ui-icon-pause"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-modif-com" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-dupliquer-com" title="Dupliquer le marché"><span class="ui-icon ui-icon-copy"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-facture-com" title="Factures"><span class="ui-icon ui-icon-cart"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-bon-com" title="Bon de commande"><span class="ui-icon ui-icon-document"></span></span></div><div>Réservations : Du <span id="edt-marche-dateDebutReservation">{dateDebutReservation}</span> à <span id="edt-marche-heureDebutReservation">{heureDebutReservation}</span>H<span id="edt-marche-minuteDebutReservation">{minuteDebutReservation}</span> au <span id="edt-marche-dateFinReservation">{dateFinReservation}</span> à <span id="edt-marche-heureFinReservation">{heureFinReservation}</span>H<span id="edt-marche-minuteFinReservation">{minuteFinReservation}</span> <br/>Marché : Le <span id="edt-marche-dateMarcheDebut">{dateMarcheDebut}</span> de <span id="edt-marche-heureMarcheDebut">{heureMarcheDebut}</span>H<span id="edt-marche-minuteMarcheDebut">{minuteMarcheDebut}</span> à <span id="edt-marche-heureMarcheFin">{heureMarcheFin}</span>H<span id="edt-marche-minuteMarcheFin">{minuteMarcheFin}</span></div></div><div id="btn-ajout-produit-div" class="com-widget-window ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-ajout-produit" class="ui-state-default ui-corner-all com-button com-center">Ajouter un produit</button></div><div id="liste-ferme"></div></div></div>';this.listeReservation='<div id="contenu">{editerMenu}<div id="edt-com-liste" ><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Gestion des réservations<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-resa" title="Exporter les réservations"><span class="ui-icon ui-icon-print"></span></span></div><div id="edt-com-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></form></div><table class="com-table" id="edt-com-liste-resa"><thead><tr class="ui-widget ui-widget-header com-cursor-pointer"><th class="com-table-th-debut com-underline-hover"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th-med com-underline-hover"><span class="ui-icon span-icon"></span>Compte</th><th class="com-table-th-med com-underline-hover"><span class="ui-icon span-icon"></span>Nom</th>	<th class="com-table-th-med com-underline-hover"><span class="ui-icon span-icon"></span>Prénom</th><th class="com-table-th-fin"></th></tr></thead><tbody><!-- BEGIN listeAdherent --><tr class="com-cursor-pointer edt-com-reservation-ligne" id-adherent="{listeAdherent.adhId}"><td class="com-table-td-debut com-underline-hover"><span class="ui-helper-hidden">{listeAdherent.adhIdTri}</span>{listeAdherent.adhNumero}</td><td class="com-table-td-med com-underline-hover">{listeAdherent.cptLabel}</td><td class="com-table-td-med com-underline-hover">{listeAdherent.adhNom}</td><td class="com-table-td-med com-underline-hover">{listeAdherent.adhPrenom}</td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END listeAdherent --></tbody></table></div></div></div>';this.listeAchatEtReservation='<div id="contenu">{editerMenu}<div id="edt-com-liste" ><div class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Liste des Achats et Réservations<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-achat" title="Exporter les Achats et les réservations"><span class="ui-icon ui-icon-print"></span></span></div><div id="edt-com-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></form></div>{achatInvite}<table class="com-table" id="edt-com-liste-resa"><thead><tr class="ui-widget ui-widget-header com-cursor-pointer"><th class="com-table-th-debut com-underline-hover"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th-med com-underline-hover"><span class="ui-icon span-icon"></span>Compte</th><th class="com-table-th-med com-underline-hover"><span class="ui-icon span-icon"></span>Nom</th>	<th class="com-table-th-med com-underline-hover"><span class="ui-icon span-icon"></span>Prénom</th><th colspan="2" class="com-table-th-fin"></span>Achat</th></tr></thead><tbody><!-- BEGIN listeAchatEtReservation --><tr class="com-cursor-pointer edt-com-achat-ligne" id-adherent="{listeAchatEtReservation.adhId}"><td class="com-table-td-debut com-underline-hover"><span class="ui-helper-hidden">{listeAchatEtReservation.adhIdTri}</span>{listeAchatEtReservation.adhNumero}</td><td class="com-table-td-med com-underline-hover">{listeAchatEtReservation.cptLabel}</td><td class="com-table-td-med com-underline-hover">{listeAchatEtReservation.adhNom}</td><td class="com-table-td-med com-underline-hover">{listeAchatEtReservation.adhPrenom}</td><td class="com-table-td-med com-underline-hover"><span class="{listeAchatEtReservation.achat} ui-state-hover com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-circle-check"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END listeAchatEtReservation --></tbody></table></div></div></div>';this.listeAchatInvite='<table class="com-table"><thead><tr class="ui-widget ui-widget-header com-cursor-pointer" id="entete-achat-invite" ><th colspan="4" class="com-table-th com-underline-hover com-center">Compte invité<span class="com-btn-header-multiples ui-widget-content ui-widget-content-transparent ui-corner-all com-cursor-pointer"><span id="icon-achat-invite" class="ui-icon ui-icon-triangle-1-s"></span></th></tr><tr class="ui-widget ui-widget-header com-cursor-pointer ui-helper-hidden detail-achat-invite"><th class="com-table-th-debut"></span>Achat</th><th class="com-table-th-med"></span>Achat Solidaire</th><th colspan="2" class="com-table-th-fin"></span>Montant</th></tr><tbody class="ui-helper-hidden detail-achat-invite"><!-- BEGIN listeAchatInvite --><tr class="com-cursor-pointer edt-com-achat-ligne-invite" data-id-operation="{listeAchatInvite.id}"><td class="com-table-td-debut"><span class="{listeAchatInvite.achat} com-flag ui-state-hover com-cursor-pointer ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-circle-check"></span></span></td><td class="com-table-td-med"><span class="{listeAchatInvite.achatSolidaire} com-flag ui-state-hover com-cursor-pointer ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-circle-check"></span></span></td><td class="com-table-td-med">{listeAchatInvite.montant} {sigleMonetaire}</td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END listeAchatInvite --></tbody></thead></table>';this.listeAchatEtReservationVide='<div id="contenu">{editerMenu}<div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Liste des Achats et Réservations</div><p id="texte-liste-vide">Aucun adhérent sur ce marché.</p></div></div></div>';this.dateAchat="Achat du {dateAchat} :";this.boutonSupprimerAchat='<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all btn-achat" id="btn-supp-achat" title="Supprimer" data-id-achat="{idAchat}"><span class="ui-icon ui-icon-trash"></span></span>';this.boutonSupprimerAchatSolidaire='<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all btn-achat-solidaire" id="btn-supp-achat-solidaire" title="Supprimer" data-id-achat="{idAchat}"><span class="ui-icon ui-icon-trash"></span></span>';this.detailAchatEtReservationEnteteInvite='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-annuler"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour à la liste des achats</button></div><div class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Compte Invité</div></div>{detailAchat}</div>';this.detailAchatEtReservationEntete='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-annuler"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour à la liste des achats</button></div><div class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Adhérent</div><div class="com-widget-content"><div id="resa-info-commande">{adhNumero} :  {adhPrenom} {adhNom}<br/>N° de Compte : {adhCompte}</div><div><span>Solde : </span><span><span id="affiche-solde" class="solde">{adhSolde}</span><span id="affiche-solde-modification" class="ui-helper-hidden solde">{adhSolde}</span> {sigleMonetaire}</span></div><div class="com-clear-float-left"></div></div></div>{detailAchat}</div>';this.detailAchatVide='<div class="com-widget-header ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-nv-produit" class="com-btn-edt ui-state-default ui-corner-all com-button com-center">Ajouter un produit</button></div>';this.detailAchatEtReservation='<div class="achat com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">{dateAchat} {totalMarche} {sigleMonetaire}<span id="btn-nv-produit" class="com-cursor-pointer com-btn-header-text ui-widget-content ui-corner-all" title="Ajouter un produit"><span class="com-float-left ui-icon ui-icon-plusthick"></span>Ajouter un produit</span></div><table class="com-table-100"><tr><td></td><td colspan="2" class="col-reservation"><div class="ui-widget-header ui-corner-all com-center">Réservation</div></td><td colspan="3" class="col-achat"><div class="ui-widget-header ui-corner-all com-center">Achat{boutonSupprimerAchat}<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all btn-achat" id="btn-modif-achat" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden btn-achat" id="btn-annuler-achat" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden btn-achat" id="btn-check-achat" title="Valider" data-id-achat="{idAchat}" data-type=""><span class="ui-icon ui-icon-check"></span></span></div></td><td colspan="3" class="col-achat-solidaire"><div class="ui-widget-header ui-corner-all com-center">Achat Solidaire{boutonSupprimerAchatSolidaire}<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all btn-achat-solidaire" id="btn-modif-achat-solidaire" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden btn-achat-solidaire" id="btn-annuler-achat-solidaire" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden btn-achat-solidaire" id="btn-check-achat-solidaire" title="Valider" data-id-achat="{idAchatSolidaire}" data-type="solidaire"><span class="ui-icon ui-icon-check"></span></span></div></td></tr><!-- BEGIN categories --><tr><td><div class="ui-widget-header ui-corner-all com-center">{categories.nom}</div></td><td colspan="2" class="col-reservation"></td><td colspan="3" class="col-achat"></td><td colspan="3" class="col-achat-solidaire"></td></tr><!-- BEGIN categories.achat --><tr class="com-ligne-hover ligne-produit-achat" data-id-produit="{categories.achat.proId}"><td>{categories.achat.nproNom}</td><td class="col-reservation com-text-align-right detail-achat-unite">{categories.achat.stoQuantiteReservation}</td><td class="col-reservation detail-achat-unite">{categories.achat.proUniteMesureReservation}</td><td class="com-text-align-right detail-achat-unite col-achat"><span class="detail-achat-qte affiche-produit-quantite">{categories.achat.stoQuantiteAffiche}</span><span class="detail-achat-qte ui-helper-hidden "><input type="text" value="{categories.achat.stoQuantite}" class="com-numeric produit-quantite com-input-text ui-widget-content ui-corner-all" id="achat-{idAchat}-produits{categories.achat.proId}quantite" maxlength="12" size="3"/></span></td><td class="detail-achat-unite detail-achat-unite col-achat"><span class="detail-achat-qte">{categories.achat.proUniteMesure}</span><span class="detail-achat-qte ui-helper-hidden">{categories.achat.unite}</span></td><td class="com-text-align-right detail-achat-unite col-achat"><span class="detail-achat-prix"><span class="affiche-produit-prix">{categories.achat.prixAffiche}</span> {categories.achat.sigleMonetaire}</span><span class="detail-achat-prix ui-helper-hidden"><input type="text" value="{categories.achat.prix}" class="com-numeric produit-prix com-input-text ui-widget-content ui-corner-all" id="achat-{idAchat}-produits{categories.achat.proId}prix" maxlength="12" size="3"/> {sigleMonetaire}</span></td><td class="com-text-align-right detail-achat-unite col-achat-solidaire"><span class="detail-achat-qte-solidaire affiche-produit-quantite-solidaire">{categories.achat.stoQuantiteSolidaireAffiche}</span><span class="detail-achat-qte-solidaire ui-helper-hidden "><input type="text" value="{categories.achat.stoQuantiteSolidaire}" class="com-numeric produit-quantite-solidaire com-input-text ui-widget-content ui-corner-all" id="achat-{idAchatSolidaire}-produits{categories.achat.proId}quantite" maxlength="12" size="3"/></span></td><td class="detail-achat-unite col-achat-solidaire"><span class="detail-achat-qte-solidaire">{categories.achat.proUniteMesureSolidaire}</span><span class="detail-achat-qte-solidaire ui-helper-hidden">{categories.achat.unite}</span></td><td class="com-text-align-right detail-achat-unite col-achat-solidaire"><span class="detail-achat-prix-solidaire"><span class="affiche-produit-prix-solidaire">{categories.achat.prixSolidaireAffiche}</span> {categories.achat.sigleMonetaireSolidaire}</span><span class="detail-achat-prix-solidaire ui-helper-hidden"><input type="text" value="{categories.achat.prixSolidaire}" class="com-numeric produit-prix-solidaire com-input-text ui-widget-content ui-corner-all" id="achat-{idAchatSolidaire}-produits{categories.achat.proId}prix" maxlength="12" size="3"/> {sigleMonetaire}</span></td></tr><!-- END categories.achat --><!-- END categories --><tr><td></td><td colspan="2" class="col-reservation"></td><td class="com-text-align-right col-achat" colspan="2">Total : </td><td class="com-text-align-right col-achat"><span id="affiche-total" class="total-achat">{total}</span><span id="affiche-total-modification" class="total-achat ui-helper-hidden">{total}</span> {sigleMonetaire}</td><td class="com-text-align-right col-achat-solidaire" colspan="2">Total Solidaire : </td><td class="com-text-align-right col-achat-solidaire"><span id="affiche-total-solidaire" class="total-achat-solidaire">{totalSolidaire}</span><span id="affiche-total-modification-solidaire" class="total-achat-solidaire ui-helper-hidden">{totalSolidaire}</span> {sigleMonetaire}</td></tr></table></div>';this.supprimerReservationDialog='<div id="dialog-supprimer-reservation" title="Supprimer la réservation"><p>Voulez-vous supprimer la réservation ?</p></div>';this.dialogSupprimerAchat='<div title="Supprimer la réservation"><p>Voulez-vous supprimer cet achat ?</p></div>';this.detailReservation='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-annuler"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero}</div><div>Fin des réservations : Le {dateFinReservation} à {heureFinReservation}H{minuteFinReservation} <br/>Marché : Le {dateMarcheDebut} de {heureMarcheDebut}H{minuteMarcheDebut} à {heureMarcheFin}H{minuteMarcheFin}</div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Adhérent</div><div class="com-widget-content"><div id="resa-info-commande">{adhNumero} :  {adhPrenom} {adhNom}<br/>N° de Compte : {adhCompte}</div><div><span>Solde Actuel : </span><span>{adhSolde} {sigleMonetaire}</span></div><div class="com-clear-float-left"></div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">La réservation</div><table><!-- BEGIN categories --><td class="ui-widget-header ui-corner-all com-center">{categories.nom}</td><td colspan="6"></td><!-- BEGIN categories.produits --><tr ><td class="detail-resa-npro">{categories.produits.nproNom}</td><td class="td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-info-produit" title="Information sur le produit" id-produit="{categories.produits.proId}"><span class="ui-icon ui-icon-info"></span></span></td><td>{categories.produits.flagType}</td><td class="com-text-align-right detail-resa-qte">{categories.produits.stoQuantite}</td><td class="detail-resa-unite">{categories.produits.proUniteMesure}</td><td class="com-text-align-right detail-resa-prix">{categories.produits.prix}</td><td>{sigleMonetaire}</td></tr><!-- END categories.produits --><!-- END categories --><tr><td class="com-text-align-right" colspan="5">Total : </td><td class="com-text-align-right">{total}</td><td>{sigleMonetaire}</td></tr></table></div><div class="boutons-edition com-widget-header ui-widget ui-widget-header ui-corner-all com-center"><button class="com-btn-edt-multiples ui-state-default ui-corner-all com-button com-center" id="btn-modifier">Modifier</button><button class="ui-state-default ui-corner-all com-button com-center" id="btn-supprimer">Supprimer</button></div></div>';this.modifierReservation='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero}</div><div>Fin des réservations : Le {dateFinReservation} à {heureFinReservation}H{minuteFinReservation} <br/>Marché : Le {dateMarcheDebut} de {heureMarcheDebut}H{minuteMarcheDebut} à {heureMarcheFin}H{minuteMarcheFin}</div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Adhérent</div><div class="com-widget-content"><div id="resa-info-commande">{adhNumero} :  {adhPrenom} {adhNom}<br/>N° de Compte : {adhCompte}</div><div><span>Solde Actuel : </span><span>{adhSolde} {sigleMonetaire}</span><br/><span>Nouveau Solde : </span><span id="nouveau-solde">{adhNouveauSolde}</span> <span id="nouveau-solde-sigle">{sigleMonetaire}</span></div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">La réservation</div><div><table><!-- BEGIN categories --><tr><td colspan="4" class="ui-widget-header ui-corner-all com-center">{categories.nom}</td><td colspan="7"></td></tr><!-- BEGIN categories.produits -->{categories.produits.detailProduit}<!-- END categories.produits --><!-- END categories --><tr><td colspan="10" class="com-text-align-right">Total : </td><td class="com-text-align-right detail-resa-prix"><span id="total">{total}</span> {sigleMonetaire}</td></tr></table></div></div><div class="boutons-edition-modification com-widget-header ui-widget ui-widget-header ui-corner-all com-center"><button class="com-btn-edt-multiples ui-state-default ui-corner-all com-button com-center" id="btn-annuler">Annuler</button><button class="ui-state-default ui-corner-all com-button com-center" id="btn-valider">Valider</button></div></div>';this.formReservationProduit='<tr class="pdt"><td><input type="checkbox" {checked}/></td><td><span class="ui-helper-hidden"><span class="pdt-id">{proId}</span></span></td><td id="commandes{proId}stoQuantite" >{nproNom}</td><td class="td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-info-produit" title="Information sur le produit" id-produit="{proId}"><span class="ui-icon ui-icon-info"></span></span></td><td><select id="lot-{proId}"><!-- BEGIN lot --><option value="{lot.dcomId}">par {lot.dcomTaille} {proUniteMesure}</option><!-- END lot --></select></td><td>à <span id="prix-unitaire-{proId}">{prixUnitaire}</span> {sigleMonetaire}/{proUniteMesure}</td><td>{flagType}</td><td class="ui-helper-hidden resa-pdt-{proId}"><button class="btn-moins">-</button></td><td class="ui-helper-hidden resa-pdt-{proId}"><span id="qte-pdt-{proId}"></span> {proUniteMesure}</td><td class="ui-helper-hidden resa-pdt-{proId}"><button class="btn-plus">+</button></td><td class="ui-helper-hidden resa-pdt-{proId} com-text-align-right"><span id="prix-pdt-{proId}"></span> {sigleMonetaire}</td></tr>';this.formReservationProduitInfo='<tr class="pdt"><td></td><td><span class="ui-helper-hidden"><span class="pdt-id">{proId}</span></span></td><td id="commandes{proId}stoQuantite" >{nproNom}</td><td class="td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-info-produit" title="Information sur le produit" id-produit="{proId}"><span class="ui-icon ui-icon-info"></span></span></td><td><select id="lot-{proId}"><!-- BEGIN lot --><option value="{lot.dcomId}">par {lot.dcomTaille} {proUniteMesure}</option><!-- END lot --></select></td><td>à <span id="prix-unitaire-{proId}">{prixUnitaire}</span> {sigleMonetaire}/{proUniteMesure}</td><td>{flagType}</td><td></td><td></td><td></td><td></td></tr>';this.formReservationProduitAbonnementInfo='<tr class="pdt"><td></td><td><span class="ui-helper-hidden"><span class="pdt-id">{proId}</span></span></td><td id="commandes{proId}stoQuantite" >{nproNom}</td><td class="td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-info-produit" title="Information sur le produit" id-produit="{proId}"><span class="ui-icon ui-icon-info"></span></span></td><td><select id="lot-{proId}"><!-- BEGIN lot --><option value="{lot.dcomId}">par {lot.dcomTaille} {proUniteMesure}</option><!-- END lot --></select></td><td>à <span id="prix-unitaire-{proId}">{prixUnitaire}</span> {sigleMonetaire}/{proUniteMesure}</td><td>{flagType}</td><td></td><td>{stoQuantiteReservation} {proUniteMesure}</td><td></td><td class="com-text-align-right">{prixReservation} {sigleMonetaire}</td></tr>';this.listeCommandeVide='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-archive"><span class="com-float-left">Les Marchés cloturés</span><span class="com-float-left ui-icon ui-icon-arrowthick-1-e"></span></button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés en cours<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-nv-marche" title="Ajouter un marché"><span class="ui-icon ui-icon-plusthick"></span></span></div><p id="texte-liste-vide">Aucun Marché en cours.</p></div></div>';this.listeCommandeArchiveVide='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-encours"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Les Marchés en cours</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés en cloturés</div><p id="texte-liste-vide">Aucun Marché cloturé.</p></div></div>';this.listeReservationVide='<div id="contenu">{editerMenu}<div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Gestion des réservations</div><p id="texte-liste-vide">Aucune réservation.</p></div></div></div>';this.dialogEnregistrement='<div title="Enregistrer les modifications"><p>Vous n\'avez pas enregistré vos modifications.</p></div>';this.dialogExportBonDeCommande='<div id="dialog-export-bon-commande" title="Export du Bon de Commande du Marché n°{comNumero}"><form><table><tr><td>Format de sortie : </td><td><input type="radio" name="format" value="0" checked="checked" />Pdf</td><td><input type="radio" name="format" value="1" />CSV</td></tr></table></form></div>';this.bonDeCommande='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-editer-com"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Bon de commande du Marché n°{comNumero}<span class="ui-helper-hidden com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-bcom" title="Exporter le bon de commande"><span class="ui-icon ui-icon-print"></span></span></div><div><form><span>Producteur : <select id="select-prdt"><option value="0" >== Choisir une ferme ==</option><!-- BEGIN producteurs --><option value="{producteurs.proIdCompteFerme}">{producteurs.ferNom}</option><!-- END producteurs --></select></span></form></div><div id="liste-pdt"></div></div></div>';this.listeProduitVide='<div id="liste-pdt"></div>';this.listeProduitBonDeCommande='<div id="liste-pdt"><table class="com-table-100"><thead><tr><th>Ref</th><th>Produit</th><th colspan="2" class="com-center">Réservation</th><th colspan="2" class="com-center">Commande</th><th colspan="2" class="com-center">Prix</th><th>État</th></tr></thead><tbody><!-- BEGIN produits --><tr><td>{produits.nproNumero}</td><td>{produits.nproNom}</td><td class="com-text-align-right">{produits.stoQuantite}</td><td> {produits.proUniteMesure}</td><td class="com-text-align-right"><input class="formulaire qte-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" size="3" name="qte-commande-{produits.proId}-{produits.dcomId}" maxlength="11" value="{produits.stoQuantiteCommande}" id="produits{produits.dcomId}quantite" data-taille="{produits.dcomTaille}" data-prix="{produits.dcomPrix}" data-id-produit="{produits.proId}" data-id-detail-commande="{produits.dcomId}" /><span class="detail">{produits.stoQuantiteCommandeAffichage}</span></td><td> {produits.proUniteMesure}</td><td class="com-text-align-right"><input class="formulaire prix-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" size="3" name="prix-commande-{produits.proId}-{produits.dcomId}" maxlength="11" value="{produits.dopeMontant}" id="produits{produits.dcomId}prix" /><span class="detail">{produits.dopeMontantAffichage}</span></td><td> {sigleMonetaire}</td><td><div id="etat-commande-{produits.dcomId}" class="{produits.classEtat} ui-corner-all"></div></td></tr><!-- END produits --></tbody></table><div class="com-center"><button class="ui-helper-hidden com-btn-edt-multiples ui-state-default ui-corner-all com-button" id="btn-annuler">Annuler</button><button class="formulaire ui-state-default ui-corner-all com-button" id="btn-enregistrer">Enregistrer</button><button class="detail ui-state-default ui-corner-all com-button" id="btn-modifier">Modifier</button></div></div>';this.dialogExportFacture='<div id="dialog-export-facture" title="Export de la Facture"><form><table><tr><td>Format de sortie : </td><td><input type="radio" name="format" value="0" checked="checked" />Pdf</td><td><input type="radio" name="format" value="1" />CSV</td></tr></table></form></div>';this.bonDeLivraison='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-editer-com"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Bon de Livraison du Marché n°{comNumero}<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-bcom" title="Exporter le bon de livraison"><span class="ui-icon ui-icon-print"></span></span></div><div><form><span>Producteur : <select id="select-prdt"><option value="0" >== Choisir une ferme ==</option><!-- BEGIN producteurs --><option value="{producteurs.proIdCompteFerme}">{producteurs.ferNom}</option><!-- END producteurs --></select></span></form></div><div id="liste-pdt"></div></div></div>';this.listeProduitLivraison='<div id="liste-pdt"><table class="com-table-100"><thead><tr><th>Ref</th><th>Produit</th><th colspan="2" class="com-center">Réservation</th><th colspan="2" class="com-center">Commande</th><th colspan="2" class="com-center">Prix</th><th colspan="2" class="com-center">Livraison</th><th colspan="2" class="com-center">Prix</th><th colspan="2" class="com-center">Solidaire</th><th>État</th></tr></thead><tbody><!-- BEGIN produits --><tr><td>{produits.nproNumero}</td><td>{produits.nproNom}</td><td class="com-text-align-right">{produits.stoQuantite}</td><td> {produits.proUniteMesure}</td><td class="com-text-align-right">{produits.stoQuantiteCommande}</td><td> {produits.proUniteMesure}</td><td class="com-text-align-right">{produits.opeMontantCommande}</td><td> {sigleMonetaire}</td><td class="com-text-align-right"><span class="pro-id pro-id-etat ui-helper-hidden">{produits.proId}</span><input class="{produits.masquerNormal} formulaire input-bon-livraison qte-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="qte-commande-{produits.proId}" maxlength="11" value="{produits.stoQuantiteLivraison}" id="produits{produits.proId}quantite"/><span class="detail {produits.masquerNormal}">{produits.stoQuantiteLivraison}</span></td><td> <span class="{produits.masquerNormal}">{produits.proUniteMesure}</span></td><td class="com-text-align-right"><input class="{produits.masquerNormal} formulaire input-bon-livraison prix-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="prix-commande-{produits.proId}" maxlength="11" value="{produits.opeMontantLivraison}" id="produits{produits.proId}prix" /><span class="detail {produits.masquerNormal}">{produits.opeMontantLivraison}</span></td><td> <span class="{produits.masquerNormal}">{sigleMonetaire}</span></td><td><span class="pro-id-etat ui-helper-hidden">{produits.proId}</span><input class="formulaire qte-solidaire-commande input-bon-livraison com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="qte-solidaire-commande-{produits.proId}" maxlength="11" value="{produits.stoQuantiteSolidaire}" id="produits{produits.proId}quantiteSolidaire" /><span class="detail">{produits.stoQuantiteSolidaire}</span></td><td> {produits.proUniteMesure}</td><td><div id="etat-commande-{produits.proId}" class="{produits.classEtat} ui-corner-all"></div></td></tr><!-- END produits --></tbody><tfoot><tr><td colspan="4"></td><td colspan="2">Total :</td><td>{totalCommande}</td><td> {sigleMonetaire}</td><td></td><td></td><td><input class="formulaire input-bon-livraison com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="total" maxlength="11" value="{total}" id="total" /><span class="detail">{total}</span></td><td> {sigleMonetaire}</td><td colspan="3"><select class="formulaire" name="typepaiement" id="typePaiement"><option value="0">== Choisir le paiement ==</option><!-- BEGIN typePaiement --><option value="{typePaiement.tppId}">{typePaiement.tppType}</option><!-- END typePaiement --></select><span class="detail">{tppType}</span></td></tr><tr id="tr-champ-complementaire"><td colspan="10"></td><td colspan="2"><span id="label-champ-complementaire" ></span></td><td colspan="3"><input type="text" name="champ-complementaire" value="{champComplementaire}" class="formulaire com-input-text ui-widget-content ui-corner-all" id="typePaiementChampComplementaire" maxlength="50" size="15"/><span class="detail">{champComplementaire}</span></td></tr></tfoot></table><div class="com-center"><button class="ui-helper-hidden com-btn-edt-multiples ui-state-default ui-corner-all com-button" id="btn-annuler">Annuler</button><button class="formulaire ui-state-default ui-corner-all com-button" id="btn-enregistrer">Enregistrer</button><button class="detail ui-state-default ui-corner-all com-button" id="btn-modifier">Modifier</button></div></div>';this.infoCommandeArchive='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Détail du Marché n°{numero}<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-dupliquer-com" title="Dupliquer le marché"><span class="ui-icon ui-icon-copy"></span></span></div><div><div class="com-center" id="resultat-marche-archive"><span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Marché : {total} {sigleMonetaire}</span>    <span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Solidaire : {totalSolidaire} {sigleMonetaire}</span></div><table class="com-table" id="info-marche-archive"><thead><tr><th></th><th class="com-table-th ui-widget ui-widget-header" colspan="5">Achat</th><th class="com-table-th ui-widget ui-widget-header" colspan="4">Vente</th></tr><tr class="ui-widget ui-widget-header"><th class="com-table-th">Produit</th><th class="com-table-th">Qté Commande</th><th class="com-table-th">Prix Commande</th><th class="com-table-th">Qté Livraison</th><th class="com-table-th">Prix Livraison</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Qté Vente</th><th class="com-table-th">Prix Vente</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Prix Solidaire</th></tr></thead><tbody><!-- BEGIN infoCommande --><tr><td class="com-table-td">{infoCommande.nproNom}</td><td class="com-table-td">{infoCommande.stoQuantite} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontant} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteLivraison} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantLivraison} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.stoQuantiteVente} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVente} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteVenteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVenteSolidaire} {sigleMonetaire}</td></tr><!-- END infoCommande --></tbody></table></div></div></div>';this.resumeMarche='<div id="contenu">{editerMenu}<div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Détail du Marché n°{numero}</div><div><div class="com-center" id="resultat-marche-archive"><span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Marché : {total} {sigleMonetaire}</span>    <span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Solidaire : {totalSolidaire} {sigleMonetaire}</span></div><table class="com-table" id="info-marche-archive"><thead><tr><th></th><th class="com-table-th ui-widget ui-widget-header" colspan="5">Achat</th><th class="com-table-th ui-widget ui-widget-header" colspan="4">Vente</th></tr><tr class="ui-widget ui-widget-header"><th class="com-table-th">Produit</th><th class="com-table-th">Qté Commande</th><th class="com-table-th">Prix Commande</th><th class="com-table-th">Qté Livraison</th><th class="com-table-th">Prix Livraison</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Qté Vente</th><th class="com-table-th">Prix Vente</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Prix Solidaire</th></tr></thead><tbody><!-- BEGIN infoCommande --><tr><td class="com-table-td">{infoCommande.nproNom}</td><td class="com-table-td">{infoCommande.stoQuantite} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontant} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteLivraison} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantLivraison} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.stoQuantiteVente} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVente} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteVenteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVenteSolidaire} {sigleMonetaire}</td></tr><!-- END infoCommande --></tbody></table></div></div></div>';this.produitIndisponible='<tr><td colspan="11">Le produit {nom} n\'est plus disponible.</td></tr>';this.lotUnique='<input type="hidden" id="lot-{IdPdt}" value="{valeur}" /><span>{text}</span>';this.editerMarcheListeProduit='<div id="liste-ferme"><!-- BEGIN fermes --><div class="com-widget-window ui-widget ui-widget-content ui-corner-all" id="ferme-{fermes.ferId}"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">{fermes.ferNom}</div><!-- BEGIN fermes.categories --><table class="com-table-100"><tr class="ui-widget-header" ><td class="com-table-td-debut">{fermes.categories.cproNom}</td><td class="com-table-td-med"></td><td class="com-table-td-med"></td><td class="com-table-td-med"></td><td class="com-table-td-fin"></td></tr><!-- BEGIN fermes.categories.produits --><tr><td class="com-table-td-debut">{fermes.categories.produits.nproNom}</td><td class="com-table-td-med edt-marche-pro-unite">{fermes.categories.produits.abonnement}</td><td class="com-table-td-med edt-marche-pro-unite">{fermes.categories.produits.qteReservation} {fermes.categories.produits.nproUnite}</td><td class="com-table-td-med td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-produit" title="Modifier" id-produit="{fermes.categories.produits.id}" typeProduit="{fermes.categories.produits.type}"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-produit" title="Supprimer" id-produit="{fermes.categories.produits.id}" qte-reservation="{fermes.categories.produits.qteReservation}" typeProduit="{fermes.categories.produits.type}" ><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END fermes.categories.produits --></table><!-- END fermes.categories --></div><!-- END fermes --></div>';"<!-- END fermes --></div>";this.dialogModifierInfoMarche='<div id="dialog-modif-pro" title="Produit"><div class="com-widget-content"><form id="formulaire-information-creation-commande"><table class="com-table-form"><tr><th class="com-table-form-th">Nom du Marché : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="nom" id="marche-nom" maxlength="100" value="{nom}"/></td></tr><tr><th class="com-table-form-th">Début des Réservations * : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-debut-reservation" id="marche-dateDebutReservation" value="{dateDebutReservation}"/></td><td class="com-table-form-td">à <select name="heure-debut-reservation" id="marche-timeDebutReservation" class="informations-marche" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><select name="minute-debut-reservation" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Fin des Réservations * : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-fin-reservation" id="marche-dateFinReservation" value="{dateFinReservation}"/></td><td class="com-table-form-td">à <select name="heure-fin-reservation" id="marche-timeFinReservation" class="informations-marche" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><select name="minute-fin-reservation" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Jour du marché * : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-debut" id="marche-dateMarcheDebut" value="{dateMarcheDebut}"/></td><td class="com-table-form-td">de <select name="heure-debut" id="marche-timeMarcheDebut" class="informations-marche"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><select name="minute-debut" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td><td class="com-table-form-td">à <select name="heure-fin" id="marche-timeMarcheFin" class="informations-marche"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><select name="minute-fin" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Description : </th><td class="com-table-form-td"><textarea class="com-input-text ui-widget-content ui-corner-all informations-marche" name="description" id="marche-description" >{comDescription}</textarea></td></tr></table></form></div></div>';this.dialogSupprimerProduit='<div id="dialog-supprimer-produit" title="Supprimer le produit du marché"><p>Des réservations sont présentes sur ce produit.<br/>Voulez-vous toujours le supprimer ?</p></div>';this.dialogInfoProduit='<div id="dialog-info-pro" title="Produit"><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Informations</div><div class="com-widget-content"><table class="com-table-form"><tr><th class="com-table-form-th">Nom : </th><td class="com-table-form-td">{nom}</td></tr><tr><th class="com-table-form-th">Catégorie : </th><td class="com-table-form-td">{cproNom}</td></tr><tr><th class="com-table-form-th">Description : </th><td class="com-table-form-td">{description}</td></tr></table></div></div><div id="pro-prdt"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Producteurs</div><table class="com-table-form"><!-- BEGIN producteurs --><tr><td class="com-table-form-td">{producteurs.prdtPrenom} {producteurs.prdtNom}</td></tr><!-- END producteurs --></table></div><div id="pro-car"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Caractéristiques</div><table class="com-table-form"><!-- BEGIN caracteristiques --><tr><td class="com-table-form-td">{caracteristiques.carNom}</td></tr><!-- END caracteristiques --></table></div></div>';this.listeFerme='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Fermes</div><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-underline-hover liste-adh-th-num com-cursor-pointer"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th-med com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Compte</th><th class="com-table-th-med com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th><th class="com-table-th-fin liste-adh-th-solde"></th></tr></thead><tbody><!-- BEGIN listeFerme --><tr class="com-cursor-pointer compte-ligne" data-id-compte-ferme="{listeFerme.ferIdCompte}"><td class="com-table-td-debut com-underline-hover"><span class="ui-helper-hidden">{listeFerme.ferIdTri}</span>{listeFerme.ferNumero}</td><td class="com-table-td-med com-underline-hover">{listeFerme.cptLabel}</td><td class="com-table-td-med com-underline-hover">{listeFerme.ferNom}</td><td class="com-table-td-fin com-underline-hover liste-adh-td-solde"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END listeFerme --></tbody></table></div></div>';this.listeFermeVide='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Fermes</div><p id="texte-liste-vide">Aucune ferme dans la base.</p></div></div>';this.listeStockProduitFermeEntete='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-retour"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour à la liste des fermes</button></div>{detail}</div>';this.listeStockProduitFermeDetail='<div class="achat com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Produits : {ferNom}</div><table class="com-table-100"><tr><td></td><td colspan="2"><div class="ui-widget-header ui-corner-all com-center">Stock</div></td><td colspan="2"><div class="ui-widget-header ui-corner-all com-center">Stock Solidaire</div></td><td colspan="2"><div class="ui-widget-header ui-corner-all com-center">Stock Total</div></td><td></td></tr><!-- BEGIN listeProduit --><tr><td><div class="ui-widget-header ui-corner-all com-center">{listeProduit.cproNom}</div></td><td colspan="7"></td></tr><!-- BEGIN listeProduit.produits --><tr class="com-ligne-hover"><td>{listeProduit.produits.nproNom}</td><td class="com-text-align-right"><span class="produit-{listeProduit.produits.stoQteId}" id="label-quantite-{listeProduit.produits.stoQteId}">{listeProduit.produits.stoQteQuantiteAffiche}</span><span class="ui-helper-hidden produit-{listeProduit.produits.stoQteId}"><input type="text" value="{listeProduit.produits.stoQteQuantite}" class="com-numeric com-input-text ui-widget-content ui-corner-all" id="{listeProduit.produits.stoQteId}-quantite" maxlength="12" size="3" data-id="{listeProduit.produits.stoQteId}" /></span></td><td>{listeProduit.produits.stoQteUnite}</td><td class="com-text-align-right"><span class="produit-{listeProduit.produits.stoQteId}" id="label-quantite-solidaire-{listeProduit.produits.stoQteId}">{listeProduit.produits.stoQteQuantiteSolidaireAffiche}</span><span class="ui-helper-hidden produit-{listeProduit.produits.stoQteId}"><input type="text" value="{listeProduit.produits.stoQteQuantiteSolidaire}" class="com-numeric com-input-text ui-widget-content ui-corner-all" id="{listeProduit.produits.stoQteId}-quantiteSolidaire" maxlength="12" size="3" data-id="{listeProduit.produits.stoQteId}" /></span></td><td>{listeProduit.produits.stoQteUnite}</td><td class="com-text-align-right"><span class="produit-{listeProduit.produits.stoQteId}"id="label-quantite-total-{listeProduit.produits.stoQteId}">{listeProduit.produits.stoQteQuantiteTotal}</span><span class="ui-helper-hidden produit-{listeProduit.produits.stoQteId}" id="label-quantite-total-edit-{listeProduit.produits.stoQteId}">{listeProduit.produits.stoQteQuantiteTotal}</span></td><td>{listeProduit.produits.stoQteUnite}</td><td>{listeProduit.produits.btnEdition}</td></tr><!-- END listeProduit.produits --><!-- END listeProduit --></table></div>';this.listeStockProduitFermeDetailBtnEdition='<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all btn-modif" id="btn-modif-{stoQteId}" title="Modifier" data-id="{stoQteId}"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden btn-annuler" id="btn-annuler-{stoQteId}" title="Annuler" data-id="{stoQteId}"><span class="ui-icon ui-icon-closethick"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden btn-check" id="btn-check-{stoQteId}" title="Valider" data-id="{stoQteId}"><span class="ui-icon ui-icon-check"></span></span>';this.listeStockProduitFermeDetailVide='<div class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Produits</div><p id="texte-liste-vide">Aucun produit pour cette ferme dans la base.</p></div>';this.rechercheListeFacture='<div id="contenu"><div class="com-barre-menu-2 ui-helper-hidden"><button class="ui-state-default ui-corner-top com-button" id="btn-retour"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour</button></div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Factures<span class="com-btn-header-text ui-widget-content ui-corner-all" id="btn-nv-facture" title="Ajouter une Facture"><span class="com-float-left ui-icon ui-icon-plusthick"></span>Ajouter</span></div><div id="form-recherche-liste-facture" class="com-center com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all">Entre le <input type="text" value="{dateDebut}" id="dateDebut" class="com-input-text ui-widget-content ui-corner-all"> et le <input type="text" value="{dateFin}" id="dateFin" class="com-input-text ui-widget-content ui-corner-all"> Marché <select id="idMarche" ><option value="0" >Tout</option><option value="-1" >Hors Marché</option><!-- BEGIN listeMarche --><option value="{listeMarche.id}">N° {listeMarche.numero}</option><!-- END listeMarche --></select><button type="button" id="btn-rechercher-liste-facture" class="ui-state-default ui-corner-all com-button com-center">Rechercher</button></div><div id="liste-facture" class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"></div></div>';this.listeFacture='<table class="com-table"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th-med com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Date</th><th class="com-table-th-med com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Marché</th>	<th class="com-table-th-med com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Ferme</th>	<th class="com-table-th-med com-center">Montant</th>	<th class="com-table-th-fin"></th></tr></thead><tbody><!-- BEGIN listeFacture --><tr><td class="com-table-td-debut">{listeFacture.valeur}</td><td class="com-table-td-med"><span class="ui-helper-hidden">{listeFacture.dateTri}</span>{listeFacture.date}</td><td class="com-table-td-med">{listeFacture.numero}</td><td class="com-table-td-med">{listeFacture.nom}</td><td class="com-table-td-med com-text-align-right">{listeFacture.montant} {sigleMonetaire}</td><td class="com-table-td-fin"><span data-id-facture="{listeFacture.id}" class="btn-afficher-facture com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END listeFacture --></tbody></table>';this.listeFactureNumeroMarche='<span class="ui-helper-hidden">{numero}</span>N°{numero}';this.listeFactureVide='<p id="texte-liste-vide">Aucune Facture.</p>';this.facture='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-retour"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour</button></div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all"><span class="entete-numero-facture" >Facture n°{numeroFacture}</span><span>Ferme : {listeFermeAffiche}</span><span class="ui-helper-hidden com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-facture" title="Exporter la facture"><span class="ui-icon ui-icon-print"></span></span></div><div id="liste-pdt"></div></div>';this.factureSelectFerme='<select id="select-ferme"><option value="0">== Choisir une ferme ==</option><!-- BEGIN listeFerme --><option value="{listeFerme.ferId}">{listeFerme.ferNom}</option><!-- END listeFerme --></select>';this.listeProduitFermeVide='<div id="liste-pdt" class="com-center com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all">Aucun produit pour cette ferme.</div>';this.listeProduitFerme='<div id="liste-pdt"><div id="facture-catalogue-produit" ><div id="form-affiche-paiement-facture" class="ui-helper-hidden com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><table ><thead><tr><td>Total</td><td><input type="text" name="montant-total" value="{montant}" class="com-numeric com-input-text ui-widget-content ui-corner-all" id="montant" maxlength="12" size="5"/> <span>{sigleMonetaire}</span></td></tr></thead><tbody><tr id="ligne-operation"><td>Paiement</td><td><select name="typepaiement" id="typePaiement"><option value="0">== Choisir ==</option><!-- BEGIN typePaiement --><option value="{typePaiement.id}">{typePaiement.type}</option><!-- END typePaiement --></select></td></tr>{champComplementaire}</tbody></table></div><div id="affiche-paiement-facture" class="ui-helper-hidden com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><table ><thead><tr><td>Total</td><td>{montantAffiche} {sigleMonetaire}</td></tr></thead><tbody><tr id="ligne-operation"><td>Paiement</td><td>{tppType}</td></tr>{champComplementaireAffiche}</table></div><div id="widget-catalogue-produit" class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form-produit"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right filter" name="filter-produit" id="filter-produit" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table" id="table-produit"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut">Ref.</th><th class="com-table-th-med">Nom</th><th class="com-table-th-fin td-edt"></th></tr></thead><tbody><!-- BEGIN listeProduit --><tr class="ui-widget-header"><th colspan="3" class="com-table-th">{listeProduit.nom}</th></tr><!-- BEGIN listeProduit.produits --><tr class="com-cursor-pointer"><td class="com-table-td-debut">{listeProduit.produits.nproNumero}</td><td class="com-table-td-med">{listeProduit.produits.nproNom}</td><td class="com-table-td-fin com-underline-hover td-edt"><span data-id-nom-produit="{listeProduit.produits.nproId}" class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-ajout-produit" title="Ajouter"><span class="ui-icon ui-icon-plusthick"></span></span></td></tr><!-- END listeProduit.produits --><!-- END listeProduit --></tbody></table></div></div><div id="facture-detail" class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all">{detailFacture}</div></div>';this.detailFactureVide='<div class="detail-facture com-center">Ajouter un produit.</div><div class="detail-facture ui-helper-hidden"><table class="com-table" id="table-detail-facture"><thead><tr><th class="facture-detail-ref">Ref.</th><th class="facture-detail-nom">Nom</th><th class="facture-detail-quantite">Quantite</th><th class="facture-detail-montant">Montant</th><th class="facture-detail-quantite">Solidaire</th><th></th></tr></thead><tbody></tbody></table><div class="com-center"><button type="button" id="btn-enregistrer-facture" class="ui-state-default ui-corner-all com-button com-center">Enregistrer</button><button type="button" id="btn-modifier-facture" class="ui-helper-hidden ui-state-default ui-corner-all com-button com-center">Modifier</button><button type="button" id="btn-supprimer-facture" class="ui-helper-hidden ui-state-default ui-corner-all com-button com-center">Supprimer</button><button type="button" id="btn-annuler-modifier-facture" class="ui-helper-hidden ui-state-default ui-corner-all com-button com-center">Annuler</button><button type="button" id="btn-enregistrer-modifier-facture" class="ui-helper-hidden ui-state-default ui-corner-all com-button com-center">Enregistrer</button></div></div>';this.champComplementaire='<!-- BEGIN champComplementaire --><tr class="champ-complementaire"><td>{champComplementaire.label}</td><td><input type="text" value="" class="com-input-text ui-widget-content ui-corner-all" id="champComplementaire{champComplementaire.id}valeur" data-id-champ-complementaire="{champComplementaire.id}" maxlength="50" size="15"/></td></tr><!-- END champComplementaire -->';this.listeProduitAffiche='<!-- BEGIN categorie --><tr id="cat-{categorie.cproId}"><th colspan="6" class="ui-widget-header">{categorie.cproNom}</th></tr><!-- BEGIN categorie.produits --><!-- BEGIN categorie.produits.produit --><tr id="stock-{categorie.produits.produit.compteurStock}" class="cat-{categorie.cproId} pro-{categorie.produits.produit.nproId} produit-detail-facture" data-compteur-stock="{categorie.produits.produit.compteurStock}" data-id-nom-produit="{categorie.produits.produit.nproId}" ><td>{categorie.produits.produit.nproNumero}</td><td>{categorie.produits.produit.nproNom}</td><td class="produit-detail-facture-stock" data-id-stock="{categorie.produits.produit.idStock}" ><span class="affiche-detail-facture"><span>{categorie.produits.produit.quantiteAffiche}</span> <span>{categorie.produits.produit.uniteAffiche}</span></span><span class="ui-helper-hidden affiche-detail-facture"><input type="text" value="{categorie.produits.produit.quantite}" class="com-numeric com-input-text ui-widget-content ui-corner-all" maxlength="12" size="3" id="produits{categorie.produits.produit.compteurStock}quantite" /> <span class="facture-detail-unite-span">{categorie.produits.produit.unite}</span></span></td><td class="produit-detail-facture-montant" data-id-detail-operation="{categorie.produits.produit.idDetailOperation}"><span class="affiche-detail-facture"><span>{categorie.produits.produit.montantAffiche}</span> <span>{categorie.produits.produit.sigleMonetaireAffiche}</span></span><span class="ui-helper-hidden affiche-detail-facture"><input type="text" value="{categorie.produits.produit.montant}" class="montant-produit com-numeric com-input-text ui-widget-content ui-corner-all" maxlength="12" size="3" id="produits{categorie.produits.produit.compteurStock}montant" />{categorie.produits.produit.sigleMonetaire}</span></td><td class="produit-detail-facture-stock-solidaire" data-id-stock-solidaire="{categorie.produits.produit.idStockSolidaire}"><span class="affiche-detail-facture"><span>{categorie.produits.produit.quantiteSolidaireAffiche}</span> <span>{categorie.produits.produit.uniteSolidaireAffiche}</span></span><span class="ui-helper-hidden affiche-detail-facture"><input type="text" value="{categorie.produits.produit.quantiteSolidaire}" class="com-numeric com-input-text ui-widget-content ui-corner-all" maxlength="12" size="3" id="produits{categorie.produits.produit.compteurStock}quantiteSolidaire" /> <span class="facture-detail-unite-span">{categorie.produits.produit.uniteSolidaire}</span></span></td><td class="td-edt"><span data-compteur-stock="{categorie.produits.produit.compteurStock}" data-id-categorie="{categorie.cproId}" data-id-nom-produit="{categorie.produits.produit.nproId}" class="ui-helper-hidden affiche-detail-facture com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-produit" title="Supprimer"><span class="ui-icon ui-icon-closethick"></span></span></td></tr><!-- END categorie.produits.produit --><!-- END categorie.produits --><!-- END categorie -->';this.categorieDetailFacture='<tr id="cat-{cproId}"><th colspan="6" class="ui-widget-header">{cproNom}</th></tr>';this.produitDetailFacture='<tr id="stock-{compteurStock}" class="cat-{cproId} pro-{nproId} produit-detail-facture" data-compteur-stock="{compteurStock}" data-id-nom-produit="{nproId}" ><td>{nproNumero}</td><td>{nproNom}</td><td class="produit-detail-facture-stock"><input type="text" value="" class="com-numeric com-input-text ui-widget-content ui-corner-all" maxlength="12" size="3" id="produits{compteurStock}quantite" /> <span class="facture-detail-unite-span">{unite}</span></td><td class="produit-detail-facture-montant"><input type="text" value="" class="montant-produit com-numeric com-input-text ui-widget-content ui-corner-all" maxlength="12" size="3" id="produits{compteurStock}montant" /> {sigleMonetaire}</td><td class="produit-detail-facture-stock-solidaire"><input type="text" value="" class="com-numeric com-input-text ui-widget-content ui-corner-all" maxlength="12" size="3" id="produits{compteurStock}quantiteSolidaire" /> <span class="facture-detail-unite-span">{uniteSolidaire}</span></td><td class="td-edt"><span data-compteur-stock="{compteurStock}" data-id-categorie="{cproId}" data-id-nom-produit="{nproId}" class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-produit" title="Supprimer"><span class="ui-icon ui-icon-closethick"></span></span></td></tr>';this.uniteDetailFactureSelect='<select class="facture-detail-unite" id="produits{compteurStock}unite{type}"><!-- BEGIN mLotUnite --><option value="{mLotUnite.unite}">{mLotUnite.unite}</option><!-- END mLotUnite --></select>';this.dialogSupprimerFacture='<div title="Supprimer la facture"><p>Voulez-vous supprimer cette facture ?</p></div>';this.rechercheListeAchat='<div id="contenu"><div class="com-barre-menu-2 ui-helper-hidden"><button class="ui-state-default ui-corner-top com-button" id="btn-retour"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour</button></div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Achats</div><div id="form-recherche-liste-achat" class="com-center com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all">Entre le <input type="text" value="{dateDebut}" id="dateDebut" class="com-input-text ui-widget-content ui-corner-all"> et le <input type="text" value="{dateFin}" id="dateFin" class="com-input-text ui-widget-content ui-corner-all"> Marché <select id="idMarche" ><option value="0" >Tout</option><option value="-1" >Hors Marché</option><!-- BEGIN listeMarche --><option value="{listeMarche.id}">N° {listeMarche.numero}</option><!-- END listeMarche --></select><button type="button" id="btn-rechercher-liste-achat" class="ui-state-default ui-corner-all com-button com-center">Rechercher</button></div><div id="liste-achat" class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"></div></div>';this.listeAchat='<table class="com-table"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Date</th><th class="com-table-th-med com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Marché</th>	<th class="com-table-th-med com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>N°</th>	<th class="com-table-th-med com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Compte</th>	<th class="com-table-th-med com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th>	<th class="com-table-th-med com-center com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Prénom</th>	<th class="com-table-th-med com-center">Montant</th>	<th class="com-table-th-fin"></th></tr></thead><tbody><!-- BEGIN listeAchat --><tr><td class="com-table-td-debut"><span class="ui-helper-hidden">{listeAchat.dateTri}</span>{listeAchat.date}</td><td class="com-table-td-med">{listeAchat.comNumero}</td><td class="com-table-td-med">{listeAchat.adhNumero}</td><td class="com-table-td-med">{listeAchat.cptLabel}</td><td class="com-table-td-med">{listeAchat.adhNom}</td><td class="com-table-td-med">{listeAchat.adhPrenom}</td><td class="com-table-td-med com-text-align-right">{listeAchat.montant} {sigleMonetaire}</td><td class="com-table-td-fin"><span data-id-achat="{listeAchat.opeId}" class="btn-afficher-achat com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END listeAchat --></tbody></table>';this.listeAchatNumeroMarche='<span class="ui-helper-hidden">{numero}</span>N°{numero}';this.listeAchatVide='<p id="texte-liste-vide">Aucun Achat.</p>'}function GestionListeCommandeVue(a){this.construct=function(b){$.history({vue:function(){GestionListeCommandeVue(b)}});var c=this;$.post("./index.php?m=GestionCommande&v=ListeCommande",function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var c=this;var b=new GestionCommandeTemplate();if(d.listeCommande.length>0&&d.listeCommande[0].comId!=null){var e=new Object;e.commande=new Array();$(d.listeCommande).each(function(){var g=new Object();g.id=this.comId;g.numero=this.comNumero;g.nom=this.comNom;g.jourFinReservation=jourSem(this.comDateFinReservation.extractDbDate());g.dateFinReservation=this.comDateFinReservation.extractDbDate().dateDbToFr();g.heureFinReservation=this.comDateFinReservation.extractDbHeure();g.minuteFinReservation=this.comDateFinReservation.extractDbMinute();g.jourMarcheDebut=jourSem(this.comDateMarcheDebut.extractDbDate());g.dateMarcheDebut=this.comDateMarcheDebut.extractDbDate().dateDbToFr();g.heureMarcheDebut=this.comDateMarcheDebut.extractDbHeure();g.minuteMarcheDebut=this.comDateMarcheDebut.extractDbMinute();g.heureMarcheFin=this.comDateMarcheFin.extractDbHeure();g.minuteMarcheFin=this.comDateMarcheFin.extractDbMinute();e.commande.push(g)});var f=b.listeCommandePage;$("#contenu").replaceWith(c.affect($(f.template(e))))}else{$("#contenu").replaceWith(c.affect($(b.listeCommandeVide)))}};this.affect=function(b){b=this.affectLienEditer(b);b=this.affectLienListeCommandeArchive(b);b=this.affectNouveauMarche(b);b=gCommunVue.comHoverBtn(b);return b};this.affectNouveauMarche=function(b){b.find("#btn-nv-marche").click(function(){AjoutCommandeVue()});return b};this.affectLienEditer=function(b){b.find(".btn-marche").click(function(){EditerCommandeVue({id_marche:$(this).attr("id")})});return b};this.affectLienListeCommandeArchive=function(b){b.find("#lien-marche-archive").click(function(){ListeCommandeArchiveVue()});return b};this.construct(a)}function StockProduitVue(a){this.construct=function(b){$.history({vue:function(){StockProduitVue(b)}});var c=this;b.fonction="detailFerme";$.post("./index.php?m=GestionCommande&v=StockProduit","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(h){var g=this;var c=new GestionCommandeTemplate();var b="";if(h.listeProduit.length>0&&h.listeProduit[0].cproNom!=null){var f=h.listeProduit[0].cproId;var e=h.listeProduit[0].cproNom;var d=[];var j=[];h.ferNom=h.listeProduit[0].ferNom;$(h.listeProduit).each(function(){if(this.stoQteQuantite!=null){this.stoQteQuantiteTotal=(parseFloat(this.stoQteQuantite)+parseFloat(this.stoQteQuantiteSolidaire)).toFixed(2).nombreFormate(2,","," ");this.stoQteQuantiteAffiche=this.stoQteQuantite.nombreFormate(2,","," ");this.stoQteQuantite=this.stoQteQuantite.nombreFormate(2,",","");this.stoQteQuantiteSolidaireAffiche=this.stoQteQuantiteSolidaire.nombreFormate(2,","," ");this.stoQteQuantiteSolidaire=this.stoQteQuantiteSolidaire.nombreFormate(2,",","");this.btnEdition=c.listeStockProduitFermeDetailBtnEdition.template({stoQteId:this.stoQteId})}else{this.stoQteQuantiteTotal="0".nombreFormate(2,","," ");this.stoQteQuantiteSolidaire="0".nombreFormate(2,","," ");this.stoQteQuantiteSolidaireAffiche=this.stoQteQuantiteSolidaire;this.stoQteQuantite="0".nombreFormate(2,","," ");this.stoQteQuantiteAffiche=this.stoQteQuantite;this.stoQteUnite="";this.btnEdition=""}if(f!=this.cproId){d.push({cproNom:e,produits:j});f=this.cproId;e=this.cproNom;j=[]}j.push(this)});d.push({cproNom:e,produits:j});h.listeProduit=d;b=c.listeStockProduitFermeDetail.template(h)}else{b=c.listeStockProduitFermeDetailVide}$("#contenu").replaceWith(g.affect($(c.listeStockProduitFermeEntete.template({detail:b}))))};this.affect=function(b){b=this.affectEdition(b);b=this.affectRetour(b);b=this.affectCalculTotal(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b,{allowNegatives:true});return b};this.affectRetour=function(b){b.find("#btn-retour").click(StockProduitListeFermeVue);return b};this.affectEdition=function(b){var c=this;b.find(".btn-modif, .btn-annuler").click(function(){var d=$(this).data("id");$(".produit-"+d+", #btn-modif-"+d+", #btn-annuler-"+d+", #btn-check-"+d).toggle()});b.find(".btn-check").click(function(){c.enregistrer($(this).data("id"))});return b};this.enregistrer=function(c){var b=new StockQuantiteVO();b.id=c;b.quantite=$("#"+c+"-quantite").val().numberFrToDb();b.quantiteSolidaire=$("#"+c+"-quantiteSolidaire").val().numberFrToDb();var d=new StockQuantiteValid();var e=d.validUpdate(b);Infobulle.init();if(e.valid){b.fonction="modifierStock";$.post("./index.php?m=GestionCommande&v=StockProduit","pParam="+$.toJSON(b),function(h){Infobulle.init();if(h){if(h&&h.valid){var k=parseFloat(b.quantite);if(isNaN(k)||k==""){k=0}var j=parseFloat(b.quantiteSolidaire);if(isNaN(j)||j==""){j=0}$("#label-quantite-total-"+c).text((k+j).toFixed(2).nombreFormate(2,","," "));$("#label-quantite-"+c).text(b.quantite.nombreFormate(2,","," "));$("#label-quantite-solidaire-"+c).text(b.quantiteSolidaire.nombreFormate(2,","," "));$(".produit-"+c+", #btn-modif-"+c+", #btn-annuler-"+c+", #btn-check-"+c).toggle();var f=new TemplateVR();f.valid=false;f.log.valid=false;var g=new VRerreur();g.code=ERR_361_CODE;g.message=ERR_361_MSG;f.log.erreurs.push(g);Infobulle.generer(f,"")}else{Infobulle.generer(h,c+"-")}}},"json")}else{Infobulle.generer(e,c+"-")}};this.affectCalculTotal=function(b){b.find(".com-ligne-hover :input").keyup(function(){var d=$(this).data("id");var e=parseFloat($("#"+d+"-quantite").val().numberFrToDb());if(isNaN(e)||e==""){e=0}var c=parseFloat($("#"+d+"-quantiteSolidaire").val().numberFrToDb());if(isNaN(c)||c==""){c=0}$("#label-quantite-total-edit-"+d).text((e+c).toFixed(2).nombreFormate(2,","," "))});return b};this.construct(a)}function ResumeMarcheVue(a){this.mIdMarche=0;this.construct=function(b){$.history({vue:function(){ResumeMarcheVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=ResumeMarche","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var e=this;var b=new GestionCommandeTemplate();var g=b.resumeMarche;c.infoMarcheSelected="";c.listeReservationSelected="";c.listeAchatSelected="";c.resumeMarcheSelected="ui-state-active";c.editerMenu=b.editerMarcheMenu.template(c);c.sigleMonetaire=gSigleMonetaire;var d=0;var f=0;$(c.infoCommande).each(function(){e.mIdMarche=this.comId;if(this.proType==1){this.nproNom+=" (Solidaire)"}else{if(this.proType==2){this.nproNom+=" (Abonnement)"}}if(this.stoQuantite==null){this.stoQuantite=0}if(this.opeMontant==null){this.opeMontant=0}if(this.stoQuantiteLivraison==null){this.stoQuantiteLivraison=0}if(this.opeMontantLivraison==null){this.opeMontantLivraison=0}if(this.stoQuantiteSolidaire==null){this.stoQuantiteSolidaire=0}if(this.stoQuantiteVente==null){this.stoQuantiteVente=0}if(this.opeMontantVente==null){this.opeMontantVente=0}if(this.stoQuantiteVenteSolidaire==null){this.stoQuantiteVenteSolidaire=0}if(this.opeMontantVenteSolidaire==null){this.opeMontantVenteSolidaire=0}d-=parseFloat(this.opeMontantLivraison);d+=parseFloat(this.opeMontantVente);f+=parseFloat(this.opeMontantVenteSolidaire);this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");this.opeMontant=this.opeMontant.nombreFormate(2,","," ");this.stoQuantiteLivraison=this.stoQuantiteLivraison.nombreFormate(2,","," ");this.opeMontantLivraison=this.opeMontantLivraison.nombreFormate(2,","," ");this.stoQuantiteSolidaire=this.stoQuantiteSolidaire.nombreFormate(2,","," ");this.stoQuantiteVente=this.stoQuantiteVente.nombreFormate(2,","," ");this.opeMontantVente=this.opeMontantVente.nombreFormate(2,","," ");this.stoQuantiteVenteSolidaire=this.stoQuantiteVenteSolidaire.nombreFormate(2,","," ");this.opeMontantVenteSolidaire=this.opeMontantVenteSolidaire.nombreFormate(2,","," ")});c.total=d.nombreFormate(2,","," ");c.totalSolidaire=f.nombreFormate(2,","," ");c.numero=c.detailMarche.numero;$("#contenu").replaceWith(e.affect($(g.template(c))))};this.affect=function(b){b=this.affectMenu(b);b=gCommunVue.comHoverBtn(b);return b};this.affectMenu=function(b){var c=this;b.find("#btn-information-marche").click(function(){EditerCommandeVue(c.mParam)});b.find("#btn-liste-achat-resa").click(function(){ListeAchatMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-liste-resa").click(function(){ListeReservationMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-resume-marche").click(function(){ResumeMarcheVue({id_marche:c.mIdMarche})});return b};this.construct(a)}function AjoutCommandeVue(a){this.mListeFerme={};this.mProduits=[];this.mMarche=new MarcheVO();this.mAffichageMarche=[];this.mNbProduit=0;this.mEditionLot=false;this.mIdLot=0;this.mIdLotAbonnement=0;this.mEtapeCreationMarche=0;this.construct=function(b){$.history({vue:function(){AjoutCommandeVue(b)}});var d={};d=$.extend(d,b);if(b&&b.fonction&&b.fonction=="dupliquer"){d.fonction="dupliquer"}else{d.fonction="afficher"}var c=this;$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(d),function(e){Infobulle.init();if(e){if(e.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}delete c.mProduits;c.mProduits=[];if(d.fonction=="dupliquer"){c.afficherDupliquer(e)}else{c.afficher(e)}}else{Infobulle.generer(e,"")}}},"json")};this.afficher=function(c){var d=this;this.mListeFerme=c.listeFerme;var b=new GestionCommandeTemplate();var e=b.formulaireAjoutMarche;$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affect=function(b){b=this.affectDialogAjoutProduit(b);b=this.affectControleDatepicker(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);return b};this.afficherDupliquer=function(c){var d=this;$.each(c.marche.produits,function(){if(this.id){var p=this.ferId;var o=this.idCategorie;var k=this.idNom;var j=this.type;var m=-1;var l="";if(parseFloat(this.stockInitial)!=-1&&j==2){m=this.stockInitial;l=this.stockInitial.nombreFormate(2,","," ")}var n=-1;if(parseFloat(this.qteMaxCommande)!=-1&&j==2){n=this.qteMaxCommande}var f=this.unite;var h={nproId:k,nproNom:this.nom,nproStock:l,nproQteMax:n,nproUnite:f,type:j,modelesLot:[],modelesLotReservation:[]};var g=new ProduitMarcheVO();g.idNom=k;g.unite=f;g.qteMaxCommande=n;g.qteRestante=m;g.type=j;$.each(this.lots,function(){var q=this.id;var r={id:q,taille:this.taille.nombreFormate(2,","," "),prix:this.prix.nombreFormate(2,","," "),unite:f,selected:true,modele:true};if(this.reservation){h.modelesLotReservation[q]=r}else{h.modelesLot[q]=r}var r=new DetailCommandeVO();r.id=q;r.taille=this.taille;r.prix=this.prix;g.lots.push(r)});if(!d.mAffichageMarche[p]){d.mAffichageMarche[p]={ferId:p,ferNom:this.ferNom,categories:[]}}if(!d.mAffichageMarche[p].categories[o]){d.mAffichageMarche[p].categories[o]={cproId:o,cproNom:this.cproNom,produits:[],produitsAbonnement:[]}}g.idFerme=p;g.idCategorie=o;if(j==2){d.mAffichageMarche[p].categories[o].produitsAbonnement[k]=h;d.mMarche.produitsAbonnement[k]=g}else{d.mAffichageMarche[p].categories[o].produits[k]=h;d.mMarche.produits[k]=g}d.mNbProduit++}});this.mListeFerme=c.listeFerme;var b=new GestionCommandeTemplate();var e=b.formulaireAjoutMarche;$("#contenu").replaceWith(d.affectDupliquer($(e.template(c))))};this.affectDupliquer=function(b){b=this.affectDialogAjoutProduit(b);b=this.affectControleDatepicker(b);b=this.majListeFerme(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);return b};this.affectDialogAjoutProduit=function(b){var c=this;b.find("#btn-ajout-produit").click(function(){var d=new GestionCommandeTemplate();var f=d.dialogAjoutProduitAjoutMarche;var e={listeFerme:c.mListeFerme};$(c.affectAjoutProduitSelectFerme($(f.template(e)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,position:"top",buttons:{Ajouter:function(){c.ajouterProduit($(this))},Annuler:function(){c.mEditionLot=false;$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})});return b};this.affectAjoutProduitSelectFerme=function(b){var c=this;b.find("#pro-idFerme select").change(function(){var e=$(this).val();$("#pro-idCategorie select, #pro-idProduit select").prop("disabled",true).selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');if(e>0){var d={fonction:"listeProduit",id:e};$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(d),function(j){if(j){if(j.valid){Infobulle.init();if(j.listeProduit.length>0&&j.listeProduit[0].nproId!=null){c.mProduits=[];var h=0;var l=[];$.each(j.listeProduit,function(){if(c.mProduits[this.cproId]){c.mProduits[this.cproId].listeProduit.push(this)}else{c.mProduits[this.cproId]={nom:this.cproNom,listeProduit:[this]}}if(h!=this.cproId){l.push({cproId:this.cproId,cproNom:this.cproNom});h=this.cproId}});var f=new GestionCommandeTemplate();var k=f.ajoutProduitSelectCategorie;$("#pro-idCategorie").replaceWith(c.affectAjoutProduitSelectCategorie($(k.template({listeCategorie:l}))))}else{var m=new TemplateVR();m.valid=false;m.log.valid=false;var g=new VRerreur();g.code=ERR_332_CODE;g.message=ERR_332_MSG;m.log.erreurs.push(g);Infobulle.generer(m,"")}}else{Infobulle.generer(j,"")}}},"json")}});return b};this.affectAjoutProduitSelectCategorie=function(b){var c=this;b.find("select").change(function(){var f=$(this).val();$("#pro-idProduit select").prop("disabled",true).selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');if(f>0){var d=new GestionCommandeTemplate();var e=d.ajoutProduitSelectProduit;$("#pro-idProduit").replaceWith(c.affectAjoutProduitSelectProduit($(e.template(c.mProduits[f]))))}});return b};this.affectAjoutProduitSelectProduit=function(b){var c=this;b.find("select").change(function(){var g=$(this).val();if(g>0){if(!c.mMarche.produits[g]||!c.mMarche.produitsAbonnement[g]){var e={fonction:"listeModeleLot",idNomProduit:g};$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(e),function(l){if(l){if(l.valid){Infobulle.init();if((!c.mMarche.produitsAbonnement[g]&&l.detailAbonnement.idNomProduit==g)||!c.mMarche.produits[g]){var h=new GestionCommandeTemplate();var k={sigleMonetaire:gSigleMonetaire};if($(l.modelesLot).length>0){k.modelesLot=[];$.each(l.modelesLot,function(){if(this.mLotId!=null){this.id=this.mLotId;this.quantite=this.mLotQuantite.nombreFormate(2,","," ");this.unite=this.mLotUnite;this.prix=this.mLotPrix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;k.modelesLot.push(this);k.unite=this.mLotUnite}})}if(l.detailAbonnement.idNomProduit==g){k.modelesLotAbonnement=[];k.modelesLotAbonnementReservation=[];k.uniteAbonnement=l.detailAbonnement.unite;$.each(l.detailAbonnement.lots,function(){this.quantite=this.taille.nombreFormate(2,","," ");this.unite=k.uniteAbonnement;this.prix=this.prix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;if(this.reservation){k.modelesLotAbonnementReservation.push(this)}else{k.modelesLotAbonnement.push(this)}})}if(c.mMarche.produits[g]){k.typeNormalSelected='disabled="disabled"';k.typeSolidaireSelected='disabled="disabled"';k.typeAbonnementSelected='checked="checked"';k.visibleSolidaire="ui-helper-hidden";k.visibleNormal="ui-helper-hidden";k.visibleAbonnement=""}else{if(c.mMarche.produitsAbonnement[g]){k.typeNormalSelected='checked="checked"';k.typeAbonnementSelected='disabled="disabled"';k.visibleSolidaire="";k.visibleNormal="";k.visibleAbonnement="ui-helper-hidden"}else{k.typeNormalSelected='checked="checked"';k.visibleSolidaire="";k.visibleNormal="";k.visibleAbonnement="ui-helper-hidden"}}if(l.detailAbonnement.idNomProduit==g){k.stockInitialAbonnement=l.detailAbonnement.stockInitial.nombreFormate(2,","," ");if(parseFloat(l.detailAbonnement.max)==-1){k.qMaxAbonnement="Pas de limite"}else{k.qMaxAbonnement=l.detailAbonnement.max.nombreFormate(2,","," ")+" "+k.uniteAbonnement}k.qMaxAbonnementValue=l.detailAbonnement.max;k.typeProduitAbonnement=h.typeProduitAbonnementAjoutProduit.template(k);k.divLotAbonnement=h.prixAbonnementAjoutProduit.template(k);k.divStockAbonnement=h.stockAbonnementAjoutProduit.template(k)}k.divTypeProduit=h.typeProduitAjoutProduit.template(k);k.divLot=h.prixAjoutProduit.template(k);k.divStock=h.stockAjoutProduit.template(k);var n=h.prixEtStockAjoutProduit;$("#prix-stock-produit").replaceWith(c.affectPrixEtStock($(n.template(k))))}else{var m=new Object();var j=new VRerreur();j.code=ERR_211_CODE;j.message=ERR_211_MSG;m.valid=false;m.log=new VRelement();m.log.valid=false;m.log.erreurs.push(j);Infobulle.generer(m,"")}}else{Infobulle.generer(l,"")}}},"json")}else{var f=new Object();var d=new VRerreur();d.code=ERR_211_CODE;d.message=ERR_211_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(d);Infobulle.generer(f,"")}}else{$("#prix-stock-produit").replaceWith($('<div id="prix-stock-produit">'))}});return b};this.affectPrixEtStock=function(b){b=this.affectAjoutLotGestion(b);b=this.affectAjoutLotAbonnementGestion(b);b=this.affectAjoutLot(b);b=this.affectLimiteStock(b);b=this.affectChangeTypeProduit(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectChangeTypeProduit=function(b){var c=this;b.find(":input[name=typeProduit]").click(function(){return c.testChangeTypeProduit()}).change(function(){c.changeTypeProduit($(":input[name=typeProduit]:checked").val())});return b};this.testChangeTypeProduit=function(){if(this.mEditionLot){var c=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;c.valid=false;c.log=new VRelement();c.log.valid=false;c.log.erreurs.push(b);Infobulle.generer(c,"");return false}return true};this.changeTypeProduit=function(c){if(!this.mEditionLot){$(".pro-detail").hide();if(c==0){$("#pro-normal,#id-stock").show()}else{if(c==1){$("#pro-normal").show()}else{$("#pro-abonnement").show()}}}else{var d=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;d.valid=false;d.log=new VRelement();d.log.valid=false;d.log.erreurs.push(b);Infobulle.generer(d,"");return false}};this.affectLimiteStock=function(b){b.find(":input[name=pro-stock-choix]").change(function(){if($(":input[name=pro-stock-choix]:checked").val()==1){$(":input[name=pro-stock]").prop("disabled",false).val("")}else{$(":input[name=pro-stock]").prop("disabled",true).val("")}});b.find(":input[name=pro-qte-max-choix]").change(function(){if($(":input[name=pro-qte-max-choix]:checked").val()==1){$(":input[name=pro-qte-max]").prop("disabled",false).val("")}else{$(":input[name=pro-qte-max]").prop("disabled",true).val("")}});return b};this.affectAjoutLot=function(b){var c=this;b.find("#btn-ajout-lot").click(function(){c.ajoutLot(1)});b.find("#table-pro-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(1)}});b.find("#btn-ajout-lot-abonnement").click(function(){c.ajoutLot(2)});b.find("#table-pro-abonnement-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(2)}});return b};this.ajoutLot=function(d){var c=new ModeleLotVO();if(d==1){c.quantite=$(":input[name=lot-quantite]").val().numberFrToDb();c.unite=$(":input[name=lot-unite]").val();c.prix=$(":input[name=lot-prix]").val().numberFrToDb()}else{c.quantite=$(":input[name=lot-abo-quantite]").val().numberFrToDb();c.unite=$("#pro-abo-lot-unite").text();c.prix=$(":input[name=lot-abo-prix]").val().numberFrToDb()}var e=new ModeleLotValid();var g=e.validAjout(c);if(g.valid){Infobulle.init();var b=new GestionCommandeTemplate();if(d==1){var f=b.modeleLot;this.mIdLot--;c.id=this.mIdLot;c.sigleMonetaire=gSigleMonetaire;c.quantite=c.quantite.nombreFormate(2,","," ");c.prix=c.prix.nombreFormate(2,","," ");$("#lot-liste").append(this.affectLot($(f.template(c))));$(":input[name=lot-quantite], :input[name=lot-unite], :input[name=lot-prix]").val("")}else{var f=b.modeleLotAbonnement;this.mIdLotAbonnement--;c.id=this.mIdLotAbonnement;c.sigleMonetaire=gSigleMonetaire;c.quantite=c.quantite.nombreFormate(2,","," ");c.prix=c.prix.nombreFormate(2,","," ");$("#lot-liste-abonnement").append(this.affectLotAbonnement($(f.template(c))));$(":input[name=lot-abo-quantite], :input[name=lot-abo-unite], :input[name=lot-abo-prix]").val("")}}else{if(d==1){Infobulle.generer(g,"pro-lot-")}else{Infobulle.generer(g,"pro-abo-lot-")}}};this.affectLot=function(b){b=this.affectAjoutLotGestion(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectLotAbonnement=function(b){b=this.affectAjoutLotAbonnementGestion(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectAjoutLotGestion=function(b){var c=this;b.find(".btn-modifier-lot").click(function(){c.ajoutLotModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot").click(function(){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot").click(function(){c.ajoutLotAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot").click(function(){c.ajoutLotSupprimer($(this).closest("tr").find("#id-lot").text())});b.find(":checkbox").change(function(){if(!c.majUnite()){if($(this).prop("checked")){$(this).prop("checked",false)}else{$(this).prop("checked",true)}}});return b};this.affectAjoutLotAbonnementGestion=function(b){var c=this;b.find(".btn-modifier-lot-abonnement").click(function(){c.ajoutLotAbonnementModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot-abonnement").click(function(){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot-abonnement").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot-abonnement").click(function(){c.ajoutLotAbonnementAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot-abonnement").click(function(){c.ajoutLotAbonnementSupprimer($(this).closest("tr").find("#id-lot").text())});return b};this.majUnite=function(){var d=true;var c=0;var e="";$(".ligne-lot :checkbox:checked").each(function(){var g=$(this).closest(".ligne-lot").find(".lot-unite").text();if(e!=""&&e!=g){d=false}else{e=g}c++});if(d){if(c>0){$(".unite-stock").text(e)}}else{var f=new Object();var b=new VRerreur();b.code=ERR_333_CODE;b.message=ERR_333_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(b);Infobulle.generer(f,"")}return d};this.ajoutLotModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();$("#pro-lot-"+b+"-quantite").val($("#lot-"+b+"-quantite").text().numberFrToDb().nombreFormate(2,",",""));$("#pro-lot-"+b+"-unite").val($("#lot-"+b+"-unite").text());$("#pro-lot-"+b+"-prix").val($("#lot-"+b+"-prix").text().numberFrToDb().nombreFormate(2,",",""));this.mEditionLot=true};this.ajoutLotAbonnementModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();$("#pro-lot-abonnement"+b+"-quantite").val($("#lot-"+b+"-quantite-abonnement").text().numberFrToDb().nombreFormate(2,",",""));$("#pro-lot-abonnement"+b+"-unite").val($("#lot-"+b+"-unite-abonnement").text());$("#pro-lot-abonnement"+b+"-prix").val($("#lot-"+b+"-prix-abonnement").text().numberFrToDb().nombreFormate(2,",",""));this.mEditionLot=true};this.ajoutLotValiderModification=function(c){var b=new ModeleLotVO();b.quantite=$("#pro-lot-"+c+"-quantite").val().numberFrToDb();b.unite=$("#pro-lot-"+c+"-unite").val();b.prix=$("#pro-lot-"+c+"-prix").val().numberFrToDb();var d=new ModeleLotValid();var e=d.validAjout(b);if(e.valid){Infobulle.init();$("#lot-"+c+"-quantite").text(b.quantite.nombreFormate(2,","," "));$("#lot-"+c+"-unite").text(b.unite);$("#lot-"+c+"-prix").text(b.prix.nombreFormate(2,","," "));$(".btn-lot, #btn-annuler-lot-"+c+", #btn-valider-lot-"+c+", .champ-lot-"+c).toggle();this.mEditionLot=false;this.majUnite()}else{Infobulle.generer(e,"pro-lot-"+c+"-")}};this.ajoutLotAbonnementValiderModification=function(c){var b=new ModeleLotVO();b.quantite=$("#pro-lot-abonnement"+c+"-quantite").val().numberFrToDb();b.unite=$("#pro-lot-abonnement"+c+"-unite").val();b.prix=$("#pro-lot-abonnement"+c+"-prix").val().numberFrToDb();var d=new ModeleLotValid();var e=d.validAjout(b);if(e.valid){Infobulle.init();$("#lot-"+c+"-quantite-abonnement").text(b.quantite.nombreFormate(2,","," "));$("#lot-"+c+"-unite-abonnement").text(b.unite);$("#lot-"+c+"-prix-abonnement").text(b.prix.nombreFormate(2,","," "));$(".btn-lot-abonnement, #btn-annuler-lot-"+c+"-abonnement, #btn-valider-lot-"+c+"-abonnement, .champ-lot-"+c+"-abonnement").toggle();this.mEditionLot=false}else{Infobulle.generer(e,"pro-lot-abonnement"+c+"-")}};this.ajoutLotAnnulerModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();this.mEditionLot=false};this.ajoutLotAbonnementAnnulerModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();this.mEditionLot=false};this.ajoutLotSupprimer=function(b){$("#ligne-lot-"+b).remove()};this.ajoutLotAbonnementSupprimer=function(b){$("#ligne-lot-abonnement-"+b).remove()};this.ajouterProduit=function(k){var h=this;if(!this.mEditionLot){var r=k.find(":input[name=ferme]").val();var p=k.find(":input[name=categorie]").val();var f=k.find(":input[name=produit]").val();var e=k.find(":input[name=typeProduit]:checked").val();if(f!=0){var o=0;if(e==2){o=k.find("#stock-abonnement").text().numberFrToDb()}else{o=k.find(":input[name=pro-stock]").val().numberFrToDb()}if(k.find(":input[name=pro-stock-choix]:checked").val()==1&&o==""&&e==0){var s=new Object();var m=new VRerreur();m.code=ERR_201_CODE;m.message=ERR_201_MSG;s.valid=false;s.qteRestante=new VRelement();s.qteRestante.valid=false;s.qteRestante.erreurs.push(m);Infobulle.generer(s,"pro-")}else{var n=0;if(e==2){n=k.find("#max-abonnement").text().numberFrToDb()}else{if(e==0){n=k.find(":input[name=pro-qte-max]").val().numberFrToDb()}}if(k.find(":input[name=pro-qte-max-choix]:checked").val()==1&&n==""&&e==0){var s=new Object();var m=new VRerreur();m.code=ERR_201_CODE;m.message=ERR_201_MSG;s.valid=false;s.qteMaxCommande=new VRelement();s.qteMaxCommande.valid=false;s.qteMaxCommande.erreurs.push(m);Infobulle.generer(s,"pro-")}else{var b="";if(e==2){b=k.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{b=k.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}if(e==2&&this.mMarche.produitsAbonnement[f]){var s=new Object();var m=new VRerreur();m.code=ERR_253_CODE;m.message=ERR_253_MSG;s.valid=false;s.qteMaxCommande=new VRelement();s.qteMaxCommande.valid=false;s.qteMaxCommande.erreurs.push(m);Infobulle.generer(s,"pro-")}else{if(e<2&&this.mMarche.produits[f]){var s=new Object();var m=new VRerreur();m.code=ERR_211_CODE;m.message=ERR_211_MSG;s.valid=false;s.qteMaxCommande=new VRelement();s.qteMaxCommande.valid=false;s.qteMaxCommande.erreurs.push(m);Infobulle.generer(s,"pro-")}else{var l="";if(o!=""){l=o}else{o=-1}var g="";if(n!=""){g=n}else{n=-1}var d={nproId:f,nproNom:k.find(":input[name=produit] option:selected").text(),nproStock:l,nproQteMax:g,nproUnite:b,type:e,modelesLot:[],modelesLotReservation:[]};if(e==2){k.find(".ligne-lot-abonnement :checkbox").each(function(){var t=false;if($(this).hasClass("modele-lot")){t=true}var x=false;if($(this).hasClass("modele-lot-reservation")){x=true}var v=false;if($(this).prop("checked")){v=true}if(t||v){var u=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();var w={id:u,taille:$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot-abonnement").find(".lot-unite").text(),selected:v,modele:t};if(x){d.modelesLotReservation[u]=w}else{d.modelesLot[u]=w}}})}else{k.find(".ligne-lot :checkbox").each(function(){var t=false;if($(this).hasClass("modele-lot")){t=true}var v=false;if($(this).prop("checked")){v=true}if(t||v){var u=$(this).closest(".ligne-lot").find(".lot-id").text();var w={id:u,taille:$(this).closest(".ligne-lot").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot").find(".lot-unite").text(),selected:v,modele:t};d.modelesLot[u]=w}})}if(!this.mAffichageMarche[r]){this.mAffichageMarche[r]={ferId:r,ferNom:k.find(":input[name=ferme] option:selected").text(),categories:[]}}if(!this.mAffichageMarche[r].categories[p]){this.mAffichageMarche[r].categories[p]={cproId:p,cproNom:k.find(":input[name=categorie] option:selected").text(),produits:[],produitsAbonnement:[]}}var c=new ProduitMarcheVO();c.idNom=f;c.unite=b;c.qteMaxCommande=n;c.qteRestante=o;c.type=e;if(e==2){k.find(".ligne-lot-abonnement :checkbox:checked").each(function(){var u=new DetailCommandeVO();var t=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();if(t>0){u.id=t}u.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();u.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();c.lots.push(u)})}else{k.find(".ligne-lot :checkbox:checked").each(function(){var t=new DetailCommandeVO();t.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();t.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();c.lots.push(t)})}c.idFerme=r;c.idCategorie=p;if(e==1){c.qteMaxCommande=-1;c.qteRestante=-1}var q=new ProduitMarcheValid();var j=q.validAjout(c);if(j.valid){Infobulle.init();if(e==2){this.mMarche.produitsAbonnement[f]=c;this.mAffichageMarche[r].categories[p].produitsAbonnement[f]=d}else{this.mMarche.produits[f]=c;this.mAffichageMarche[r].categories[p].produits[f]=d}this.mNbProduit++;h.majListeFerme();k.dialog("close")}else{if(e==2){Infobulle.generer(j,"pro-abo-")}else{Infobulle.generer(j,"pro-")}}}}}}}}else{var s=new Object();var m=new VRerreur();m.code=ERR_112_CODE;m.message=ERR_112_MSG;s.valid=false;s.log=new VRelement();s.log.valid=false;s.log.erreurs.push(m);Infobulle.generer(s,"")}};this.majListeFerme=function(d){var e=this;var b=new GestionCommandeTemplate();var f=[];$(e.mAffichageMarche).each(function(){if(this.ferId){var h=[];$(this.categories).each(function(){if(this.cproId){var j=[];$(this.produits).each(function(){if(this.nproId){j.push([this.nproNom,this.nproId,this.type])}});$(this.produitsAbonnement).each(function(){if(this.nproId){j.push([this.nproNom,this.nproId,this.type])}});j.sort(sortABC);h.push([this.cproNom,this.cproId,j])}});h.sort(sortABC);f.push([this.ferNom,this.ferId,h])}});f.sort(sortABC);var c={fermes:[]};$(f).each(function(j,m){var n=m[1];var l=m[2];if(e.mAffichageMarche[n]){var k=false;var h={ferId:e.mAffichageMarche[n].ferId,ferNom:e.mAffichageMarche[n].ferNom,categories:[]};$(l).each(function(o,s){var p=s[1];var t=s[2];if(e.mAffichageMarche[n].categories[p]){var r=false;var q={cproId:e.mAffichageMarche[n].categories[p].cproId,cproNom:e.mAffichageMarche[n].categories[p].cproNom,produits:[]};$(t).each(function(w,y){var x=y[1];var v=y[2];var u="";if(v==2){u=b.flagAbonnement;if(e.mAffichageMarche[n].categories[p].produitsAbonnement[x]){q.produits.push({nproId:e.mAffichageMarche[n].categories[p].produitsAbonnement[x].nproId,nproNom:e.mAffichageMarche[n].categories[p].produitsAbonnement[x].nproNom,type:v,abonnement:u});k=true;r=true}}else{if(e.mAffichageMarche[n].categories[p].produits[x].type==1){u=b.flagSolidaire}if(e.mAffichageMarche[n].categories[p].produits[x]){q.produits.push({nproId:e.mAffichageMarche[n].categories[p].produits[x].nproId,nproNom:e.mAffichageMarche[n].categories[p].produits[x].nproNom,type:v,abonnement:u});k=true;r=true}}});if(r){h.categories.push(q)}}});if(k){c.fermes.push(h)}}});var g=b.ajoutMarcheListeProduit;if(d){d.find("#liste-ferme").replaceWith(this.affectListeProduit($(g.template(c))))}else{$("#liste-ferme").replaceWith(this.affectListeProduit($(g.template(c))))}if(this.mNbProduit>0){if($("#btn-gestion-marche").length<1){if(d){d.find("#liste-ferme").after(this.affectCeerMarche($(b.btnValiderAjoutMarche)))}else{$("#liste-ferme").after(this.affectCeerMarche($(b.btnValiderAjoutMarche)))}}}else{if(d){d.find("#btn-gestion-marche").remove()}else{$("#btn-gestion-marche").remove()}}if(d){return d}};this.affectListeProduit=function(b){b=this.affectModifierProduit(b);b=this.affectSupprimerProduit(b);b=gCommunVue.comHoverBtn(b);return b};this.affectModifierProduit=function(b){var c=this;b.find(".btn-modifier-produit").click(function(){c.dialogModifierProduit($(this).attr("id-produit"),$(this).attr("typeProduit"))});return b};this.dialogModifierProduit=function(j,e){var h=this;var c=new GestionCommandeTemplate();var f={};if(e==0||e==1){var m=this.mMarche.produits[j].idFerme;var l=this.mMarche.produits[j].idCategorie;f={ferId:m,ferNom:this.mAffichageMarche[m].ferNom,cproId:l,cproNom:this.mAffichageMarche[m].categories[l].cproNom,nproId:j,nproNom:this.mAffichageMarche[m].categories[l].produits[j].nproNom,nproStock:this.mAffichageMarche[m].categories[l].produits[j].nproStock.nombreFormate(2,",",""),nproQteMax:this.mAffichageMarche[m].categories[l].produits[j].nproQteMax.nombreFormate(2,",",""),modelesLot:[]};for(i in this.mAffichageMarche[m].categories[l].produits[j].modelesLot){var k=this.mAffichageMarche[m].categories[l].produits[j].modelesLot[i];if(k.id){var g={id:k.id,quantite:k.taille,prix:k.prix,unite:k.unite,sigleMonetaire:gSigleMonetaire};if(k.selected){g.checked='checked="checked"';f.unite=k.unite}else{g.checked=""}if(k.modele){g.modele="modele-lot"}else{g.modele=""}f.modelesLot.push(g)}}if(this.mMarche.produits[j].qteRestante==-1){f.nproStockCheckedNoLimit='checked="checked"';f.nproStockDisabled='disabled="disabled"';f.nproStock=""}else{f.nproStockCheckedLimit='checked="checked"'}if(this.mMarche.produits[j].qteMaxCommande==-1){f.nproQteMaxCheckedNoLimit='checked="checked"';f.nproQteMaxDisabled='disabled="disabled"';f.nproQteMax=""}else{f.nproQteMaxCheckedLimit='checked="checked"'}if(e==0){f.typeSolidaireSelected="";f.typeNormalSelected='checked="checked"';f.visibleSolidaire=""}else{f.typeSolidaireSelected='checked="checked"';f.typeNormalSelected="";f.visibleSolidaire="ui-helper-hidden"}f.divStock=c.stockModifProduit.template(f);f.divLot=c.prixModifProduit.template(f)}else{var m=this.mMarche.produitsAbonnement[j].idFerme;var l=this.mMarche.produitsAbonnement[j].idCategorie;f={ferId:m,ferNom:this.mAffichageMarche[m].ferNom,cproId:l,cproNom:this.mAffichageMarche[m].categories[l].cproNom,nproId:j,nproNom:this.mAffichageMarche[m].categories[l].produitsAbonnement[j].nproNom,stockInitialAbonnement:this.mAffichageMarche[m].categories[l].produitsAbonnement[j].nproStock.nombreFormate(2,","," "),modelesLotAbonnement:[],modelesLotAbonnementReservation:[]};for(i in this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLot){var k=this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLot[i];if(k.id){var g={id:k.id,quantite:k.taille,prix:k.prix,unite:k.unite,sigleMonetaire:gSigleMonetaire};if(k.selected){g.checked='checked="checked"';f.uniteAbonnement=k.unite}else{g.checked=""}if(k.modele){g.modele="modele-lot"}else{g.modele=""}f.modelesLotAbonnement.push(g)}}for(i in this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLotReservation){var k=this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLotReservation[i];if(k.id){var g={id:k.id,quantite:k.taille,prix:k.prix,unite:k.unite,sigleMonetaire:gSigleMonetaire};if(k.selected){g.checked='checked="checked"';f.uniteAbonnement=k.unite}else{g.checked=""}if(k.modele){g.modele="modele-lot"}else{g.modele=""}f.modelesLotAbonnementReservation.push(g)}}var b=this.mAffichageMarche[m].categories[l].produitsAbonnement[j].nproQteMax;if(parseFloat(b)==-1){f.qMaxAbonnement="Pas de limite"}else{f.qMaxAbonnement=b.nombreFormate(2,","," ")+" "+f.uniteAbonnement}f.qMaxAbonnementValue=b;f.divStock=c.stockAbonnementAjoutProduit.template(f);f.typeProduitLabel=c.typeProduitLabelAbonnement;f.divLot=c.prixAbonnementModifProduit.template(f)}var d=c.dialogModifProduitAjoutMarche;if(e==0||e==1){f.typeProduitLabel=c.typeProduitLabelFormulaire.template(f)}$(h.affectPrixEtStock($(d.template(f)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Modifier:function(){h.modifierProduit($(this),e)},Annuler:function(){h.mEditionLot=false;$(this).dialog("close")}},close:function(n,o){$(this).remove();Infobulle.init()}})};this.modifierProduit=function(j,f){var g=this;if(!this.mEditionLot){var q=j.find("#pro-idFerme").attr("id-ferme");var o=j.find("#pro-idCategorie").attr("id-categorie");var e=j.find("#pro-idProduit").attr("id-produit");if(f==0||f==1){f=j.find(":input[name=typeProduit]:checked").val()}var m=0;if(f==2){m=j.find("#stock-abonnement").text().numberFrToDb()}else{if(f==0){m=j.find(":input[name=pro-stock]").val().numberFrToDb()}}if(j.find(":input[name=pro-stock-choix]:checked").val()==1&&m==""&&f==0){var r=new Object();var k=new VRerreur();k.code=ERR_201_CODE;k.message=ERR_201_MSG;r.valid=false;r.qteRestante=new VRelement();r.qteRestante.valid=false;r.qteRestante.erreurs.push(k);Infobulle.generer(r,"pro-")}else{var l=0;if(f==0){l=j.find(":input[name=pro-qte-max]").val().numberFrToDb()}else{if(f==2){l=j.find("#max-abonnement").text().numberFrToDb()}}if(j.find(":input[name=pro-qte-max-choix]:checked").val()==1&&l==""&&f==0){var r=new Object();var k=new VRerreur();k.code=ERR_201_CODE;k.message=ERR_201_MSG;r.valid=false;r.qteMaxCommande=new VRelement();r.qteMaxCommande.valid=false;r.qteMaxCommande.erreurs.push(k);Infobulle.generer(r,"pro-")}else{var b="";if(f==2){b=j.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{b=j.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}if(m==""){m=-1}if(l==""){l=-1}var n="";if(f==2){n=this.mAffichageMarche[q].categories[o].produitsAbonnement[e].nproNom}else{n=this.mAffichageMarche[q].categories[o].produits[e].nproNom}var d={nproId:e,nproNom:n,nproStock:m,nproQteMax:l,nproUnite:b,type:f,modelesLot:[],modelesLotReservation:[]};if(f==2){j.find(".ligne-lot-abonnement :checkbox").each(function(){var s=false;if($(this).hasClass("modele-lot")){s=true}var w=false;if($(this).hasClass("modele-lot-reservation")){w=true}var u=false;if($(this).prop("checked")){u=true}if(s||u){var t=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();var v={id:t,taille:$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot-abonnement").find(".lot-unite").text(),selected:u,modele:s};if(w){d.modelesLotReservation[t]=v}else{d.modelesLot[t]=v}}})}else{j.find(".ligne-lot :checkbox").each(function(){var s=false;if($(this).hasClass("modele-lot")){s=true}var u=false;if($(this).prop("checked")){u=true}if(s||u){var t=$(this).closest(".ligne-lot").find(".lot-id").text();var v={id:t,taille:$(this).closest(".ligne-lot").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot").find(".lot-unite").text(),selected:u,modele:s};d.modelesLot[t]=v}})}var c=new ProduitMarcheVO();c.idNom=e;c.unite=b;c.qteMaxCommande=l;c.qteRestante=m;c.type=f;if(f==2){j.find(".ligne-lot-abonnement :checkbox:checked").each(function(){var t=new DetailCommandeVO();var s=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();if(s>0){t.id=s}t.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();t.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();c.lots.push(t)})}else{j.find(".ligne-lot :checkbox:checked").each(function(){var s=new DetailCommandeVO();s.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();s.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();c.lots.push(s)})}if(f==1){c.qteMaxCommande=-1;c.qteRestante=-1}c.idFerme=q;c.idCategorie=o;var p=new ProduitMarcheValid();var h=p.validAjout(c);if(h.valid){Infobulle.init();if(f==2){this.mMarche.produitsAbonnement[e]=c;this.mAffichageMarche[q].categories[o].produitsAbonnement[e]=d}else{this.mMarche.produits[e]=c;this.mAffichageMarche[q].categories[o].produits[e]=d}g.majListeFerme();j.dialog("close")}else{if(f==2){Infobulle.generer(h,"pro-abo-")}else{Infobulle.generer(h,"pro-")}}}}}else{var r=new Object();var k=new VRerreur();k.code=ERR_112_CODE;k.message=ERR_112_MSG;r.valid=false;r.log=new VRelement();r.log.valid=false;r.log.erreurs.push(k);Infobulle.generer(r,"")}};this.affectSupprimerProduit=function(b){var c=this;b.find(".btn-supprimer-produit").click(function(){c.supprimerProduit($(this).attr("id-produit"),$(this).attr("typeProduit"))});return b};this.supprimerProduit=function(c,b){if(b==0||b==1){var e=this.mMarche.produits[c].idFerme;var d=this.mMarche.produits[c].idCategorie;this.mMarche.produits.splice(c,1,null);this.mAffichageMarche[e].categories[d].produits.splice(c,1,null)}else{var e=this.mMarche.produitsAbonnement[c].idFerme;var d=this.mMarche.produitsAbonnement[c].idCategorie;this.mMarche.produitsAbonnement.splice(c,1,null);this.mAffichageMarche[e].categories[d].produitsAbonnement.splice(c,1,null)}this.mNbProduit--;this.majListeFerme()};this.affectCeerMarche=function(b){var c=this;b.find("#btn-creer-marche").click(function(){c.creerMarche()});b.find("#btn-modifier-creation-commande").click(function(){c.editerMarche()});return b};this.creerMarche=function(){var f=this;if(!this.mEditionLot){this.mMarche.nom=$(":input[name=nom]").val();this.mMarche.description=$(":input[name=description]").val();this.mMarche.dateMarcheDebut=$(":input[name=date-debut]").val().dateFrToDb();this.mMarche.timeMarcheDebut=$(":input[name=heure-debut]").val()+":"+$(":input[name=minute-debut]").val()+":00";this.mMarche.dateMarcheFin=$(":input[name=date-debut]").val().dateFrToDb();this.mMarche.timeMarcheFin=$(":input[name=heure-fin]").val()+":"+$(":input[name=minute-fin]").val()+":00";this.mMarche.dateDebutReservation=$(":input[name=date-debut-reservation]").val().dateFrToDb();this.mMarche.timeDebutReservation=$(":input[name=heure-debut-reservation]").val()+":"+$(":input[name=minute-debut-reservation]").val()+":00";this.mMarche.dateFinReservation=$(":input[name=date-fin-reservation]").val().dateFrToDb();this.mMarche.timeFinReservation=$(":input[name=heure-fin-reservation]").val()+":"+$(":input[name=minute-fin-reservation]").val()+":00";this.mMarche.archive="0";if(this.mEtapeCreationMarche==0){var e=new MarcheValid();var g=e.validAjout(this.mMarche);if(g.valid){this.mEtapeCreationMarche=1;Infobulle.init();$("#nom-marche-span").text(this.mMarche.nom);$("#date-debut-reservation-marche-span").text($(":input[name=date-debut-reservation]").val());$("#time-debut-reservation-marche-span").text($(":input[name=heure-debut-reservation]").val()+"H"+$(":input[name=minute-debut-reservation]").val());$("#date-fin-reservation-marche-span").text($(":input[name=date-fin-reservation]").val());$("#time-fin-reservation-marche-span").text($(":input[name=heure-fin-reservation]").val()+"H"+$(":input[name=minute-fin-reservation]").val());$("#date-debut-marche-span").text($(":input[name=date-debut]").val());$("#time-debut-marche-span").text($(":input[name=heure-debut]").val()+"H"+$(":input[name=minute-debut]").val());$("#time-fin-marche-span").text($(":input[name=heure-fin]").val()+"H"+$(":input[name=minute-fin]").val());$("#description-marche-span").text(this.mMarche.description);$("#btn-ajout-produit-div, .informations-marche, #btn-modifier-creation-commande, .btn-modifier-produit, .btn-supprimer-produit").toggle()}else{Infobulle.generer(g,"marche-")}}else{if(this.mEtapeCreationMarche==1){var d=new MarcheVO();d.nom=this.mMarche.nom;d.description=this.mMarche.description;d.dateMarcheDebut=this.mMarche.dateMarcheDebut;d.timeMarcheDebut=this.mMarche.timeMarcheDebut;d.dateMarcheFin=this.mMarche.dateMarcheFin;d.timeMarcheFin=this.mMarche.timeMarcheFin;d.dateDebutReservation=this.mMarche.dateDebutReservation;d.timeDebutReservation=this.mMarche.timeDebutReservation;d.dateFinReservation=this.mMarche.dateFinReservation;d.timeFinReservation=this.mMarche.timeFinReservation;d.archive=this.mMarche.archive;var h=[];$(this.mMarche.produits).each(function(){if(this.idNom){var j=[];$(this.lots).each(function(){if(this.taille){j.push(this)}});this.lots=j;h.push(this)}});d.produits=h;var b=[];$(this.mMarche.produitsAbonnement).each(function(){if(this.idNom){var j=[];$(this.lots).each(function(){if(this.taille){j.push(this)}});this.lots=j;b.push(this)}});d.produitsAbonnement=b;d.fonction="ajouter";$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(d),function(k){if(k){if(k.valid){var l=new Object();var j=new VRerreur();j.code=ERR_334_CODE;j.message=ERR_334_MSG;l.valid=false;l.log=new VRelement();l.log.valid=false;l.log.erreurs.push(j);EditerCommandeVue({id_marche:k.id,vr:l})}else{f.editerMarche();Infobulle.generer(k,"marche-")}}},"json")}}}else{var g=new Object();var c=new VRerreur();c.code=ERR_112_CODE;c.message=ERR_112_MSG;g.valid=false;g.log=new VRelement();g.log.valid=false;g.log.erreurs.push(c);Infobulle.generer(g,"")}};this.editerMarche=function(){this.mEtapeCreationMarche=0;$("#btn-ajout-produit-div, .informations-marche, #btn-modifier-creation-commande, .btn-modifier-produit, .btn-supprimer-produit").toggle()};this.affectControleDatepicker=function(b){b=gCommunVue.lienDatepickerMarche("marche-dateDebutReservation","marche-dateFinReservation","marche-dateMarcheDebut",b);b.find("#marche-dateDebutReservation").datepicker("setDate",getDateAujourdhuiDb().dateDbToFr());b.find("#marche-dateFinReservation").datepicker("option","minDate",new Date());b.find("#marche-dateMarcheDebut").datepicker("option","minDate",new Date());return b};this.construct(a)}function AchatVue(a){this.mIdMarche=0;this.construct=function(b){$.history({vue:function(){AchatVue(b)}});var c=this;b=$.extend(true,{},b);if(b.idMarche){this.mIdMarche=b.idMarche}b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=Achat","pParam="+$.toJSON(b),function(f){Infobulle.init();if(f){if(f.valid){var e=new RechercheListeAchatVO();if(c.mIdMarche>0){e.idMarche=c.mIdMarche}else{e.dateDebut=getPremierJourDuMois();f.dateDebut=e.dateDebut.dateDbToFr();e.dateFin=getDernierJourDuMois();f.dateFin=e.dateFin.dateDbToFr()}if(b&&b.vr){e.vr=b.vr}var d=new GestionCommandeTemplate();$("#contenu").replaceWith(c.affectEntete($(d.rechercheListeAchat.template(f))));c.recherche(e)}else{Infobulle.generer(f,"")}}},"json")};this.affectEntete=function(b){b=this.affectModeMarche(b);b=this.affectControleDatepicker(b);b=this.affectRechercheListeAchat(b);b=gCommunVue.comHoverBtn(b);return b};this.affectModeMarche=function(b){if(this.mIdMarche>0){var c=this;b.find("#form-recherche-liste-achat").remove();b.find(".com-barre-menu-2").show();b.find("#btn-retour").click(function(){EditerCommandeVue({id_marche:c.mIdMarche})})}return b};this.affectControleDatepicker=function(b){b=gCommunVue.comLienDatepicker("dateDebut","dateFin",b);b.find("#dateDebut, #dateFin").datepicker("option","yearRange","1900:c");return b};this.affectRechercheListeAchat=function(b){var c=this;b.find("#btn-rechercher-liste-achat").click(function(){var d=new RechercheListeAchatVO();d.dateDebut=$("#dateDebut").val().dateFrToDb();d.dateFin=$("#dateFin").val().dateFrToDb();d.idMarche=$("#idMarche").val();var e=new AchatValid();var f=e.validRechercheListeAchat(d);Infobulle.init();if(f.valid){c.recherche(d)}else{Infobulle.generer(f,"")}});return b};this.recherche=function(c){var b=this;c.fonction="rechercher";$.post("./index.php?m=GestionCommande&v=Achat","pParam="+$.toJSON(c),function(d){Infobulle.init();if(d){if(d.valid){if(c&&c.vr){Infobulle.generer(c.vr,"")}b.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var c=this;var b=new GestionCommandeTemplate();if(d.listeAchat.length>0&&d.listeAchat[0].opeId!=null){d.sigleMonetaire=gSigleMonetaire;$.each(d.listeAchat,function(){this.montant=this.opeMontant.nombreFormate(2,","," ");this.dateTri=this.opeDate.extractDbDate().dateDbToTri();this.date=this.opeDate.extractDbDate().dateDbToFr();if(this.comNumero==null){this.comNumero=""}else{this.comNumero=b.listeAchatNumeroMarche.template(this)}if(this.adhNumero==null){this.adhNumero=""}if(this.adhNom==null){this.adhNom=""}if(this.adhPrenom==null){this.adhPrenom=""}});$("#liste-achat").html(c.affect($(b.listeAchat.template(d))))}else{$("#liste-achat").html(c.affect($(b.listeAchatVide)))}};this.affect=function(b){b=this.affectTri(b);b=this.affectAfficherAchat(b);b=gCommunVue.comHoverBtn(b);return b};this.affectTri=function(b){b.tablesorter({sortList:[[0,1]],headers:{6:{sorter:false},7:{sorter:false}}});return b};this.affectAfficherAchat=function(b){b.find(".btn-afficher-achat").click(function(){var c={id:$(this).data("id-achat"),module:"GestionCommande"};CaisseVue(c)});return b};this.construct(a)}function StockProduitListeFermeVue(a){this.construct=function(b){$.history({vue:function(){StockProduitListeFermeVue(b)}});var c=this;var d={fonction:"ListeFerme"};$.post("./index.php?m=GestionCommande&v=StockProduit","pParam="+$.toJSON(d),function(e){Infobulle.init();if(e){if(e.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(e)}else{Infobulle.generer(e,"")}}},"json")};this.afficher=function(d){var c=this;var b=new GestionCommandeTemplate();if(d.listeFerme.length>0&&d.listeFerme[0].ferId!=null){var e=b.listeFerme;$.each(d.listeFerme,function(){this.ferIdTri=this.ferNumero.replace("F","")});$("#contenu").replaceWith(c.affect($(e.template(d))))}else{$("#contenu").replaceWith(c.affect($(b.listeFermeVide)))}};this.affect=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectDetailFerme(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[0,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectDetailFerme=function(b){b.find(".compte-ligne").click(function(){StockProduitVue({idCompte:$(this).data("id-compte-ferme")})});return b};this.construct(a)}function FactureVue(a){this.mIdMarche=0;this.construct=function(b){$.history({vue:function(){FactureVue(b)}});var c=this;b=$.extend(true,{},b);if(b.idMarche){this.mIdMarche=b.idMarche}b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=Facture","pParam="+$.toJSON(b),function(f){Infobulle.init();if(f){if(f.valid){var e=new RechercheListeFactureVO();if(c.mIdMarche>0){e.idMarche=c.mIdMarche}else{e.dateDebut=getPremierJourDuMois();f.dateDebut=e.dateDebut.dateDbToFr();e.dateFin=getDernierJourDuMois();f.dateFin=e.dateFin.dateDbToFr()}if(b&&b.vr){e.vr=b.vr}var d=new GestionCommandeTemplate();$("#contenu").replaceWith(c.affectEntete($(d.rechercheListeFacture.template(f))));c.recherche(e)}else{Infobulle.generer(f,"")}}},"json")};this.affectEntete=function(b){b=this.affectModeMarche(b);b=this.affectAjoutFacture(b);b=this.affectControleDatepicker(b);b=this.affectRechercheListeFacture(b);b=gCommunVue.comHoverBtn(b);return b};this.affectModeMarche=function(b){if(this.mIdMarche>0){var c=this;b.find("#form-recherche-liste-facture").remove();b.find(".com-barre-menu-2").show();b.find("#btn-retour").click(function(){EditerCommandeVue({id_marche:c.mIdMarche})})}return b};this.affectControleDatepicker=function(b){b=gCommunVue.comLienDatepicker("dateDebut","dateFin",b);b.find("#dateDebut, #dateFin").datepicker("option","yearRange","1900:c");return b};this.affectRechercheListeFacture=function(b){var c=this;b.find("#btn-rechercher-liste-facture").click(function(){var d=new RechercheListeFactureVO();d.dateDebut=$("#dateDebut").val().dateFrToDb();d.dateFin=$("#dateFin").val().dateFrToDb();d.idMarche=$("#idMarche").val();var e=new FactureValid();var f=e.validRechercheListeFacture(d);Infobulle.init();if(f.valid){c.recherche(d)}else{Infobulle.generer(f,"")}});return b};this.recherche=function(c){var b=this;c.fonction="rechercher";$.post("./index.php?m=GestionCommande&v=Facture","pParam="+$.toJSON(c),function(d){Infobulle.init();if(d){if(d.valid){if(c&&c.vr){Infobulle.generer(c.vr,"")}b.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var c=this;var b=new GestionCommandeTemplate();if(d.listeFacture.length>0&&d.listeFacture[0].id!=null){d.sigleMonetaire=gSigleMonetaire;$.each(d.listeFacture,function(){this.montant=this.montant.nombreFormate(2,","," ");this.dateTri=this.date.extractDbDate().dateDbToTri();this.date=this.date.extractDbDate().dateDbToFr();if(this.numero==null){this.numero=""}else{this.numero=b.listeFactureNumeroMarche.template(this)}});$("#liste-facture").html(c.affect($(b.listeFacture.template(d))))}else{$("#liste-facture").html(c.affect($(b.listeFactureVide)))}};this.affect=function(b){b=this.affectTri(b);b=this.affectAfficherFacture(b);b=gCommunVue.comHoverBtn(b);return b};this.affectTri=function(b){b.tablesorter({sortList:[[0,1]],headers:{4:{sorter:false},5:{sorter:false}}});return b};this.affectAjoutFacture=function(b){var c=this;b.find("#btn-nv-facture").click(function(){var d={};if(c.mIdMarche>0){d.idMarche=c.mIdMarche}EditionFactureVue(d)});return b};this.affectAfficherFacture=function(b){var c=this;b.find(".btn-afficher-facture").click(function(){var d={id:$(this).data("id-facture")};if(c.mIdMarche>0){d.idMarche=c.mIdMarche}EditionFactureVue(d)});return b};this.construct(a)}function ListeAchatMarcheVue(a){this.mIdMarche=null;this.construct=function(b){$.history({vue:function(){ListeAchatMarcheVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=ListeAchatMarche","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){c.mIdMarche=b.id_marche;c.afficher(d);if(b&&b.vr){Infobulle.generer(b.vr,"")}}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var d=this;$(c.listeAchatEtReservation).each(function(){if(this.idOperation==null){this.achat="ui-helper-hidden"}else{this.achat=""}this.adhIdTri=this.adhNumero.replace("Z","")});var b=new GestionCommandeTemplate();c.achatInvite="";if(c.listeAchatInvite&&c.listeAchatInvite[0]&&c.listeAchatInvite[0].id!=null){$(c.listeAchatInvite).each(function(){if(this.typePaiement==7){this.achatSolidaire="ui-helper-hidden";this.achat=""}else{this.achatSolidaire="";this.achat="ui-helper-hidden"}this.montant=(this.montant*-1).nombreFormate(2,","," ")});c.sigleMonetaire=gSigleMonetaire;c.achatInvite=b.listeAchatInvite.template(c)}c.infoMarcheSelected="";c.listeReservationSelected="";c.listeAchatSelected="ui-state-active";c.resumeMarcheSelected="";c.editerMenu=b.editerMarcheMenu.template(c);if(c.listeAchatEtReservation.length>0&&c.listeAchatEtReservation[0].adhId!=null){var e=b.listeAchatEtReservation;$("#contenu").replaceWith(d.affectAchatEtReservation($(e.template(c))))}else{$("#contenu").replaceWith(d.affectAchatEtReservation($(b.listeAchatEtReservationVide.template(c))))}};this.affectAchatEtReservation=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectAchat(b);b=this.affectExportDataEtReservation(b);b=this.affectMenu(b);b=this.affectToggleAchatInvite(b);return b};this.affectMenu=function(b){var c=this;b.find("#btn-information-marche").click(function(){EditerCommandeVue(c.mParam)});b.find("#btn-liste-achat-resa").click(function(){ListeAchatMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-liste-resa").click(function(){ListeReservationMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-resume-marche").click(function(){ResumeMarcheVue({id_marche:c.mIdMarche})});return b};this.affectTri=function(b){b.find("#edt-com-liste-resa").tablesorter({sortList:[[2,0]],headers:{4:{sorter:false}}});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($("#edt-com-liste-resa"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectExportDataEtReservation=function(b){var c=this;b.find("#btn-export-achat").click(function(){var d=new GestionCommandeTemplate();var e=d.dialogExportListeAchatEtReservation;$(e.template(c.mMarche)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){lParam={fonction:"exportAchatEtReservation",id_marche:c.mIdMarche};$.download("./index.php?m=GestionCommande&v=ListeAchatMarche",lParam)},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}})});return b};this.affectAchat=function(b){var c=this;b.find(".edt-com-achat-ligne").click(function(){AchatAdherentVue({id_marche:c.mIdMarche,id_adherent:$(this).attr("id-adherent"),idOperation:""})});b.find(".edt-com-achat-ligne-invite").click(function(){AchatAdherentVue({id_marche:c.mIdMarche,id_adherent:-3,idOperation:$(this).data("id-operation")})});return b};this.affectToggleAchatInvite=function(b){b.find("#entete-achat-invite").click(function(){$("#icon-achat-invite").toggleClass("ui-icon-triangle-1-s").toggleClass("ui-icon-triangle-1-n");$(".detail-achat-invite").toggle()});return b};this.construct(a)}function EditionFactureVue(a){this.mListeProduit=[];this.mDetailFacture=[];this.mFactureInitiale={};this.mCompteurStock=0;this.mNbProduit=0;this.mTypePaiementSelect=0;this.mTypePaiement=[];this.mBanques=[];this.mFermes=[];this.mTypeEdition=0;this.mIdMarche=0;this.mIdFacture=0;this.construct=function(c){$.history({vue:function(){EditionFactureVue(c)}});var d=this;if(c&&c.idMarche){this.mIdMarche=c.idMarche}var b={};if(c&&c.id){this.mIdFacture=c.id;b.id=c.id;b.fonction="afficherFacture";this.mTypeEdition=1}else{b.fonction="listeFerme";this.mTypeEdition=0}$.post("./index.php?m=GestionCommande&v=Facture","pParam="+$.toJSON(b),function(e){Infobulle.init();if(e){if(e.valid){if(c&&c.vr){Infobulle.generer(c.vr,"")}d.mTypePaiement=e.typePaiement;d.mBanques=e.banques;if(d.mTypeEdition==0){$(e.listeFerme).each(function(){d.mFermes[this.ferId]=this})}d.afficher(e)}else{Infobulle.generer(e,"")}}},"json")};this.afficher=function(e){var d=this;var b=new GestionCommandeTemplate();if(this.mTypeEdition==0){if(e.listeFerme.length>0&&e.listeFerme[0].ferId!=null){e.listeFermeAffiche=b.factureSelectFerme.template(e)}else{var f=new Object();var c=new VRerreur();c.code=ERR_265_CODE;c.message=ERR_265_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(c);Infobulle.generer(f,"")}}else{this.mResponseAfficheFacture=e;e.numeroFacture=e.facture.id.champComplementaire[11].valeur;e.listeFermeAffiche=e.ferme.nom}$("#contenu").replaceWith(d.affect($(b.facture.template(e))));if(this.mTypeEdition==1){this.afficheListeProduit(e)}};this.affect=function(b){b=this.retour(b);b=this.affectSelectFerme(b);b=this.affectExport(b);b=gCommunVue.comHoverBtn(b);return b};this.affectExport=function(b){if(this.mTypeEdition==1){var c=this;b.find("#btn-export-facture").show().click(function(){var d=new GestionCommandeTemplate();$(d.dialogExportFacture).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var e=$(this).find(":input[name=format]:checked").val();var g=new ExportFactureVO();g.id=c.mIdFacture;g.format=e;g.fonction="export";var f=new ExportFactureValid();var h=f.validAjout(g);Infobulle.init();if(h.valid){$.download("./index.php?m=GestionCommande&v=Facture",g)}else{Infobulle.generer(h,"")}},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})})}return b};this.retour=function(b){var c=this;b.find("#btn-retour").click(function(){var d={};if(c.mIdMarche>0){d.idMarche=c.mIdMarche}FactureVue(d)});return b};this.affectSelectFerme=function(b){var c=this;b.find("#select-ferme").change(function(){var e=$(this).val();c.mCompteurStock=0;c.mDetailFacture=[];c.mNbProduit=0;if(e==0){$("#btn-export-facture, #liste-pdt").hide()}else{var d={fonction:"listeProduitFerme",id:e,idMarche:""};if(c.mIdMarche>0){d.idMarche=c.mIdMarche}$.post("./index.php?m=GestionCommande&v=Facture","pParam="+$.toJSON(d),function(f){Infobulle.init();if(f){if(f.valid){if(a&&a.vr){Infobulle.generer(a.vr,"")}c.afficheListeProduit(f)}else{Infobulle.generer(f,"")}}},"json")}});return b};this.afficheListeProduit=function(e){var f=this;this.mFactureInitiale=clone(e);this.mListeProduit=[];var b=new GestionCommandeTemplate();if(e.listeProduit.length>0&&e.listeProduit[0].nproId!=null){$.each(e.listeProduit,function(){if(f.mListeProduit[this.cproNom]){f.mListeProduit[this.cproNom].produits.push(this)}else{f.mListeProduit[this.cproNom]={id:this.cproId,nom:this.cproNom,produits:[this]}}});e.listeProduit=this.mListeProduit;e.banques=this.mBanques;e.sigleMonetaire=gSigleMonetaire;e.typePaiement=this.mTypePaiement;if(this.mTypeEdition==1){e.montant=e.facture.id.montant.nombreFormate(2,",","");e.montantAffiche=e.facture.id.montant.nombreFormate(2,","," ");this.mTypePaiementSelect=e.facture.operationZeybu.typePaiement;e.tppType=e.facture.operationZeybu.tppType;var d=new TypePaiementService();var g=[];if(this.mTypePaiement[e.facture.operationZeybu.typePaiement]){$(this.mTypePaiement[e.facture.operationZeybu.typePaiement].champComplementaire).each(function(){var h=e.facture.operationZeybu.champComplementaire[this.id];h.id=this.id;h.tppCpVisible=1;h.chCpLabel=this.label;g.push(h)})}e.champComplementaire=d.getFormChampcomplementaire(g,this.mBanques);e.champComplementaireAffiche=d.getFormChampcomplementaire(g,this.mBanques,true)}e.detailFacture=b.detailFactureVide.template(e);var c=$(b.listeProduitFerme.template(e));if(this.mTypeEdition==1){c.find("#affiche-paiement-facture").toggle()}else{if(this.mIdMarche>0&&e.listeProduitCommande[0]&&e.listeProduitCommande[0].cproId!=null){c.find("#form-affiche-paiement-facture").toggle()}}$("#liste-pdt").replaceWith(this.affectListeProduit(c));if(this.mTypeEdition==1){this.afficheDetailProduit(e.facture)}else{if(this.mIdMarche>0&&e.listeProduitCommande[0]&&e.listeProduitCommande[0].cproId!=null){this.afficheDetailProduit({produits:e.listeProduitCommande})}}}else{$("#liste-pdt").replaceWith(b.listeProduitFermeVide)}};this.affectListeProduit=function(c){c=this.affectRecherche(c);c=this.affectSelectTypePaiement(c);c=this.affectAjoutProduitDetail(c);c=this.affectEnregistrer(c);c=this.affectModifier(c);c=this.affectSupprimer(c);c=this.affectAnnulerModifier(c);var b=new TypePaiementService();c=b.affect(c,this.mBanques);c=gCommunVue.comNumeric(c);c=gCommunVue.comHoverBtn(c);return c};this.affectSelectTypePaiement=function(b){var c=this;b.find(":input[name=typepaiement]").change(function(){c.changerTypePaiement($(this))});b.find(":input[name=typepaiement] option[value='"+c.mTypePaiementSelect+"']").prop("selected",true);return b};this.changerTypePaiement=function(e){var d=e.val();if(!this.mTypePaiement[d]||(this.mTypePaiement[d]&&this.mTypePaiement[d].champComplementaire.length==0)){$(".champ-complementaire").remove()}else{var b=new GestionCommandeTemplate();var c=new TypePaiementService();$("#ligne-operation").after(c.affect($(b.champComplementaire.template(this.mTypePaiement[d])),this.mBanques))}};this.affectRecherche=function(b){b.find("#filter-produit").keyup(function(){$.uiTableFilter($("#table-produit"),this.value)});b.find("#filter-form-produit").submit(function(){return false});return b};this.affectAjoutProduitDetail=function(b){var c=this;b.find(".btn-ajout-produit").click(function(){var d=$(this).data("id-nom-produit");$.post("./index.php?m=GestionCommande&v=Facture","pParam="+$.toJSON({fonction:"uniteProduit",id:d}),function(e){Infobulle.init();if(e){if(e.valid){if(a&&a.vr){Infobulle.generer(a.vr,"")}c.ajoutProduitDetail(e)}else{Infobulle.generer(e,"")}}},"json")});return b};this.ajoutProduitDetail=function(f){var b=new GestionCommandeTemplate();if(!this.mDetailFacture[f.uniteNomProduit.cproId]||(this.mDetailFacture[f.uniteNomProduit.cproId]&&this.mDetailFacture[f.uniteNomProduit.cproId].nbProduit<1)){if(this.mDetailFacture.length==0){$("#table-detail-facture tbody").prepend(b.categorieDetailFacture.template(f.uniteNomProduit))}else{var c=0;var d=0;for(i in this.mListeProduit){if(f.uniteNomProduit.cproId==this.mListeProduit[i].id){c=d}if($(".cat-"+this.mListeProduit[i].id).length>0){d=this.mListeProduit[i].id}}if(c==0){$("#table-detail-facture tbody").prepend(b.categorieDetailFacture.template(f.uniteNomProduit))}else{$(".cat-"+c).last().after(b.categorieDetailFacture.template(f.uniteNomProduit))}}this.mDetailFacture[f.uniteNomProduit.cproId]={produits:[],nbProduit:0}}this.mDetailFacture[f.uniteNomProduit.cproId].nbProduit++;f.uniteNomProduit.sigleMonetaire=gSigleMonetaire;if(f.uniteNomProduit.mLotUnite.length==1){f.uniteNomProduit.unite=f.uniteNomProduit.mLotUnite[0];f.uniteNomProduit.uniteSolidaire=f.uniteNomProduit.mLotUnite[0]}else{var e=[];$.each(f.uniteNomProduit.mLotUnite,function(){e.push({unite:this})});f.uniteNomProduit.unite=b.uniteDetailFactureSelect.template({mLotUnite:e,type:""});f.uniteNomProduit.uniteSolidaire=b.uniteDetailFactureSelect.template({mLotUnite:e,type:"Solidaire"})}f.uniteNomProduit.compteurStock=this.mCompteurStock;this.mCompteurStock++;if(this.mDetailFacture[f.uniteNomProduit.cproId].produits.length==0){$("#cat-"+f.uniteNomProduit.cproId).after(this.affectProduitDetailFacture($(b.produitDetailFacture.template(f.uniteNomProduit))))}else{var c=0;var g=0;for(i in this.mListeProduit[f.uniteNomProduit.cproNom].produits){if(f.uniteNomProduit.nproId==this.mListeProduit[f.uniteNomProduit.cproNom].produits[i].nproId){c=g}if($(".pro-"+this.mListeProduit[f.uniteNomProduit.cproNom].produits[i].nproId).length>0){g=this.mListeProduit[f.uniteNomProduit.cproNom].produits[i].nproId}}if(c==0){$("#cat-"+f.uniteNomProduit.cproId).after(this.affectProduitDetailFacture($(b.produitDetailFacture.template(f.uniteNomProduit))))}else{$(".pro-"+c).last().after(this.affectProduitDetailFacture($(b.produitDetailFacture.template(f.uniteNomProduit))))}}if(this.mDetailFacture[f.uniteNomProduit.cproId].produits[f.uniteNomProduit.nproId]){this.mDetailFacture[f.uniteNomProduit.cproId].produits[f.uniteNomProduit.nproId].produit.push(f.uniteNomProduit)}else{this.mDetailFacture[f.uniteNomProduit.cproId].produits[f.uniteNomProduit.nproId]={produit:[f.uniteNomProduit]}}if(this.mNbProduit==0){if(this.mTypeEdition==0){$(".detail-facture, #form-affiche-paiement-facture").toggle()}else{if(this.mTypeEdition==1){$("#btn-enregistrer-modifier-facture").show()}}}this.mNbProduit++};this.affectProduitDetailFacture=function(b){b=this.affectSupprimerProduit(b);b=this.affectCalculTotal(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);return b};this.affectSupprimerProduit=function(b){var c=this;b.find(".btn-supprimer-produit").click(function(){var e=$(this).data("compteur-stock");var d=$(this).data("id-categorie");$("#stock-"+e).remove();c.mDetailFacture[d].nbProduit--;if(c.mDetailFacture[d].nbProduit==0){$("#cat-"+d).remove()}c.mNbProduit--;if(c.mNbProduit==0){if(c.mTypeEdition==0){$(".detail-facture, #form-affiche-paiement-facture").toggle();$(".champ-complementaire").remove();$("#typePaiement").selectOptions("0");$("#montant").val("")}else{if(c.mTypeEdition==1){$("#btn-enregistrer-modifier-facture").hide()}}}c.majTotal()});return b};this.affectCalculTotal=function(b){var c=this;b.find(".montant-produit").keyup(function(){c.majTotal()});return b};this.majTotal=function(){var b=0;$(".montant-produit").each(function(){var c=parseFloat($(this).val().numberFrToDb());if(!isNaN(c)){b=(parseFloat(b)+c).toFixed(2)}});$("#montant").val(b.nombreFormate(2,",",""))};this.afficheDetailProduit=function(e){var d=this;this.mDetailFacture=[];this.mNbProduit=0;var c=[];$(e.produits).each(function(){if(!d.mDetailFacture[this.cproId]){d.mDetailFacture[this.cproId]={cproId:this.cproId,cproNom:this.cproNom,produits:[],nbProduit:0};c[this.cproNom]={cproId:this.cproId,cproNom:this.cproNom,produits:[]}}d.mDetailFacture[this.cproId].nbProduit++;this.compteurStock=d.mCompteurStock;d.mCompteurStock++;this.nproId=this.idNomProduit;if(this.quantite==null||this.quantite==""){this.quantiteAffiche="";this.quantite="";this.uniteAffiche="";this.unite=this.uniteSolidaire;this.montantAffiche="";this.montant="";this.sigleMonetaireAffiche=""}else{var h=this.quantite;this.quantiteAffiche=h.nombreFormate(2,","," ");this.quantite=h.nombreFormate(2,",","");this.uniteAffiche=this.unite;var g=this.montant;this.montantAffiche=g.nombreFormate(2,","," ");this.montant=g.nombreFormate(2,",","");this.sigleMonetaireAffiche=gSigleMonetaire}this.sigleMonetaire=gSigleMonetaire;if(this.quantiteSolidaire==null||this.quantiteSolidaire==""){this.quantiteSolidaireAffiche="";this.quantiteSolidaire="";this.uniteSolidaireAffiche="";this.uniteSolidaire=this.unite}else{var f=this.quantiteSolidaire;this.quantiteSolidaireAffiche=f.nombreFormate(2,","," ");this.quantiteSolidaire=f.nombreFormate(2,",","");this.uniteSolidaireAffiche=this.uniteSolidaire}if(d.mDetailFacture[this.cproId].produits[this.nproId]){d.mDetailFacture[this.cproId].produits[this.nproId].produit.push(this);c[this.cproNom].produits[this.nproNom].produit.push(this)}else{d.mDetailFacture[this.cproId].produits[this.nproId]={produit:[this]};c[this.cproNom].produits[this.nproNom]={produit:[this]}}d.mNbProduit++});if(this.mNbProduit>0){var b=new GestionCommandeTemplate();$("#table-detail-facture tbody").prepend(d.affectProduitDetailFacture($(b.listeProduitAffiche.template({categorie:c}))));if(this.mTypeEdition==0&&this.mIdMarche>0){$(".detail-facture, .affiche-detail-facture").toggle();this.majTotal()}else{$(".detail-facture, #widget-catalogue-produit, #btn-enregistrer-facture, #btn-modifier-facture, #btn-supprimer-facture").toggle()}}};this.affectEnregistrer=function(b){var c=this;b.find("#btn-enregistrer-facture, #btn-enregistrer-modifier-facture").click(function(){c.enregistrer()});return b};this.enregistrer=function(){var f=this;var b=new FactureVO();$(".produit-detail-facture").each(function(){var l=new ProduitDetailFactureVO();l.idNomProduit=$(this).data("id-nom-produit");l.idStock=$(this).find(".produit-detail-facture-stock").data("id-stock");if(l.idStock==undefined){l.idStock=""}l.idDetailOperation=$(this).find(".produit-detail-facture-montant").data("id-detail-operation");if(l.idDetailOperation==undefined){l.idDetailOperation=""}l.idStockSolidaire=$(this).find(".produit-detail-facture-stock-solidaire").data("id-stock-solidaire");if(l.idStockSolidaire==undefined){l.idStockSolidaire=""}var n=$(this).find(".produit-detail-facture-stock :input").val().numberFrToDb();if(!isNaN(n)&&!n.isEmpty()){n=parseFloat(n)}else{n=""}l.quantite=n;l.unite=($(this).find(".produit-detail-facture-stock select").length==1)?$(this).find(".produit-detail-facture-stock select").val():$(this).find(".produit-detail-facture-stock .facture-detail-unite-span").text();var k=$(this).find(".produit-detail-facture-stock-solidaire :input").val().numberFrToDb();if(!isNaN(k)&&!k.isEmpty()){k=parseFloat(k)}else{k=""}l.quantiteSolidaire=k;l.uniteSolidaire=($(this).find(".produit-detail-facture-stock-solidaire select").length==1)?$(this).find(".produit-detail-facture-stock-solidaire select").val():$(this).find(".produit-detail-facture-stock-solidaire .facture-detail-unite-span").text();var m=$(this).find(".produit-detail-facture-montant :input").val().numberFrToDb();if(!isNaN(m)&&!m.isEmpty()){m=parseFloat(m)}else{m=""}l.montant=m;b.produits[$(this).data("compteur-stock")]=l});lOperationProducteur=new OperationDetailVO();if(this.mTypeEdition==0){lOperationProducteur.idCompte=this.mFermes[$("#select-ferme").val()].ferIdCompte}else{if(this.mTypeEdition==1){lOperationProducteur.idCompte=this.mFactureInitiale.facture.operationProducteur.idCompte}}var e=$(":input[name=montant-total]").val().numberFrToDb();if(!isNaN(e)&&!e.isEmpty()){e=parseFloat(e)}else{e=""}lOperationProducteur.montant=e;lOperationProducteur.typePaiement=$(":input[name=typepaiement]").val();if(this.mTypePaiement[lOperationProducteur.typePaiement]){var c=new TypePaiementService();lOperationProducteur.champComplementaire=c.getChampComplementaire(this.mTypePaiement[lOperationProducteur.typePaiement].champComplementaire)}b.operationProducteur=lOperationProducteur;var h=new OperationDetailVO();if(f.mIdMarche>0){var g=new ChampComplementaireVO();g.id=1;g.obligatoire=0;g.valeur=f.mIdMarche;h.champComplementaire[1]=g}if(this.mTypeEdition==1){h.id=this.mFactureInitiale.facture.id.id}b.id=h;var d=new FactureValid();var j=d.validEnregistrer(b);Infobulle.init();if(j.valid){b.fonction="enregistrer";$.post("./index.php?m=GestionCommande&v=Facture","pParam="+$.toJSON(b),function(l){Infobulle.init();if(l.valid){var m=new TemplateVR();m.valid=false;m.log.valid=false;var k=new VRerreur();k.code=ERR_362_CODE;k.message=ERR_362_MSG;m.log.erreurs.push(k);f.construct({vr:m,id:l.id})}else{Infobulle.generer(l,"")}},"json")}else{Infobulle.generer(j,"")}};this.affectModifier=function(b){b.find("#btn-modifier-facture").click(function(){$(".affiche-detail-facture, #affiche-paiement-facture, #form-affiche-paiement-facture, #btn-export-facture, #widget-catalogue-produit, #btn-modifier-facture, #btn-supprimer-facture, #btn-annuler-modifier-facture, #btn-enregistrer-modifier-facture").toggle()});return b};this.affectAnnulerModifier=function(b){var c=this;b.find("#btn-annuler-modifier-facture").click(function(){c.afficheListeProduit(c.mFactureInitiale);$("#btn-export-facture").show()});return b};this.affectSupprimer=function(b){var c=this;b.find("#btn-supprimer-facture").click(function(){var d=new GestionCommandeTemplate();$(d.dialogSupprimerFacture).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var f=this;var e={fonction:"supprimer",id:c.mFactureInitiale.facture.id.id};$.post("./index.php?m=GestionCommande&v=Facture","pParam="+$.toJSON(e),function(h){Infobulle.init();if(h){if(h.valid){var k=new TemplateVR();k.valid=false;k.log.valid=false;var g=new VRerreur();g.code=ERR_363_CODE;g.message=ERR_363_MSG;k.log.erreurs.push(g);var j={vr:k};if(c.mIdMarche>0){j.idMarche=c.mIdMarche}FactureVue(j);$(f).dialog("close")}else{Infobulle.generer(h,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove()}})});return b};this.construct(a)}function ListeCommandeArchiveVue(a){this.construct=function(b){$.history({vue:function(){ListeCommandeArchiveVue(b)}});var c=this;var d={archive:1};$.post("./index.php?m=GestionCommande&v=ListeCommande","pParam="+$.toJSON(d),function(e){Infobulle.init();if(e){if(e.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(e)}else{Infobulle.generer(e,"")}}},"json")};this.afficher=function(e){var d=this;var c=new GestionCommandeTemplate();if(e.listeCommande.length>0&&e.listeCommande[0].comId!=null){var f=new Object;f.commande=new Array();$(e.listeCommande).each(function(){var h=new Object();h.id=this.comId;h.numero=this.comNumero;h.nom=this.comNom;h.jourFinReservation=jourSem(this.comDateFinReservation.extractDbDate());h.dateFinReservation=this.comDateFinReservation.extractDbDate().dateDbToFr();h.heureFinReservation=this.comDateFinReservation.extractDbHeure();h.minuteFinReservation=this.comDateFinReservation.extractDbMinute();h.jourMarcheDebut=jourSem(this.comDateMarcheDebut.extractDbDate());h.dateMarcheDebut=this.comDateMarcheDebut.extractDbDate().dateDbToFr();h.heureMarcheDebut=this.comDateMarcheDebut.extractDbHeure();h.minuteMarcheDebut=this.comDateMarcheDebut.extractDbMinute();h.heureMarcheFin=this.comDateMarcheFin.extractDbHeure();h.minuteMarcheFin=this.comDateMarcheFin.extractDbMinute();h.dateTimeFinResa=this.comDateFinReservation.replace("-","").replace(" ","").replace(":","");h.dateTimeMarche=this.comDateMarcheDebut.replace("-","").replace(" ","").replace(":","");f.commande.push(h)});var g=c.listeCommandeArchivePage;var b=$(g.template(f));if(e.listeCommande.length<16){b=this.masquerPagination(b)}else{b=this.paginnation(b)}$("#contenu").replaceWith(d.affect(b))}else{$("#contenu").replaceWith(d.affect($(c.listeCommandeArchiveVide)))}};this.affect=function(b){b=this.affectLienListeCommandeArchive(b);b=this.affectLienDetail(b);b=gCommunVue.comHoverBtn(b);return b};this.affectLienListeCommandeArchive=function(b){b.find("#lien-marche-encours").click(function(){GestionListeCommandeVue()});return b};this.paginnation=function(b){b.find("#table-marche-archive").tablesorter({sortList:[[2,1]],headers:{3:{sorter:false}}}).tablesorterPager({container:b.find("#content-nav-liste-operation"),positionFixed:false,size:15});return b};this.masquerPagination=function(b){b.find("#content-nav-liste-operation").hide();b.find("#table-marche-archive").tablesorter({sortList:[[2,1]],headers:{3:{sorter:false}}});return b};this.affectLienDetail=function(b){b.find(".detail-commande-ligne").click(function(){var c={id_marche:$(this).attr("id-marche")};EditerCommandeVue(c)});return b};this.construct(a)}function BonDeLivraisonVue(a){this.mIdCommande=null;this.mComNumero=null;this.mEtatEdition=false;this.mListeProduit=[];this.mSuiteEdition=0;this.mIdCompteProducteur=0;this.mTypePaiement=[];this.mResponse;this.mArchive=-1;this.mListeProduitCommande=[];this.construct=function(b){$.history({vue:function(){BonDeLivraisonVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=BonDeLivraison","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mEtatEdition=false;c.mArchive=d.archive;c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var d=this;var b=new GestionCommandeTemplate();var e=b.bonDeLivraison;this.mIdCommande=c.producteurs[0].proIdCommande;this.mComNumero=c.comNumero;$(c.typePaiement).each(function(){d.mTypePaiement[this.tppId]=this});$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affectDroitArchive=function(b){b.find("#btn-annuler").remove();b.find("#btn-enregistrer").remove();b.find("#btn-modifier").remove();return b};this.affect=function(b){b=gCommunVue.comHoverBtn(b);b=this.affectBtnRetourMarche(b);b=this.affectChangementProducteur(b);b=this.affectExportBonDeLivraison(b);return b};this.affectBtnRetourMarche=function(b){var c=this;b.find("#btn-editer-com").click(function(){EditerCommandeVue({id_marche:c.mIdCommande})});return b};this.affectChangementProducteur=function(b){var c=this;b.find("#select-prdt").change(function(){if(c.mEtatEdition){c.mSuiteEdition=1;c.dialogEnregistrer()}else{c.changementProducteur()}});return b};this.changementProducteur=function(){var c=this;var d=$("#select-prdt").val();if(d>0){var e={id_commande:c.mIdCommande,id_compte_ferme:d,fonction:"afficherProducteur"};$.post("./index.php?m=GestionCommande&v=BonDeLivraison","pParam="+$.toJSON(e),function(h){Infobulle.init();if(h){if(h.valid){c.mIdCompteProducteur=d;c.mEtatEdition=false;var j=[];c.mListeProduitCommande=[];$(h.produits).each(function(){var k=this.proId;if(c.mListeProduitCommande[k]){if(this.stoQuantite==null){this.stoQuantite="0"}c.mListeProduitCommande[k].qteReservation+=parseFloat(this.stoQuantite);c.mListeProduitCommande[k].NbLot++;c.mListeProduit[k]+=parseFloat(this.stoQuantite)}else{if(this.stoQuantite==null){this.stoQuantite="0"}c.mListeProduitCommande[k]={qteReservation:parseFloat(this.stoQuantite),qteCommande:0,prixCommande:0,NbLot:1,lotTraite:0};c.mListeProduit[k]=parseFloat(this.stoQuantite)}var l=this.dcomId;$(h.produitsCommande).each(function(){if(this.dcomId==l){if(this.stoQuantite!=null){c.mListeProduitCommande[k].qteCommande+=parseFloat(this.stoQuantite)}if(this.dopeMontant!=null){c.mListeProduitCommande[k].prixCommande+=parseFloat(this.dopeMontant)}}})});var g=0;$(h.produits).each(function(){var k=false;if(c.mListeProduitCommande[this.proId].NbLot>1){k=true}var m=this;var l=this.proId;if(!k){$(h.produitsCommande).each(function(){if(this.proId==l){var n=0;if(this.stoQuantite!=null){m.stoQuantiteCommande=parseFloat(this.stoQuantite)}if(this.dopeMontant!=null){m.opeMontantCommande=parseFloat(this.dopeMontant);n=parseFloat(this.dopeMontant)}g+=n}})}else{m.stoQuantite=c.mListeProduitCommande[this.proId].qteReservation;m.stoQuantiteCommande=c.mListeProduitCommande[this.proId].qteCommande;m.opeMontantCommande=c.mListeProduitCommande[this.proId].prixCommande;if(c.mListeProduitCommande[this.proId].lotTraite==0){g+=c.mListeProduitCommande[this.proId].prixCommande}}if(c.mListeProduitCommande[this.proId].lotTraite==0){c.mListeProduitCommande[this.proId].lotTraite=1;j.push(this)}});h.totalCommande=g.nombreFormate(2,","," ");h.produits=j;c.mResponse=h;if(h.operationProducteur&&h.operationProducteur.idCompte!=null){c.afficherDetail(h)}else{c.afficherFormulaire(h,1)}if(a&&a.vr){Infobulle.generer(a.vr,"")}}else{Infobulle.generer(h,"")}}},"json")}else{var b=new GestionCommandeTemplate();var f=b.listeProduitVide;$("#liste-pdt").replaceWith(f)}};this.afficherDetail=function(e){var f=this;$(e.produits).each(function(){var l=0;var j=this.proId;var k=this;if(this.stoQuantite==null){this.stoQuantite="0"}this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");if(this.stoQuantiteCommande==null){this.stoQuantiteCommande="0"}this.stoQuantiteCommande=this.stoQuantiteCommande.nombreFormate(2,","," ");if(this.opeMontantCommande==null){this.opeMontantCommande="0"}this.opeMontantCommande=this.opeMontantCommande.nombreFormate(2,","," ");this.stoQuantiteLivraison="0".nombreFormate(2,","," ");this.opeMontantLivraison="0".nombreFormate(2,","," ");this.stoQuantiteSolidaire="0".nombreFormate(2,","," ");$(e.produitsLivraison).each(function(){if(this.proId==j){if(this.stoQuantite!=null){k.stoQuantiteLivraison=this.stoQuantite.nombreFormate(2,","," ");l+=parseFloat(this.stoQuantite)}if(this.dopeMontant!=null){k.opeMontantLivraison=this.dopeMontant.nombreFormate(2,","," ")}}});$(e.produitsSolidaire).each(function(){if(this.proId==j){if(this.stoQuantite!=null){k.stoQuantiteSolidaire=this.stoQuantite.nombreFormate(2,","," ");l+=parseFloat(this.stoQuantite)}}});if(l-parseFloat(this.stoQuantite)<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}this.masquerNormal="";if(this.proType==1){this.masquerNormal="ui-helper-hidden"}});e.total="";if(e.operationProducteur){if(e.operationProducteur.montant!=null){e.total=(e.operationProducteur.montant).nombreFormate(2,","," ")}if(e.operationProducteur.typePaiementChampComplementaire!=null){e.champComplementaire=e.operationProducteur.typePaiementChampComplementaire}}e.sigleMonetaire=gSigleMonetaire;e.typePaiement=f.mTypePaiement;var c=new GestionCommandeTemplate();var h=c.listeProduitLivraison;if(e.operationProducteur&&e.operationProducteur.typePaiement!=null){e.tppType=f.mTypePaiement[e.operationProducteur.typePaiement].tppType}var b=f.affectListeProduit($(h.template(e)));if(e.operationProducteur&&e.operationProducteur.typePaiement!=null){var g=e.operationProducteur.typePaiement;b.find(":input[name=typepaiement]").selectOptions(g);var d=f.getLabelChamComplementaire(g);if(d!=null){b.find("#label-champ-complementaire").text(d);b.find("#tr-champ-complementaire").show()}else{b.find("#label-champ-complementaire").text("");b.find("#tr-champ-complementaire").hide()}}else{b.find("#label-champ-complementaire").text("");b.find("#tr-champ-complementaire").hide()}$("#liste-pdt").replaceWith(b)};this.afficherFormulaire=function(f,e){var g=this;$(f.produits).each(function(){var m=0;var k=this.proId;var l=this;if(this.stoQuantite==null){this.stoQuantite="0"}this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");if(this.stoQuantiteCommande==null){this.stoQuantiteCommande="0"}this.stoQuantiteCommande=this.stoQuantiteCommande.nombreFormate(2,","," ");if(this.opeMontantCommande==null){this.opeMontantCommande="0"}this.opeMontantCommande=this.opeMontantCommande.nombreFormate(2,","," ");this.stoQuantiteLivraison="0".nombreFormate(2,","," ");this.opeMontantLivraison="0".nombreFormate(2,","," ");this.stoQuantiteSolidaire="0".nombreFormate(2,","," ");$(f.produitsLivraison).each(function(){if(this.proId==k){if(this.stoQuantite!=null){l.stoQuantiteLivraison=this.stoQuantite.nombreFormate(2,",","");m+=parseFloat(this.stoQuantite)}if(this.dopeMontant!=null){l.opeMontantLivraison=this.dopeMontant.nombreFormate(2,",","")}}});$(f.produitsSolidaire).each(function(){if(this.proId==k){if(this.stoQuantite!=null){l.stoQuantiteSolidaire=this.stoQuantite.nombreFormate(2,",","");m+=parseFloat(this.stoQuantite)}}});if(m-parseFloat(this.stoQuantite)<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}this.masquerNormal="";if(this.proType==1){this.masquerNormal="ui-helper-hidden"}});f.total="";if(f.operationProducteur){if(f.operationProducteur.montant!=null){f.total=(f.operationProducteur.montant).nombreFormate(2,",","")}if(f.operationProducteur.typePaiementChampComplementaire!=null){f.champComplementaire=f.operationProducteur.typePaiementChampComplementaire}}f.sigleMonetaire=gSigleMonetaire;f.typePaiement=g.mTypePaiement;var c=new GestionCommandeTemplate();var j=c.listeProduitLivraison;var b=g.affectListeProduitFormulaire($(j.template(f)));if(f.operationProducteur&&f.operationProducteur.typePaiement!=null){var h=f.operationProducteur.typePaiement;b.find(":input[name=typepaiement]").selectOptions(h);var d=g.getLabelChamComplementaire(h);if(d!=null){b.find("#label-champ-complementaire").text(d);b.find("#tr-champ-complementaire").show()}else{b.find("#label-champ-complementaire").text("");b.find("#tr-champ-complementaire").hide()}}else{b.find("#label-champ-complementaire").text("");b.find("#tr-champ-complementaire").hide()}if(e==2){b.find("#btn-annuler").show()}$("#liste-pdt").replaceWith(b)};this.affectListeProduit=function(b){b=this.affectEtatCommande(b);b=this.affectEnregistrer(b);b=this.affectModifier(b);b=this.affectTypePaiement(b);b=this.affectChangementEtatEdition(b);b=this.affectMasquerFormulaire(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectListeProduitFormulaire=function(b){b=this.affectEtatCommande(b);b=this.affectEnregistrer(b);b=this.affectModifier(b);b=this.affectTypePaiement(b);b=this.affectChangementEtatEdition(b);b=this.affectMasquerDetail(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectMasquerDetail=function(b){b.find(".detail").hide();return b};this.affectMasquerFormulaire=function(b){b.find(".formulaire").hide();return b};this.affectTypePaiement=function(b){var c=this;b.find(":input[name=typepaiement]").change(function(){c.changerTypePaiement($(this))});return b};this.changerTypePaiement=function(d){var c=d.val();var b=this.getLabelChamComplementaire(c);if(b!=null){$("#label-champ-complementaire").text(b);$("#tr-champ-complementaire").show()}else{$("#label-champ-complementaire").text("");$(":input[name=champ-complementaire]").val("");$("#tr-champ-complementaire").hide()}};this.getLabelChamComplementaire=function(c){var b=this.mTypePaiement;if(b[c]){if(b[c].tppChampComplementaire==1){return b[c].tppLabelChampComplementaire}}return null};this.affectEtatCommande=function(b){var c=this;b.find(".qte-commande ,.qte-solidaire-commande ").keyup(function(){c.mEtatEdition=true;var e=$(this).prev(".pro-id-etat").text();if(c.mListeProduit[e]){var g=0;var f=$(":input[name=qte-commande-"+e+"]").val().numberFrToDb();var d=$(":input[name=qte-solidaire-commande-"+e+"]").val().numberFrToDb();if(!isNaN(f)&&!f.isEmpty()){g+=parseFloat(f)}if(!isNaN(d)&&!d.isEmpty()){g+=parseFloat(d)}if(g-c.mListeProduit[e]<0){$("#etat-commande-"+e).removeClass("qte-reservation-ok").addClass("qte-reservation-ko")}else{$("#etat-commande-"+e).removeClass("qte-reservation-ko").addClass("qte-reservation-ok")}}});return b};this.affectEnregistrer=function(b){var c=this;b.find("#btn-enregistrer").click(function(){c.mSuiteEdition=0;c.enregistrer()});b.find(".qte-commande ,.prix-commande ").keyup(function(d){if(d.keyCode=="13"){c.mSuiteEdition=0;c.enregistrer()}});return b};this.affectModifier=function(b){var c=this;b.find("#btn-modifier").click(function(){c.afficherFormulaire(c.mResponse,2)});b.find("#btn-annuler").click(function(){c.changementProducteur()});return b};this.enregistrer=function(){var c=this;var d=new ProduitsBonDeLivraisonVO();d.id_commande=this.mIdCommande;d.id_compte_ferme=this.mIdCompteProducteur;$(".pro-id").each(function(){var f=$(this).text();var g=new ProduitBonDeLivraisonVO();g.id=f;g.quantite=$(":input[name=qte-commande-"+f+"]").val().numberFrToDb();g.quantiteSolidaire=$(":input[name=qte-solidaire-commande-"+f+"]").val().numberFrToDb();g.prix=$(":input[name=prix-commande-"+f+"]").val().numberFrToDb();d.produits.push(g)});d.typePaiement=$(":input[name=typepaiement]").val();d.total=$(":input[name=total]").val().numberFrToDb();if(this.getLabelChamComplementaire(d.typePaiement)!=null){d.typePaiementChampComplementaireObligatoire=1;d.typePaiementChampComplementaire=$(":input[name=champ-complementaire]").val()}else{d.typePaiementChampComplementaireObligatoire=0}var b=new ProduitsBonDeLivraisonValid();var e=b.validAjout(d);if(e.valid){d.fonction="enregistrer";$.post("./index.php?m=GestionCommande&v=BonDeLivraison","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g){if(g.valid){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.dialogExportBonDeLivraison()}else{var h=new TemplateVR();h.valid=false;h.log.valid=false;var f=new VRerreur();f.code=ERR_301_CODE;f.message=ERR_301_MSG;h.log.erreurs.push(f);c.changementProducteur({vr:h})}}}else{Infobulle.generer(g,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}}},"json")}else{Infobulle.generer(e,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}};this.affectExportBonDeLivraison=function(b){var c=this;b.find("#btn-export-bcom").click(function(){if(c.mEtatEdition){c.mSuiteEdition=2;c.dialogEnregistrer()}else{c.dialogExportBonDeLivraison()}});return b};this.affectChangementEtatEdition=function(b){var c=this;b.find(".com-input-text").keyup(function(){c.mEtatEdition=true});b.find(":input[name=typepaiement]").change(function(){c.mEtatEdition=true});return b};this.dialogExportBonDeLivraison=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogExportBonDeLivraison;$(d.template({comNumero:c.mComNumero})).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var e=$(this).find(":input[name=format]:checked").val();var g=new ExportBonLivraisonVO();g.id_commande=c.mIdCommande;g.format=e;g.fonction="export";var f=new ExportBonLivraisonValid();var h=f.validAjout(g);Infobulle.init();if(h.valid){$.download("./index.php?m=GestionCommande&v=BonDeLivraison",g)}else{Infobulle.generer(h,"")}},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.dialogEnregistrer=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogEnregistrement;$(d).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Enregistrer:function(){c.enregistrer();$(this).dialog("close")},Annuler:function(){if(c.mSuiteEdition==1){$("#select-prdt").selectOptions(c.mIdCompteProducteur)}$(this).dialog("close")},"Ne pas Enregistrer":function(){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.changementProducteur();c.dialogExportBonDeLivraison()}}$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.construct(a)}function InfoCommandeArchiveVue(a){this.mIdMarche=0;this.construct=function(b){$.history({vue:function(){InfoCommandeArchiveVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=InfoCommandeArchive","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(e){var d=this;var b=new GestionCommandeTemplate();var g=b.infoCommandeArchive;e.sigleMonetaire=gSigleMonetaire;var c=0;var f=0;$(e.infoCommande).each(function(){d.mIdMarche=this.comId;if(this.stoQuantite==null){this.stoQuantite=0}if(this.opeMontant==null){this.opeMontant=0}if(this.stoQuantiteLivraison==null){this.stoQuantiteLivraison=0}if(this.opeMontantLivraison==null){this.opeMontantLivraison=0}if(this.stoQuantiteSolidaire==null){this.stoQuantiteSolidaire=0}if(this.stoQuantiteVente==null){this.stoQuantiteVente=0}if(this.opeMontantVente==null){this.opeMontantVente=0}if(this.stoQuantiteVenteSolidaire==null){this.stoQuantiteVenteSolidaire=0}if(this.opeMontantVenteSolidaire==null){this.opeMontantVenteSolidaire=0}c-=parseFloat(this.opeMontantLivraison);c+=parseFloat(this.opeMontantVente);f+=parseFloat(this.opeMontantVenteSolidaire);this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");this.opeMontant=this.opeMontant.nombreFormate(2,","," ");this.stoQuantiteLivraison=this.stoQuantiteLivraison.nombreFormate(2,","," ");this.opeMontantLivraison=this.opeMontantLivraison.nombreFormate(2,","," ");this.stoQuantiteSolidaire=this.stoQuantiteSolidaire.nombreFormate(2,","," ");this.stoQuantiteVente=this.stoQuantiteVente.nombreFormate(2,","," ");this.opeMontantVente=this.opeMontantVente.nombreFormate(2,","," ");this.stoQuantiteVenteSolidaire=this.stoQuantiteVenteSolidaire.nombreFormate(2,","," ");this.opeMontantVenteSolidaire=this.opeMontantVenteSolidaire.nombreFormate(2,","," ")});e.total=c.nombreFormate(2,","," ");e.totalSolidaire=f.nombreFormate(2,","," ");e.numero=e.detailMarche.numero;$("#contenu").replaceWith(d.affect($(g.template(e))))};this.affect=function(b){b=this.affectDupliquerMarche(b);b=gCommunVue.comHoverBtn(b);return b};this.affectDupliquerMarche=function(b){var c=this;b.find("#btn-dupliquer-com").click(function(){AjoutCommandeVue({id_marche:c.mIdMarche,fonction:"dupliquer"})});return b};this.construct(a)}function AchatAdherentVue(a){this.pParam={};this.mAdherent=null;this.infoReservation={};this.mAchat={detailAchat:[],detailAchatSolidaire:[]};this.produit=[];this.construct=function(b){$.history({vue:function(){AchatAdherentVue(b)}});var c=this;this.pParam=b;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mAdherent=d.adherent;c.infoReservation=d.reservation;c.produit=d.detailProduit;$(d.achats).each(function(){if(this.detailAchat.length>0){c.mAchat.idAchat=this.id.idAchat;c.mAchat.detailAchat=this.detailAchat}if(this.detailAchatSolidaire.length>0){c.mAchat.idAchatSolidaire=this.id.idAchat;c.mAchat.detailAchatSolidaire=this.detailAchatSolidaire}if(this.dateAchat){c.mAchat.dateAchat=this.dateAchat}});c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(e){var f=this;var c=new GestionCommandeTemplate();var h=c.detailAchatEtReservationEnteteInvite;var g={};g.detailAchat=c.detailAchatVide;if(this.mAdherent.adhId&&this.mAdherent.adhId!=null){g.adhId=this.mAdherent.adhId;g.adhNumero=this.mAdherent.adhNumero;g.adhCompte=this.mAdherent.cptLabel;g.adhNom=this.mAdherent.adhNom;g.adhPrenom=this.mAdherent.adhPrenom;g.adhSolde=this.mAdherent.cptSolde.nombreFormate(2,","," ");h=c.detailAchatEtReservationEntete}g.sigleMonetaire=gSigleMonetaire;var d={};d.sigleMonetaire=gSigleMonetaire;if(f.produit[0]&&f.produit[0].proId!=null){if(this.infoReservation){d.totalReservation=(this.infoReservation.total*-1).nombreFormate(2,","," ")}d.reservation=[];d.categories=[];d.sigleMonetaire=gSigleMonetaire;d.total=0;d.totalSolidaire=0;$.each(f.produit,function(){var j=this;$(f.mAchat).each(function(){var k={unite:j.proUniteMesure,proId:j.proId,nproNom:j.nproNom,stoQuantiteReservation:"",proUniteMesureReservation:"",stoQuantite:"",stoQuantiteAffiche:"",prix:"",prixAffiche:"",proUniteMesure:"",sigleMonetaire:"",stoQuantiteSolidaire:"",stoQuantiteSolidaireAffiche:"",prixSolidaire:"",prixSolidaireAffiche:"",proUniteMesureSolidaire:"",sigleMonetaireSolidaire:""};if(f.infoReservation){$(f.infoReservation.detailReservation).each(function(){if(this.idProduit==j.proId){k.stoQuantiteReservation=(this.quantite*-1).nombreFormate(2,","," ");k.proUniteMesureReservation=j.proUniteMesure}})}$(this.detailAchat).each(function(){if(this.idProduit==j.proId){k.stoQuantiteAffiche=(this.quantite*-1).nombreFormate(2,","," ");k.stoQuantite=(this.quantite*-1).nombreFormate(2,",","");k.prixAffiche=(this.montant*-1).nombreFormate(2,","," ");k.prix=(this.montant*-1).nombreFormate(2,",","");k.proUniteMesure=j.proUniteMesure;k.sigleMonetaire=gSigleMonetaire;d.total+=this.montant*-1}});$(this.detailAchatSolidaire).each(function(){if(this.idProduit==j.proId){k.stoQuantiteSolidaireAffiche=(this.quantite*-1).nombreFormate(2,","," ");k.stoQuantiteSolidaire=(this.quantite*-1).nombreFormate(2,",","");k.prixSolidaireAffiche=(this.montant*-1).nombreFormate(2,","," ");k.prixSolidaire=(this.montant*-1).nombreFormate(2,",","");k.proUniteMesureSolidaire=j.proUniteMesure;k.sigleMonetaireSolidaire=gSigleMonetaire;d.totalSolidaire+=this.montant*-1}});if(!d.categories[j.cproNom]){d.categories[j.cproNom]={nom:j.cproNom,achat:[]}}d.categories[j.cproNom].achat.push(k);if(this.idAchat){d.boutonSupprimerAchat=c.boutonSupprimerAchat.template({idAchat:this.idAchat});d.idAchat=this.idAchat}else{d.idAchat=-1}if(this.idAchatSolidaire){d.boutonSupprimerAchatSolidaire=c.boutonSupprimerAchatSolidaire.template({idAchat:this.idAchatSolidaire});d.idAchatSolidaire=this.idAchatSolidaire}else{d.idAchatSolidaire=-2}})});if(f.mAchat.dateAchat){d.dateAchat=c.dateAchat.template({dateAchat:f.mAchat.dateAchat.extractDbDate().dateDbToFr()})}d.totalMarche=d.total+d.totalSolidaire;d.total=d.total.nombreFormate(2,","," ");d.totalSolidaire=d.totalSolidaire.nombreFormate(2,","," ");d.totalMarche=d.totalMarche.nombreFormate(2,","," ");g.detailAchat=c.detailAchatEtReservation.template(d)}var b=$(h.template(g));if(f.pParam.id_adherent==-3){b.find(".col-reservation").remove();if(d.idAchat>0){b.find(".col-achat-solidaire").remove()}else{b.find(".col-achat").remove()}}$("#contenu").replaceWith(f.affect($(b)))};this.affect=function(b){b=this.affectRetour(b);b=this.affectAjoutProduit(b);b=this.affectModifierAchat(b);b=this.affectSupprimerAchat(b);b=this.affectCalculTotal(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectRetour=function(b){var c=this;b.find("#btn-annuler").click(function(){ListeAchatMarcheVue({id_marche:c.pParam.id_marche})});return b};this.affectAjoutProduit=function(b){var c=this;b.find("#btn-nv-produit").click(function(){c.dialogAjoutProduit()});return b};this.dialogAjoutProduit=function(b){var c=this;var d={fonction:"listeFerme"};$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(d),function(f){Infobulle.init();if(f){if(f.valid){var e=new GestionCommandeTemplate();var g=e.dialogAjoutAchatProduit;$(c.affectAjoutProduitSelectFerme($(g.template(f)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Ajouter:function(){c.ajouterProduit($(this))},Annuler:function(){$(this).dialog("close")}},close:function(h,j){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(f,"")}}},"json");return b};this.affectAjoutProduitSelectFerme=function(b){var c=this;b.find("#pro-idFerme select").change(function(){Infobulle.init();var e=$(this).val();$("#pro-idCategorie select, #pro-idProduit select").prop("disabled",true).selectOptions("0");$("#detail-produit").replaceWith('<div id="detail-produit"></div>');if(e>0){var d={fonction:"listeProduit",id:e};$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(d),function(j){if(j){if(j.valid){Infobulle.init();if(j.listeProduit.length>0&&j.listeProduit[0].nproId!=null){c.mProduits=[];var h=0;var l=[];$.each(j.listeProduit,function(){if(c.mProduits[this.cproId]){c.mProduits[this.cproId].listeProduit.push(this)}else{c.mProduits[this.cproId]={nom:this.cproNom,listeProduit:[this]}}if(h!=this.cproId){l.push({cproId:this.cproId,cproNom:this.cproNom});h=this.cproId}});var f=new GestionCommandeTemplate();var k=f.ajoutProduitSelectCategorie;$("#pro-idCategorie").replaceWith(c.affectAjoutProduitSelectCategorie($(k.template({listeCategorie:l}))))}else{var m=new TemplateVR();m.valid=false;m.log.valid=false;var g=new VRerreur();g.code=ERR_332_CODE;g.message=ERR_332_MSG;m.log.erreurs.push(g);Infobulle.generer(m,"");$("#detail-achat").replaceWith($('<div id="detail-achat">'))}}else{Infobulle.generer(j,"");$("#detail-achat").replaceWith($('<div id="detail-achat">'))}}},"json")}else{$("#detail-achat").replaceWith($('<div id="detail-achat">'))}});return b};this.affectAjoutProduitSelectCategorie=function(b){var c=this;b.find("select").change(function(){Infobulle.init();var f=$(this).val();$("#pro-idProduit select").prop("disabled",true).selectOptions("0");$("#detail-produit").replaceWith('<div id="detail-produit"></div>');if(f>0){var d=new GestionCommandeTemplate();var e=d.ajoutProduitSelectProduit;$("#pro-idProduit").replaceWith(c.affectAjoutProduitSelectProduit($(e.template(c.mProduits[f]))))}else{$("#detail-achat").replaceWith($('<div id="detail-achat">'))}});return b};this.affectAjoutProduitSelectProduit=function(b){var c=this;b.find("select").change(function(){var g=$(this).val();Infobulle.init();if(g>0){var e=true;$(c.produit).each(function(){if(this.nproId==g){e=false}});if(e){var f={fonction:"listeUnite",id:g};$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(f),function(m){if(m){if(m.valid){Infobulle.init();var j=new GestionCommandeTemplate();var n=j.detailProduitAjoutAchatProduit;var l="";$.each(m.unite,function(){l=this.mLotUnite});var k={unite:l,sigleMonetaire:gSigleMonetaire,idProduit:g};$("#detail-achat").replaceWith(c.affectDetailProduit($(n.template(k))))}else{Infobulle.generer(m,"")}}},"json")}else{var h=new TemplateVR();h.valid=false;h.log.valid=false;var d=new VRerreur();d.code=ERR_262_CODE;d.message=ERR_262_MSG;h.log.erreurs.push(d);Infobulle.generer(h,"");$("#detail-achat").replaceWith($('<div id="detail-achat">'))}}else{$("#detail-achat").replaceWith($('<div id="detail-achat">'))}});return b};this.affectDetailProduit=function(b){if(this.pParam.id_adherent==-3){b=this.affectAjoutProduitCompteInvite(b)}b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectAjoutProduitCompteInvite=function(b){b.find("#choixTypeAchat").remove();return b};this.ajouterProduit=function(b){if(b.find("#pro-id").length==1){var e=this;var c=new ProduitAjoutAchatVO();c.idMarche=this.pParam.id_marche;c.idNomProduit=b.find("#pro-id").val();c.prix=b.find("#pro-prix").val().numberFrToDb()*-1;c.quantite=b.find("#pro-quantite").val().numberFrToDb()*-1;if(this.pParam.id_adherent==-3){c.idCompte=-3;c.idOperation=this.pParam.idOperation;if(e.mAchat.idAchat){c.solidaire=0}else{c.solidaire=1}}else{c.idCompte=this.mAdherent.adhIdCompte;c.solidaire=b.find(":input[name=typeProduit]:checked").val()}var d=new ProduitAjoutAchatValid();var f=d.validAjout(c);Infobulle.init();if(f.valid){c.fonction="ajoutProduitAchat";$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(c),function(j){Infobulle.init();if(j){if(j&&j.valid){var g=new TemplateVR();g.valid=false;g.log.valid=false;var h=new VRerreur();h.code=ERR_314_CODE;h.message=ERR_314_MSG;g.log.erreurs.push(h);b.dialog("close");e.rechargerPage()}else{Infobulle.generer(j,"")}}},"json")}else{Infobulle.generer(f,"pro-")}}};this.rechargerPage=function(){this.mAdherent=null;this.infoReservation={};this.mAchat={detailAchat:[],detailAchatSolidaire:[]};this.produit=[];this.construct(this.pParam)};this.affectModifierAchat=function(b){var c=this;b.find("#btn-modif-achat, #btn-annuler-achat").click(function(){$(".btn-achat, .detail-achat-qte, .detail-achat-prix, .total-achat, .solde, #btn-modif-achat-solidaire, #btn-supp-achat-solidaire").toggle()});b.find("#btn-modif-achat-solidaire, #btn-annuler-achat-solidaire").click(function(){$(".btn-achat-solidaire, .detail-achat-qte-solidaire, .total-achat-solidaire, .solde, .detail-achat-prix-solidaire, #btn-modif-achat, #btn-supp-achat").toggle()});b.find("#btn-check-achat, #btn-check-achat-solidaire").click(function(){c.validerModifierAchat($(this).data("id-achat"),$(this).data("type"))});b.find("#btn-modif-achat").click(function(){c.initFormModifierAchat("")});b.find("#btn-modif-achat-solidaire").click(function(){c.initFormModifierAchat("-solidaire")});return b};this.initFormModifierAchat=function(b){var c=0;$(".ligne-produit-achat").each(function(){var e=parseFloat($(this).find(".affiche-produit-quantite"+b).text().numberFrToDb());if(isNaN(e)){e=0}e=e.nombreFormate(2,",","");$(this).find(".produit-quantite"+b).val(e);var d=parseFloat($(this).find(".affiche-produit-prix"+b).text().numberFrToDb());if(isNaN(d)){d=0}c=(parseFloat(c)+parseFloat(d)).toFixed(2);d=d.nombreFormate(2,",","");$(this).find(".produit-prix"+b).val(d)});$("#affiche-total-modification"+b).text(c.nombreFormate(2,","," "));$("#affiche-solde-modification").text($("#affiche-solde").text())};this.affectCalculTotal=function(b){var c=this;b.find(".produit-prix").keyup(function(){c.majTotal("")});b.find(".produit-prix-solidaire").keyup(function(){c.majTotal("-solidaire")});return b};this.majTotal=function(c){var d=0;$(".produit-prix"+c).each(function(){var f=parseFloat($(this).val().numberFrToDb());if(!isNaN(f)){d=(parseFloat(d)+f).toFixed(2)}});$("#affiche-total-modification"+c).text(d.nombreFormate(2,","," "));var b=parseFloat($("#affiche-solde").text().numberFrToDb());if(isNaN(b)){b=0}var e=parseFloat($("#affiche-total"+c).text().numberFrToDb());if(isNaN(e)){e=0}b=(b+e-d).toFixed(2);$("#affiche-solde-modification").text(b.nombreFormate(2,","," "))};this.affectSupprimerAchat=function(b){var c=this;b.find("#btn-supp-achat, #btn-supp-achat-solidaire").click(function(){c.supprimerAchat($(this).data("id-achat"))});return b};this.validerModifierAchat=function(f,c){var e=this;if(c!=""){c="-"+c}var b={};b.idAchat=f;b.produits=[];var j=[];$(".ligne-produit-achat").each(function(){var l=new ProduitAchatVO();l.id=$(this).data("id-produit");var m=$(this).find(".produit-quantite"+c).val().numberFrToDb();if(!isNaN(m)&&!m.isEmpty()&&m!=0){m=parseFloat(m);l.quantite=m*-1;var k=$(this).find(".produit-prix"+c).val().numberFrToDb();if(!isNaN(k)&&!k.isEmpty()&&k!=0){k=parseFloat(k);l.prix=k*-1}b.produits.push(l)}else{var k=$(this).find(".produit-prix"+c).val().numberFrToDb();if(!isNaN(k)&&!k.isEmpty()&&k!=0){k=parseFloat(k);l.prix=k*-1;b.produits.push(l)}}j.push(l)});if(parseInt(f)<0){b.idCompte=e.mAdherent.adhIdCompte;b.idMarche=e.pParam.id_marche}var d=new AchatAdherentValid();var h=d.validUpdate(b);Infobulle.init();if(h.valid){var g={fonction:"modifierAchat",achat:b};$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(g),function(m){Infobulle.init();if(m){if(m&&m.valid){var k=new TemplateVR();k.valid=false;k.log.valid=false;var l=new VRerreur();l.code=ERR_314_CODE;l.message=ERR_314_MSG;k.log.erreurs.push(l);e.pParam.vr=k;e.rechargerPage(e.pParam)}else{Infobulle.generer(m,"")}}},"json")}else{Infobulle.generer(h,"achat-"+f+"-")}};this.supprimerAchat=function(d){var c=this;var b=new GestionCommandeTemplate();var e=b.dialogSupprimerAchat;$(e).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var g=this;var f={fonction:"supprimerAchat",idAchat:d};$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(f),function(k){Infobulle.init();if(k){if(k&&k.valid){var h=new TemplateVR();h.valid=false;h.log.valid=false;var j=new VRerreur();j.code=ERR_315_CODE;j.message=ERR_315_MSG;h.log.erreurs.push(j);c.pParam.vr=h;if(c.pParam.id_adherent==-3){ListeAchatMarcheVue({id_marche:c.pParam.id_marche})}else{c.rechargerPage(c.pParam)}$(g).dialog("close")}else{Infobulle.generer(k,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}})};this.construct(a)}function BonDeCommandeVue(a){this.mIdCommande=null;this.mComNumero=null;this.mEtatEdition=false;this.mListeProduit=[];this.mSuiteEdition=0;this.mIdCompteProducteur=0;this.mArchive=-1;this.mAfficheLot=[];this.construct=function(b){$.history({vue:function(){BonDeCommandeVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=BonDeCommande","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mEtatEdition=false;c.mArchive=d.archive;c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var d=this;var b=new GestionCommandeTemplate();var e=b.bonDeCommande;this.mIdCommande=c.producteurs[0].proIdCommande;this.mComNumero=c.comNumero;$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affectDroitArchive=function(b){b.find("#btn-annuler").remove();b.find("#btn-enregistrer").remove();b.find("#btn-modifier").remove();return b};this.affect=function(b){b=gCommunVue.comHoverBtn(b);b=this.affectBtnRetourMarche(b);b=this.affectChangementProducteur(b);b=this.affectExportBonCommande(b);return b};this.affectBtnRetourMarche=function(b){var c=this;b.find("#btn-editer-com").click(function(){EditerCommandeVue({id_marche:c.mIdCommande})});return b};this.affectChangementProducteur=function(b){var c=this;b.find("#select-prdt").change(function(){if(c.mEtatEdition){c.mSuiteEdition=1;c.dialogEnregistrer()}else{c.changementProducteur()}});return b};this.changementProducteur=function(c){var d=this;var e=$("#select-prdt").val();if(e>0){var f={id_commande:d.mIdCommande,id_compte_ferme:e,fonction:"afficherProducteur"};$.post("./index.php?m=GestionCommande&v=BonDeCommande","pParam="+$.toJSON(f),function(h){Infobulle.init();if(h){if(h.valid){$("#btn-export-bcom").show();d.mIdCompteProducteur=e;d.mEtatEdition=false;if(h.produitsCommande[0]&&h.produitsCommande[0].proIdCommande!=null){d.afficherDetail(h)}else{d.afficherFormulaire(h)}if(c&&c.vr){Infobulle.generer(c.vr,"")}}else{Infobulle.generer(h,"")}}},"json")}else{var b=new GestionCommandeTemplate();var g=b.listeProduitVide;$("#liste-pdt").replaceWith(g);$("#btn-export-bcom").hide()}};this.afficherDetail=function(c){var d=this;this.mAfficheLot=[];$(c.produits).each(function(){if(d.mAfficheLot[this.proId]){d.mAfficheLot[this.proId]=2}else{d.mAfficheLot[this.proId]=1}d.mListeProduit[this.dcomId]=this.stoQuantite;this.stoQuantiteCommande="0";this.dopeMontant="0";var g=this.dcomId;var f=this;$(c.produitsCommande).each(function(){if(this.dcomId==g){f.stoQuantiteCommande=this.stoQuantite;f.dopeMontant=this.dopeMontant}});if(this.stoQuantiteCommande-this.stoQuantite<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}if(this.stoQuantiteCommande!=""){this.stoQuantiteCommandeAffichage=this.stoQuantiteCommande.nombreFormate(2,","," ");this.stoQuantiteCommande=this.stoQuantiteCommande.nombreFormate(2,",","")}if(this.stoQuantite==null){this.stoQuantite="0"}this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");this.dopeMontantAffichage=this.dopeMontant.nombreFormate(2,","," ");this.dopeMontant=this.dopeMontant.nombreFormate(2,",","")});$(c.produits).each(function(){if(d.mAfficheLot[this.proId]&&d.mAfficheLot[this.proId]==2){this.nproNom+=" ("+this.dcomTaille.nombreFormate(2,","," ")+" "+this.proUniteMesure+")"}});c.sigleMonetaire=gSigleMonetaire;var b=new GestionCommandeTemplate();var e=b.listeProduitBonDeCommande;$("#liste-pdt").replaceWith(d.affectListeProduit($(e.template(c))))};this.afficherFormulaire=function(c){var d=this;this.mAfficheLot=[];$(c.produits).each(function(){if(d.mAfficheLot[this.proId]){d.mAfficheLot[this.proId]=2}else{d.mAfficheLot[this.proId]=1}d.mListeProduit[this.dcomId]=this.stoQuantite;if(this.stoQuantite==null){this.stoQuantite=0}this.stoQuantiteCommande=this.stoQuantite;this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");if(this.dopeMontant==null){this.dopeMontant="0".nombreFormate(2,",","")}else{this.dopeMontant=(this.dopeMontant*-1).nombreFormate(2,",","")}if(this.stoQuantiteCommande-this.stoQuantite<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}this.stoQuantiteCommande=this.stoQuantiteCommande.nombreFormate(2,",","")});$(c.produits).each(function(){if(d.mAfficheLot[this.proId]&&d.mAfficheLot[this.proId]==2){this.nproNom+=" ("+this.dcomTaille.nombreFormate(2,","," ")+" "+this.proUniteMesure+")"}});c.sigleMonetaire=gSigleMonetaire;var b=new GestionCommandeTemplate();var e=b.listeProduitBonDeCommande;$("#liste-pdt").replaceWith(d.affectListeProduitFormulaire($(e.template(c))))};this.affectListeProduit=function(b){b=this.affectEtatCommande(b);b=this.affectEnregistrer(b);b=this.affectModifier(b);b=this.affectMasquerFormulaire(b);b=this.affectCalculPrix(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectListeProduitFormulaire=function(b){b=this.affectEtatCommande(b);b=this.affectEnregistrer(b);b=this.affectModifier(b);b=this.affectMasquerDetail(b);b=this.affectCalculPrix(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectMasquerDetail=function(b){b.find(".detail").hide();return b};this.affectMasquerFormulaire=function(b){b.find(".formulaire").hide();return b};this.affectEtatCommande=function(b){var c=this;b.find(".qte-commande").keyup(function(){c.mEtatEdition=true;var d=$(this).data("id-detail-commande");if(c.mListeProduit[d]){if($(this).val().numberFrToDb()-c.mListeProduit[d]<0){$("#etat-commande-"+d).removeClass("qte-reservation-ok").addClass("qte-reservation-ko")}else{$("#etat-commande-"+d).removeClass("qte-reservation-ko").addClass("qte-reservation-ok")}}});return b};this.affectEnregistrer=function(b){var c=this;b.find("#btn-enregistrer").click(function(){c.mSuiteEdition=0;c.enregistrer()});b.find(".qte-commande ,.prix-commande ").keyup(function(d){if(d.keyCode=="13"){c.mSuiteEdition=0;c.enregistrer()}});return b};this.affectModifier=function(b){var c=this;b.find("#btn-modifier").click(function(){$(".detail").hide();$(".formulaire, #btn-annuler").show()});b.find("#btn-annuler").click(function(){c.changementProducteur()});return b};this.affectCalculPrix=function(b){b.find(".qte-commande").keyup(function(){var c=($(this).val().numberFrToDb()*$(this).data("prix")/$(this).data("taille")).toFixed(2);if(isNaN(c)||c<=0){c=""}else{c=c.nombreFormate(2,",","")}$(":input[name=prix-commande-"+$(this).data("id-produit")+"-"+$(this).data("id-detail-commande")+"]").val(c)});return b};this.enregistrer=function(){var c=this;var d=new ProduitsBonDeCommandeVO();d.id_commande=this.mIdCommande;d.id_compte_ferme=this.mIdCompteProducteur;d.export_type=0;$(".qte-commande").each(function(){var g=$(this).data("id-produit");var f=$(this).data("id-detail-commande");var h=new ProduitBonDeCommandeVO();h={id:g,dcomId:f,quantite:$(":input[name=qte-commande-"+g+"-"+f+"]").val().numberFrToDb(),prix:$(":input[name=prix-commande-"+g+"-"+f+"]").val().numberFrToDb()};d.produits.push(h)});var b=new ProduitsBonDeCommandeValid();var e=b.validAjout(d);if(e.valid){d.fonction="enregistrer";return $.post("./index.php?m=GestionCommande&v=BonDeCommande","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g){if(g.valid){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.dialogExportBonDeCommande()}else{var h=new TemplateVR();h.valid=false;h.log.valid=false;var f=new VRerreur();f.code=ERR_301_CODE;f.message=ERR_301_MSG;h.log.erreurs.push(f);c.changementProducteur({vr:h})}}}else{Infobulle.generer(g,"")}}},"json")}else{Infobulle.generer(e,"")}};this.affectExportBonCommande=function(b){var c=this;b.find("#btn-export-bcom").click(function(){if(c.mEtatEdition){c.mSuiteEdition=2;c.dialogEnregistrer()}else{c.dialogExportBonDeCommande()}});return b};this.dialogExportBonDeCommande=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogExportBonDeCommande;$(d.template({comNumero:c.mComNumero})).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var e=$(this).find(":input[name=format]:checked").val();var g=new ExportBonReservationVO();g.id_commande=c.mIdCommande;g.format=e;g.fonction="export";g.idCompteFerme=$("#select-prdt").val();var f=new ExportBonReservationValid();var h=f.validAjout(g);Infobulle.init();if(h.valid){$.download("./index.php?m=GestionCommande&v=BonDeCommande",g)}else{Infobulle.generer(h,"")}},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.dialogEnregistrer=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogEnregistrement;$(d).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Enregistrer:function(){c.enregistrer();$(this).dialog("close")},Annuler:function(){if(c.mSuiteEdition==1){$("#select-prdt").selectOptions(c.mIdCompteProducteur)}$(this).dialog("close")},"Ne pas Enregistrer":function(){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.changementProducteur();c.dialogExportBonDeCommande()}}$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.construct(a)}function ReservationAdherentVue(a){this.mAdherent=null;this.infoCommande=new Object();this.pdtCommande=new Array();this.reservation=new Array();this.reservationModif=new Array();this.solde=0;this.soldeNv=0;this.mPremiereReservation=true;this.construct=function(b){$.history({vue:function(){ReservationAdherentVue(b)}});var c=this;b.fonction="afficherReservation";$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mAdherent=d.adherent;c.infoCommande.comId=d.marche.id;c.infoCommande.comNumero=d.marche.numero;c.infoCommande.comNom=d.marche.nom;c.infoCommande.comDescription=d.marche.description;c.infoCommande.dateTimeFinReservation=d.marche.dateFinReservation;c.infoCommande.dateFinReservation=d.marche.dateFinReservation.extractDbDate().dateDbToFr();c.infoCommande.heureFinReservation=d.marche.dateFinReservation.extractDbHeure();c.infoCommande.minuteFinReservation=d.marche.dateFinReservation.extractDbMinute();c.infoCommande.dateMarcheDebut=d.marche.dateMarcheDebut.extractDbDate().dateDbToFr();c.infoCommande.heureMarcheDebut=d.marche.dateMarcheDebut.extractDbHeure();c.infoCommande.minuteMarcheDebut=d.marche.dateMarcheDebut.extractDbMinute();c.infoCommande.heureMarcheFin=d.marche.dateMarcheFin.extractDbHeure();c.infoCommande.minuteMarcheFin=d.marche.dateMarcheFin.extractDbMinute();c.infoCommande.comArchive=d.marche.archive;c.pdtCommande=d.marche.produits;$.each(c.pdtCommande,function(){if(this.id){var e=this.id;$.each(this.lots,function(){if(this.id){var f=this.id;$(d.reservation).each(function(){if(this.idDetailCommande==f){this.stoQuantite=this.quantite*-1;this.dcomId=this.idDetailCommande;this.proId=e;c.reservation[e]=this}})}})}});if(d.reservation.length>0){c.mPremiereReservation=false;c.afficher(1)}else{c.afficher(2)}}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(b){if(b==1){this.afficherDetailReservation()}else{this.afficherModifier()}};this.afficherDetailReservation=function(){var f=this;var b=new GestionCommandeTemplate();var c=b.detailReservation;var d={};d.adhId=this.mAdherent.adhId;d.adhNumero=this.mAdherent.adhNumero;d.adhCompte=this.mAdherent.cptLabel;d.adhNom=this.mAdherent.adhNom;d.adhPrenom=this.mAdherent.adhPrenom;d.adhSolde=this.mAdherent.cptSolde.nombreFormate(2,","," ");d.sigleMonetaire=gSigleMonetaire;d.comNumero=this.infoCommande.comNumero;d.dateFinReservation=this.infoCommande.dateFinReservation;d.heureFinReservation=this.infoCommande.heureFinReservation;d.minuteFinReservation=this.infoCommande.minuteFinReservation;d.dateMarcheDebut=this.infoCommande.dateMarcheDebut;d.heureMarcheDebut=this.infoCommande.heureMarcheDebut;d.minuteMarcheDebut=this.infoCommande.minuteMarcheDebut;d.heureMarcheFin=this.infoCommande.heureMarcheFin;d.minuteMarcheFin=this.infoCommande.minuteMarcheFin;var j=0;var k="";var h=[];var e=[];var g=0;$.each(this.pdtCommande,function(){var m=this;if(f.reservation[this.id]){if(j==0){j=this.idCategorie;k=this.cproNom}var l=new Object;l.proId=m.id;l.nproNom=this.nom;l.stoQuantite=parseFloat(f.reservation[this.id].stoQuantite);l.proUniteMesure=this.unite;l.prix=0;var n=f.reservation[this.id].dcomId;$.each(this.lots,function(){if(this.id==n){l.prix=(l.stoQuantite/this.taille)*this.prix}});g+=l.prix;l.stoQuantite=l.stoQuantite.nombreFormate(2,","," ");l.prix=l.prix.nombreFormate(2,","," ");l.flagType="";if(m.type==2){l.flagType=b.flagAbonnement}if(j!=this.idCategorie){h.push({nom:k,produits:e});j=this.idCategorie;k=this.cproNom;e=[]}e.push(l)}});d.total=parseFloat(g).nombreFormate(2,","," ");h.push({nom:k,produits:e});d.categories=h;$("#contenu").replaceWith(f.affect($(c.template(d))))};this.afficherModifier=function(){var f=this;var b=new GestionCommandeTemplate();var c=b.modifierReservation;var d={};d.adhId=this.mAdherent.adhId;d.adhNumero=this.mAdherent.adhNumero;d.adhCompte=this.mAdherent.cptLabel;d.adhNom=this.mAdherent.adhNom;d.adhPrenom=this.mAdherent.adhPrenom;d.adhSolde=this.mAdherent.cptSolde.nombreFormate(2,","," ");d.adhNouveauSolde=0;d.sigleMonetaire=gSigleMonetaire;d.comNumero=this.infoCommande.comNumero;d.dateFinReservation=this.infoCommande.dateFinReservation;d.heureFinReservation=this.infoCommande.heureFinReservation;d.minuteFinReservation=this.infoCommande.minuteFinReservation;d.dateMarcheDebut=this.infoCommande.dateMarcheDebut;d.heureMarcheDebut=this.infoCommande.heureMarcheDebut;d.minuteMarcheDebut=this.infoCommande.minuteMarcheDebut;d.heureMarcheFin=this.infoCommande.heureMarcheFin;d.minuteMarcheFin=this.infoCommande.minuteMarcheFin;var j=0;var k="";var h=[];var e=[];var g=0;$.each(this.pdtCommande,function(){if(this.id){if(j==0){j=this.idCategorie;k=this.cproNom}var m={};m.proId=this.id;m.nproNom=this.nom;m.proUniteMesure=this.unite;m.proMaxProduitCommande=parseFloat(this.qteMaxCommande);m.flagType="";if(f.reservation[this.id]){m.stock=parseFloat(this.stockReservation)+parseFloat(f.reservation[this.id].stoQuantite)}else{m.stock=parseFloat(this.stockReservation)}m.lot=new Array();var o=false;if(parseFloat(this.qteMaxCommande)==-1&&parseFloat(this.stockInitial)==-1){o=true}else{if(parseFloat(this.stockInitial)==-1){m.max=m.proMaxProduitCommande}else{if(parseFloat(this.qteMaxCommande)==-1){m.max=m.stock}else{if(parseFloat(m.proMaxProduitCommande)<parseFloat(m.stock)){m.max=m.proMaxProduitCommande}else{m.max=m.stock}}}}var n=-1;m.stoQuantiteReservation=0;m.prixReservation=0;$.each(this.lots,function(){if(this.id){if(o||(!o&&parseFloat(this.taille)<=m.max)){var p={};p.dcomId=this.id;p.dcomTaille=parseFloat(this.taille).nombreFormate(2,","," ");p.dcomPrix=parseFloat(this.prix).nombreFormate(2,","," ");p.prixReservation=parseFloat(this.prix);p.stoQuantiteReservation=parseFloat(this.taille);if(f.reservation[m.proId]&&(f.reservation[m.proId].dcomId==this.id)){p.stoQuantiteReservation=parseFloat(f.reservation[m.proId].stoQuantite);p.prixReservation=(p.stoQuantiteReservation/this.taille)*this.prix;g+=p.prixReservation;n=this.id;p.checked='checked="checked"';m.stoQuantiteReservation=p.stoQuantiteReservation.nombreFormate(2,","," ");m.prixReservation=p.prixReservation.nombreFormate(2,","," ")}if(m.prixReservation==0){m.stoQuantiteReservation=p.stoQuantiteReservation.nombreFormate(2,","," ");m.prixReservation=p.prixReservation.nombreFormate(2,","," ")}m.prixUnitaire=(p.prixReservation/p.stoQuantiteReservation).nombreFormate(2,","," ");m.lot.push(p)}}});d.total=parseFloat(g).nombreFormate(2,","," ");if(n!=-1){m.checked='checked="checked"'}else{m.checked=""}m.sigleMonetaire=gSigleMonetaire;var l=true;if(this.type==0){if(m.lot.length==0){m.nom=this.nom;m.detailProduit=b.produitIndisponible.template(m)}else{m.detailProduit=b.formReservationProduit.template(m)}}else{if(this.type==1){m.flagType=b.flagSolidaire;m.detailProduit=b.formReservationProduitInfo.template(m)}else{if(this.type==2){m.flagType=b.flagAbonnement;if(m.lot.length==0){l=false}else{m.detailProduit=b.formReservationProduit.template(m)}}}}if(l){if(j!=this.idCategorie){h.push({nom:k,produits:e});j=this.idCategorie;k=this.cproNom;e=[]}e.push(m)}}});h.push({nom:k,produits:e});d.categories=h;this.reservationModif=[];$(this.reservation).each(function(){if(this.proId){f.reservationModif[this.proId]={proId:this.proId,dcomId:this.dcomId,stoQuantite:this.stoQuantite}}});$("#contenu").replaceWith(f.affectModifier($(c.template(d))));this.majNouveauSolde()};this.affectDroitArchive=function(b){b.find(".boutons-edition").remove();b.find(".boutons-edition-modification").remove();return b};this.affect=function(b){b=this.affectModifierReservation(b);b=this.affectAnnulerDetailReservation(b);b=this.affectSupprimerReservation(b);b=this.affectInfoProduit(b);b=gCommunVue.comHoverBtn(b);if(this.infoCommande.comArchive==2){b=this.affectDroitArchive(b)}return b};this.affectModifier=function(b){b=this.affectBtnQte(b);b=this.affectChangementLot(b);b=this.affectChangementProduit(b);b=this.preparerAffichageModifier(b);b=this.affectValiderReservation(b);b=this.affectAnnulerReservation(b);b=this.supprimerSelect(b);b=this.affectNouveauSolde(b);b=this.affectInitLot(b);b=this.affectInfoProduit(b);b=gCommunVue.comHoverBtn(b);if(this.infoCommande.comArchive==2){b=this.affectDroitArchive(b)}return b};this.affectInfoProduit=function(b){b.find(".btn-info-produit").click(function(){var d=$(this).attr("id-produit");var c={id:d,fonction:"detailProduit"};$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(c),function(g){Infobulle.init();if(g){if(g.valid){var f=new GestionCommandeTemplate();var h=f.dialogInfoProduit;g.produit.sigleMonetaire=gSigleMonetaire;var e=$(h.template(g.produit));if(g.produit.producteurs.length>0&&g.produit.producteurs[0].nPrdtIdNomProduit==null){e.find("#pro-prdt").remove()}if(g.produit.caracteristiques.length>0&&g.produit.caracteristiques[0].carProIdNomProduit==null){e.find("#pro-car").remove()}$(e).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,close:function(j,k){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(g,"")}}},"json")});return b};this.affectBtnQte=function(b){var c=this;b.find(".btn-plus").click(function(){Infobulle.init();var d=$(this).parent().parent().find(".pdt-id").text();c.nouvelleQuantite(d,$(this).parent().parent().find("#lot-"+d).val(),1)});b.find(".btn-moins").click(function(){Infobulle.init();var d=$(this).parent().parent().find(".pdt-id").text();c.nouvelleQuantite(d,$(this).parent().parent().find("#lot-"+d).val(),-1)});return b};this.affectChangementLot=function(b){var c=this;b.find(".pdt select").change(function(){Infobulle.init();c.changerLot($(this).parent().parent().find(".pdt-id").text(),$(this).val())});return b};this.affectChangementProduit=function(b){var c=this;b.find(".pdt :checkbox").click(function(){Infobulle.init();c.changerProduit($(this).parent().parent().find(".pdt-id").text())});return b};this.affectValiderReservation=function(b){var c=this;b.find("#btn-valider").click(function(){c.validerReservation()});return b};this.affectAnnulerReservation=function(b){var c=this;b.find("#btn-annuler").click(function(){if(c.mPremiereReservation){ListeReservationMarcheVue({id_marche:c.infoCommande.comId})}else{c.afficherDetailReservation()}});return b};this.affectModifierReservation=function(b){var c=this;b.find("#btn-modifier").click(function(){c.afficherModifier()});return b};this.affectAnnulerDetailReservation=function(b){var c=this;b.find("#btn-annuler").click(function(){ListeReservationMarcheVue({id_marche:c.infoCommande.comId})});return b};this.affectInitLot=function(b){var c=this;b.find(".pdt select").each(function(){var d=$(this).parent().parent().find(".pdt-id").text();var g=$(this).val();if(c.pdtCommande[d]&&c.pdtCommande[d].lots[g]){var e=c.pdtCommande[d].lots[g].prix;var h=c.pdtCommande[d].lots[g].taille;var f=(e/h).nombreFormate(2,","," ");$(b).find("#prix-unitaire-"+d).text(f)}});return b};this.nouvelleQuantite=function(g,o,b){var k=parseFloat(this.pdtCommande[g].qteMaxCommande);var m=0;if(this.reservation[g]){m=parseFloat(this.pdtCommande[g].stockReservation)+parseFloat(this.reservation[g].stoQuantite)}else{m=parseFloat(this.pdtCommande[g].stockReservation)}var h=false;if(parseFloat(this.pdtCommande[g].qteMaxCommande)==-1&&parseFloat(this.pdtCommande[g].stockInitial)==-1){h=true}else{if(parseFloat(this.pdtCommande[g].stockInitial)==-1){k=this.pdtCommande[g].qteMaxCommande}else{if(parseFloat(this.pdtCommande[g].qteMaxCommande)==-1){k=m}else{if(parseFloat(m)<parseFloat(k)){k=m}}}}var p=this.pdtCommande[g].lots[o].taille;var n=this.pdtCommande[g].lots[o].prix;var e=0;if(this.reservationModif[g]&&(this.reservationModif[g].dcomId==o)){e=parseFloat(this.reservationModif[g].stoQuantite)/parseFloat(p)}e+=b;var c=0;c=e*p;if((h&&c>0)||(!h&&c>0&&c<=k)){var f=0;f=(e*n).toFixed(2);this.reservationModif[g].stoQuantite=c;$("#qte-pdt-"+g).text(parseFloat(c).nombreFormate(2,","," "));$("#prix-pdt-"+g).text(parseFloat(f).nombreFormate(2,","," "));this.majTotal()}else{if(c>k&&k!=-1){var j=new TemplateVR();j.valid=false;j.commandes=[];var d=new ReservationCommandeVR();d.valid=false;d.stoQuantite.valid=false;var l=new VRerreur();l.code=ERR_304_CODE;l.message=ERR_304_MSG;d.stoQuantite.erreurs.push(l);j.commandes[g]=d;Infobulle.generer(j,"")}}};this.changerLot=function(b,c){var d=this.pdtCommande[b].lots[c].prix;var f=this.pdtCommande[b].lots[c].taille;var e=(d/f).nombreFormate(2,","," ");$("#prix-unitaire-"+b).text(e);if(this.reservationModif[b]){this.reservationModif[b].dcomId=c;this.reservationModif[b].stoQuantite=f;$("#qte-pdt-"+b).text(f.nombreFormate(2,","," "));$("#prix-pdt-"+b).text(d.nombreFormate(2,","," "))}this.majTotal()};this.changerProduit=function(b){if(this.reservationModif[b]!=null){$(".resa-pdt-"+b).hide();$("#qte-pdt-"+b).text("");$("#prix-pdt-"+b).text("");this.reservationModif[b]=null}else{var e=$("#lot-"+b).val();var f=this.pdtCommande[b].lots[e].taille;var d={};d.comId=this.infoCommande.comId;d.proId=b;d.dcomId=e;d.stoQuantite=f;this.reservationModif[b]=d;$("#qte-pdt-"+b).text(f.nombreFormate(2,","," "));var c=this.pdtCommande[b].lots[e].prix.nombreFormate(2,","," ");$("#prix-pdt-"+b).text(c);$(".resa-pdt-"+b).show()}this.majTotal()};this.majTotal=function(){$("#total").text(this.calculTotal().nombreFormate(2,","," "));this.majNouveauSolde()};this.majNouveauSolde=function(){var b=this.mAdherent.cptSolde-this.calculTotal();if(b<=0){$("#nouveau-solde").addClass("com-nombre-negatif");$("#nouveau-solde-sigle").addClass("com-nombre-negatif")}else{$("#nouveau-solde").removeClass("com-nombre-negatif");$("#nouveau-solde-sigle").removeClass("com-nombre-negatif")}$("#nouveau-solde").text(b.nombreFormate(2,","," "))};this.affectNouveauSolde=function(c){var b=this.mAdherent.cptSolde-this.calculTotal();if(b<=0){c.find("#nouveau-solde").addClass("com-nombre-negatif");c.find("#nouveau-solde-sigle").addClass("com-nombre-negatif")}else{c.find("#nouveau-solde").removeClass("com-nombre-negatif");c.find("#nouveau-solde-sigle").removeClass("com-nombre-negatif")}c.find("#nouveau-solde").text(b.nombreFormate(2,","," "));return c};this.calculTotal=function(){var c=this;var b=0;$(this.reservationModif).each(function(){var d=this;if(d.stoQuantite){if(c.pdtCommande[d.proId]){$.each(c.pdtCommande[d.proId].lots,function(){if(d.dcomId==this.id){b+=(d.stoQuantite/this.taille)*this.prix}})}}});return b};this.preparerAffichageModifier=function(b){var c=this;$(b).find(".pdt").each(function(){var d=$(this).find(".pdt-id").text();if(c.reservation[d]!=null){var g=c.reservation[d];var f=g.dcomId;var h=g.stoQuantite;$(b).find("#qte-pdt-"+d).text(h.nombreFormate(2,","," "));var e=((c.pdtCommande[d].lots[f].prix*g.stoQuantite)/c.pdtCommande[d].lots[f].taille).nombreFormate(2,","," ");$(b).find("#prix-pdt-"+d).text(e);$(b).find("#lot-"+d).selectOptions(f);$(b).find(".resa-pdt-"+d).css("display","table-cell")}});return b};this.validerReservation=function(){var e=this;Infobulle.init();var c=new ListeReservationCommandeVO();var f=0;$(this.reservationModif).each(function(){if(this.stoQuantite){var h=new ReservationCommandeVO();h.stoQuantite=this.stoQuantite*-1;h.stoIdDetailCommande=this.dcomId;c.detailReservation.push(h);f++}});if(f>0){var d=new ListeReservationCommandeValid();var g=d.validAjout(c);if(!g.valid){Infobulle.generer(g,"")}else{c.fonction="modifierReservation";c.id_compte=this.mAdherent.adhIdCompte;$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(c),function(j){Infobulle.init();if(j){if(j.valid){e.reservation=[];$(e.reservationModif).each(function(){if(this.proId){e.reservation[this.proId]={proId:this.proId,dcomId:this.dcomId,stoQuantite:this.stoQuantite}}});if(e.mPremiereReservation){e.mPremiereReservation=false;var k=new TemplateVR();k.valid=false;k.log.valid=false;var h=new VRerreur();h.code=ERR_350_CODE;h.message=ERR_350_MSG;k.log.erreurs.push(h);Infobulle.generer(k,"")}else{var k=new TemplateVR();k.valid=false;k.log.valid=false;var h=new VRerreur();h.code=ERR_337_CODE;h.message=ERR_337_MSG;k.log.erreurs.push(h);Infobulle.generer(k,"")}e.afficher(1)}else{Infobulle.generer(j,"")}}},"json")}}else{var g=new TemplateVR();g.valid=false;g.log.valid=false;var b=new VRerreur();b.code=ERR_207_CODE;b.message=ERR_207_MSG;g.log.erreurs.push(b);Infobulle.generer(g,"")}};this.affectSupprimerReservation=function(b){var c=this;b.find("#btn-supprimer").click(function(){var d=new GestionCommandeTemplate();var e=d.supprimerReservationDialog;$(e).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var f={id_commande:c.infoCommande.comId,id_compte:c.mAdherent.adhIdCompte,fonction:"supprimerReservation"};var g=this;$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(f),function(j){Infobulle.init();if(j){if(j.valid){var k=new TemplateVR();k.valid=false;k.log.valid=false;var h=new VRerreur();h.code=ERR_303_CODE;h.message=ERR_303_MSG;k.log.erreurs.push(h);ListeReservationMarcheVue({id_marche:c.infoCommande.comId,vr:k});$(g).dialog("close")}else{Infobulle.generer(j,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove()}})});return b};this.supprimerSelect=function(b){b.find(".pdt select").each(function(){if($(this).find("option").size()==1){var c=new GestionCommandeTemplate();var e=c.lotUnique;var d={};d.IdPdt=$(this).parent().parent().find(".pdt-id").text();d.valeur=$(this).val();d.text=$(this).text();$(this).replaceWith(e.template(d))}});return b};this.construct(a)}function ListeReservationMarcheVue(a){this.mIdMarche=null;this.construct=function(b){$.history({vue:function(){ListeReservationMarcheVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=ListeReservationMarche","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b.vr){Infobulle.generer(b.vr,"")}c.mIdMarche=b.id_marche;c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var e=this;var c=new GestionCommandeTemplate();var f="";if(d.listeAdherent[0].adhId&&d.listeAdherent[0].adhId!=null){f=c.listeReservation;$.each(d.listeAdherent,function(){this.adhIdTri=this.adhNumero.replace("Z","")})}else{f=c.listeReservationVide}d.infoMarcheSelected="";d.listeReservationSelected="ui-state-active";d.listeAchatSelected="";d.resumeMarcheSelected="";d.editerMenu=c.editerMarcheMenu.template(d);var b=e.affectReservationAction($(f.template(d)));$("#contenu").replaceWith(b)};this.affectReservationAction=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectExportReservation(b);b=this.affectReservation(b);b=this.affectMenu(b);b=gCommunVue.comHoverBtn(b);return b};this.affectMenu=function(b){var c=this;b.find("#btn-information-marche").click(function(){EditerCommandeVue({id_marche:c.mIdMarche})});b.find("#btn-liste-achat-resa").click(function(){ListeAchatMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-liste-resa").click(function(){ListeReservationMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-resume-marche").click(function(){ResumeMarcheVue({id_marche:c.mIdMarche})});return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[2,0]],headers:{4:{sorter:false}}});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectReservation=function(b){var c=this;b.find(".edt-com-reservation-ligne").click(function(){ReservationAdherentVue({id_commande:c.mIdMarche,id_adherent:$(this).attr("id-adherent")})});return b};this.affectExportReservation=function(b){var c=this;b.find("#btn-export-resa").click(function(){var d=new GestionCommandeTemplate();var f=d.dialogExportListeReservation;var e={fermes:[]};$(c.mListeFerme.fermes).each(function(h,k){var j=false;var g={ferId:this.ferId,ferNom:this.ferNom,categories:[]};$(this.categories).each(function(l,o){var n=false;var m={cproId:this.cproId,cproNom:this.cproNom,produits:[]};$(this.produits).each(function(p,q){if(this.type==2||this.type==0){m.produits.push(this);j=true;n=true}});if(n){g.categories.push(m)}});if(j){e.fermes.push(g)}});$(f.template(e)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var j="";$(this).find(":input[name=id_produits]:checked").each(function(){j+=$(this).val()+","});j=j.substr(0,j.length-1);var g=$(this).find(":input[name=format]:checked").val();var k=new ExportListeReservationVO();k={fonction:"exportReservation",id_commande:c.mIdMarche,id_produits:j,format:g};var h=new ExportListeReservationValid();var l=h.validAjout(k);Infobulle.init();if(l.valid){$.download("./index.php?m=GestionCommande&v=ListeReservationMarche",k)}else{Infobulle.generer(l,"")}},Annuler:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})});return b};this.construct(a)}function EditerCommandeVue(a){this.mArchive=-1;this.mIdMarche=null;this.mMarche=new MarcheVO();this.mListeFerme=null;this.mEditionLot=false;this.mIdLot=0;this.mIdLotAbonnement=0;this.mNbProduit=0;this.mProduits=[];this.mParam=null;this.mLotRemplacement=[];this.mLotReservation=[];this.mTailleLotResaMax=-1;this.mQuantiteReservation=-1;this.construct=function(b){$.history({vue:function(){EditerCommandeVue(b)}});this.mParam=b;var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b.vr){Infobulle.generer(b.vr,"")}delete c.mProduits;c.mProduits=[];c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(e){var f=this;var b=new GestionCommandeTemplate();var d={};d.comId=e.marche.id;this.mIdMarche=d.comId;d.comNumero=e.marche.numero;d.nom=e.marche.nom;d.comDescription=e.marche.description;d.dateTimeDebutReservation=e.marche.dateDebutReservation;d.dateDebutReservation=e.marche.dateDebutReservation.extractDbDate().dateDbToFr();d.heureDebutReservation=e.marche.dateDebutReservation.extractDbHeure();d.minuteDebutReservation=e.marche.dateDebutReservation.extractDbMinute();d.dateTimeFinReservation=e.marche.dateFinReservation;d.dateFinReservation=e.marche.dateFinReservation.extractDbDate().dateDbToFr();d.heureFinReservation=e.marche.dateFinReservation.extractDbHeure();d.minuteFinReservation=e.marche.dateFinReservation.extractDbMinute();d.dateMarcheDebut=e.marche.dateMarcheDebut.extractDbDate().dateDbToFr();d.heureMarcheDebut=e.marche.dateMarcheDebut.extractDbHeure();d.minuteMarcheDebut=e.marche.dateMarcheDebut.extractDbMinute();d.heureMarcheFin=e.marche.dateMarcheFin.extractDbHeure();d.minuteMarcheFin=e.marche.dateMarcheFin.extractDbMinute();d.archive=e.marche.archive;var c=[];$.each(e.marche.produits,function(){var o=this.ferId;var l=this.idCategorie;var k=this.idNom;var j=this.type;if(j==0||j==2){var m=parseFloat(this.stockInitial)-parseFloat(this.stockReservation);if(this.stockInitial==-1){m++}}else{m=0}var n={id:this.id,nproId:k,nproNom:this.nom,nproStock:this.stockInitial,nproQteMax:this.qteMaxCommande,nproUnite:this.unite,type:j,qteReservation:m.nombreFormate(2,","," ")};if(!c[o]){c[o]={ferId:o,ferNom:this.ferNom,categories:[]}}if(!c[o].categories[l]){c[o].categories[l]={cproId:l,cproNom:this.cproNom,produits:[],produitsAbonnement:[]}}if(j==2){c[o].categories[l].produitsAbonnement[k]=n}else{c[o].categories[l].produits[k]=n}f.mNbProduit++});var g=[];$(c).each(function(){if(this.ferId){var j=[];$(this.categories).each(function(){if(this.cproId){var k=[];$(this.produits).each(function(){if(this.nproId){k.push([this.nproNom,this.nproId,this.type])}});$(this.produitsAbonnement).each(function(){if(this.nproId){k.push([this.nproNom,this.nproId,this.type])}});k.sort(sortABC);j.push([this.cproNom,this.cproId,k])}});j.sort(sortABC);g.push([this.ferNom,this.ferId,j])}});g.sort(sortABC);this.mListeFerme={fermes:[]};$(g).each(function(k,n){var o=n[1];var m=n[2];if(c[o]){var l=false;var j={ferId:c[o].ferId,ferNom:c[o].ferNom,categories:[]};$(m).each(function(p,t){var q=t[1];var u=t[2];if(c[o].categories[q]){var s=false;var r={cproId:c[o].categories[q].cproId,cproNom:c[o].categories[q].cproNom,produits:[]};$(u).each(function(x,z){var y=z[1];var w=z[2];var v="";if(w==2){v=b.flagAbonnement;if(c[o].categories[q].produitsAbonnement[y]){r.produits.push({id:c[o].categories[q].produitsAbonnement[y].id,nproId:c[o].categories[q].produitsAbonnement[y].nproId,nproNom:c[o].categories[q].produitsAbonnement[y].nproNom,nproUnite:c[o].categories[q].produitsAbonnement[y].nproUnite,qteReservation:c[o].categories[q].produitsAbonnement[y].qteReservation,type:w,abonnement:v});l=true;s=true}}else{if(c[o].categories[q].produits[y].type==1){v=b.flagSolidaire}if(c[o].categories[q].produits[y]){r.produits.push({id:c[o].categories[q].produits[y].id,nproId:c[o].categories[q].produits[y].nproId,nproNom:c[o].categories[q].produits[y].nproNom,nproUnite:c[o].categories[q].produits[y].nproUnite,qteReservation:c[o].categories[q].produits[y].qteReservation,type:w,abonnement:v});l=true;s=true}}});if(s){j.categories.push(r)}}});if(l){f.mListeFerme.fermes.push(j)}}});d.sigleMonetaire=gSigleMonetaire;this.mMarche=$.extend(f.mMarche,d);this.mMarche.produits=[];this.mMarche.produitsAbonnement=[];$.each(e.marche.produits,function(){if(this.type==2){f.mMarche.produitsAbonnement[this.idNom]=1}else{f.mMarche.produits[this.idNom]=1}});var h=b.editerCommandePage;d.infoMarcheSelected="ui-state-active";d.listeReservationSelected="";d.listeAchatSelected="";e.resumeMarcheSelected="";d.editerMenu=b.editerMarcheMenu.template(d);this.mArchive=e.marche.archive;$("#contenu").replaceWith(f.affect($(h.template(d))))};this.affectDroitArchive=function(b){b.find("#btn-ajout-produit-div").remove();b.find("#btn-modif-com").remove();b.find(".btn-modifier-produit").remove();b.find(".btn-supprimer-produit").remove();b.find("#btn-pause-com").remove();b.find("#btn-play-com").remove();b.find("#btn-cloture-com").remove();return b};this.affect=function(b){b=this.affectModifier(b);b=this.affectDupliquerMarche(b);b=this.affectBonDeCommande(b);b=this.affectFacture(b);b=this.affectArchive(b);b=this.affectMajListeFerme(b);b=this.affectDialogAjoutProduit(b);b=this.affectMenu(b);b=gCommunVue.comHoverBtn(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectMenu=function(b){var c=this;b.find("#btn-information-marche").click(function(){EditerCommandeVue(c.mParam)});b.find("#btn-liste-achat-resa").click(function(){ListeAchatMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-liste-resa").click(function(){ListeReservationMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-resume-marche").click(function(){ResumeMarcheVue({id_marche:c.mIdMarche})});return b};this.affectModifier=function(b){var c=this;b.find("#btn-modif-com").click(function(){c.dialogModifierInformationMarche()});return b};this.affectBonDeCommande=function(b){var c=this;b.find("#btn-bon-com").click(function(){BonDeCommandeVue({id_commande:c.mIdMarche})});return b};this.affectFacture=function(b){var c=this;b.find("#btn-facture-com").click(function(){FactureVue({idMarche:c.mIdMarche})});return b};this.affectDupliquerMarche=function(b){var c=this;b.find("#btn-dupliquer-com").click(function(){AjoutCommandeVue({id_marche:c.mIdMarche,fonction:"dupliquer"})});return b};this.affectArchive=function(b){if(this.mMarche.archive==0){b.find(".marche-archive-0").show()}else{if(this.mMarche.archive==1){b.find(".marche-archive-1").show()}}b=this.affectPause(b);b=this.affectPlay(b);b=this.affectCloturer(b);return b};this.modifierArchive=function(){if(this.mMarche.archive==0){$(".marche-archive-0").show();$(".marche-archive-1").hide()}else{if(this.mMarche.archive==1){$(".marche-archive-0").hide();$(".marche-archive-1").show()}}};this.affectCloturer=function(b){var c=this;b.find("#btn-cloture-com").click(function(){var d=new GestionCommandeTemplate();var e=d.dialogClotureCommande;$(e.template(c.mMarche)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Cloturer:function(){var f={id_marche:c.mIdMarche,fonction:"cloturer"};var g=this;$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(f),function(k){Infobulle.init();if(k){if(k.valid){var l=new TemplateVR();l.valid=false;l.log.valid=false;var j=new VRerreur();j.code=ERR_313_CODE;j.message=ERR_313_MSG;l.log.erreurs.push(j);var h={id_marche:c.mIdMarche,vr:l};InfoCommandeArchiveVue(h);$(g).dialog("close")}else{Infobulle.generer(k,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}})});return b};this.affectPause=function(b){var c=this;b.find("#btn-pause-com").click(function(){var d={id_marche:c.mIdMarche,fonction:"pause"};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(f){Infobulle.init();if(f){if(f.valid){c.mMarche.archive=1;c.modifierArchive();var g=new TemplateVR();g.valid=false;g.log.valid=false;var e=new VRerreur();e.code=ERR_311_CODE;e.message=ERR_311_MSG;g.log.erreurs.push(e);Infobulle.generer(g,"")}else{Infobulle.generer(f,"")}}},"json")});return b};this.affectPlay=function(b){var c=this;b.find("#btn-play-com").click(function(){var d={id_marche:c.mIdMarche,fonction:"play"};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(f){Infobulle.init();if(f){if(f.valid){c.mMarche.archive=0;c.modifierArchive();var g=new TemplateVR();g.valid=false;g.log.valid=false;var e=new VRerreur();e.code=ERR_312_CODE;e.message=ERR_312_MSG;g.log.erreurs.push(e);Infobulle.generer(g,"")}else{Infobulle.generer(f,"")}}},"json")});return b};this.affectMajListeFerme=function(c){var d=this;var b=new GestionCommandeTemplate();var e=b.editerMarcheListeProduit;c.find("#liste-ferme").replaceWith(d.affectGestionProduit($(e.template(d.mListeFerme))));return c};this.affectGestionProduit=function(b){b=this.affectModifierProduit(b);b=this.affectSupprimerProduit(b);return b};this.affectModifierProduit=function(b){var c=this;b.find(".btn-modifier-produit").click(function(){c.dialogModifierProduit($(this).attr("id-produit"),$(this).attr("typeProduit"))});return b};this.dialogModifierProduit=function(b){var c=this;var d={fonction:"detailProduitMarche",id:b};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(m){if(m){if(m.valid){var g=new GestionCommandeTemplate();var o=m.produit.ferId;var n=m.produit.idCategorie;var e=parseInt(m.produit.type);c.mQuantiteReservation=-1;var l="";if(parseFloat(m.produit.stockInitial)!=-1){c.mQuantiteReservation=parseFloat(m.produit.stockInitial)-parseFloat(m.produit.stockReservation);if(e==0){l=m.produit.stockInitial.nombreFormate(2,",","")}else{if(e==2){l=m.produit.stockInitial.nombreFormate(2,","," ")}}}else{c.mQuantiteReservation=parseFloat(m.produit.stockReservation)*-1}var j="";if(parseFloat(m.produit.qteMaxCommande)!=-1){if(e==0){j=m.produit.qteMaxCommande.nombreFormate(2,",","")}else{if(e==2){j=m.produit.qteMaxCommande.nombreFormate(2,","," ")}}}var k={ferId:o,ferNom:m.produit.ferNom,cproId:n,cproNom:m.produit.cproNom,nproId:b,nproNom:m.produit.nom,unite:m.produit.unite,nproStock:l,nproQteMax:j,modelesLot:[],modelesLotReservation:[],modelesLotAbonnement:[],modelesLotAbonnementReservationModif:[],listeModelesLot:[],listeModelesLotAbonnement:[]};c.mLotReservation=[];c.mTailleLotResaMax=-1;switch(e){case 0:k.typeProduitLabel=g.typeProduitLabelNormal;$.each(m.modelesLot,function(){if(this.mLotId!=null){c.mIdLot--;var p={id:c.mIdLot,quantite:this.mLotQuantite.nombreFormate(2,","," "),prix:this.mLotPrix.nombreFormate(2,","," "),unite:this.mLotUnite,sigleMonetaire:gSigleMonetaire,modele:"modele-lot",checked:""};k.listeModelesLot.push(p)}});$.each(m.produit.lots,function(){var p={id:this.id,quantite:this.taille.nombreFormate(2,","," "),prix:this.prix.nombreFormate(2,","," "),unite:m.produit.unite,sigleMonetaire:gSigleMonetaire,modele:"",checked:'checked="checked"'};if(this.reservation){k.modelesLotReservation.push(p);c.mLotReservation[this.id]={id:this.id,quantite:this.taille};if(this.taille>c.mTailleLotResaMax){c.mTailleLotResaMax=this.taille}}else{k.modelesLot.push(p)}});if(m.produit.qteRestante==""||m.produit.stockInitial==-1){k.nproStockCheckedNoLimit='checked="checked"';k.nproStockDisabled='disabled="disabled"'}else{k.nproStockCheckedLimit='checked="checked"'}if(m.produit.qteMaxCommande==""||m.produit.qteMaxCommande==-1){k.nproQteMaxCheckedNoLimit='checked="checked"';k.nproQteMaxDisabled='disabled="disabled"'}else{k.nproQteMaxCheckedLimit='checked="checked"'}k.divStock=g.stockModifProduit.template(k);k.divLot=g.prixModifProduit.template(k);break;case 1:k.typeProduitLabel=g.typeProduitLabelSolidaire;$.each(m.modelesLot,function(){if(this.mLotId!=null){c.mIdLot--;var p={id:c.mIdLot,quantite:this.mLotQuantite.nombreFormate(2,","," "),prix:this.mLotPrix.nombreFormate(2,","," "),unite:this.mLotUnite,sigleMonetaire:gSigleMonetaire,modele:"modele-lot",checked:""};k.listeModelesLot.push(p)}});$.each(m.produit.lots,function(){var p={id:this.id,quantite:this.taille.nombreFormate(2,","," "),prix:this.prix.nombreFormate(2,","," "),unite:m.produit.unite,sigleMonetaire:gSigleMonetaire,modele:"",checked:'checked="checked"'};k.modelesLot.push(p)});k.divLot=g.prixModifProduit.template(k);break;case 2:$.each(m.modelesLot,function(){if(this.mLotId!=null&&this.mLotUnite==m.produit.unite){c.mIdLotAbonnement--;var p={id:c.mIdLotAbonnement,quantite:this.mLotQuantite.nombreFormate(2,","," "),prix:this.mLotPrix.nombreFormate(2,","," "),unite:this.mLotUnite,sigleMonetaire:gSigleMonetaire,modele:"modele-lot",checked:""};k.listeModelesLotAbonnement.push(p)}});$.each(m.produit.lots,function(){var p={id:this.id,quantite:this.taille.nombreFormate(2,","," "),prix:this.prix.nombreFormate(2,","," "),unite:m.produit.unite,sigleMonetaire:gSigleMonetaire,modele:"",checked:'checked="checked"'};if(this.reservation){k.modelesLotAbonnementReservationModif.push(p);c.mLotReservation[this.id]={id:this.id,quantite:this.taille}}else{k.modelesLotAbonnement.push(p)}});k.typeProduitLabel=g.typeProduitLabelAbonnement;k.stockInitialAbonnement=l;k.uniteAbonnement=m.produit.unite;var f=m.produit.qteMaxCommande;if(parseFloat(f)==-1){k.qMaxAbonnement="Pas de limite"}else{k.qMaxAbonnement=f.nombreFormate(2,","," ")+" "+k.uniteAbonnement}k.qMaxAbonnementValue=f;k.divStock=g.stockAbonnementAjoutProduit.template(k);k.divLot=g.prixAbonnementModifProduit.template(k);break}var h=g.dialogModifProduitAjoutMarche;c.mLotRemplacement=[];$(c.affectModifierPrixEtStock($(h.template(k)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Modifier:function(){c.modifierProduit($(this),e)},Annuler:function(){c.mEditionLot=false;$(this).dialog("close")}},close:function(p,q){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(m,"marche-")}}},"json")};this.affectPrixEtStock=function(b){b=this.affectAjoutLotGestion(b);b=this.affectAjoutLotAbonnementGestion(b);b=this.affectAjoutLot(b);b=this.affectLimiteStock(b);b=this.affectChangeTypeProduit(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectModifierPrixEtStock=function(b){b=this.affectAjoutLotGestionModifier(b);b=this.affectAjoutLotAbonnementGestionModifier(b);b=this.affectAjoutLot(b);b=this.affectLimiteStock(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectChangeTypeProduit=function(b){var c=this;b.find(":input[name=typeProduit]").click(function(){return c.testChangeTypeProduit($(":input[name=typeProduit]:checked").val())}).change(function(){c.changeTypeProduit($(":input[name=typeProduit]:checked").val())});return b};this.testChangeTypeProduit=function(c){if(this.mEditionLot){var d=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;d.valid=false;d.log=new VRelement();d.log.valid=false;d.log.erreurs.push(b);Infobulle.generer(d,"");return false}return true};this.changeTypeProduit=function(c){if(!this.mEditionLot){$(".pro-detail").hide();if(c==0){$("#pro-normal,#id-stock").show()}else{if(c==1){$("#pro-normal").show()}else{$("#pro-abonnement").show()}}}else{var d=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;d.valid=false;d.log=new VRelement();d.log.valid=false;d.log.erreurs.push(b);Infobulle.generer(d,"");return false}};this.affectLimiteStock=function(b){b.find(":input[name=pro-stock-choix]").change(function(){if($(":input[name=pro-stock-choix]:checked").val()==1){$(":input[name=pro-stock]").prop("disabled",false).val("")}else{$(":input[name=pro-stock]").prop("disabled",true).val("")}});b.find(":input[name=pro-qte-max-choix]").change(function(){if($(":input[name=pro-qte-max-choix]:checked").val()==1){$(":input[name=pro-qte-max]").prop("disabled",false).val("")}else{$(":input[name=pro-qte-max]").prop("disabled",true).val("")}});return b};this.affectAjoutLot=function(b){var c=this;b.find("#btn-ajout-lot").click(function(){c.ajoutLot(1)});b.find("#table-pro-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(1)}});b.find("#btn-ajout-lot-abonnement").click(function(){c.ajoutLot(2)});b.find("#table-pro-abonnement-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(2)}});return b};this.ajoutLot=function(d){var h=new ModeleLotVO();if(d==1){h.quantite=$(":input[name=lot-quantite]").val().numberFrToDb();h.unite=$(":input[name=lot-unite]").val();h.prix=$(":input[name=lot-prix]").val().numberFrToDb()}else{h.quantite=$(":input[name=lot-abo-quantite]").val().numberFrToDb();h.unite=$("#pro-abo-lot-unite").text();h.prix=$(":input[name=lot-abo-prix]").val().numberFrToDb()}var k=new ModeleLotValid();var f=k.validAjout(h);if(f.valid){Infobulle.init();var l=new TemplateVR();var b=new GestionCommandeTemplate();if(d==1){var j=$("#pro-qteRestante").val();if(j!=undefined&&j!=""){j=j.numberFrToDb();if(j!=-1&&h.quantite>parseFloat(j)){l.valid=false;l.log.valid=false;var g=new VRerreur();g.code=ERR_241_CODE;g.message=ERR_241_MSG;l.log.erreurs.push(g)}}var e=$("#pro-qteMaxCommande").val();if(e!=undefined&&e!=""){e=e.numberFrToDb();if(e!=-1&&h.quantite>parseFloat(e)){l.valid=false;l.log.valid=false;var g=new VRerreur();g.code=ERR_241_CODE;g.message=ERR_241_MSG;l.log.erreurs.push(g)}}if(l.valid){var c=b.modeleLot;this.mIdLot--;h.id=this.mIdLot;h.sigleMonetaire=gSigleMonetaire;h.quantite=h.quantite.nombreFormate(2,","," ");h.prix=h.prix.nombreFormate(2,","," ");$("#lot-liste").append(this.affectLot($(c.template(h))));$(":input[name=lot-quantite], :input[name=lot-unite], :input[name=lot-prix]").val("")}else{Infobulle.generer(l,"pro-lot-")}}else{var j=$("#stock-abonnement").text().numberFrToDb();var e=$("#max-abonnement").text().numberFrToDb();if(e!=-1&&parseFloat(h.quantite)>parseFloat(e)){l.valid=false;l.log.valid=false;var g=new VRerreur();g.code=ERR_241_CODE;g.message=ERR_241_MSG;l.log.erreurs.push(g)}if(j!=-1&&parseFloat(h.quantite)>parseFloat(j)){l.valid=false;l.log.valid=false;var g=new VRerreur();g.code=ERR_241_CODE;g.message=ERR_241_MSG;l.log.erreurs.push(g)}if(l.valid){var c=b.modeleLotAbonnement;this.mIdLotAbonnement--;h.id=this.mIdLotAbonnement;h.sigleMonetaire=gSigleMonetaire;h.quantite=h.quantite.nombreFormate(2,","," ");h.prix=h.prix.nombreFormate(2,","," ");$("#lot-liste-abonnement").append(this.affectLotAbonnement($(c.template(h))));$(":input[name=lot-abo-quantite], :input[name=lot-abo-unite], :input[name=lot-abo-prix]").val("")}else{Infobulle.generer(l,"pro-abo-lot-")}}}else{if(d==1){Infobulle.generer(f,"pro-lot-")}else{Infobulle.generer(f,"pro-abo-lot-")}}};this.affectLot=function(b){b=this.affectAjoutLotGestion(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectLotAbonnement=function(b){b=this.affectAjoutLotAbonnementGestion(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectAjoutLotGestion=function(b){var c=this;b.find(".btn-modifier-lot").click(function(){c.ajoutLotModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot").click(function(){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot").click(function(){c.ajoutLotAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot").click(function(){c.ajoutLotSupprimer($(this).closest("tr").find("#id-lot").text())});b.find(":checkbox").change(function(){var d=c.majUnite();if(!d){if($(this).prop("checked")){$(this).prop("checked",false)}else{$(this).prop("checked",true)}}});return b};this.affectAjoutLotGestionModifier=function(b){var c=this;b.find(".btn-modifier-lot").click(function(){c.ajoutLotModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot").click(function(){c.ajoutLotModifierValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotModifierValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot").click(function(){c.ajoutLotAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot").click(function(){c.modifierLotSupprimer($(this).closest("tr").find("#id-lot").text())});b.find(":checkbox").change(function(){if(!c.majUnite()){if($(this).prop("checked")){$(this).prop("checked",false)}else{$(this).prop("checked",true)}}});return b};this.affectAjoutLotAbonnementGestion=function(b){var c=this;b.find(".btn-modifier-lot-abonnement").click(function(){c.ajoutLotAbonnementModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot-abonnement").click(function(){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot-abonnement").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot-abonnement").click(function(){c.ajoutLotAbonnementAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot-abonnement").click(function(){c.ajoutLotAbonnementSupprimer($(this).closest("tr").find("#id-lot").text())});return b};this.affectAjoutLotAbonnementGestionModifier=function(b){var c=this;b.find(".btn-modifier-lot-abonnement").click(function(){c.ajoutLotAbonnementModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot-abonnement").click(function(){c.ajoutLotModifierAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot-abonnement").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotModifierAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot-abonnement").click(function(){c.ajoutLotAbonnementAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot-abonnement").click(function(){c.modifierLotAbonnementSupprimer($(this).closest("tr").find("#id-lot").text())});return b};this.majUnite=function(){var d=true;var c=0;var e="";$(".ligne-lot :checkbox:checked").each(function(){var g=$(this).closest(".ligne-lot").find(".lot-unite").text();if(e!=""&&e!=g){d=false}else{e=g}c++});if(d){if(c>0){$(".unite-stock").text(e)}}else{var f=new Object();var b=new VRerreur();b.code=ERR_333_CODE;b.message=ERR_333_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(b);Infobulle.generer(f,"")}return d};this.ajoutLotModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();$("#pro-lot-"+b+"-quantite").val($("#lot-"+b+"-quantite").text().numberFrToDb().nombreFormate(2,",",""));$("#pro-lot-"+b+"-unite").val($("#lot-"+b+"-unite").text());$("#pro-lot-"+b+"-prix").val($("#lot-"+b+"-prix").text().numberFrToDb().nombreFormate(2,",",""));this.mEditionLot=true};this.ajoutLotAbonnementModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();$("#pro-lot-abonnement"+b+"-quantite").val($("#lot-"+b+"-quantite-abonnement").text().numberFrToDb().nombreFormate(2,",",""));$("#pro-lot-abonnement"+b+"-unite").val($("#lot-"+b+"-unite-abonnement").text());$("#pro-lot-abonnement"+b+"-prix").val($("#lot-"+b+"-prix-abonnement").text().numberFrToDb().nombreFormate(2,",",""));this.mEditionLot=true};this.ajoutLotValiderModification=function(e){var d=new ModeleLotVO();d.quantite=$("#pro-lot-"+e+"-quantite").val().numberFrToDb();d.unite=$("#pro-lot-"+e+"-unite").val();d.prix=$("#pro-lot-"+e+"-prix").val().numberFrToDb();var f=new ModeleLotValid();var j=f.validAjout(d);if(j.valid){Infobulle.init();var h=new TemplateVR();var g=$("#pro-qteRestante").val();if(g!=undefined&&g!=""){g=g.numberFrToDb();if(g!=-1&&d.quantite>parseFloat(g)){h.valid=false;h.log.valid=false;var c=new VRerreur();c.code=ERR_241_CODE;c.message=ERR_241_MSG;h.log.erreurs.push(c)}}var b=$("#pro-qteMaxCommande").val();if(b!=undefined&&b!=""){b=b.numberFrToDb();if(b!=-1&&d.quantite>parseFloat(b)){h.valid=false;h.log.valid=false;var c=new VRerreur();c.code=ERR_241_CODE;c.message=ERR_241_MSG;h.log.erreurs.push(c)}}if(h.valid){$("#lot-"+e+"-quantite").text(d.quantite.nombreFormate(2,","," "));$("#lot-"+e+"-unite").text(d.unite);$("#lot-"+e+"-prix").text(d.prix.nombreFormate(2,","," "));$(".btn-lot, #btn-annuler-lot-"+e+", #btn-valider-lot-"+e+", .champ-lot-"+e).toggle();this.mEditionLot=false;this.majUnite()}else{Infobulle.generer(h,"pro-lot-"+e+"-")}}else{Infobulle.generer(j,"pro-lot-"+e+"-")}};this.ajoutLotModifierValiderModification=function(e){var d=new ModeleLotVO();d.id=e;d.quantite=$("#pro-lot-"+e+"-quantite").val().numberFrToDb();d.unite=$("#pro-lot-"+e+"-unite").val();d.prix=$("#pro-lot-"+e+"-prix").val().numberFrToDb();var f=new ModeleLotValid();var j={};if(this.autorisationSupprimerLot(e)){j=f.validAjout(d)}else{j=f.validUpdateAvecReservation(d,this.mLotReservation[e].quantite)}if(j.valid){Infobulle.init();var h=new TemplateVR();var g=$("#pro-qteRestante").val();if(g!=undefined&&g!=""){g=g.numberFrToDb();if(g!=-1&&d.quantite>parseFloat(g)){h.valid=false;h.log.valid=false;var c=new VRerreur();c.code=ERR_241_CODE;c.message=ERR_241_MSG;h.log.erreurs.push(c)}}var b=$("#pro-qteMaxCommande").val();if(b!=undefined&&b!=""){b=b.numberFrToDb();if(b!=-1&&d.quantite>parseFloat(b)){h.valid=false;h.log.valid=false;var c=new VRerreur();c.code=ERR_241_CODE;c.message=ERR_241_MSG;h.log.erreurs.push(c)}}if(h.valid){$("#lot-"+e+"-quantite").text(d.quantite.nombreFormate(2,","," "));$("#lot-"+e+"-unite").text(d.unite);$("#lot-"+e+"-prix").text(d.prix.nombreFormate(2,","," "));$(".btn-lot, #btn-annuler-lot-"+e+", #btn-valider-lot-"+e+", .champ-lot-"+e).toggle();this.mEditionLot=false;this.majUnite()}else{Infobulle.generer(h,"pro-lot-"+e+"-")}}else{Infobulle.generer(j,"pro-lot-"+e+"-")}};this.ajoutLotAbonnementValiderModification=function(e){var d=new ModeleLotVO();d.quantite=$("#pro-lot-abonnement"+e+"-quantite").val().numberFrToDb();d.unite=$("#pro-lot-abonnement"+e+"-unite").val();d.prix=$("#pro-lot-abonnement"+e+"-prix").val().numberFrToDb();var f=new ModeleLotValid();var j=f.validAjout(d);if(j.valid){Infobulle.init();var h=new TemplateVR();var g=$("#stock-abonnement").text().numberFrToDb();var c=$("#max-abonnement").text().numberFrToDb();if(c!=-1&&d.quantite>parseFloat(c)){h.valid=false;h.log.valid=false;var b=new VRerreur();b.code=ERR_241_CODE;b.message=ERR_241_MSG;h.log.erreurs.push(b)}if(g!=-1&&d.quantite>parseFloat(g)){h.valid=false;h.log.valid=false;var b=new VRerreur();b.code=ERR_241_CODE;b.message=ERR_241_MSG;h.log.erreurs.push(b)}if(h.valid){Infobulle.init();$("#lot-"+e+"-quantite-abonnement").text(d.quantite.nombreFormate(2,","," "));$("#lot-"+e+"-unite-abonnement").text(d.unite);$("#lot-"+e+"-prix-abonnement").text(d.prix.nombreFormate(2,","," "));$(".btn-lot-abonnement, #btn-annuler-lot-"+e+"-abonnement, #btn-valider-lot-"+e+"-abonnement, .champ-lot-"+e+"-abonnement").toggle();this.mEditionLot=false}else{Infobulle.generer(h,"pro-lot-abonnement"+e+"-")}}else{Infobulle.generer(j,"pro-lot-abonnement"+e+"-")}};this.ajoutLotModifierAbonnementValiderModification=function(e){var d=new ModeleLotVO();d.quantite=$("#pro-lot-abonnement"+e+"-quantite").val().numberFrToDb();d.unite=$("#pro-lot-abonnement"+e+"-unite").val();d.prix=$("#pro-lot-abonnement"+e+"-prix").val().numberFrToDb();var f=new ModeleLotValid();var j={};if(this.autorisationSupprimerLot(e)){j=f.validAjout(d)}else{j=f.validUpdateAvecReservation(d,this.mLotReservation[e].quantite)}if(j.valid){Infobulle.init();var h=new TemplateVR();var g=$("#stock-abonnement").text().numberFrToDb();var c=$("#max-abonnement").text().numberFrToDb();if(c!=-1&&d.quantite>parseFloat(c)){h.valid=false;h.log.valid=false;var b=new VRerreur();b.code=ERR_241_CODE;b.message=ERR_241_MSG;h.log.erreurs.push(b)}if(g!=-1&&d.quantite>parseFloat(g)){h.valid=false;h.log.valid=false;var b=new VRerreur();b.code=ERR_241_CODE;b.message=ERR_241_MSG;h.log.erreurs.push(b)}if(h.valid){Infobulle.init();$("#lot-"+e+"-quantite-abonnement").text(d.quantite.nombreFormate(2,","," "));$("#lot-"+e+"-unite-abonnement").text(d.unite);$("#lot-"+e+"-prix-abonnement").text(d.prix.nombreFormate(2,","," "));$(".btn-lot-abonnement, #btn-annuler-lot-"+e+"-abonnement, #btn-valider-lot-"+e+"-abonnement, .champ-lot-"+e+"-abonnement").toggle();this.mEditionLot=false}else{Infobulle.generer(h,"pro-lot-abonnement"+e+"-")}}else{Infobulle.generer(j,"pro-lot-abonnement"+e+"-")}};this.ajoutLotAnnulerModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();this.mEditionLot=false};this.ajoutLotAbonnementAnnulerModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();this.mEditionLot=false};this.ajoutLotSupprimer=function(b){$("#ligne-lot-"+b).remove()};this.autorisationSupprimerLot=function(b){if(this.mLotReservation[b]){return false}return true};this.modifierLotSupprimer=function(b){if(this.autorisationSupprimerLot(b)){$("#ligne-lot-"+b).remove()}else{this.dialogSupprimerLot(b)}};this.ajoutLotAbonnementSupprimer=function(b){$("#ligne-lot-abonnement-"+b).remove()};this.modifierLotAbonnementSupprimer=function(b){if(this.autorisationSupprimerLot(b)){$("#ligne-lot-abonnement-"+b).remove()}else{this.dialogSupprimerLotAbonnement(b)}};this.dialogSupprimerLot=function(e){var f=this;var b=new GestionCommandeTemplate();var c={modelesLot:[]};var d=$("#dialog-modif-pro").find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text();var g=this.mLotReservation[e].quantite;$("#dialog-modif-pro").find(".ligne-lot").each(function(){var l=$(this).find(".lot-id").text();var h=parseFloat($(this).find(".lot-quantite").text().numberFrToDb());var j=parseFloat($(this).find(".lot-prix").text().numberFrToDb());var k=$(this).find(".lot-unite").text();if(l!=null&&l!=e&&k==d&&h<=g&&(g%h)==0){var m={id:l,quantite:h.nombreFormate(2,","," "),prix:j.nombreFormate(2,","," "),unite:d,sigleMonetaire:gSigleMonetaire};c.modelesLot.push(m)}});$(b.dialogSupprimerLotModifierMarche.template(c)).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Valider:function(){f.supprimerLotModifierReservation($(this),e)},Annuler:function(){$(this).dialog("close")}},close:function(h,j){$(this).remove();Infobulle.init()}})};this.dialogSupprimerLotAbonnement=function(e){var f=this;var b=new GestionCommandeTemplate();var c={modelesLot:[]};var d=$("#dialog-modif-pro").find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text();var g=this.mLotReservation[e].quantite;$("#dialog-modif-pro").find(".ligne-lot-abonnement").each(function(){var l=$(this).find(".lot-id").text();var h=parseFloat($(this).find(".lot-quantite").text().numberFrToDb());var j=parseFloat($(this).find(".lot-prix").text().numberFrToDb());var k=$(this).find(".lot-unite").text();if(l!=null&&l!=e&&k==d&&h<=g&&(g%h)==0){var m={id:l,quantite:h.nombreFormate(2,","," "),prix:j.nombreFormate(2,","," "),unite:d,sigleMonetaire:gSigleMonetaire};c.modelesLot.push(m)}});$(b.dialogSupprimerLotModifierMarche.template(c)).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Valider:function(){f.supprimerLotModifierReservation($(this),e)},Annuler:function(){$(this).dialog("close")}},close:function(h,j){$(this).remove();Infobulle.init()}})};this.supprimerLotModifierReservation=function(b,d){var e=b.find(":input[name=pro-lot]:checked").val();Infobulle.init();if(e==undefined){var f=new Object();var c=new VRerreur();c.code=ERR_254_CODE;c.message=ERR_254_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(c);Infobulle.generer(f,"")}else{this.mLotRemplacement[d]=e;$("#ligne-lot-abonnement-"+d+", #ligne-lot-"+d+", #btn-supprimer-lot-abonnement-"+e+", #btn-supprimer-lot-"+e).remove();$("#pro-lot-"+e+"-id").prop("checked",true).prop("disabled",true);b.dialog("close")}};this.modifierProduit=function(g,d){var e=this;if(!this.mEditionLot){var j=-1;if(d==2){j=g.find("#stock-abonnement").text().numberFrToDb()}else{if(d==0){j=g.find(":input[name=pro-stock]").val().numberFrToDb()}}if(g.find(":input[name=pro-stock-choix]:checked").val()==1&&j==""&&d==0){var m=new Object();var h=new VRerreur();h.code=ERR_201_CODE;h.message=ERR_201_MSG;m.valid=false;m.qteRestante=new VRelement();m.qteRestante.valid=false;m.qteRestante.erreurs.push(h);Infobulle.generer(m,"pro-")}else{var k=-1;if(d==0){k=g.find(":input[name=pro-qte-max]").val().numberFrToDb()}else{if(d==2){k=g.find("#max-abonnement").text().numberFrToDb()}}if(g.find(":input[name=pro-qte-max-choix]:checked").val()==1&&k==""&&d==0){var m=new Object();var h=new VRerreur();h.code=ERR_201_CODE;h.message=ERR_201_MSG;m.valid=false;m.qteMaxCommande=new VRelement();m.qteMaxCommande.valid=false;m.qteMaxCommande.erreurs.push(h);Infobulle.generer(m,"pro-")}else{var b="";if(d==2){b=g.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{b=g.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}if(j==""){j=-1}if(k==""){k=-1}var c=new ProduitMarcheVO();c.id=g.find("#pro-idProduit").attr("id-produit");c.unite=b;c.qteMaxCommande=k;c.qteRestante=j;c.type=d;c.lotRemplacement=this.mLotRemplacement;if(d==2){g.find(".ligne-lot-abonnement :checkbox:checked").each(function(){var n=new DetailCommandeVO();n.id=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();n.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();n.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();c.lots.push(n)})}else{g.find(".ligne-lot :checkbox:checked").each(function(){var n=new DetailCommandeVO();n.id=$(this).closest(".ligne-lot").find(".lot-id").text();n.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();n.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();c.lots.push(n)})}if(d==1){c.qteMaxCommande=-1;c.qteRestante=-1}c.tailleLotResaMax=this.mTailleLotResaMax;c.quantiteReservation=this.mQuantiteReservation;var l=new ProduitMarcheValid();var f=l.validUpdate(c);if(f.valid){Infobulle.init();c.fonction="modifierProduitMarche";$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(c),function(o){if(o){if(o.valid){var p=new Object();var n=new VRerreur();n.code=ERR_330_CODE;n.message=ERR_330_MSG;p.valid=false;p.log=new VRelement();p.log.valid=false;p.log.erreurs.push(n);Infobulle.generer(p,"");g.dialog("close");e.construct({id_marche:e.mIdMarche,vr:p})}else{Infobulle.generer(o,"pro-")}}},"json")}else{Infobulle.generer(f,"pro-")}}}}else{var m=new Object();var h=new VRerreur();h.code=ERR_112_CODE;h.message=ERR_112_MSG;m.valid=false;m.log=new VRelement();m.log.valid=false;m.log.erreurs.push(h);Infobulle.generer(m,"")}};this.affectSupprimerProduit=function(b){var c=this;b.find(".btn-supprimer-produit").click(function(){var d=$(this).attr("id-produit");if($(this).attr("qte-reservation")>0){c.dialogConfirmationSupprimerProduit(d)}else{c.supprimerProduit(d)}});return b};this.dialogConfirmationSupprimerProduit=function(c){var d=this;var b=new GestionCommandeTemplate();$(b.dialogSupprimerProduit).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){d.supprimerProduit(c)},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.supprimerProduit=function(b){var c=this;var d={fonction:"supprimerProduitMarche",id:b};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){c.mNbProduit--;var g=new Object();var e=new VRerreur();e.code=ERR_331_CODE;e.message=ERR_331_MSG;g.valid=false;g.log=new VRelement();g.log.valid=false;g.log.erreurs.push(e);Infobulle.generer(g,"");$("#dialog-supprimer-produit").dialog("close");c.construct({id_marche:c.mIdMarche,vr:g})}else{Infobulle.generer(f,"marche-")}}},"json")};this.dialogModifierInformationMarche=function(){var d=this;var c=new GestionCommandeTemplate();var b=$(c.dialogModifierInfoMarche.template(d.mMarche));b.find(":input[name=heure-debut]").selectOptions(d.mMarche.heureMarcheDebut);b.find(":input[name=minute-debut]").selectOptions(d.mMarche.minuteMarcheDebut);b.find(":input[name=heure-fin]").selectOptions(d.mMarche.heureMarcheFin);b.find(":input[name=minute-fin]").selectOptions(d.mMarche.minuteMarcheFin);b.find(":input[name=heure-debut-reservation]").selectOptions(d.mMarche.heureDebutReservation);b.find(":input[name=minute-debut-reservation]").selectOptions(d.mMarche.minuteDebutReservation);b.find(":input[name=heure-fin-reservation]").selectOptions(d.mMarche.heureFinReservation);b.find(":input[name=minute-fin-reservation]").selectOptions(d.mMarche.minuteFinReservation);b=gCommunVue.lienDatepickerMarche("marche-dateDebutReservation","marche-dateFinReservation","marche-dateMarcheDebut",b);b.find("#marche-dateDebutReservation").datepicker("option","maxDate",d.mMarche.dateFinReservation);b.find("#marche-dateFinReservation").datepicker("option","minDate",d.mMarche.dateDebutReservation).datepicker("option","maxDate",d.mMarche.dateMarcheDebut);b.find("#marche-dateMarcheDebut").datepicker("option","minDate",d.mMarche.dateFinReservation);$(b).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:800,buttons:{Modifier:function(){d.modifierInformationMarche($(this))},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.modifierInformationMarche=function(b){var e=this;var c=new MarcheVO();c.id=this.mMarche.comId;c.nom=b.find(":input[name=nom]").val();c.description=b.find(":input[name=description]").val();c.dateMarcheDebut=b.find(":input[name=date-debut]").val().dateFrToDb();c.timeMarcheDebut=b.find(":input[name=heure-debut]").val()+":"+b.find(":input[name=minute-debut]").val()+":00";c.dateMarcheFin=b.find(":input[name=date-debut]").val().dateFrToDb();c.timeMarcheFin=b.find(":input[name=heure-fin]").val()+":"+b.find(":input[name=minute-fin]").val()+":00";c.dateDebutReservation=b.find(":input[name=date-debut-reservation]").val().dateFrToDb();c.timeDebutReservation=b.find(":input[name=heure-debut-reservation]").val()+":"+b.find(":input[name=minute-debut-reservation]").val()+":00";c.dateFinReservation=b.find(":input[name=date-fin-reservation]").val().dateFrToDb();c.timeFinReservation=b.find(":input[name=heure-fin-reservation]").val()+":"+b.find(":input[name=minute-fin-reservation]").val()+":00";var d=new MarcheValid();var f=d.validUpdateInformation(c);if(f.valid){c.fonction="modifierInformationMarche";$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(c),function(j){if(j){if(j.valid){e.mMarche.nom=c.nom;e.mMarche.comDescription=c.description;var g=c.dateDebutReservation+" "+c.timeDebutReservation;e.mMarche.dateDebutReservation=g.extractDbDate().dateDbToFr();e.mMarche.heureDebutReservation=g.extractDbHeure();e.mMarche.minuteDebutReservation=g.extractDbMinute();g=c.dateFinReservation+" "+c.timeFinReservation;e.mMarche.dateFinReservation=g.extractDbDate().dateDbToFr();e.mMarche.heureFinReservation=g.extractDbHeure();e.mMarche.minuteFinReservation=g.extractDbMinute();g=c.dateMarcheDebut+" "+c.timeMarcheDebut;e.mMarche.dateMarcheDebut=g.extractDbDate().dateDbToFr();e.mMarche.heureMarcheDebut=g.extractDbHeure();e.mMarche.minuteMarcheDebut=g.extractDbMinute();g=c.dateMarcheDebut+" "+c.timeMarcheFin;e.mMarche.heureMarcheFin=g.extractDbHeure();e.mMarche.minuteMarcheFin=g.extractDbMinute();$("#edt-marche-dateDebutReservation").text(e.mMarche.dateDebutReservation);$("#edt-marche-heureDebutReservation").text(e.mMarche.heureDebutReservation);$("#edt-marche-minuteDebutReservation").text(e.mMarche.minuteDebutReservation);$("#edt-marche-dateFinReservation").text(e.mMarche.dateFinReservation);$("#edt-marche-heureFinReservation").text(e.mMarche.heureFinReservation);$("#edt-marche-minuteFinReservation").text(e.mMarche.minuteFinReservation);$("#edt-marche-dateMarcheDebut").text(e.mMarche.dateMarcheDebut);$("#edt-marche-heureMarcheDebut").text(e.mMarche.heureMarcheDebut);$("#edt-marche-minuteMarcheDebut").text(e.mMarche.minuteMarcheDebut);$("#edt-marche-heureMarcheFin").text(e.mMarche.heureMarcheFin);$("#edt-marche-minuteMarcheFin").text(e.mMarche.minuteMarcheFin);b.dialog("close");var k=new Object();var h=new VRerreur();h.code=ERR_335_CODE;h.message=ERR_335_MSG;k.valid=false;k.log=new VRelement();k.log.valid=false;k.log.erreurs.push(h);Infobulle.generer(k,"")}else{Infobulle.generer(j,"marche-")}}},"json")}else{Infobulle.generer(f,"marche-")}};this.affectDialogAjoutProduit=function(b){var c=this;b.find("#btn-ajout-produit").click(function(){var d={fonction:"listeFerme"};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();var e=new GestionCommandeTemplate();var g=e.dialogAjoutProduitAjoutMarche;$(c.affectAjoutProduitSelectFerme($(g.template(f)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,position:"top",buttons:{Ajouter:function(){c.ajouterProduit($(this))},Annuler:function(){c.mEditionLot=false;$(this).dialog("close")}},close:function(h,j){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(f,"")}}},"json")});return b};this.affectAjoutProduitSelectFerme=function(b){var c=this;b.find("#pro-idFerme select").change(function(){var e=$(this).val();$("#pro-idCategorie select, #pro-idProduit select").prop("disabled",true).selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');if(e>0){var d={fonction:"listeProduit",id:e};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(j){if(j){if(j.valid){Infobulle.init();if(j.listeProduit.length>0&&j.listeProduit[0].nproId!=null){c.mProduits=[];var h=0;var l=[];$.each(j.listeProduit,function(){if(c.mProduits[this.cproId]){c.mProduits[this.cproId].listeProduit.push(this)}else{c.mProduits[this.cproId]={nom:this.cproNom,listeProduit:[this]}}if(h!=this.cproId){l.push({cproId:this.cproId,cproNom:this.cproNom});h=this.cproId}});var f=new GestionCommandeTemplate();var k=f.ajoutProduitSelectCategorie;$("#pro-idCategorie").replaceWith(c.affectAjoutProduitSelectCategorie($(k.template({listeCategorie:l}))))}else{var m=new TemplateVR();m.valid=false;m.log.valid=false;var g=new VRerreur();g.code=ERR_332_CODE;g.message=ERR_332_MSG;m.log.erreurs.push(g);Infobulle.generer(m,"")}}else{Infobulle.generer(j,"")}}},"json")}});return b};this.affectAjoutProduitSelectCategorie=function(b){var c=this;b.find("select").change(function(){$("#pro-idProduit select").prop("disabled",true).selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');var f=$(this).val();if(f>0){var d=new GestionCommandeTemplate();var e=d.ajoutProduitSelectProduit;$("#pro-idProduit").replaceWith(c.affectAjoutProduitSelectProduit($(e.template(c.mProduits[f]))))}});return b};this.affectAjoutProduitSelectProduit=function(b){var c=this;b.find("select").change(function(){var g=$(this).val();if(g>0){if(!c.mMarche.produits[g]||!c.mMarche.produitsAbonnement[g]){var e={fonction:"listeModeleLot",idNomProduit:g};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(e),function(l){if(l){if(l.valid){Infobulle.init();if((!c.mMarche.produitsAbonnement[g]&&l.detailAbonnement.idNomProduit==g)||!c.mMarche.produits[g]){var h=new GestionCommandeTemplate();var k={sigleMonetaire:gSigleMonetaire};if($(l.modelesLot).length>0){k.modelesLot=[];$.each(l.modelesLot,function(){if(this.mLotId!=null){this.id=this.mLotId;this.quantite=this.mLotQuantite.nombreFormate(2,","," ");this.unite=this.mLotUnite;this.prix=this.mLotPrix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;k.modelesLot.push(this);k.unite=this.mLotUnite}})}if(l.detailAbonnement.idNomProduit==g){k.modelesLotAbonnement=[];k.modelesLotAbonnementReservation=[];k.uniteAbonnement=l.detailAbonnement.unite;$.each(l.detailAbonnement.lots,function(){this.quantite=this.taille.nombreFormate(2,","," ");this.unite=k.uniteAbonnement;this.prix=this.prix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;if(this.reservation){k.modelesLotAbonnementReservation.push(this)}else{k.modelesLotAbonnement.push(this)}})}if(c.mMarche.produits[g]){k.typeNormalSelected='disabled="disabled"';k.typeSolidaireSelected='disabled="disabled"';k.typeAbonnementSelected='checked="checked"';k.visibleSolidaire="ui-helper-hidden";k.visibleNormal="ui-helper-hidden";k.visibleAbonnement=""}else{if(c.mMarche.produitsAbonnement[g]){k.typeNormalSelected='checked="checked"';k.typeAbonnementSelected='disabled="disabled"';k.visibleSolidaire="";k.visibleNormal="";k.visibleAbonnement="ui-helper-hidden"}else{k.typeNormalSelected='checked="checked"';k.visibleSolidaire="";k.visibleNormal="";k.visibleAbonnement="ui-helper-hidden"}}if(l.detailAbonnement.idNomProduit==g){k.stockInitialAbonnement=l.detailAbonnement.stockInitial.nombreFormate(2,","," ");if(parseFloat(l.detailAbonnement.max)==-1){k.qMaxAbonnement="Pas de limite"}else{k.qMaxAbonnement=l.detailAbonnement.max.nombreFormate(2,","," ")+" "+k.uniteAbonnement}k.qMaxAbonnementValue=l.detailAbonnement.max;k.typeProduitAbonnement=h.typeProduitAbonnementAjoutProduit.template(k);k.divLotAbonnement=h.prixAbonnementAjoutProduit.template(k);k.divStockAbonnement=h.stockAbonnementAjoutProduit.template(k)}k.divTypeProduit=h.typeProduitAjoutProduit.template(k);k.divLot=h.prixAjoutProduit.template(k);k.divStock=h.stockAjoutProduit.template(k);var n=h.prixEtStockAjoutProduit;$("#prix-stock-produit").replaceWith(c.affectPrixEtStock($(n.template(k))))}else{var m=new Object();var j=new VRerreur();j.code=ERR_211_CODE;j.message=ERR_211_MSG;m.valid=false;m.log=new VRelement();m.log.valid=false;m.log.erreurs.push(j);Infobulle.generer(m,"")}}else{Infobulle.generer(l,"")}}},"json")}else{var f=new Object();var d=new VRerreur();d.code=ERR_211_CODE;d.message=ERR_211_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(d);Infobulle.generer(f,"")}}else{$("#prix-stock-produit").replaceWith($('<div id="prix-stock-produit">'))}});return b};this.ajouterProduit=function(h){var f=this;if(!this.mEditionLot){var e=h.find(":input[name=produit]").val();var d=h.find(":input[name=typeProduit]:checked").val();if(e!=0){var k=-1;if(d==2){k=h.find("#stock-abonnement").text().numberFrToDb()}else{if(d==0){k=h.find(":input[name=pro-stock]").val().numberFrToDb()}}if(h.find(":input[name=pro-stock-choix]:checked").val()==1&&k==""&&d==0){var n=new Object();var j=new VRerreur();j.code=ERR_201_CODE;j.message=ERR_201_MSG;n.valid=false;n.qteRestante=new VRelement();n.qteRestante.valid=false;n.qteRestante.erreurs.push(j);Infobulle.generer(n,"pro-")}else{var l=-1;if(d==2){l=h.find("#max-abonnement").text().numberFrToDb()}else{if(d==0){l=h.find(":input[name=pro-qte-max]").val().numberFrToDb()}}if(h.find(":input[name=pro-qte-max-choix]:checked").val()==1&&l==""&&d==0){var n=new Object();var j=new VRerreur();j.code=ERR_201_CODE;j.message=ERR_201_MSG;n.valid=false;n.qteMaxCommande=new VRelement();n.qteMaxCommande.valid=false;n.qteMaxCommande.erreurs.push(j);Infobulle.generer(n,"pro-")}else{var b="";if(d==2){b=h.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{b=h.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}if(d==2&&this.mMarche.produitsAbonnement[e]){var n=new Object();var j=new VRerreur();j.code=ERR_253_CODE;j.message=ERR_253_MSG;n.valid=false;n.qteMaxCommande=new VRelement();n.qteMaxCommande.valid=false;n.qteMaxCommande.erreurs.push(j);Infobulle.generer(n,"pro-")}else{if(d<2&&this.mMarche.produits[e]){var n=new Object();var j=new VRerreur();j.code=ERR_211_CODE;j.message=ERR_211_MSG;n.valid=false;n.qteMaxCommande=new VRelement();n.qteMaxCommande.valid=false;n.qteMaxCommande.erreurs.push(j);Infobulle.generer(n,"pro-")}else{if(k==""){k=-1}if(l==""){l=-1}var c=new ProduitMarcheVO();c.id=f.mIdMarche;c.idNom=e;c.unite=b;c.qteMaxCommande=l;c.qteRestante=k;c.type=d;if(d==2){h.find(".ligne-lot-abonnement :checkbox").each(function(){var p=new DetailCommandeVO();var o=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();if(o>0){p.id=o}p.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();p.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();c.lots.push(p)})}else{h.find(".ligne-lot :checkbox").each(function(){var o=new DetailCommandeVO();o.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();o.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();c.lots.push(o)})}var m=new CommandeCompleteValid();var g=m.validAjoutProduit(c);if(g.valid){Infobulle.init();c.fonction="ajouterProduitMarche";$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(c),function(p){if(p){if(p.valid){var q=new Object();var o=new VRerreur();o.code=ERR_329_CODE;o.message=ERR_329_MSG;q.valid=false;q.log=new VRelement();q.log.valid=false;q.log.erreurs.push(o);Infobulle.generer(q,"");h.dialog("close");f.construct({id_marche:f.mIdMarche,vr:q})}else{Infobulle.generer(p,"pro-")}}},"json")}else{Infobulle.generer(g,"pro-")}}}}}}}else{var n=new Object();var j=new VRerreur();j.code=ERR_112_CODE;j.message=ERR_112_MSG;n.valid=false;n.log=new VRelement();n.log.valid=false;n.log.erreurs.push(j);Infobulle.generer(n,"")}};this.construct(a)};