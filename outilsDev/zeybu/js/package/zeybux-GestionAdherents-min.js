function GestionAdherentsTemplate(){this.formulaireAjoutAdherent='<div id="contenu"><div id="formulaire_modifier_adherent_int"><form><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Information de l\'adhérent</div><div class="com-widget-content"><table class="com-table-form"><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Nom *</th><td class="com-table-form-td"><input type="hidden" name="{NAME_ID}" value="{VALUE_ID}" /><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom" value="{nom}" maxlength="50" id="nom"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Prénom *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="prenom" value="{prenom}" maxlength="50" id="prenom"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Mot de Passe *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="password" name="pass" maxlength="100" id="motPasse"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Resaisir le mot de Passe *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="password" name="pass_confirm" maxlength="100" id="motPasseConfirm"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Date de Naissance (jj/mm/aaaa)</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="date_naissance" value="{dateNaissance}" maxlength="10" id="dateNaissance"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Date d\'adhésion (jj/mm/aaaa) *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="date_adhesion" value="{dateAdhesion}" maxlength="10" id="dateAdhesion" /></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Lier un compte<input type="checkbox" name="lien_numero_compte" /></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="numero_compte" value="{compte}" maxlength="5" disabled="disabled" id="compte"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Commentaire</th><td class="com-table-form-td"><textarea class="com-input-text ui-widget-content ui-corner-all" name="commentaire" id="commentaire">{commentaire}</textarea></td></tr></table></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Coordonnées de l\'adhérent</div><div class="com-widget-content"><table class="com-table-form"><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Courriel Principal</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="courriel_principal" value="{courrielPrincipal}" maxlength="100" id="courrielPrincipal"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Courriel Secondaire</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" ype="text" name="courriel_secondaire" value="{courrielSecondaire}" maxlength="100" id="courrielSecondaire"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Téléphone Principal</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="telephone_principal" value="{telephonePrincipal}" maxlength="20" id="telephonePrincipal"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Téléphone Secondaire</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="telephone_secondaire" value="{telephoneSecondaire}" maxlength="20" id="telephoneSecondaire"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Adresse</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="adresse" value="{adresse}" maxlength="300" id="adresse"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Code Postal</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="code_postal" value="{codePostal}" maxlength="10" id="codePostal"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Ville</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="ville" value="{ville}" maxlength="100" id="ville"/></td></tr></table></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all"> Autorisations</div><div class="com-widget-content"><table id="formulaire-modifier-adherent-table-autorisation" class="com-table-form"><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Modules autorisés</th><!-- BEGIN modules_default --><input type="hidden" name="modules_default[]" value="{modules_default.id}"/><!-- END modules_default --></tr><!-- BEGIN modules --><tr class="ui-widget-content" ><td class="com-table-form-td" ><input type="checkbox" name="modules[]" value="{modules.id}" {modules.checked}/>{modules.label}</td></tr><!-- END modules --><tr><td class="com-center com-ligne-submit"><input class="ui-state-default ui-corner-all com-button com-center" type="submit" value="Valider" /></td></tr></table></div></div></form></div></div>';this.ajoutAdherentSucces='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Nouvel Adhérent</div><div class="com-widget-content"><p class="com-msg-confirm-icon" ><span class="com-float-left ui-icon ui-icon-check"></span>L\'adhérent {numero} a été ajouté avec succès.</p></div></div></div>';this.modifierAdherentSucces='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Modification d\'Adhérent</div><div class="com-widget-content"><p class="com-msg-confirm-icon" ><span class="com-float-left ui-icon ui-icon-check"></span>L\'adhérent {numero} a été mis à jour avec succès.</p></div></div></div>';this.supprimerAdherentSucces='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Suppression d\'Adhérent</div><div class="com-widget-content"><p class="com-msg-confirm-icon" ><span class="com-float-left ui-icon ui-icon-check"></span>L\'adhérent {numero} a été supprimé avec succès.</p></div></div></div>';this.listeAdherent='<div id="contenu"><div id="liste_adherent_solde_int"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Adhérents</div><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th com-underline-hover liste-adh-th-num com-cursor-pointer"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th com-underline-hover liste-adh-th-nom com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th><th class="com-table-th com-underline-hover liste-adh-th-nom com-cursor-pointer"><span class="ui-icon span-icon"></span>Prénom</th><th class="com-table-th com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Courriel</th><th class="com-table-th liste-adh-th-solde">Solde</th></tr></thead><tbody><!-- BEGIN listeAdherent --><tr class="com-cursor-pointer compte-ligne" ><td class="com-table-td com-underline-hover"><span class="ui-helper-hidden id-adherent">{listeAdherent.adhId}</span>{listeAdherent.adhNumero}</td><td class="com-table-td com-underline-hover">{listeAdherent.adhNom}</td><td class="com-table-td com-underline-hover">{listeAdherent.adhPrenom}</td><td class="com-table-td com-underline-hover">{listeAdherent.adhCourrielPrincipal}</td><td class="com-table-td com-underline-hover liste-adh-td-solde"><span class="{listeAdherent.classSolde}">{listeAdherent.cptSolde} {sigleMonetaire}</span></td></tr><!-- END listeAdherent --></tbody></table></div></div></div></div>';this.listeAdherentVide='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Adhérents</div><p id="texte-liste-vide">Aucun adhérent dans la base.</p></div></div>';this.dialogSuppressionAdherent='<div id="dialog-supp-adh" title="Supprimer l\'adhérent {adhNumero}"><p class="ui-state-error ui-corner-all"><span class="ui-icon ui-icon-alert com-float-left"></span>ATTENTION : Voulez-vous réellement supprimer l\'adherent : {adhNumero}</p></div>';this.infoCompteAdherentDebut='<div id="info_compte_solde_adherent_ext"><div id="info_compte_solde_adherent_int"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Informations<span class="com-btn-header-multiples ui-widget-content ui-corner-all com-cursor-pointer" id="btn-supp" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span><span class="com-btn-header-multiples ui-widget-content ui-corner-all com-cursor-pointer" id="btn-edt" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span></div><div class="com-widget-content"><div>Numéro d\'adhérent : {adhNumero}</div><div>Numéro de Compte : {cptLabel}</div><div>Nom : {adhNom}</div><div>Prénom : {adhPrenom}</div><div>Date de naissance : {adhDateNaissance}</div><div>Date d\'adhésion : {adhDateAdhesion}</div><div>Commentaire : {adhCommentaire}</div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Coordonnées</div><div class="com-widget-content"><div>Courriel Principal : {adhCourrielPrincipal}</div><div>Courriel Secondaire : {adhCourrielSecondaire}</div><div>Téléphone Principal : {adhTelephonePrincipal}</div><div>Téléphone Secondaire : {adhTelephoneSecondaire}</div><div>Adresse : {adhAdresse}</div><div>Ville : {adhVille}</div><div>Code Postal : {adhCodePostal}</div></div></div>';this.infoCompteAdherentAutorisation='<div id="info_compte_autorisations_int"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Autorisations</div><div class="com-widget-content"><!-- BEGIN modules --><div><span class="com-float-left ui-icon {modules.classAutorisation}"></span>{modules.label}</div><!-- END modules --></div></div></div>';this.infoCompteAdherentFin="</div></div>";this.listeOperationPassee='<div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Solde : <span id="solde">{opeMontant} {sigleMonetaire}</span></div>	<div><div id="content-nav-liste-operation" class="ui-helper-clearfix ui-state-default ui-corner-all"><form>	<span id="icone-nav-liste-operation-w" class="prev ui-helper-hidden ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-w"></span></span>	<span id="page-compteur">Page : <span type="text" class="pagedisplay"></span></span>	<span id="icone-nav-liste-operation-e" class="next ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-e"></span></span>	<input type="hidden" class="pagesize" value="10"></form></div><table id="table-operation" class="com-table"><thead><tr class="ui-widget ui-widget-header" ><th class="com-table-th">Date</th><th class="com-table-th">Libellé</th><th class="com-table-th">Type de paiement</th><th class="com-table-th">Débit</th><th class="com-table-th">Crédit</th></tr></thead><tbody><!-- BEGIN operationPassee --><tr><td class="com-table-td td-date ">{operationPassee.opeDate}</td><td class="com-table-td td-libelle">{operationPassee.opeLibelle}</td><td class="com-table-td td-type-paiement">{operationPassee.tppType}</td><td class="com-table-td td-montant">{operationPassee.debit}</td><td class="com-table-td td-montant">{operationPassee.credit}</td></tr><!-- END operationPassee --></tbody></table></div></div>';this.listeOperationAdherentDebut='<div id="liste_operation_adherent_ext"><div id="liste_operation_adherent_int">';this.listeOperationAdherentFin="</div></div>";this.listeOperationAvenir='<div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Achat(s) Futur(s)</div><div><table class="com-table"><tr class="ui-widget ui-widget-header" ><th class="com-table-th">Réservation</th><th class="com-table-th">Libellé</th><th class="com-table-th">Marché</th><th class="com-table-th">Prix</th><th class="com-table-th">Solde</th><th class="com-table-th">Recharger</th></tr><!-- BEGIN operationAvenir --><tr><td class="com-table-td td-date">{operationAvenir.opeDate}</td><td class="com-table-td td-libelle ">{operationAvenir.opeLibelle}</td><td class="com-table-td td-date">{operationAvenir.comDateMarche}</td><td class="com-table-td td-montant">{operationAvenir.opeMontant}  {sigleMonetaire}</td><td class="com-table-td td-montant"><span class="nouveau-solde"><span class="nouveau-solde-val">{operationAvenir.nouveauSolde}</span>  {sigleMonetaire}</span></td><td class="com-table-td td-montant">{operationAvenir.rechargement}  {sigleMonetaire}</td></tr><!-- END operationAvenir --></table></div></div>'}function AjoutAdherentVue(a){this.mCommunVue=new CommunVue();this.construct=function(b){$.history({vue:function(){AjoutAdherentVue(b)}});var c=this;$.post("./index.php?m=GestionAdherents&v=AjoutAdherent",function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var c=this;var b={modules:[],modules_default:[]};$(d.modules).each(function(){if(this.defaut==1){b.modules_default.push(this)}else{b.modules.push(this)}});b.dateAdhesion=getDateAujourdhuiDb().dateDbToFr();var e=new GestionAdherentsTemplate();var f=e.formulaireAjoutAdherent;$("#contenu").replaceWith(c.affect($(f.template(b))))};this.affect=function(b){b=this.boutonLienCompte(b);b=this.mCommunVue.comNumeric(b);b=this.affectControleDatepicker(b);b=this.affectSubmit(b);b=this.mCommunVue.comHoverBtn(b);return b};this.boutonLienCompte=function(b){b.find(":input[name=lien_numero_compte]").click(function(){if(b.find(":input[name=numero_compte]").attr("disabled")){b.find(":input[name=numero_compte]").removeAttr("disabled")}else{b.find(":input[name=numero_compte]").attr("disabled","disabled").val("")}});return b};this.affectControleDatepicker=function(b){b=this.mCommunVue.comLienDatepicker("dateNaissance","dateAdhesion",b);b.find("#dateNaissance").datepicker("option","yearRange","1900:c");b.find("#dateAdhesion").datepicker("option","yearRange","1900:c");return b};this.affectSubmit=function(b){var c=this;b.find("form").submit(function(){c.ajoutAdherent();return false});return b};this.ajoutAdherent=function(){var b=new AdherentVO();b.motPasse=$(":input[name=pass]").val();b.motPasseConfirm=$(":input[name=pass_confirm]").val();b.compte=$(":input[name=numero_compte]").val();b.nom=$(":input[name=nom]").val();b.prenom=$(":input[name=prenom]").val();b.courrielPrincipal=$(":input[name=courriel_principal]").val();b.courrielSecondaire=$(":input[name=courriel_secondaire]").val();b.telephonePrincipal=$(":input[name=telephone_principal]").val();b.telephoneSecondaire=$(":input[name=telephone_secondaire]").val();b.adresse=$(":input[name=adresse]").val();b.codePostal=$(":input[name=code_postal]").val();b.ville=$(":input[name=ville]").val();b.dateNaissance=$(":input[name=date_naissance]").val().dateFrToDb();b.dateAdhesion=$(":input[name=date_adhesion]").val().dateFrToDb();b.commentaire=$(":input[name=commentaire]").val();$(":input[name=modules[]]:checked").each(function(){b.modules.push($(this).val())});$(":input[name=modules_default[]]").each(function(){b.modules.push($(this).val())});var c=new AdherentValid();var d=c.validAjout(b);if(d.valid){Infobulle.init();$.post("./index.php?m=GestionAdherents&v=AjoutAdherent","pParam="+$.toJSON(b),function(e){Infobulle.init();if(e){if(e.valid){var f=new GestionAdherentsTemplate();var g=f.ajoutAdherentSucces;$("#contenu").replaceWith(g.template(e))}else{Infobulle.generer(e,"")}}},"json")}else{Infobulle.generer(d,"")}};this.construct(a)}function CompteAdherentVue(a){this.mIdAdherent=null;this.mAdhNumero=null;this.construct=function(b){$.history({vue:function(){CompteAdherentVue(b)}});var c=this;$.post("./index.php?m=GestionAdherents&v=CompteAdherent","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(f){var e=this;this.mIdAdherent=f.adherent.adhId;this.mAdhNumero=f.adherent.adhNumero;f.opeMontant=f.adherent.cptSolde.nombreFormate(2,","," ");f.sigleMonetaire=gSigleMonetaire;f.adherent.adhDateNaissance=f.adherent.adhDateNaissance.extractDbDate().dateDbToFr();f.adherent.adhDateAdhesion=f.adherent.adhDateAdhesion.extractDbDate().dateDbToFr();$(f.operationPassee).each(function(){this.opeDate=this.opeDate.extractDbDate().dateDbToFr();if(this.tppType==null){this.tppType=""}if(this.opeMontant<0){this.debit=(this.opeMontant*-1).nombreFormate(2,","," ")+" "+gSigleMonetaire;this.credit=""}else{this.debit="";this.credit=this.opeMontant.nombreFormate(2,","," ")+" "+gSigleMonetaire}});var d=parseFloat(f.adherent.cptSolde);var c=0;$(f.operationAvenir).each(function(){if(this.opeDate!=null){d+=parseFloat(this.opeMontant);this.nouveauSolde=d.nombreFormate(2,","," ");this.rechargement=(0).nombreFormate(2,","," ");var i=5;if(d<i){this.rechargement=(Math.ceil((i-d)/i)*i)-c}c+=this.rechargement;this.rechargement=this.rechargement.nombreFormate(2,","," ");this.opeDate=this.opeDate.extractDbDate().dateDbToFr();this.comDateMarche=this.comDateMarche.extractDbDate().dateDbToFr();this.opeMontant=(this.opeMontant*-1).nombreFormate(2,","," ")}});$(f.modules).each(function(){var i=this;this.classAutorisation="ui-icon-closethick";$(f.autorisations).each(function(){if(this.idModule==i.id){i.classAutorisation="ui-icon-check"}})});var g=new GestionAdherentsTemplate();var h=new CommunTemplate();var b=h.debutContenu;b+=g.infoCompteAdherentDebut.template(f.adherent);b+=g.infoCompteAdherentAutorisation.template(f);b+=g.infoCompteAdherentFin.template(f);b+=g.listeOperationAdherentDebut.template(f);b+=g.listeOperationPassee.template(f);if(isArray(f.operationAvenir)&&f.operationAvenir[0].opeLibelle!=null){b+=g.listeOperationAvenir.template(f)}b+=g.listeOperationAdherentFin.template(f);b+=h.finContenu;b=$(b);if(f.adherent.cptSolde<0){b=this.soldeNegatif(b)}if(f.operationPassee.length<11){b=this.masquerPagination(b)}else{b=this.paginnation(b)}$("#contenu").replaceWith(e.affect(b))};this.affect=function(b){b=this.nouveauSoldeNegatif(b);b=this.affectHover(b);b=this.affectLienModifier(b);b=this.affectDialogSuppAdherent(b);b=gCommunVue.comHoverBtn(b);return b};this.paginnation=function(b){b.find("#table-operation").tablesorter({headers:{0:{sorter:false},1:{sorter:false},2:{sorter:false},3:{sorter:false},4:{sorter:false}}}).tablesorterPager({container:b.find("#content-nav-liste-operation"),positionFixed:false});return b};this.nouveauSoldeNegatif=function(b){b.find(".nouveau-solde-val").each(function(){if(parseFloat($(this).text().numberFrToDb())<0){$(this).closest(".nouveau-solde").addClass("com-nombre-negatif")}});return b};this.soldeNegatif=function(b){b.find("#solde").addClass("com-nombre-negatif");return b};this.affectHover=function(b){b.find("#icone-nav-liste-operation-w,#icone-nav-liste-operation-e").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});return b};this.masquerPagination=function(b){b.find("#content-nav-liste-operation").hide();return b};this.affectLienModifier=function(b){var c=this;b.find("#btn-edt").click(function(){ModificationAdherentVue({id_adherent:c.mIdAdherent})});return b};this.affectDialogSuppAdherent=function(b){var c=this;b.find("#btn-supp").click(function(){var d=new GestionAdherentsTemplate();var e=d.dialogSuppressionAdherent;$(e.template({adhNumero:c.mAdhNumero})).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var f={id_adherent:c.mIdAdherent};var g=this;$.post("./index.php?m=GestionAdherents&v=SuppressionAdherent","pParam="+$.toJSON(f),function(h){Infobulle.init();if(h){if(h.valid){var i=new GestionAdherentsTemplate();var j=i.supprimerAdherentSucces;$("#contenu").replaceWith(j.template(h));$(g).dialog("close")}else{Infobulle.generer(h,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove()}})});return b};this.construct(a)}function ListeAdherentVue(a){this.construct=function(b){$.history({vue:function(){ListeAdherentVue(b)}});var c=this;$.post("./index.php?m=GestionAdherents&v=ListeAdherent",function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var b=this;var d=new GestionAdherentsTemplate();if(c.listeAdherent.length>0&&c.listeAdherent[0].adhId!=null){var e=d.listeAdherent;c.sigleMonetaire=gSigleMonetaire;$(c.listeAdherent).each(function(){this.classSolde="";if(this.cptSolde<0){this.classSolde="com-nombre-negatif"}this.cptSolde=this.cptSolde.nombreFormate(2,","," ")});$("#contenu").replaceWith(b.affect($(e.template(c))))}else{$("#contenu").replaceWith(d.listeAdherentVide)}};this.affect=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectLienCompte(b);return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[0,0]],headers:{4:{sorter:false}}});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectLienCompte=function(b){var c=this;b.find(".compte-ligne").click(function(){CompteAdherentVue({id_adherent:$(this).find(".id-adherent").text()})});return b};this.construct(a)}function ModificationAdherentVue(a){this.mCommunVue=new CommunVue();this.mIdAdherent=null;this.construct=function(b){$.history({vue:function(){ModificationAdherentVue(b)}});var c=this;$.post("./index.php?m=GestionAdherents&v=ModificationAdherent","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mIdAdherent=b.id_adherent;c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(e){var d=this;var c=e;var g=[],b=[];$(e.modules).each(function(){if(this.defaut==1){g.push(this)}else{b.push(this)}});c.modules_default=g;c.modules=b;c.dateAdhesion=e.dateAdhesion.extractDbDate().dateDbToFr();c.dateNaissance=e.dateNaissance.extractDbDate().dateDbToFr();$(e.autorisations).each(function(){var i=this.idModule;$(c.modules).each(function(){if(this.id==i){this.checked='checked="checked"'}})});var f=new GestionAdherentsTemplate();var h=f.formulaireAjoutAdherent;$("#contenu").replaceWith(d.affect($(h.template(c))))};this.affect=function(b){b=this.boutonLienCompte(b);b=this.mCommunVue.comNumeric(b);b=this.affectControleDatepicker(b);b=this.affectSubmit(b);b=this.mCommunVue.comHoverBtn(b);return b};this.boutonLienCompte=function(b){b.find(":input[name=lien_numero_compte]").click(function(){if(b.find(":input[name=numero_compte]").attr("disabled")){b.find(":input[name=numero_compte]").removeAttr("disabled")}else{b.find(":input[name=numero_compte]").attr("disabled","disabled")}});return b};this.affectControleDatepicker=function(b){b=this.mCommunVue.comLienDatepicker("dateNaissance","dateAdhesion",b);b.find("#dateNaissance").datepicker("option","yearRange","1900:c");b.find("#dateAdhesion").datepicker("option","yearRange","1900:c");return b};this.affectSubmit=function(b){var c=this;b.find("form").submit(function(){c.modifAdherent();return false});return b};this.modifAdherent=function(){var b=new AdherentVO();b.id=this.mIdAdherent;b.motPasse=$(":input[name=pass]").val();b.motPasseConfirm=$(":input[name=pass_confirm]").val();b.compte=$(":input[name=numero_compte]").val();b.nom=$(":input[name=nom]").val();b.prenom=$(":input[name=prenom]").val();b.courrielPrincipal=$(":input[name=courriel_principal]").val();b.courrielSecondaire=$(":input[name=courriel_secondaire]").val();b.telephonePrincipal=$(":input[name=telephone_principal]").val();b.telephoneSecondaire=$(":input[name=telephone_secondaire]").val();b.adresse=$(":input[name=adresse]").val();b.codePostal=$(":input[name=code_postal]").val();b.ville=$(":input[name=ville]").val();b.dateNaissance=$(":input[name=date_naissance]").val().dateFrToDb();b.dateAdhesion=$(":input[name=date_adhesion]").val().dateFrToDb();b.commentaire=$(":input[name=commentaire]").val();$(":input[name=modules[]]:checked").each(function(){b.modules.push($(this).val())});$(":input[name=modules_default[]]").each(function(){b.modules.push($(this).val())});var c=new AdherentValid();var d=c.validUpdate(b);if(d.valid){Infobulle.init();$.post("./index.php?m=GestionAdherents&v=ModificationAdherent","pParam="+$.toJSON(b),function(e){Infobulle.init();if(e){if(e.valid){var f=new GestionAdherentsTemplate();var g=f.modifierAdherentSucces;$("#contenu").replaceWith(g.template(e))}else{Infobulle.generer(e,"")}}},"json")}else{Infobulle.generer(d,"")}};this.construct(a)};