function GestionCommandeTemplate(){this.formulaireModifierCommande='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-editer-com"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div id="formulaire_ajout_commande_ext"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Modifier le Marché n°{comNumero}</div><div class="com-widget-content"><form id="formulaire-information-creation-commande"><table class="com-table-form"><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Nom du Marché</th><td class="com-table-form-td"><input value="{comNom}" class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom_commande" id="commande-nom" maxlength="100" /></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Fin des Réservations *</th><td class="com-table-form-td"><input value="{dateTimeFinReservation}" class="com-input-text ui-widget-content ui-corner-all" type="text" name="date_fin_commande" id="commande-dateFinReservation" /></td><td class="com-table-form-td">&nbsp;&nbsp;à <select name="heure_fin_commande" id="commande-timeFinReservation" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>H <select name="minute_fin_commande"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Jour du marché *</th><td class="com-table-form-td"><input value="{dateMarcheDebut}" class="com-input-text ui-widget-content ui-corner-all" type="text" name="date_debut_marche" id="commande-dateMarcheDebut"/></td><td class="com-table-form-td">de <select name="heure_debut_marche" id="commande-timeMarcheDebut"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>H <select name="minute_debut_marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td><td class="com-table-form-td">à  <select name="heure_fin_marche" id="commande-timeMarcheFin"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>H <select name="minute_fin_marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Description :</th><td class="com-table-form-td"><textarea class="com-input-text ui-widget-content ui-corner-all" name="description_commande" id="commande-description" >{comDescription}</textarea></td></tr></table></form></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all" id="window-ajout-produit-creation-commande"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Ajouter un produit</div><div class="com-widget-content"><form id="formulaire-ajout-produit-creation-commande"><table class="com-table-form"><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Produit</th><td class="com-table-form-td" id="ajout-produit-nom"><select name="produit" id="ajout-produit-idNom"><option value="0" >== Choisir un produit ==</option><!-- BEGIN produits --><option value={produits.id} >{produits.nom}</option><!-- END produits --></select></td><td class="com-center"><button type="button" id="btn-creer-nv-pdt" class="ui-state-default ui-corner-all com-button com-center">Créer un nouveau produit</button></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Producteur</th><td class="com-table-form-td" colspan="2"><select name="producteur" id="ajout-produit-idProducteur"><option value="0" >== Choisir un producteur ==</option><!-- BEGIN producteurs --><option value="{producteurs.prdtId}" >{producteurs.prdtPrenom} {producteurs.prdtNom}</option><!-- END producteurs --></select></td></tr><tr><td class="com-table-form-td"><br/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Stock</th><th class="com-table-form-th ui-widget-content ui-corner-all">Unité</th><th class="com-table-form-th ui-widget-content ui-corner-all">Quantité max par adhérent</th></tr><tr><td class="com-table-form-td"><input class="com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="stock" maxlength="11" id="ajout-produit-qteRestante"/></td><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" name="unite" type="text" maxlength="20" id="ajout-produit-unite"/></td><td class="com-table-form-td"><input class="com-numeric com-input-text ui-widget-content ui-corner-all" name="qmax" type="text" maxlength="11" id="ajout-produit-qteMaxCommande" /></td></tr><tr><td class="com-table-form-td"><br/></td></tr><tr><td></td><th class="com-table-form-th ui-widget-content ui-corner-all">Taille</th><th class="com-table-form-th ui-widget-content ui-corner-all">Prix</th></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Lot</th><td class="com-table-form-td"><input class="com-numeric com-input-text ui-widget-content ui-corner-all" name="taille" type="text" maxlength="12" id="ajout-produit-lots0taille"/></td><td class="com-table-form-td"><input class="com-numeric com-input-text ui-widget-content ui-corner-all" name="prix" type="text" maxlength="12" id="ajout-produit-lots0prix"/> {SIGLE_MONETAIRE}</td></tr><tr><td class="com-table-form-td"><br/></td></tr><tr><td colspan="3" class="com-center"><input class="ui-state-default ui-corner-all com-button com-center" type="submit" value="Ajouter au Marché"/></td></tr></table></form></div></div><div id="liste_produit"></div><div class="com-widget-window ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-modifier-creation-commande" class="com-btn-edt-multiples ui-helper-hidden ui-state-default ui-corner-all com-button com-center">Modifier</button><button type="button" id="btn-creer-commande" class="ui-state-default ui-corner-all com-button com-center">Valider</button></div></div></div>';this.dialogAjoutProduit='<div id="dialog-form-creer-nv-pdt" title="Créer un nouveau produit"><form><table><tr><td>Nom</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom" id="nom-pdt-nom"/></td></tr><tr><td>Description</td><td><textarea class="com-input-text ui-widget-content ui-corner-all" name="description" id="nom-pdt-description"></textarea></td></tr></table></form></div>';this.ajoutProduitModifierCommande='<div class="produit-div com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all"><span class="produit-nom-id ui-helper-hidden">{proIdNomProduit}</span><span class="produit-nom">{nproNom}</span><span class="com-delete com-btn-header ui-widget-content ui-corner-all" title="Supprimer"><span class="ui-icon ui-icon-circle-close"></span></span></div><div class="com-widget-content"><span class="produit-id ui-helper-hidden">{proId}</span>Producteur : <span class="info-produit" id="nom-producteur">{nomProducteur}</span><select name="producteur" id="commande-produits{idNom}idProducteur" class="info-produit ui-helper-hidden"><option value="0" >== Choisir un producteur ==</option><!-- BEGIN producteurs --><option value="{producteurs.prdtId}" >{producteurs.prdtPrenom} {producteurs.prdtNom}</option><!-- END producteurs --></select><span class="edit-nom-pdt-creation-commande edit-nom-pdt-creation-commande-edit com-btn-header ui-widget-content ui-corner-all" title="Editer"><span class="ui-icon ui-icon-pencil"></span></span><span class="ui-helper-hidden btn-valider com-btn-header edit-nom-pdt-creation-commande edit-nom-pdt-creation-commande-valid ui-widget-content ui-corner-all" title="Valider"><span class="ui-icon ui-icon-check com-float-left"></span>Valider</span><br/>Quantité en stock : <span class="info-produit produit-stock">{quantiteInit}</span><input class="info-produit ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="stock" value="{quantiteInit}" id="produit-{proIdNomProduit}-qteRestante" maxlength="11"/> <span class="info-produit produit-unite">{proUniteMesure}</span> <input class="info-produit ui-helper-hidden com-input-text ui-widget-content ui-corner-all" type="text" name="unite" value="{proUniteMesure}" id="produit-{proIdNomProduit}-unite" maxlength="20"/><br/>Quantité max par adhérent : <input class="info-produit ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="qmax" value="{proMaxProduitCommande}" id="produit-{proIdNomProduit}-qteMaxCommande" maxlength="11"/><span class="info-produit produit-qmax">{proMaxProduitCommande}</span> <span class="produit-unite">{proUniteMesure}</span><div class="lots-section" ><div class="form-ajout-lot-creation-commande"><form><table><tr><td></td><td>Taille</td><td>Prix</td></tr><tr><td>Nouveau Lot : </td><td><input class="com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="taille" id="ajout-lot-produit-{proId}-taille" maxlength="12"/> <span class="produit-unite">{proUniteMesure}</span></td><td><input class="com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="prix" id="ajout-lot-produit-{proId}-prix" maxlength="12"/> {sigleMonetaire}</td><td><button type="button" class="btn-ajout-lot-creation-commande ui-state-default ui-corner-all com-button com-center">Ajouter</button></td></tr></table></form></div><div class="produit-lots"></div></div></div></div>';this.modifCommandeSucces='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Modification de la commande n°{numero}</div><div class="com-widget-content"><p class="com-msg-confirm-icon"><span class="com-float-left ui-icon ui-icon-check"></span>Marché n°{numero} modifié avec succès.</p></div></div></div>';this.formulaireAjoutCommande='<div id="contenu"><div id="formulaire_ajout_commande_ext"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Nouveau Marché</div><div class="com-widget-content"><form id="formulaire-information-creation-commande"><table class="com-table-form"><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Nom du Marché</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom_commande" id="commande-nom" maxlength="100" /></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Fin des Réservations *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="date_fin_commande" id="commande-dateFinReservation" /></td><td class="com-table-form-td">&nbsp;&nbsp;à <select name="heure_fin_commande" id="commande-timeFinReservation" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>H <select name="minute_fin_commande"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Jour du marché *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="date_debut_marche" id="commande-dateMarcheDebut"/></td><td class="com-table-form-td">de <select name="heure_debut_marche" id="commande-timeMarcheDebut"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>H <select name="minute_debut_marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td><td class="com-table-form-td">à  <select name="heure_fin_marche" id="commande-timeMarcheFin"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>H <select name="minute_fin_marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Description :</th><td class="com-table-form-td"><textarea class="com-input-text ui-widget-content ui-corner-all" name="description_commande" id="commande-description" ></textarea></td></tr></table></form></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all" id="window-ajout-produit-creation-commande"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Ajouter un produit</div><div class="com-widget-content"><form id="formulaire-ajout-produit-creation-commande"><table class="com-table-form"><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Produit</th><td class="com-table-form-td" id="ajout-produit-nom"><select name="produit" id="ajout-produit-idNom"><option value="0" >== Choisir un produit ==</option><!-- BEGIN produits --><option value="{produits.id}" >{produits.nom}</option><!-- END produits --></select></td><td class="com-center"><button type="button" id="btn-creer-nv-pdt" class="ui-state-default ui-corner-all com-button com-center">Créer un nouveau produit</button></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Producteur</th><td class="com-table-form-td" colspan="2"><select name="producteur" id="ajout-produit-idProducteur"><option value="0" >== Choisir un producteur ==</option><!-- BEGIN producteurs --><option value="{producteurs.prdtId}" >{producteurs.prdtPrenom} {producteurs.prdtNom}</option><!-- END producteurs --></select></td></tr><tr><td class="com-table-form-td"><br/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Stock</th><th class="com-table-form-th ui-widget-content ui-corner-all">Unité</th><th class="com-table-form-th ui-widget-content ui-corner-all">Quantité max par adhérent</th></tr><tr><td class="com-table-form-td"><input class="com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="stock" maxlength="11" id="ajout-produit-qteRestante"/></td><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" name="unite" type="text" maxlength="20" id="ajout-produit-unite"/></td><td class="com-table-form-td"><input class="com-numeric com-input-text ui-widget-content ui-corner-all" name="qmax" type="text" maxlength="11" id="ajout-produit-qteMaxCommande" /></td></tr><tr><td class="com-table-form-td"><br/></td></tr><tr><td></td><th class="com-table-form-th ui-widget-content ui-corner-all">Taille</th><th class="com-table-form-th ui-widget-content ui-corner-all">Prix</th></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Lot</th><td class="com-table-form-td"><input class="com-numeric com-input-text ui-widget-content ui-corner-all" name="taille" type="text" maxlength="12" id="ajout-produit-lots0taille"/></td><td class="com-table-form-td"><input class="com-numeric com-input-text ui-widget-content ui-corner-all" name="prix" type="text" maxlength="12" id="ajout-produit-lots0prix"/> {SIGLE_MONETAIRE}</td></tr><tr><td class="com-table-form-td"><br/></td></tr><tr><td colspan="3" class="com-center"><input type="submit" value="Ajouter au Marché" class="ui-state-default ui-corner-all com-button com-center"/></td></tr></table></form></div></div><div id="liste_produit"></div><div class="com-widget-window ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-modifier-creation-commande" class="com-btn-edt-multiples ui-helper-hidden ui-state-default ui-corner-all com-button com-center">Modifier le Marché</button><button type="button" id="btn-creer-commande" class="ui-state-default ui-corner-all com-button com-center">Créer le Marché</button></div></div></div>';this.ajoutProduitAjoutCommande='<div class="produit-div com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all"><span class="produit-nom">{nom}</span><span class="com-delete com-btn-header ui-widget-content ui-corner-all" title="Supprimer"><span class="ui-icon ui-icon-circle-close"></span></span></div><div class="com-widget-content"><span class="produit-id ui-helper-hidden">{idNom}</span>Producteur : <span class="info-produit" id="nom-producteur">{nomProducteur}</span><select name="producteur" id="commande-produits{idNom}idProducteur" class="info-produit ui-helper-hidden"><option value="0" >== Choisir un producteur ==</option><!-- BEGIN producteurs --><option value="{producteurs.prdtId}" >{producteurs.prdtPrenom} {producteurs.prdtNom}</option><!-- END producteurs --></select><span class="edit-nom-pdt-creation-commande edit-nom-pdt-creation-commande-edit com-btn-header ui-widget-content ui-corner-all" title="Editer"><span class="ui-icon ui-icon-pencil"></span></span><span class="ui-helper-hidden btn-valider com-btn-header edit-nom-pdt-creation-commande edit-nom-pdt-creation-commande-valid ui-widget-content ui-corner-all" title="Valider"><span class="ui-icon ui-icon-check com-float-left"></span>Valider</span><br/>Quantité en stock : <span class="produit-stock info-produit">{qteRestante}</span><input class="info-produit ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="stock" value="{qteRestante}" id="produit-{idNom}-qteRestante" maxlength="11"/> <span class="info-produit produit-unite">{unite}</span> <input class="info-produit ui-helper-hidden com-input-text ui-widget-content ui-corner-all" type="text" name="unite" value="{unite}" id="produit-{idNom}-unite" maxlength="20"/><br/>Quantité max par adhérent : <span class="info-produit produit-qmax">{qteMaxCommande}</span><input class="info-produit ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="qmax" value="{qteMaxCommande}" id="produit-{idNom}-qteMaxCommande" maxlength="11"/> <span class="produit-unite">{unite}</span><div class="lots-section" ><div class="form-ajout-lot-creation-commande"><form><table><tr><td></td><td>Taille</td><td>Prix</td></tr><tr><td>Nouveau Lot : </td><td><input class="com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="taille" id="ajout-lot-produit-{idNom}-taille" maxlength="12"/> <span class="produit-unite">{unite}</span></td><td><input class="com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="prix" id="ajout-lot-produit-{idNom}-prix" maxlength="12"/> {siglemonetaire}</td><td><button type="button" class="btn-ajout-lot-creation-commande ui-state-default ui-corner-all com-button com-center">Ajouter</button></td></tr></table></form></div><div class="produit-lots"></div></div></div></div>';this.ajoutLotModifPdt='<!-- BEGIN lots --><div class="produit-lot"><span class="lot-id ui-helper-hidden">{lots.id}</span>Taille : <input class="pdt-{lots.idPdt}-lot-{lots.id} ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="taille" value="{lots.taille}" id="produit-{lots.idPdt}-lot-{lots.id}-taille" maxlength="12"/><span class="pdt-{lots.idPdt}-lot-{lots.id} produit-taille">{lots.taille}</span> <span class="produit-unite">{lots.unite}</span>   Prix : <input class="pdt-{lots.idPdt}-lot-{lots.id} ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="prix" value="{lots.prix}" id="produit-{lots.idPdt}-lot-{lots.id}-prix" maxlength="12" /><span class="pdt-{lots.idPdt}-lot-{lots.id} produit-prix">{lots.prix}</span> {siglemonetaire}<span class="conteneur-btn-edt-lot"><span class="ui-helper-hidden delete-lot com-btn-header-multiples ui-widget-content ui-corner-all" title="Supprimer"><span class="ui-icon ui-icon-closethick"></span></span><span class="edit-lot-creation-commande edit-lot-creation-commande-edit com-btn-header-multiples ui-widget-content ui-corner-all" title="Editer"><span class="ui-icon ui-icon-pencil"></span></span><span class="ui-helper-hidden btn-valider com-btn-header-multiples edit-lot-creation-commande edit-lot-creation-commande-valid ui-widget-content ui-corner-all" title="Valider"><span class="ui-icon ui-icon-check com-float-left"></span>Valider</span></span></div><!-- END lots -->';this.ajoutLotAjoutPdt='<!-- BEGIN lots --><div class="produit-lot"><span class="lot-id ui-helper-hidden">0</span>Taille : <span class="pdt-{idNom}-lot-0 produit-taille">{lots.taille}</span><input class="pdt-{idNom}-lot-0 ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="taille" value="{lots.taille}" id="produit-{idNom}-lot-0-taille" maxlength="12"/> <span class="produit-unite">{unite}</span>   Prix : <span class="pdt-{idNom}-lot-0 produit-prix">{lots.prix}</span><input class="pdt-{idNom}-lot-0 ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="prix" value="{lots.prix}" id="produit-{idNom}-lot-0-prix" maxlength="12" /> {siglemonetaire}<span class="conteneur-btn-edt-lot"><span class="ui-helper-hidden delete-lot com-btn-header-multiples ui-widget-content ui-corner-all" title="Supprimer"><span class="ui-icon ui-icon-closethick"></span></span><span class="edit-lot-creation-commande edit-lot-creation-commande-edit com-btn-header-multiples ui-widget-content ui-corner-all" title="Editer"><span class="ui-icon ui-icon-pencil"></span></span><span class="ui-helper-hidden btn-valider com-btn-header-multiples edit-lot-creation-commande edit-lot-creation-commande-valid ui-widget-content ui-corner-all" title="Valider"><span class="ui-icon ui-icon-check com-float-left"></span>Valider</span></span></div><!-- END lots -->';this.ajoutLot='<div class="produit-lot"><span class="lot-id ui-helper-hidden">{id}</span>Taille : <span class="pdt-{idNom}-lot-{id} produit-taille">{taille}</span><input class="pdt-{idNom}-lot-{id} ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="taille" value="{taille}" id="produit-{idNom}-lot-{id}-taille" maxlength="12"> <span class="produit-unite">{unite}</span>   Prix : <span class="pdt-{idNom}-lot-{id} produit-prix">{prix}</span><input class="pdt-{idNom}-lot-{id} ui-helper-hidden com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="prix" value="{prix}" id="produit-{idNom}-lot-{id}-prix" maxlength="12"> {siglemonetaire}<span class="conteneur-btn-edt-lot"><span class="ui-helper-hidden delete-lot com-btn-header-multiples ui-widget-content ui-corner-all" title="Supprimer"><span class="ui-icon ui-icon-closethick"></span></span><span class="edit-lot-creation-commande edit-lot-creation-commande-edit com-btn-header-multiples ui-widget-content ui-corner-all" title="Editer"><span class="ui-icon ui-icon-pencil"></span></span><span class="ui-helper-hidden btn-valider com-btn-header-multiples edit-lot-creation-commande edit-lot-creation-commande-valid ui-widget-content ui-corner-all" title="Valider"><span class="ui-icon ui-icon-check com-float-left"></span>Valider</span></span></div>';this.ajoutCommandeSucces='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Création du Marché</div><div class="com-widget-content"><p class="com-msg-confirm-icon"><span class="com-float-left ui-icon ui-icon-check"></span>Le marché n°{numero} a été ajouté avec succès.</p></div></div></div>';this.listeCommandePage='<div id="contenu"><div id="liste_commande_int"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-archive"><span class="com-float-left">Les Marchés cloturés</span><span class="com-float-left ui-icon ui-icon-arrowthick-1-e"></span></button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés en cours</div><table class="com-table"><tr class="ui-widget ui-widget-header"><th class="com-table-th lst-resa-th-num">N°</th><th class="com-table-th">Date de cloture des Réservations</th><th class="com-table-th">Marché</th>	<th class="com-table-th"></th><th class="com-table-th"></th></tr><!-- BEGIN commande --><tr><td class="com-table-td com-text-align-right">{commande.numero}</td><td class="com-table-td">Le {commande.dateFinReservation} à {commande.heureFinReservation}H{commande.minuteFinReservation}</td><td class="com-table-td">Le {commande.dateMarcheDebut} de {commande.heureMarcheDebut}H{commande.minuteMarcheDebut} à {commande.heureMarcheFin}H{commande.minuteMarcheFin}</td><td class="com-table-td lst-resa-btn-commander"><button class="btn-editer ui-state-default ui-corner-all com-button com-center" id="{commande.id}" >Editer</button></td><td class="com-table-td lst-resa-btn-commander"><button class="btn-marche ui-state-default ui-corner-all com-button com-center" id="{commande.id}" >Vente</button></td></tr><!-- END commande --></table></div></div></div></div>';this.listeCommandeArchivePage='<div id="contenu"><div id="liste_commande_int"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-encours"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Les Marchés en cours</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés cloturés</div><div id="content-nav-liste-operation" class="ui-helper-clearfix ui-state-default ui-corner-all"><form>	<span id="icone-nav-liste-operation-w" class="prev ui-helper-hidden ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-w"></span></span>	<span id="page-compteur">Page : <span type="text" class="pagedisplay"></span></span>	<span id="icone-nav-liste-operation-e" class="next ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-e"></span></span>	<input type="hidden" class="pagesize" value="30"></form></div><table class="com-table" id="table-marche-archive"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th lst-resa-th-num com-cursor-pointer"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th com-cursor-pointer" ><span class="ui-icon span-icon"></span>Date de cloture des Réservations</th><th class="com-table-th com-cursor-pointer" ><span class="ui-icon span-icon"></span>Marché</th>	</tr></thead><tbody><!-- BEGIN commande --><tr class="com-cursor-pointer detail-commande-ligne" ><td class="com-table-td com-underline-hover com-text-align-right"><span class="ui-helper-hidden id-commande">{commande.id}</span>{commande.numero}</td><td class="com-table-td com-underline-hover">Le {commande.dateFinReservation} à {commande.heureFinReservation}H{commande.minuteFinReservation}</td><td class="com-table-td com-underline-hover">Le {commande.dateMarcheDebut} de {commande.heureMarcheDebut}H{commande.minuteMarcheDebut} à {commande.heureMarcheFin}H{commande.minuteMarcheFin}</td></tr><!-- END commande --></tbody></table></div></div></div></div>';this.listeAdherentCommandePage='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Vente du Marché n°{comNumero}</div><div class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"> <span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></form></div><table class="com-table"><thead><tr class="ui-widget ui-widget-header com-cursor-pointer"><th class="com-table-th com-underline-hover marche-com-th-num-adh"><span class="ui-icon span-icon"></span>Numéro Adhérent</th><th class="com-table-th com-underline-hover marche-com-th-num-adh"><span class="ui-icon span-icon"></span>Numéro Compte</th><th class="com-table-th com-underline-hover marche-com-th-nom"><span class="ui-icon span-icon"></span>Nom</th>	<th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Prénom</th></tr></thead><tbody><!-- BEGIN listeAdherentCommande --><tr class="com-cursor-pointer achat-commande-ligne" ><td class="com-table-td com-underline-hover"><span class="ui-helper-hidden id-adherent">{listeAdherentCommande.adhId}</span>{listeAdherentCommande.adhNumero}</td><td class="com-table-td com-underline-hover">{listeAdherentCommande.adhLabelCompte}</td><td class="com-table-td com-underline-hover">{listeAdherentCommande.adhNom}</td><td class="com-table-td com-underline-hover">{listeAdherentCommande.adhPrenom}</td></tr><!-- END listeAdherentCommande --></tbody></table></div></div></div>';this.achatCommandePage='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Vente du Marché n°{comNumero}</div><div class="com-widget-content"><div id="achat-info-marche">{adhNumero} :  {adhPrenom} {adhNom}<br/>N° de Compte : {adhCompte}</div><div><span>Solde Actuel : </span><span>{adhSolde} {sigleMonetaire}</span><br/><span>Nouveau Solde : </span><span id="nouveau-solde">{adhNouveauSolde}</span> <span id="nouveau-solde-sigle">{sigleMonetaire}</span></div></div></div><div class="com-clear-float-left com-widget-header ui-widget ui-widget-header ui-corner-all com-center"><span>Total Marché : <span id="total-global"></span> {sigleMonetaire}</span></div><div class="com-float-left"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all" id="achat-pdt-widget"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Achat</div><div class="com-widget-content"><table class="achat-commande-table-pdt"><thead><tr><th>Produit</th><th>Quantité</th><th></th><th>Prix</th><th></th></tr></thead><tbody><!-- BEGIN produits --><tr class="ligne-produit"><td><span class="produit-id ui-helper-hidden">{produits.proId}</span>{produits.nproNom}</td><td class="com-text-align-right td-qte"><input type="text" value="{produits.stoQuantite}" class="com-numeric produit-quantite com-input-text ui-widget-content ui-corner-all" id="produits{produits.proId}quantite" maxlength="12" size="3"/> </td><td class="td-unite">{produits.proUniteMesure}</td><td class="com-text-align-right td-qte" ><input type="text" value="{produits.proPrix}" class="com-numeric produit-prix com-input-text ui-widget-content ui-corner-all" id="produits{produits.proId}prix" maxlength="12" size="3"/></td><td><span>{sigleMonetaire}</span></td></tr><!-- END produits --></tbody><tfoot><tr><td colspan="2"></td><td class="com-text-align-right" >Total :</td><td class="com-text-align-right" ><span id="total-achat">{total}</span></td><td><span>{sigleMonetaire}</span></td></tr></tfoot></table></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all" id="achat-pdt-solidaire-widget" ><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Achat Solidaire</div><div class="com-widget-content"><table class="achat-commande-table-pdt"><thead><tr><th>Produit</th><th>Quantité</th><th></th><th>Prix</th><th></th></tr></thead><tbody><!-- BEGIN produitsSolidaire --><tr class="ligne-produit-solidaire"><td><span class="produit-id ui-helper-hidden">{produitsSolidaire.proId}</span>{produitsSolidaire.nproNom}</td><td class="com-text-align-right td-qte"><input type="text" value="0" class="com-numeric produit-solidaire-quantite com-input-text ui-widget-content ui-corner-all" id="produitsSolidaire{produitsSolidaire.proId}quantite" maxlength="12" size="3"/> </td><td class="td-unite">{produitsSolidaire.proUniteMesure}</td><td class="com-text-align-right td-qte" ><input type="text" value="0" class="com-numeric produit-solidaire-prix com-input-text ui-widget-content ui-corner-all" id="produitsSolidaire{produitsSolidaire.proId}prix" maxlength="12" size="3"/></td><td><span>{sigleMonetaire}</span></td></tr><!-- END produitsSolidaire --></tbody><tfoot><tr><td colspan="2"></td><td class="com-text-align-right" >Total :</td><td class="com-text-align-right" ><span id="total-achat-solidaire">0,00</span></td><td><span>{sigleMonetaire}</span></td></tr></tfoot></table></div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all com-float-left" id="achat-rechgt-widget"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Rechargement du compte</div><div class="com-widget-content"><table><thead><tr><th>Montant</th><th>Type de Paiement</th><th id="label-champ-complementaire"></th></tr></thead><tbody><tr><td><input type="text" name="montant-rechargement" value="" class="com-numeric com-input-text ui-widget-content ui-corner-all" id="rechargementmontant" maxlength="12" size="3"/> <span>{sigleMonetaire}</span></td><td class="com-center"><select name="typepaiement" id="rechargementtypePaiement"><option value="0">== Choisir ==</option><!-- BEGIN typePaiement --><option value="{typePaiement.tppId}">{typePaiement.tppType}</option><!-- END typePaiement --></select></td><td id="td-champ-complementaire"><input type="text" name="champ-complementaire" value="" class="com-input-text ui-widget-content ui-corner-all" id="rechargementchampComplementaire" maxlength="50" size="15"/></td></tr></tbody></table></div></div><div class="com-clear-float-left com-widget-header ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-annuler" class="com-btn-edt-multiples ui-state-default ui-corner-all com-button com-center">Annuler</button><button type="button" class="ui-helper-hidden com-btn-edt-multiples ui-state-default ui-corner-all com-button com-center" id="btn-modifier">Modifier</button><button type="button" id="btn-valider" class="ui-state-default ui-corner-all com-button com-center">Valider</button></div></div>';this.achatCommandeSucces='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Achat</div><div class="com-widget-content"><p class="com-msg-confirm-icon"><span class="com-float-left ui-icon ui-icon-check"></span>Achat effectué avec succès.<br/><br/><button id="btn-annuler" class="ui-state-default ui-corner-all com-button com-center">Retourner à la liste des réservations</button></p></div></div></div>';this.cloturerCommandeSucces='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Cloture du Marché n°{numero}</div><div class="com-widget-content"><p class="com-msg-confirm-icon"><span class="com-float-left ui-icon ui-icon-check"></span>Cloture du Marché n°{numero} effectuée avec succès.</p></div></div></div>';this.dialogClotureCommande='<div id="dialog-cloturer-com" title="Cloture du Marché n°{comNumero}"><p>Vous allez cloturer le Marché n°{comNumero}</p></div>';this.dialogExportListeReservation='<div id="dialog-export-liste-reservation" title="Export des réservations du Marché n°{comNumero}"><form><table><tr><td>Format de sortie : </td><td><input type="radio" name="format" value="0" checked="checked" />Pdf</td><td><input type="radio" name="format" value="1" />CSV</td></tr><tr></tr><tr><td colspan="3">Sélectionner les produits : </td></tr><!-- BEGIN pdtCommande --><tr><td></td><td><input type="checkbox" value="{pdtCommande.proId}" name="id_produits"/></td><td>{pdtCommande.nproNom}</td></tr><!-- END pdtCommande --></table></form></div>';this.editerCommandePage='<div id="contenu"><div class="com-float-left" id="edt-com-info"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero}<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-cloture-com" title="Cloturer"><span class="ui-icon ui-icon-disk"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-modif-com" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-livraison-com" title="Bon de livraison"><span class="ui-icon ui-icon-cart"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-bon-com" title="Bon de commande"><span class="ui-icon ui-icon-document"></span></span></div><div>Fin des réservations : <br/>Le {dateFinReservation} à {heureFinReservation}H{minuteFinReservation} <br/>Marché : <br/>Le {dateMarcheDebut} de {heureMarcheDebut}H{minuteMarcheDebut} à {heureMarcheFin}H{minuteMarcheFin}</div></div><!-- BEGIN pdtCommande --><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">{pdtCommande.nproNom}</div><div><div class="edt-com-progressbar-pdt" id="pdt-{pdtCommande.proId}"><div class="edt-com-info-progressbar-pdt">{pdtCommande.quantiteCommande} {pdtCommande.unite} / {pdtCommande.quantiteInit} {pdtCommande.unite}</div></div></div></div><!-- END pdtCommande --></div><div class="com-float-left" id="edt-com-liste" ><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Liste des Réservation<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-resa" title="Exporter les réservations"><span class="ui-icon ui-icon-print"></span></span></div><div id="edt-com-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></form></div><table class="com-table" id="edt-com-liste-resa"><thead><tr class="ui-widget ui-widget-header com-cursor-pointer"><th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Numéro Adhérent</th><th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Numéro Compte</th><th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Nom</th>	<th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Prénom</th></tr></thead><tbody><!-- BEGIN listeAdherentCommande --><tr class="com-cursor-pointer edt-com-reservation-ligne" ><td class="com-table-td com-underline-hover"><span class="ui-helper-hidden id-adherent">{listeAdherentCommande.adhId}</span>{listeAdherentCommande.adhNumero}</td><td class="com-table-td com-underline-hover">{listeAdherentCommande.adhLabelCompte}</td><td class="com-table-td com-underline-hover">{listeAdherentCommande.adhNom}</td><td class="com-table-td com-underline-hover">{listeAdherentCommande.adhPrenom}</td></tr><!-- END listeAdherentCommande --></tbody></table></div></div></div></div>';this.supprimerReservationDialog='<div id="dialog-supprimer-reservation" title="Supprimer la réservation"><p>Voulez-vous supprimer la réservation ?</p></div>';this.detailReservation='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-annuler"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero}</div><div>Fin des réservations : Le {dateFinReservation} à {heureFinReservation}H{minuteFinReservation} <br/>Marché : Le {dateMarcheDebut} de {heureMarcheDebut}H{minuteMarcheDebut} à {heureMarcheFin}H{minuteMarcheFin}</div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Adhérent</div><div class="com-widget-content"><div id="resa-info-commande">{adhNumero} :  {adhPrenom} {adhNom}<br/>N° de Compte : {adhCompte}</div><div><span>Solde Actuel : </span><span>{adhSolde} {sigleMonetaire}</span></div><div class="com-clear-float-left"></div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">La réservation</div><table><!-- BEGIN reservation --><tr ><td class="detail-resa-npro">{reservation.nproNom}</td><td class="com-text-align-right detail-resa-qte">{reservation.stoQuantite}</td><td class="detail-resa-unite">{reservation.proUniteMesure}</td><td class="com-text-align-right detail-resa-prix">{reservation.prix}</td><td>{sigleMonetaire}</td></tr><!-- END reservation --><tr><td class="com-text-align-right" colspan="3">Total : </td><td class="com-text-align-right">{total}</td><td>{sigleMonetaire}</td></tr></table></div><div class="boutons-edition com-widget-header ui-widget ui-widget-header ui-corner-all com-center"><button class="com-btn-edt-multiples ui-state-default ui-corner-all com-button com-center" id="btn-modifier">Modifier</button><button class="ui-state-default ui-corner-all com-button com-center" id="btn-supprimer">Supprimer</button></div></div>';this.modifierReservation='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero}</div><div>Fin des réservations : Le {dateFinReservation} à {heureFinReservation}H{minuteFinReservation} <br/>Marché : Le {dateMarcheDebut} de {heureMarcheDebut}H{minuteMarcheDebut} à {heureMarcheFin}H{minuteMarcheFin}</div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Adhérent</div><div class="com-widget-content"><div id="resa-info-commande">{adhNumero} :  {adhPrenom} {adhNom}<br/>N° de Compte : {adhCompte}</div><div><span>Solde Actuel : </span><span>{adhSolde} {sigleMonetaire}</span><br/><span>Nouveau Solde : </span><span id="nouveau-solde">{adhNouveauSolde}</span> <span id="nouveau-solde-sigle">{sigleMonetaire}</span></div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">La réservation</div><div><table><!-- BEGIN produit --><tr class="pdt"><td><input type="checkbox" {produit.checked}/></td><td><span class="ui-helper-hidden"><span class="pdt-id">{produit.proId}</span></span></td><td>{produit.nproNom}</td><td><select id="lot-{produit.proId}"><!-- BEGIN produit.lot --><option value="{produit.lot.dcomId}">par {produit.lot.dcomTaille} {produit.proUniteMesure}</option><!-- END produit.lot --></select></td><td>à <span id="prix-unitaire-{produit.proId}">{produit.prixUnitaire}</span> {sigleMonetaire}/{produit.proUniteMesure}</td><td class="ui-helper-hidden resa-pdt-{produit.proId}"><button class="btn-moins">-</button></td><td class="ui-helper-hidden resa-pdt-{produit.proId}"><span id="qte-pdt-{produit.proId}"></span> {produit.proUniteMesure}</td><td class="ui-helper-hidden resa-pdt-{produit.proId}"><button class="btn-plus">+</button></td><td class="ui-helper-hidden resa-pdt-{produit.proId} com-text-align-right"><span id="prix-pdt-{produit.proId}"></span> {sigleMonetaire}</td></tr><!-- END produit --><tr><td colspan="8" class="com-text-align-right">Total : </td><td class="com-text-align-right detail-resa-prix"><span id="total">{total}</span></td><td>{sigleMonetaire}</td></tr></table></div></div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all com-center"><button class="com-btn-edt-multiples ui-state-default ui-corner-all com-button com-center" id="btn-annuler">Annuler</button><button class="ui-state-default ui-corner-all com-button com-center" id="btn-valider">Valider</button></div></div>';this.listeCommandeVide='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-archive"><span class="com-float-left">Les Marchés cloturés</span><span class="com-float-left ui-icon ui-icon-arrowthick-1-e"></span></button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés en cours</div><p id="texte-liste-vide">Aucun Marché en cours.</p></div></div>';this.listeCommandeArchiveVide='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-encours"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Les Marchés en cours</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés en cloturés</div><p id="texte-liste-vide">Aucun Marché cloturé.</p></div></div>';this.listeMarcheVide='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Vente</div><p id="texte-liste-vide">Aucune réservation en cours.</p></div></div>';this.listeReservationVide='<p id="texte-liste-vide">Aucune reservation.</p>';this.dialogEnregistrement='<div title="Enregistrer les modifications"><p>Vous n\'avez pas enregistré vos modifications.</p></div>';this.dialogExportBonDeCommande='<div id="dialog-export-bon-commande" title="Export du Bon de Commande du Marché n°{comNumero}"><form><table><tr><td>Format de sortie : </td><td><input type="radio" name="format" value="0" checked="checked" />Pdf</td><td><input type="radio" name="format" value="1" />CSV</td></tr></table></form></div>';this.bonDeCommande='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-editer-com"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Bon de commande du Marché n°{comNumero}<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-bcom" title="Exporter le bon de commande"><span class="ui-icon ui-icon-print"></span></span></div><div><form><span>Producteur : <select id="select-prdt"><option value="0" >== Choisir un producteur ==</option><!-- BEGIN producteurs --><option value="{producteurs.prdtIdCompte}">{producteurs.prdtPrenom} {producteurs.prdtNom}</option><!-- END producteurs --></select></span></form></div><div id="liste-pdt"></div></div></div>';this.listeProduitVide='<div id="liste-pdt"></div>';this.listeProduitBonDeCommande='<div id="liste-pdt"><table class="com-table"><thead><tr><th>Produit</th><th>Réservation</th><th>Commande</th><th>Prix</th><th>État</th></tr></thead><tbody><!-- BEGIN produits --><tr><td>{produits.nproNom}</td><td>{produits.stoQuantite} {produits.proUniteMesure}</td><td><span class="pro-id ui-helper-hidden">{produits.proId}</span><input class="qte-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="qte-commande-{produits.proId}" maxlength="11" value="{produits.stoQuantiteCommande}" id="produits{produits.proId}quantite"/> {produits.proUniteMesure}</td><td><input class="prix-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="prix-commande-{produits.proId}" maxlength="11" value="{produits.dopeMontant}" id="produits{produits.proId}prix" /> {sigleMonetaire}</td><td><div id="etat-commande-{produits.proId}" class="{produits.classEtat} ui-corner-all"></div></td></tr><!-- END produits --></tbody></table><div class="com-center"><button class="ui-state-default ui-corner-all com-button" id="btn-enregistrer">Enregistrer</button></div></div>';this.dialogExportBonDeLivraison='<div id="dialog-export-livraison" title="Export du bon de livraison du Marché n°{comNumero}"><form><table><tr><td>Format de sortie : </td><td><input type="radio" name="format" value="0" checked="checked" />Pdf</td><td><input type="radio" name="format" value="1" />CSV</td></tr></table></form></div>';this.bonDeLivraison='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-editer-com"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Bon de Livraison du Marché n°{comNumero}<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-bcom" title="Exporter le bon de livraison"><span class="ui-icon ui-icon-print"></span></span></div><div><form><span>Producteur : <select id="select-prdt"><option value="0" >== Choisir un producteur ==</option><!-- BEGIN producteurs --><option value="{producteurs.prdtIdCompte}">{producteurs.prdtPrenom} {producteurs.prdtNom}</option><!-- END producteurs --></select></span></form></div><div id="liste-pdt"></div></div></div>';this.listeProduitLivraison='<div id="liste-pdt"><table class="com-table"><thead><tr><th>Produit</th><th>Réservation</th><th>Commande</th><th>Prix</th><th>Livraison</th><th>Prix</th><th>Solidaire</th><th>État</th></tr></thead><tbody><!-- BEGIN produits --><tr><td>{produits.nproNom}</td><td>{produits.stoQuantite} {produits.proUniteMesure}</td><td>{produits.stoQuantiteCommande} {produits.proUniteMesure}</td><td>{produits.opeMontantCommande} {sigleMonetaire}</td><td><span class="pro-id pro-id-etat ui-helper-hidden">{produits.proId}</span><input class="input-bon-livraison qte-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="qte-commande-{produits.proId}" maxlength="11" value="{produits.stoQuantiteLivraison}" id="produits{produits.proId}quantite"/> {produits.proUniteMesure}</td><td><input class="input-bon-livraison prix-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="prix-commande-{produits.proId}" maxlength="11" value="{produits.opeMontantLivraison}" id="produits{produits.proId}prix" /> {sigleMonetaire}</td><td><span class="pro-id-etat ui-helper-hidden">{produits.proId}</span><input class="qte-solidaire-commande input-bon-livraison com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="qte-solidaire-commande-{produits.proId}" maxlength="11" value="{produits.stoQuantiteSolidaire}" id="produits{produits.proId}quantiteSolidaire" /> {produits.proUniteMesure}</td><td><div id="etat-commande-{produits.proId}" class="{produits.classEtat} ui-corner-all"></div></td></tr><!-- END produits --></tbody><tfoot><tr><td colspan="2"></td><td>Total :</td><td>{totalCommande} {sigleMonetaire}</td><td></td><td><input class="input-bon-livraison com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="total" maxlength="11" value="{total}" id="total" /> {sigleMonetaire}</td><td><select name="typepaiement" id="typePaiement"><option value="0">== Choisir le paiement ==</option><!-- BEGIN typePaiement --><option value="{typePaiement.tppId}">{typePaiement.tppType}</option><!-- END typePaiement --></select></td></tr><tr id="tr-champ-complementaire"><td colspan="5"></td><td><span id="label-champ-complementaire" ></span></td><td><input type="text" name="champ-complementaire" value="{champComplementaire}" class="com-input-text ui-widget-content ui-corner-all" id="typePaiementChampComplementaire" maxlength="50" size="15"/></td></tr></tfoot></table><div class="com-center"><button class="ui-state-default ui-corner-all com-button" id="btn-enregistrer">Enregistrer</button></div></div>';this.infoCommandeArchive='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Détail du Marché n°{numero}</div><div><div class="com-center" id="resultat-marche-archive"><span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Marché : {total} {sigleMonetaire}</span>    <span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Solidaire : {totalSolidaire} {sigleMonetaire}</span></div><table class="com-table" id="info-marche-archive"><thead><tr><th></th><th class="com-table-th ui-widget ui-widget-header" colspan="5">Achat</th><th class="com-table-th ui-widget ui-widget-header" colspan="4">Vente</th></tr><tr class="ui-widget ui-widget-header"><th class="com-table-th">Produit</th><th class="com-table-th">Qté Commande</th><th class="com-table-th">Prix Commande</th><th class="com-table-th">Qté Livraison</th><th class="com-table-th">Prix Livraison</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Qté Vente</th><th class="com-table-th">Prix Vente</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Prix Solidaire</th></tr></thead><tbody><!-- BEGIN infoCommande --><tr><td class="com-table-td">{infoCommande.nproNom}</td><td class="com-table-td">{infoCommande.stoQuantite} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontant} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteLivraison} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantLivraison} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.stoQuantiteVente} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVente} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteVenteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVenteSolidaire} {sigleMonetaire}</td></tr><!-- END infoCommande --></tbody></table></div></div></div>'}function GestionListeCommandeVue(a){this.mCommunVue=new CommunVue();this.construct=function(b){var c=this;$.post("./index.php?m=GestionCommande&v=ListeCommande",function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(d){var c=this;var b=new GestionCommandeTemplate();if(d.listeCommande.length>0&&d.listeCommande[0].comId!=null){var e=new Object;e.commande=new Array();$(d.listeCommande).each(function(){var g=new Object();g.id=this.comId;g.numero=this.comNumero;g.dateFinReservation=this.comDateFinReservation.extractDbDate().dateDbToFr();g.heureFinReservation=this.comDateFinReservation.extractDbHeure();g.minuteFinReservation=this.comDateFinReservation.extractDbMinute();g.dateMarcheDebut=this.comDateMarcheDebut.extractDbDate().dateDbToFr();g.heureMarcheDebut=this.comDateMarcheDebut.extractDbHeure();g.minuteMarcheDebut=this.comDateMarcheDebut.extractDbMinute();g.heureMarcheFin=this.comDateMarcheFin.extractDbHeure();g.minuteMarcheFin=this.comDateMarcheFin.extractDbMinute();e.commande.push(g)});var f=b.listeCommandePage;$("#contenu").replaceWith(c.affect($(f.template(e))))}else{$("#contenu").replaceWith(c.affect($(b.listeCommandeVide)))}};this.affect=function(b){b=this.affectLienEditer(b);b=this.affectLienMarche(b);b=this.mCommunVue.comHoverBtn(b);b=this.affectLienListeCommandeArchive(b);return b};this.affectLienEditer=function(b){b.find(".btn-editer").click(function(){var c={id_commande:$(this).attr("id")};EditerCommandeVue(c)});return b};this.affectLienMarche=function(b){b.find(".btn-marche").click(function(){var c={id_commande:$(this).attr("id")};MarcheCommandeVue(c)});return b};this.affectLienListeCommandeArchive=function(b){b.find("#lien-marche-archive").click(function(){ListeCommandeArchiveVue()});return b};this.construct(a)}function ModifierCommandeVue(a){this.etapeCreationCommande=0;this.mEditionEnCours=0;this.mListeProducteurs=null;this.mCommunVue=new CommunVue();this.commande=null;this.construct=function(b){var c=this;$.post("./index.php?m=GestionCommande&v=ModifierCommande","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}if(d.producteurs[0].prdtId==null){d.producteurs=[]}c.mListeProducteurs=d.producteurs;c.afficher(d)}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(d){var e=this;var f=d.commande[0];d.sigleMonetaire=gSigleMonetaire;d.comId=f.comId;d.comNom=f.comNom;d.comNumero=f.comNumero;d.comDescription=f.comDescription;d.dateTimeFinReservation=f.comDateFinReservation.extractDbDate().dateDbToFr();d.heureFinReservation=f.comDateFinReservation.extractDbHeure();d.minuteFinReservation=f.comDateFinReservation.extractDbMinute();d.dateMarcheDebut=f.comDateMarcheDebut.extractDbDate().dateDbToFr();d.heureMarcheDebut=f.comDateMarcheDebut.extractDbHeure();d.minuteMarcheDebut=f.comDateMarcheDebut.extractDbMinute();d.heureMarcheFin=f.comDateMarcheFin.extractDbHeure();d.minuteMarcheFin=f.comDateMarcheFin.extractDbMinute();if(d.produits[0].id==null){d.produits=[]}this.commande=d;var b=new GestionCommandeTemplate();var g=b.formulaireModifierCommande;var c=e.affect($(g.template(d)));d.pdtCommande=[];$(d.commande).each(function(){var h={dcomId:this.dcomId,dcomTaille:this.dcomTaille.nombreFormate(2,","," "),dcomPrix:this.dcomPrix.nombreFormate(2,","," ")};if(d.pdtCommande[this.proId]){d.pdtCommande[this.proId].lots[this.dcomId]=h}else{var i={proId:this.proId,proUniteMesure:this.proUniteMesure,proMaxProduitCommande:this.proMaxProduitCommande.nombreFormate(2,","," "),proIdNomProduit:this.proIdNomProduit,proIdProducteur:this.proIdProducteur,nproNom:this.nproNom,lots:[]};i.lots[this.dcomId]=h;$(d.stockInitiaux).each(function(){if(this.idProduit==i.proId){i.quantiteInit=this.quantite.nombreFormate(2,","," ")}});d.pdtCommande[this.proId]=i}});var b=new GestionCommandeTemplate();var g=b.ajoutProduitModifierCommande;$(d.pdtCommande).each(function(){if(this.proId!=undefined){this.sigleMonetaire=gSigleMonetaire;this.producteurs=e.mListeProducteurs;var i=this.proIdProducteur;var j="";$(e.mListeProducteurs).each(function(){if(this.prdtId==i){j=this.prdtPrenom+" "+this.prdtNom}});this.nomProducteur=j;var h=e.affectNouveauProduit($(g.template(this)));h.find(":input[name=producteur]").selectOptions(i);var k=this;$(this.lots).each(function(){if(this.dcomId!=undefined){var l={lots:[{id:this.dcomId,taille:this.dcomTaille,prix:this.dcomPrix,unite:k.proUniteMesure,idPdt:k.proId}],siglemonetaire:gSigleMonetaire};h.find(".produit-lots").append(e.affectAjoutLot($(b.ajoutLotModifPdt.template(l))))}});c.find("#liste_produit").append(e.afficherDeleteLot($(h)))}});$("#contenu").replaceWith(c)};this.affectSelectHeure=function(b){var c=this;b.find(":input[name=heure_fin_commande]").selectOptions(c.commande.heureFinReservation);b.find(":input[name=minute_fin_commande]").selectOptions(c.commande.minuteFinReservation);b.find(":input[name=heure_debut_marche]").selectOptions(c.commande.heureMarcheDebut);b.find(":input[name=minute_debut_marche]").selectOptions(c.commande.minuteMarcheDebut);b.find(":input[name=heure_fin_marche]").selectOptions(c.commande.heureMarcheFin);b.find(":input[name=minute_fin_marche]").selectOptions(c.commande.minuteMarcheFin);return b};this.affect=function(b){b=this.affectAjoutProduit(b);b=this.affectCreerCommande(b);b=this.affectModifierCommande(b);b=this.affectDialogCreerProduit(b);b=this.affectControleDatepicker(b);b=this.mCommunVue.comNumeric(b);b=this.affectSelectHeure(b);b=this.affectBtnRetourMarche(b);b=this.mCommunVue.comHoverBtn(b);return b};this.affectNouveauProduit=function(b){b=this.mCommunVue.comDelete(b);b=this.mCommunVue.comNumeric(b);b=this.editProduit(b);b=this.ajoutLotProduit(b);b=this.mCommunVue.comHoverBtn(b);return b};this.affectAjoutLot=function(b){b=this.editLot(b);b=this.deleteLot(b);b=this.mCommunVue.comNumeric(b);return b};this.affectAjoutProduit=function(b){var d="#formulaire-ajout-produit-creation-commande";var c=this;b.find(d).submit(function(){var i=true;$(".produit-nom-id").each(function(){if(parseInt($(this).text())==$(d+" :input[name=produit]").val()){i=false}});if(i){var h=new ProduitCommandeVO();h.idNom=$(d+" :input[name=produit]").val();h.nom=$(d+" :input[name=produit] option:selected").text();h.idProducteur=$(d+" :input[name=producteur]").val();h.unite=$(d+" :input[name=unite]").val();h.qteMaxCommande=$(d+" :input[name=qmax]").val().numberFrToDb();h.qteRestante=$(d+" :input[name=stock]").val().numberFrToDb();var l=new DetailCommandeVO();l.taille=$(d+" :input[name=taille]").val().numberFrToDb();l.prix=$(d+" :input[name=prix]").val().numberFrToDb();h.lots.push(l);var i=new ProduitCommandeValid();var k=i.validAjout(h);if(k.valid){Infobulle.init();var f=new GestionCommandeTemplate();var j=f.ajoutProduitModifierCommande;h.proIdNomProduit=h.idNom;h.nproNom=h.nom;h.proUniteMesure=h.unite;h.proMaxProduitCommande=h.qteMaxCommande.nombreFormate(2,","," ");h.quantiteInit=h.qteRestante.nombreFormate(2,","," ");h.proId=h.idNom*-1;h.lots=new Array();h.lots.push({id:0,idPdt:h.proId,unite:h.unite,taille:l.taille.nombreFormate(2,","," "),prix:l.prix.nombreFormate(2,","," ")});h.siglemonetaire=gSigleMonetaire;h.producteurs=c.mListeProducteurs;h.nomProducteur=$(d+" :input[name=producteur]").selectedOptions().text();var e=c.affectNouveauProduit($(j.template(h)));e.find(":input[name=producteur]").selectOptions(h.idProducteur);j=f.ajoutLotModifPdt;e.find(".produit-lots").append(c.affectAjoutLot($(j.template(h))));$("#liste_produit").append(e);$(d+" :input[name=unite]").val("");$(d+" :input[name=qmax]").val("");$(d+" :input[name=stock]").val("");$(d+" :input[name=taille]").val("");$(d+" :input[name=prix]").val("");$(d+" :input[name=produit]").selectedOptions().attr("selected","");$(d+" :input[name=produit]").selectOptions(0);$(d+" :input[name=producteur]").selectedOptions().attr("selected","");$(d+" :input[name=producteur]").selectOptions(0)}else{Infobulle.generer(k,"ajout-produit-")}}else{var k=new TemplateVR();k.valid=false;k.log.valid=false;var g=new VRerreur();g.code=ERR_211_CODE;g.message=ERR_211_MSG;k.log.erreurs.push(g);Infobulle.generer(k,"")}return false});return b};this.affectCreerCommande=function(b){var d="#btn-creer-commande";var c=this;b.find(d).click(function(){if(c.mEditionEnCours==0){var f=new CommandeCompleteVO();f.id=c.commande.comId;f.numero=c.commande.comNumero;f.nom=$("#formulaire-information-creation-commande").find(":input[name=nom_commande]").val();f.description=$("#formulaire-information-creation-commande").find(":input[name=description_commande]").val();f.dateMarcheDebut=$("#formulaire-information-creation-commande").find(":input[name=date_debut_marche]").val().dateFrToDb();f.timeMarcheDebut=$("#formulaire-information-creation-commande").find(":input[name=heure_debut_marche]").val()+":"+$("#formulaire-information-creation-commande").find(":input[name=minute_debut_marche]").val()+":00";f.dateMarcheFin=$("#formulaire-information-creation-commande").find(":input[name=date_debut_marche]").val().dateFrToDb();f.timeMarcheFin=$("#formulaire-information-creation-commande").find(":input[name=heure_fin_marche]").val()+":"+$("#formulaire-information-creation-commande").find(":input[name=minute_fin_marche]").val()+":00";f.dateFinReservation=$("#formulaire-information-creation-commande").find(":input[name=date_fin_commande]").val().dateFrToDb();f.timeFinReservation=$("#formulaire-information-creation-commande").find(":input[name=heure_fin_commande]").val()+":"+$("#formulaire-information-creation-commande").find(":input[name=minute_fin_commande]").val()+":00";f.archive="0";$(".produit-div").each(function(){var j=new ProduitCommandeVO();j.idProducteur=$(this).find(":input[name=producteur]").val();j.id=$(this).find(".produit-id").text();j.idNom=$(this).find(".produit-nom-id").text();j.unite=$(this).find(":input[name=unite]").val();j.qteMaxCommande=$(this).find(":input[name=qmax]").val().numberFrToDb();j.qteRestante=$(this).find(":input[name=stock]").val().numberFrToDb();$(this).find(".produit-lot").each(function(){var k=new DetailCommandeVO();k.id=$(this).find(".lot-id").text();k.taille=$(this).find(":input[name=taille]").val().numberFrToDb();k.prix=$(this).find(":input[name=prix]").val().numberFrToDb();j.lots.push(k)});f.produits.push(j)});if(c.etapeCreationCommande==0){var g=new CommandeCompleteValid();var i=g.validUpdate(f);if(i.valid){c.etapeCreationCommande=1;Infobulle.init();$("#window-ajout-produit-creation-commande").hide();$("#btn-modifier-creation-commande").show();$("#liste_produit .produit-div :button , .form-ajout-lot-creation-commande, .com-btn-header, .conteneur-btn-edt-lot").each(function(){$(this).hide()});$("#formulaire-information-creation-commande :input[type=text], #formulaire-information-creation-commande :input[type=textarea], #formulaire-information-creation-commande select").each(function(){$(this).inputToText()})}else{Infobulle.generer(i,"commande-")}}else{if(c.etapeCreationCommande==1){var h={form:2,commande:f};$.post("./index.php?m=GestionCommande&v=ModifierCommande","pParam="+$.toJSON(h),function(k){if(k.valid){k.numero=c.commande.comNumero;var j=new GestionCommandeTemplate();var l=j.modifCommandeSucces;$("#contenu").replaceWith(l.template(k))}else{c.modifierCommandeFunction();Infobulle.generer(k,"commande-")}c.etapeCreationCommande=0},"json")}}}else{var i=new Object();var e=new VRerreur();e.code=ERR_112_CODE;e.message=ERR_112_MSG;i.valid=false;i.log=new VRelement();i.log.valid=false;i.log.erreurs.push(e);Infobulle.generer(i,"")}});return b};this.affectModifierCommande=function(b){var c=this;b.find("#btn-modifier-creation-commande").click(function(){c.modifierCommandeFunction()});return b};this.modifierCommandeFunction=function(){this.etapeCreationCommande=0;var b=this;$("#window-ajout-produit-creation-commande, #liste_produit .produit-div :button, .form-ajout-lot-creation-commande, .com-btn-header, .conteneur-btn-edt-lot").show();$("#btn-modifier-creation-commande, .edit-nom-pdt-creation-commande-valid").hide();$(".produit-lots").each(function(){b.afficherDeleteLot($(this))});$("#formulaire-information-creation-commande :input[type=text], #formulaire-information-creation-commande :input[type=textarea], #formulaire-information-creation-commande select").textToInput()};this.ajoutLotProduit=function(b){var c=this;b.find(".btn-ajout-lot-creation-commande").click(function(){var j=$(this).parents(".form-ajout-lot-creation-commande").find(":input[name=taille]");var d=$(this).parents(".form-ajout-lot-creation-commande").find(":input[name=prix]");var i=new DetailCommandeVO();i.idProduit=$(this).parents(".produit-div").find(".produit-id").text();i.taille=j.val().numberFrToDb();i.prix=d.val().numberFrToDb();var k=new DetailCommandeValid();var h=k.validAjout(i);if(h.valid){Infobulle.init();i.prix=parseFloat(i.prix).nombreFormate(2,","," ");i.taille=parseFloat(i.taille).nombreFormate(2,","," ");i.siglemonetaire=gSigleMonetaire;i.unite=$(this).parentsUntil(".produit-div").find(":input[name=unite]").val();i.idNom=i.idProduit;var l=new Array();$(this).parentsUntil(".produit-div").find(".produit-lot").each(function(){l.push(parseInt($(this).find(".lot-id").text()))});var e=Array.min(l);if(e<0){i.id=e-1}else{i.id=-1}var f=new GestionCommandeTemplate();var g=f.ajoutLot;c.afficherDeleteLot($(this).parents(".produit-div").find(".produit-lots").append(c.affectAjoutLot($(g.template(i)))));j.val("");d.val("")}else{Infobulle.generer(h,"ajout-lot-produit-"+i.idProduit+"-")}});return b};this.editProduit=function(b){var c=this;b.find(".edit-nom-pdt-creation-commande-valid").click(function(){var d=new ProduitCommandeVO();var j=$(this).closest(".produit-div");d.idProducteur=$(j).find(":input[name=producteur]").val();d.idNom=$(j).find(".produit-nom-id").text();d.nom=$(j).find(".produit-nom").text();d.unite=$(j).find(":input[name=unite]").val();d.qteMaxCommande=$(j).find(":input[name=qmax]").val().numberFrToDb();d.qteRestante=$(j).find(":input[name=stock]").val().numberFrToDb();var f=new ProduitCommandeValid();var k=f.validAjout(d,"simple");if(k.valid){Infobulle.init();var e=$(j).find(":input[name=producteur]").selectedOptions().text();$(j).find("#nom-producteur").text(e);var i=parseFloat(d.qteRestante).nombreFormate(2,","," ");$(j).find(".produit-stock").text(i);$(j).find(":input[name=stock]").val(i);var h=parseFloat(d.qteMaxCommande).nombreFormate(2,","," ");$(j).find(".produit-qmax").text(h);$(j).find(":input[name=qmax]").val(h);$(j).find(".produit-unite").text(d.unite);var g=$(this).parentsUntil("#liste_produit");g.find(".produit-unite").text(d.unite);b.find(".edit-nom-pdt-creation-commande, .info-produit").toggle();c.mEditionEnCours--}else{Infobulle.generer(k,"produit-"+d.idNom+"-")}});b.find(".edit-nom-pdt-creation-commande-edit").click(function(){c.mEditionEnCours++;b.find(".edit-nom-pdt-creation-commande, .info-produit").toggle()});return b};this.editLot=function(b){var c=this;b.find(".edit-lot-creation-commande-valid").click(function(){var d=new DetailCommandeVO();var h=$(this).closest(".produit-lot");d.id=$(h).find(".lot-id").text();d.idProduit=$(this).parentsUntil(".produit-div").find(".produit-id").text();d.taille=$(h).find(":input[name=taille]").val().numberFrToDb();d.prix=$(h).find(":input[name=prix]").val().numberFrToDb();var e=new DetailCommandeValid();var i=e.validAjout(d);if(i.valid){Infobulle.init();var f=d.taille.nombreFormate(2,","," ");$(h).find(".produit-taille").text(f);$(h).find(":input[name=taille]").val(f);var g=d.prix.nombreFormate(2,","," ");$(h).find(".produit-prix").text(g);$(h).find(":input[name=prix]").val(g);b.find(".edit-lot-creation-commande, .pdt-"+d.idProduit+"-lot-"+d.id).toggle();c.mEditionEnCours--}else{Infobulle.generer(i,"produit-"+d.idProduit+"-lot-"+d.id+"-")}});b.find(".edit-lot-creation-commande-edit").click(function(){var d=$(this).closest(".produit-div").find(".produit-id").text();var e=$(this).closest(".produit-lot").find(".lot-id").text();b.find(".edit-lot-creation-commande, .pdt-"+d+"-lot-"+e).toggle();c.mEditionEnCours++});return b};this.deleteLot=function(b){var c=this;b.find(".delete-lot").click(function(){var d=$(this).parents(".produit-lots");$(this).parent().parent().remove();c.afficherDeleteLot(d)});return b};this.afficherDeleteLot=function(b){if(b.find(".produit-lot").size()<2){b.find(".delete-lot").hide()}else{b.find(".delete-lot").show()}return b};this.affectDialogCreerProduit=function(b){var c=this;b.find("#btn-creer-nv-pdt").click(function(){var d=new GestionCommandeTemplate();var e=d.dialogAjoutProduit;$(e).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{"Créer le produit":function(){var f=$(this).children("form").first();c.CreerProduit(f)},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}}).submit(function(){c.CreerProduit($(this));return false})});return b};this.CreerProduit=function(c){var b=new NomProduitVO();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();b.idCategorie=1;var d=new NomProduitValid();var f=d.validAjout(b);if(f.valid){Infobulle.init();var e={form:1,nomProduit:b};$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(e),function(h){if(h.valid){Infobulle.init();var g=[];g[h.id]=h.nom;$("#formulaire-ajout-produit-creation-commande select[name=produit]").addOption(g).sortOptions();$("#dialog-form-creer-nv-pdt").dialog("close")}else{Infobulle.generer(h,"nom-pdt-")}},"json")}else{Infobulle.generer(f,"nom-pdt-")}};this.affectControleDatepicker=function(b){b=this.mCommunVue.comLienDatepicker("commande-dateFinReservation","commande-dateMarcheDebut",b);return b};this.affectBtnRetourMarche=function(b){var c=this;b.find("#btn-editer-com").click(function(){EditerCommandeVue({id_commande:c.mIdCommande})});return b};this.construct(a)}function AjoutCommandeVue(a){this.etapeCreationCommande=0;this.mEditionEnCours=0;this.mListeProducteurs=null;this.mCommunVue=new CommunVue();this.construct=function(b){var c=this;$.post("./index.php?m=GestionCommande&v=AjoutCommande",function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}if(d.producteurs[0].prdtId==null){d.producteurs=[]}c.mListeProducteurs=d.producteurs;c.afficher(d)}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(c){var d=this;if(c.produits[0].id==null){c.produits=[]}var b=new GestionCommandeTemplate();var e=b.formulaireAjoutCommande;$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affect=function(b){b=this.affectAjoutProduit(b);b=this.affectCreerCommande(b);b=this.affectModifierCommande(b);b=this.affectDialogCreerProduit(b);b=this.affectControleDatepicker(b);b=this.mCommunVue.comNumeric(b);b=this.mCommunVue.comHoverBtn(b);return b};this.affectNouveauProduit=function(b){b=this.mCommunVue.comDelete(b);b=this.mCommunVue.comNumeric(b);b=this.editProduit(b);b=this.ajoutLotProduit(b);b=this.mCommunVue.comHoverBtn(b);return b};this.affectAjoutLot=function(b){b=this.editLot(b);b=this.deleteLot(b);b=this.mCommunVue.comNumeric(b);return b};this.affectAjoutProduit=function(b){var d="#formulaire-ajout-produit-creation-commande";var c=this;b.find(d).submit(function(){var i=true;$(".produit-id").each(function(){if(parseInt($(this).text())==$(d+" :input[name=produit]").val()){i=false}});if(i){var h=new ProduitCommandeVO();h.idNom=$(d+" :input[name=produit]").val();h.nom=$(d+" :input[name=produit] option:selected").text();h.idProducteur=$(d+" :input[name=producteur]").val();h.unite=$(d+" :input[name=unite]").val();h.qteMaxCommande=$(d+" :input[name=qmax]").val().numberFrToDb();h.qteRestante=$(d+" :input[name=stock]").val().numberFrToDb();if(isNaN(parseFloat(h.qteMaxCommande))||(parseFloat(h.qteMaxCommande)>parseFloat(h.qteRestante))){h.qteMaxCommande=h.qteRestante}var l=new DetailCommandeVO();l.taille=$(d+" :input[name=taille]").val().numberFrToDb();l.prix=$(d+" :input[name=prix]").val().numberFrToDb();h.lots.push(l);var i=new ProduitCommandeValid();var k=i.validAjout(h);if(k.valid){Infobulle.init();var f=new GestionCommandeTemplate();var j=f.ajoutProduitAjoutCommande;h.qteMaxCommande=h.qteMaxCommande.nombreFormate(2,","," ");h.qteRestante=h.qteRestante.nombreFormate(2,","," ");h.lots[0].prix=parseFloat(h.lots[0].prix).nombreFormate(2,","," ");h.lots[0].taille=parseFloat(h.lots[0].taille).nombreFormate(2,","," ");h.lots[0].id=0;h.siglemonetaire=gSigleMonetaire;h.producteurs=c.mListeProducteurs;h.nomProducteur=$(d+" :input[name=producteur]").selectedOptions().text();var e=c.affectNouveauProduit($(j.template(h)));e.find(":input[name=producteur]").selectOptions(h.idProducteur);j=f.ajoutLotAjoutPdt;e.find(".produit-lots").append(c.affectAjoutLot($(j.template(h))));$("#liste_produit").append(e);$(d+" :input[name=unite]").val("");$(d+" :input[name=qmax]").val("");$(d+" :input[name=stock]").val("");$(d+" :input[name=taille]").val("");$(d+" :input[name=prix]").val("");$(d+" :input[name=produit]").selectedOptions().attr("selected","");$(d+" :input[name=produit]").selectOptions(0);$(d+" :input[name=producteur]").selectedOptions().attr("selected","");$(d+" :input[name=producteur]").selectOptions(0)}else{Infobulle.generer(k,"ajout-produit-")}}else{var k=new TemplateVR();k.valid=false;k.log.valid=false;var g=new VRerreur();g.code=ERR_211_CODE;g.message=ERR_211_MSG;k.log.erreurs.push(g);Infobulle.generer(k,"")}return false});return b};this.affectCreerCommande=function(b){var d="#btn-creer-commande";var c=this;b.find(d).click(function(){if(c.mEditionEnCours==0){var f=new CommandeCompleteVO();f.nom=$("#formulaire-information-creation-commande").find(":input[name=nom_commande]").val();f.description=$("#formulaire-information-creation-commande").find(":input[name=description_commande]").val();f.dateMarcheDebut=$("#formulaire-information-creation-commande").find(":input[name=date_debut_marche]").val().dateFrToDb();f.timeMarcheDebut=$("#formulaire-information-creation-commande").find(":input[name=heure_debut_marche]").val()+":"+$("#formulaire-information-creation-commande").find(":input[name=minute_debut_marche]").val()+":00";f.dateMarcheFin=$("#formulaire-information-creation-commande").find(":input[name=date_debut_marche]").val().dateFrToDb();f.timeMarcheFin=$("#formulaire-information-creation-commande").find(":input[name=heure_fin_marche]").val()+":"+$("#formulaire-information-creation-commande").find(":input[name=minute_fin_marche]").val()+":00";f.dateFinReservation=$("#formulaire-information-creation-commande").find(":input[name=date_fin_commande]").val().dateFrToDb();f.timeFinReservation=$("#formulaire-information-creation-commande").find(":input[name=heure_fin_commande]").val()+":"+$("#formulaire-information-creation-commande").find(":input[name=minute_fin_commande]").val()+":00";f.archive="0";$(".produit-div").each(function(){var i=new ProduitCommandeVO();i.idProducteur=$(this).find(":input[name=producteur]").val();i.idNom=$(this).find(".produit-id").text();i.unite=$(this).find(":input[name=unite]").val();i.qteMaxCommande=$(this).find(":input[name=qmax]").val().numberFrToDb();i.qteRestante=$(this).find(":input[name=stock]").val().numberFrToDb();$(this).find(".produit-lot").each(function(){var j=new DetailCommandeVO();j.taille=$(this).find(":input[name=taille]").val().numberFrToDb();j.prix=$(this).find(":input[name=prix]").val().numberFrToDb();i.lots.push(j)});f.produits.push(i)});if(c.etapeCreationCommande==0){var g=new CommandeCompleteValid();var h=g.validAjout(f);if(h.valid){c.etapeCreationCommande=1;Infobulle.init();$("#window-ajout-produit-creation-commande").hide();$("#btn-modifier-creation-commande").show();$("#liste_produit .produit-div :button , .form-ajout-lot-creation-commande, .com-btn-header, .conteneur-btn-edt-lot").each(function(){$(this).hide()});$("#formulaire-information-creation-commande :input[type=text], #formulaire-information-creation-commande :input[type=textarea], #formulaire-information-creation-commande select").each(function(){$(this).inputToText()})}else{Infobulle.generer(h,"commande-")}}else{if(c.etapeCreationCommande==1){$.post("./index.php?m=GestionCommande&v=AjoutCommande","commande="+$.toJSON(f)+"&form=2",function(j){if(j.valid){var i=new GestionCommandeTemplate();var k=i.ajoutCommandeSucces;$("#contenu").replaceWith(k.template(j))}else{c.modifierCommandeFunction();Infobulle.generer(j,"commande-")}c.etapeCreationCommande=0},"json")}}}else{var h=new Object();var e=new VRerreur();e.code=ERR_112_CODE;e.message=ERR_112_MSG;h.valid=false;h.log=new VRelement();h.log.valid=false;h.log.erreurs.push(e);Infobulle.generer(h,"")}});return b};this.affectModifierCommande=function(b){var c=this;b.find("#btn-modifier-creation-commande").click(function(){c.modifierCommandeFunction()});return b};this.modifierCommandeFunction=function(){this.etapeCreationCommande=0;var b=this;$("#window-ajout-produit-creation-commande, #liste_produit .produit-div :button, .form-ajout-lot-creation-commande, .com-btn-header, .conteneur-btn-edt-lot").show();$("#btn-modifier-creation-commande, .edit-nom-pdt-creation-commande-valid").hide();$(".produit-lots").each(function(){b.afficherDeleteLot($(this))});$("#formulaire-information-creation-commande :input[type=text], #formulaire-information-creation-commande :input[type=textarea], #formulaire-information-creation-commande select").textToInput()};this.ajoutLotProduit=function(b){var c=this;b.find(".btn-ajout-lot-creation-commande").click(function(){var g=$(this).parents(".form-ajout-lot-creation-commande").find(":input[name=taille]");var d=$(this).parents(".form-ajout-lot-creation-commande").find(":input[name=prix]");var f=new DetailCommandeVO();f.idProduit=$(this).parents(".produit-div").find(".produit-id").text();f.taille=g.val().numberFrToDb();f.prix=d.val().numberFrToDb();var h=new DetailCommandeValid();var k=h.validAjout(f);if(k.valid){Infobulle.init();f.prix=parseFloat(f.prix).nombreFormate(2,","," ");f.taille=parseFloat(f.taille).nombreFormate(2,","," ");f.siglemonetaire=gSigleMonetaire;f.unite=$(this).parentsUntil(".produit-div").find(":input[name=unite]").val();f.idNom=f.idProduit;var j=new Array();$(this).parentsUntil(".produit-div").find(".produit-lot").each(function(){j.push(parseInt($(this).find(".lot-id").text()))});f.id=Array.max(j)+1;var e=new GestionCommandeTemplate();var i=e.ajoutLot;c.afficherDeleteLot($(this).parents(".produit-div").find(".produit-lots").append(c.affectAjoutLot($(i.template(f)))));g.val("");d.val("")}else{Infobulle.generer(k,"ajout-lot-produit-"+f.idProduit+"-")}});return b};this.editProduit=function(b){var c=this;b.find(".edit-nom-pdt-creation-commande-valid").click(function(){var d=new ProduitCommandeVO();var j=$(this).closest(".produit-div");d.idProducteur=$(j).find(":input[name=producteur]").val();d.idNom=$(j).find(".produit-id").text();d.nom=$(j).find(".produit-nom").text();d.unite=$(j).find(":input[name=unite]").val();d.qteMaxCommande=$(j).find(":input[name=qmax]").val().numberFrToDb();d.qteRestante=$(j).find(":input[name=stock]").val().numberFrToDb();var f=new ProduitCommandeValid();var k=f.validAjout(d,"simple");if(k.valid){Infobulle.init();var e=$(j).find(":input[name=producteur]").selectedOptions().text();$(j).find("#nom-producteur").text(e);var i=parseFloat(d.qteRestante).nombreFormate(2,","," ");$(j).find(".produit-stock").text(i);$(j).find(":input[name=stock]").val(i);var h=parseFloat(d.qteMaxCommande).nombreFormate(2,","," ");$(j).find(".produit-qmax").text(h);$(j).find(":input[name=qmax]").val(h);$(j).find(".produit-unite").text(d.unite);var g=$(this).parentsUntil("#liste_produit");g.find(".produit-unite").text(d.unite);b.find(".edit-nom-pdt-creation-commande, .info-produit").toggle();c.mEditionEnCours--}else{Infobulle.generer(k,"produit-"+d.idNom+"-")}});b.find(".edit-nom-pdt-creation-commande-edit").click(function(){c.mEditionEnCours++;b.find(".edit-nom-pdt-creation-commande, .info-produit").toggle()});return b};this.editLot=function(b){var c=this;b.find(".edit-lot-creation-commande-valid").click(function(){var d=new DetailCommandeVO();var h=$(this).closest(".produit-lot");d.id=$(h).find(".lot-id").text();d.idProduit=$(this).parentsUntil(".produit-div").find(".produit-id").text();d.taille=$(h).find(":input[name=taille]").val().numberFrToDb();d.prix=$(h).find(":input[name=prix]").val().numberFrToDb();var e=new DetailCommandeValid();var i=e.validAjout(d);if(i.valid){Infobulle.init();var f=d.taille.nombreFormate(2,","," ");$(h).find(".produit-taille").text(f);$(h).find(":input[name=taille]").val(f);var g=d.prix.nombreFormate(2,","," ");$(h).find(".produit-prix").text(g);$(h).find(":input[name=prix]").val(g);b.find(".edit-lot-creation-commande, .pdt-"+d.idProduit+"-lot-"+d.id).toggle();c.mEditionEnCours--}else{Infobulle.generer(i,"produit-"+d.idProduit+"-lot-"+d.id+"-")}});b.find(".edit-lot-creation-commande-edit").click(function(){var d=$(this).closest(".produit-div").find(".produit-id").text();var e=$(this).closest(".produit-lot").find(".lot-id").text();b.find(".edit-lot-creation-commande, .pdt-"+d+"-lot-"+e).toggle();c.mEditionEnCours++});return b};this.deleteLot=function(b){var c=this;b.find(".delete-lot").click(function(){var d=$(this).parents(".produit-lots");$(this).parent().parent().remove();c.afficherDeleteLot(d)});return b};this.afficherDeleteLot=function(b){if(b.children(".produit-lot").size()<2){b.find(".delete-lot").hide()}else{b.find(".delete-lot").show()}return b};this.affectDialogCreerProduit=function(b){var c=this;b.find("#btn-creer-nv-pdt").click(function(){var d=new GestionCommandeTemplate();var e=d.dialogAjoutProduit;$(e).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{"Créer le produit":function(){var f=$(this).children("form").first();c.CreerProduit(f)},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}}).submit(function(){c.CreerProduit($(this));return false})});return b};this.CreerProduit=function(c){var b=new NomProduitVO();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();b.idCategorie=1;var d=new NomProduitValid();var f=d.validAjout(b);if(f.valid){Infobulle.init();var e={form:1,nomProduit:b};$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(e),function(h){if(h.valid){Infobulle.init();var g=[];g[h.id]=h.nom;$("#formulaire-ajout-produit-creation-commande select[name=produit]").addOption(g).sortOptions();$("#dialog-form-creer-nv-pdt").dialog("close")}else{Infobulle.generer(h,"nom-pdt-")}},"json")}else{Infobulle.generer(f,"nom-pdt-")}};this.affectControleDatepicker=function(b){b=this.mCommunVue.comLienDatepicker("commande-dateFinReservation","commande-dateMarcheDebut",b);return b};this.construct(a)}function AchatCommandeVue(a){this.idCommande=null;this.idAdherent=null;this.idCompte=null;this.mTypePaiement=[];this.solde=null;this.mCommunVue=new CommunVue();this.etapeValider=0;this.total=0;this.totalSolidaire=0;this.pdtCommande=[];this.construct=function(b){var c=this;this.idCommande=b.id_commande;this.idAdherent=b.id_adherent;b.fonction="infoAchat";$.post("./index.php?m=GestionCommande&v=MarcheCommande","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.idCompte=d.adherent.adhIdCompte;c.pdtCommande=d.marche.produits;$(d.typePaiement).each(function(){c.mTypePaiement[this.tppId]=this});c.solde=parseFloat(d.adherent.cptSolde);c.afficher(d)}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(d){Infobulle.init();if(d.valid){var e=this;var b=new GestionCommandeTemplate();var f=b.achatCommandePage;var c=new Object();c.comNumero=d.marche.numero;c.adhNumero=d.adherent.adhNumero;c.adhCompte=d.adherent.cptLabel;c.adhNom=d.adherent.adhNom;c.adhPrenom=d.adherent.adhPrenom;c.sigleMonetaire=gSigleMonetaire;c.total=0;c.produits=new Array();c.produitsSolidaire=new Array();$.each(e.pdtCommande,function(){if(this.id){var g=this;var i={};i.proId=this.id;i.nproNom=this.nom;i.proUniteMesure=this.unite;i.stoQuantite=0;i.proPrix=0;var h=0;$.each(this.lots,function(){if(this.id){var j=this.id;$(d.reservation).each(function(){if(this.idDetailCommande==j){i.stoQuantite=this.quantite*-1;h=this.montant*-1;i.proPrix=h.nombreFormate(2,","," ")}})}});c.total+=h;c.produits.push(i);$(d.stockSolidaire).each(function(){if(i.proId==this.proId){c.produitsSolidaire.push(i)}})}});c.adhSolde=this.solde;c.adhSolde=c.adhSolde.nombreFormate(2,","," ");c.total=c.total.nombreFormate(2,","," ");e.total=c.total;c.typePaiement=e.mTypePaiement;$("#contenu").replaceWith(e.affect($(f.template(c))));e.changerTypePaiement($(":input[name=typepaiement]"));e.majNouveauSolde()}else{Infobulle.generer(d,"")}};this.affect=function(b){b=this.affectSelectTypePaiement(b);b=this.affectNouveauSolde(b);b=this.mCommunVue.comNumeric(b);b=this.affectNouveauPrixProduit(b);b=this.affectChampComplementaire(b);b=this.affectValider(b);b=this.affectAnnuler(b);b=this.affectModifier(b);b=this.affectSupprimerPdt(b);b=this.mCommunVue.comHoverBtn(b);return b};this.affectSelectTypePaiement=function(b){var c=this;b.find(":input[name=typepaiement]").change(function(){c.changerTypePaiement($(this));c.controlerAchat()});return b};this.affectNouveauSolde=function(b){var c=this;b.find(":input[name=montant-rechargement], .produit-prix").keyup(function(){c.majNouveauSolde();c.controlerAchat()});b.find(".produit-solidaire-prix").keyup(function(){c.majNouveauSoldeSolidaire();c.controlerAchat()});return b};this.affectNouveauPrixProduit=function(b){var c=this;b.find(".produit-quantite").keyup(function(){c.majPrixProduit($(this));c.controlerAchat()});b.find(".produit-solidaire-quantite").keyup(function(){c.controlerAchat()});return b};this.affectChampComplementaire=function(b){var c=this;b.find(":input[name=champ-complementaire]").keyup(function(){c.controlerAchat()});return b};this.affectValider=function(b){var c=this;b.find("#btn-valider").click(function(){c.creerRecapitulatif()});return b};this.affectAnnuler=function(b){var c=this;b.find("#btn-annuler").click(function(){c.retourListe()});return b};this.affectModifier=function(b){var c=this;b.find("#btn-modifier").click(function(){c.boutonModifier()});return b};this.affectSupprimerPdt=function(b){if(b.find(".ligne-produit").size()==0){b.find("#achat-pdt-widget").remove()}if(b.find(".ligne-produit-solidaire").size()==0){b.find("#achat-pdt-solidaire-widget").remove()}return b};this.majPrixProduit=function(b){var f=parseFloat(b.val().numberFrToDb());if(isNaN(f)){f=0}var c=b.parent().parent();var d=c.find(".produit-id").text();var e=0;if(this.pdtCommande[d].prixUnitaire!=null){e=this.pdtCommande[d].prixUnitaire*f}if(isNaN(e)){e=0}if(e!=0){c.find(".produit-prix").val(e.nombreFormate(2,","," "))}this.majNouveauSolde()};this.controlerAchat=function(){Infobulle.init();var b=new AchatCommandeValid();var c=b.validAjout(this.getAchatCommandeVO());Infobulle.generer(c,"");return c};this.majTotal=function(){var b=this.calculerTotal();$("#total-achat").text(b.nombreFormate(2,","," "));this.total=b;this.majTotalGlobal()};this.majTotalSolidaire=function(){var b=this.calculerTotalSolidaire();$("#total-achat-solidaire").text(b.nombreFormate(2,","," "));this.totalSolidaire=b;this.majTotalGlobal()};this.majTotalGlobal=function(){var b=this.totalSolidaire+this.total;$("#total-global").text(b.nombreFormate(2,","," "))};this.calculerTotal=function(){var b=0;$(".produit-prix").each(function(){var c=parseFloat($(this).val().numberFrToDb());if(isNaN(c)){c=0}b+=c});return b};this.calculerTotalSolidaire=function(){var b=0;$(".produit-solidaire-prix").each(function(){var c=parseFloat($(this).val().numberFrToDb());if(isNaN(c)){c=0}b+=c});return b};this.majNouveauSolde=function(){this.majTotal();var b=this.calculNouveauSolde();if(b<=0){$("#nouveau-solde").addClass("com-nombre-negatif");$("#nouveau-solde-sigle").addClass("com-nombre-negatif")}else{$("#nouveau-solde").removeClass("com-nombre-negatif");$("#nouveau-solde-sigle").removeClass("com-nombre-negatif")}$("#nouveau-solde").text(b.nombreFormate(2,","," "))};this.majNouveauSoldeSolidaire=function(){this.majTotalSolidaire();var b=this.calculNouveauSolde();if(b<=0){$("#nouveau-solde").addClass("com-nombre-negatif");$("#nouveau-solde-sigle").addClass("com-nombre-negatif")}else{$("#nouveau-solde").removeClass("com-nombre-negatif");$("#nouveau-solde-sigle").removeClass("com-nombre-negatif")}$("#nouveau-solde").text(b.nombreFormate(2,","," "))};this.calculNouveauSolde=function(){var d=this.total;if(isNaN(d)){d=0}var c=this.totalSolidaire;if(isNaN(c)){c=0}var b=parseFloat($(":input[name=montant-rechargement]").val().numberFrToDb());if(isNaN(b)){b=0}return this.solde-d-c+b};this.changerTypePaiement=function(d){var c=d.val();var b=this.getLabelChamComplementaire(c);if(b!=null){$("#label-champ-complementaire").text(b).show();$("#td-champ-complementaire").show()}else{$("#label-champ-complementaire").text("").hide();$(":input[name=champ-complementaire]").val("");$("#td-champ-complementaire").hide()}};this.getLabelChamComplementaire=function(c){var b=this.mTypePaiement;if(b[c]){if(b[c].tppChampComplementaire==1){return b[c].tppLabelChampComplementaire}}return null};this.getAchatCommandeVO=function(){var b=new AchatCommandeVO();b.id=this.idCommande;b.idCompte=this.idCompte;b.produits=this.getProduitsVO();b.produitsSolidaire=this.getProduitsSolidaireVO();b.rechargement=this.getRechargementVO();return b};this.getProduitsVO=function(){var b=new Array();$(".ligne-produit").each(function(){var d=new ProduitAchatVO();d.id=$(this).find(".produit-id").text();var e=$(this).find(".produit-quantite").val().numberFrToDb();if(!isNaN(e)&&!e.isEmpty()&&e!=0){e=parseFloat(e);d.quantite=e*-1;var c=$(this).find(".produit-prix").val().numberFrToDb();if(!isNaN(c)&&!c.isEmpty()&&c!=0){c=parseFloat(c);d.prix=c*-1;b.push(d)}}});return b};this.getProduitsSolidaireVO=function(){var b=new Array();$(".ligne-produit-solidaire").each(function(){var d=new ProduitAchatVO();d.id=$(this).find(".produit-id").text();var e=$(this).find(".produit-solidaire-quantite").val().numberFrToDb();if(!isNaN(e)&&!e.isEmpty()&&e!=0){e=parseFloat(e);d.quantite=e*-1;var c=$(this).find(".produit-solidaire-prix").val().numberFrToDb();if(!isNaN(c)&&!c.isEmpty()&&c!=0){c=parseFloat(c);d.prix=c*-1;b.push(d)}}});return b};this.getRechargementVO=function(){var b=new RechargementCompteVO();var c=$(":input[name=montant-rechargement]").val().numberFrToDb();if(!isNaN(c)&&!c.isEmpty()&&c!=0){b.id=this.idCompte;c=parseFloat(c);b.montant=c;b.typePaiement=$(":input[name=typepaiement]").val();if(this.getLabelChamComplementaire(b.typePaiement)!=null){b.champComplementaireObligatoire=1;b.champComplementaire=$(":input[name=champ-complementaire]").val()}else{b.champComplementaireObligatoire=0}}return b};this.creerRecapitulatif=function(){var b=this.controlerAchat();if(b.valid){if(this.etapeValider==0){$(".produit-quantite,.produit-solidaire-quantite,#rechargementchampComplementaire,#rechargementtypePaiement").each(function(){$(this).inputToText()});$(".produit-prix,.produit-solidaire-prix,#rechargementmontant").each(function(){$(this).inputToText("montant")});$("#btn-modifier").show();$("#btn-annuler").hide();this.etapeValider=1}else{if(this.etapeValider==1){this.enregistrerAchat()}}}};this.enregistrerAchat=function(){var c=this;var b=this.getAchatCommandeVO();b.fonction="acheter";$.post("./index.php?m=GestionCommande&v=MarcheCommande","pParam="+$.toJSON(b),function(e){if(e.valid){var d=new GestionCommandeTemplate();var f=d.achatCommandeSucces;$("#contenu").replaceWith(c.affectAnnuler($(f)))}else{c.boutonModifier();Infobulle.generer(e,"")}c.etapeValider=0},"json")};this.boutonModifier=function(){if(this.etapeValider==1){$(".produit-prix,.produit-solidaire-prix,#rechargementmontant,.produit-quantite,.produit-solidaire-quantite,#rechargementchampComplementaire,#rechargementtypePaiement").each(function(){$(this).textToInput()});$("#btn-modifier").hide();$("#btn-annuler").show();this.etapeValider=0}};this.retourListe=function(){MarcheCommandeVue({id_commande:this.idCommande})};this.construct(a)}function ListeCommandeArchiveVue(a){this.mCommunVue=new CommunVue();this.construct=function(b){var c=this;var d={archive:1};$.post("./index.php?m=GestionCommande&v=ListeCommande","pParam="+$.toJSON(d),function(e){Infobulle.init();if(e.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(e)}else{Infobulle.generer(e,"")}},"json")};this.afficher=function(e){var d=this;var c=new GestionCommandeTemplate();if(e.listeCommande.length>0&&e.listeCommande[0].comId!=null){var f=new Object;f.commande=new Array();$(e.listeCommande).each(function(){var h=new Object();h.id=this.comId;h.numero=this.comNumero;h.dateFinReservation=this.comDateFinReservation.extractDbDate().dateDbToFr();h.heureFinReservation=this.comDateFinReservation.extractDbHeure();h.minuteFinReservation=this.comDateFinReservation.extractDbMinute();h.dateMarcheDebut=this.comDateMarcheDebut.extractDbDate().dateDbToFr();h.heureMarcheDebut=this.comDateMarcheDebut.extractDbHeure();h.minuteMarcheDebut=this.comDateMarcheDebut.extractDbMinute();h.heureMarcheFin=this.comDateMarcheFin.extractDbHeure();h.minuteMarcheFin=this.comDateMarcheFin.extractDbMinute();h.dateTimeFinResa=this.comDateFinReservation.replace("-","").replace(" ","").replace(":","");h.dateTimeMarche=this.comDateMarcheDebut.replace("-","").replace(" ","").replace(":","");f.commande.push(h)});var g=c.listeCommandeArchivePage;var b=$(g.template(f));if(e.listeCommande.length<31){b=this.masquerPagination(b)}else{b=this.paginnation(b)}$("#contenu").replaceWith(d.affect(b))}else{$("#contenu").replaceWith(d.affect($(c.listeCommandeArchiveVide)))}};this.affect=function(b){b=this.affectLienListeCommandeArchive(b);b=this.affectLienDetail(b);b=this.mCommunVue.comHoverBtn(b);return b};this.affectLienListeCommandeArchive=function(b){b.find("#lien-marche-encours").click(function(){GestionListeCommandeVue()});return b};this.paginnation=function(b){b.find("#table-marche-archive").tablesorter({sortList:[[2,1]]}).tablesorterPager({container:b.find("#content-nav-liste-operation"),positionFixed:false,size:30});return b};this.masquerPagination=function(b){b.find("#content-nav-liste-operation").hide();b.find("#table-marche-archive").tablesorter({sortList:[[2,1]]});return b};this.affectLienDetail=function(b){b.find(".detail-commande-ligne").click(function(){var c={id_commande:$(this).find(".id-commande").text()};InfoCommandeArchiveVue(c)});return b};this.construct(a)}function MarcheCommandeVue(a){this.idCommande=null;this.construct=function(b){var c=this;b.fonction="listeReservation";$.post("./index.php?m=GestionCommande&v=MarcheCommande","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}},"json");this.idCommande=b.id_commande};this.afficher=function(d){Infobulle.init();if(d.valid){if(d.listeAdherentCommande){var e=this;var b=new GestionCommandeTemplate();if(d.listeAdherentCommande.length>0&&d.listeAdherentCommande[0].adhId!=null){var f=b.listeAdherentCommandePage;d.comNumero=d.listeAdherentCommande[0].comNumero;$("#contenu").replaceWith(e.affect($(f.template(d))))}else{$("#contenu").replaceWith(b.listeMarcheVide)}}else{var g=new TemplateVR();g.valid=false;g.log.valid=false;var c=new VRerreur();c.code=ERR_211_CODE;c.message=ERR_211_MSG;g.log.push(c);Infobulle.generer(g,"")}}else{Infobulle.generer(d,"")}};this.affect=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectLienAchat(b);return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[2,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectLienAchat=function(b){var c=this;b.find(".achat-commande-ligne").click(function(){var d={id_commande:c.idCommande,id_adherent:$(this).find(".id-adherent").text()};AchatCommandeVue(d)});return b};this.construct(a)}function BonDeLivraisonVue(a){this.mCommunVue=new CommunVue();this.mIdCommande=null;this.mComNumero=null;this.mEtatEdition=false;this.mListeProduit=[];this.mSuiteEdition=0;this.mIdCompteProducteur=0;this.mTypePaiement=[];this.construct=function(b){var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=BonDeLivraison","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mEtatEdition=false;c.afficher(d)}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(c){var d=this;var b=new GestionCommandeTemplate();var e=b.bonDeLivraison;this.mIdCommande=c.producteurs[0].proIdCommande;this.mComNumero=c.comNumero;$(c.typePaiement).each(function(){d.mTypePaiement[this.tppId]=this});$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affect=function(b){b=this.mCommunVue.comHoverBtn(b);b=this.affectBtnRetourMarche(b);b=this.affectChangementProducteur(b);b=this.affectExportBonDeLivraison(b);return b};this.affectBtnRetourMarche=function(b){var c=this;b.find("#btn-editer-com").click(function(){EditerCommandeVue({id_commande:c.mIdCommande})});return b};this.affectChangementProducteur=function(b){var c=this;b.find("#select-prdt").change(function(){if(c.mEtatEdition){c.mSuiteEdition=1;c.dialogEnregistrer()}else{c.changementProducteur()}});return b};this.changementProducteur=function(){var c=this;var d=$("#select-prdt").val();if(d>0){var e={id_commande:c.mIdCommande,id_compte_producteur:d,fonction:"afficherProducteur"};$.post("./index.php?m=GestionCommande&v=BonDeLivraison","pParam="+$.toJSON(e),function(k){Infobulle.init();if(k.valid){c.mIdCompteProducteur=d;c.mEtatEdition=false;var j=0;$(k.produits).each(function(){c.mListeProduit[this.proId]=parseFloat(this.stoQuantite);this.stoQuantiteCommande="";this.opeMontant="";var p=0;var n=this.proId;var o=this;o.stoQuantiteCommande="0".nombreFormate(2,","," ");o.opeMontantCommande="0".nombreFormate(2,","," ");o.stoQuantiteLivraison="";o.opeMontantLivraison="";o.stoQuantiteSolidaire="";$(k.produitsCommande).each(function(){if(this.proId==n){var q=0;if(this.stoQuantite!=null){o.stoQuantiteCommande=this.stoQuantite.nombreFormate(2,","," ")}if(this.dopeMontant!=null){o.opeMontantCommande=this.dopeMontant.nombreFormate(2,","," ");q=parseFloat(this.dopeMontant)}j+=q}});$(k.produitsLivraison).each(function(){if(this.proId==n){if(this.stoQuantite!=null){o.stoQuantiteLivraison=this.stoQuantite.nombreFormate(2,","," ");p+=parseFloat(this.stoQuantite)}if(this.dopeMontant!=null){o.opeMontantLivraison=this.dopeMontant.nombreFormate(2,","," ")}}});$(k.produitsSolidaire).each(function(){if(this.proId==n){if(this.stoQuantite!=null){o.stoQuantiteSolidaire=this.stoQuantite.nombreFormate(2,","," ");p+=parseFloat(this.stoQuantite)}}});if(p-parseFloat(this.stoQuantite)<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ")});k.total="";if(k.operationProducteur){if(k.operationProducteur.montant!=null){k.total=(k.operationProducteur.montant).nombreFormate(2,","," ")}if(k.operationProducteur.typePaiementChampComplementaire!=null){k.champComplementaire=k.operationProducteur.typePaiementChampComplementaire}}k.sigleMonetaire=gSigleMonetaire;k.totalCommande=j.nombreFormate(2,","," ");k.typePaiement=c.mTypePaiement;var h=new GestionCommandeTemplate();var m=h.listeProduitLivraison;var g=c.affectListeProduit($(m.template(k)));if(k.operationProducteur&&k.operationProducteur.typePaiement!=null){var l=k.operationProducteur.typePaiement;g.find(":input[name=typepaiement]").selectOptions(l);var i=c.getLabelChamComplementaire(l);if(i!=null){g.find("#label-champ-complementaire").text(i);g.find("#tr-champ-complementaire").show()}else{g.find("#label-champ-complementaire").text("");g.find("#tr-champ-complementaire").hide()}}else{g.find("#label-champ-complementaire").text("");g.find("#tr-champ-complementaire").hide()}$("#liste-pdt").replaceWith(g)}else{Infobulle.generer(k,"")}},"json")}else{var b=new GestionCommandeTemplate();var f=b.listeProduitVide;$("#liste-pdt").replaceWith(f)}};this.affectListeProduit=function(b){b=this.mCommunVue.comNumeric(b);b=this.affectEtatCommande(b);b=this.mCommunVue.comHoverBtn(b);b=this.affectEnregistrer(b);b=this.affectTypePaiement(b);b=this.affectChangementEtatEdition(b);return b};this.affectTypePaiement=function(b){var c=this;b.find(":input[name=typepaiement]").change(function(){c.changerTypePaiement($(this))});return b};this.changerTypePaiement=function(d){var c=d.val();var b=this.getLabelChamComplementaire(c);if(b!=null){$("#label-champ-complementaire").text(b);$("#tr-champ-complementaire").show()}else{$("#label-champ-complementaire").text("");$(":input[name=champ-complementaire]").val("");$("#tr-champ-complementaire").hide()}};this.getLabelChamComplementaire=function(c){var b=this.mTypePaiement;if(b[c]){if(b[c].tppChampComplementaire==1){return b[c].tppLabelChampComplementaire}}return null};this.affectEtatCommande=function(b){var c=this;b.find(".qte-commande ,.qte-solidaire-commande ").keyup(function(){c.mEtatEdition=true;var e=$(this).prev(".pro-id-etat").text();if(c.mListeProduit[e]){var g=0;var f=$(":input[name=qte-commande-"+e+"]").val().numberFrToDb();var d=$(":input[name=qte-solidaire-commande-"+e+"]").val().numberFrToDb();if(!isNaN(f)&&!f.isEmpty()){g+=parseFloat(f)}if(!isNaN(d)&&!d.isEmpty()){g+=parseFloat(d)}if(g-c.mListeProduit[e]<0){$("#etat-commande-"+e).removeClass("qte-reservation-ok").addClass("qte-reservation-ko")}else{$("#etat-commande-"+e).removeClass("qte-reservation-ko").addClass("qte-reservation-ok")}}});return b};this.affectEnregistrer=function(b){var c=this;b.find("#btn-enregistrer").click(function(){c.mSuiteEdition=0;c.enregistrer()});b.find(".qte-commande ,.prix-commande ").keyup(function(d){if(d.keyCode=="13"){c.mSuiteEdition=0;c.enregistrer()}});return b};this.enregistrer=function(){var c=this;var d=new ProduitsBonDeLivraisonVO();d.id_commande=this.mIdCommande;d.id_compte_producteur=this.mIdCompteProducteur;$(".pro-id").each(function(){var f=$(this).text();var g=new ProduitBonDeLivraisonVO();g.id=f;g.quantite=$(":input[name=qte-commande-"+f+"]").val().numberFrToDb();g.quantiteSolidaire=$(":input[name=qte-solidaire-commande-"+f+"]").val().numberFrToDb();g.prix=$(":input[name=prix-commande-"+f+"]").val().numberFrToDb();d.produits.push(g)});d.typePaiement=$(":input[name=typepaiement]").val();d.total=$(":input[name=total]").val().numberFrToDb();if(this.getLabelChamComplementaire(d.typePaiement)!=null){d.typePaiementChampComplementaireObligatoire=1;d.typePaiementChampComplementaire=$(":input[name=champ-complementaire]").val()}else{d.typePaiementChampComplementaireObligatoire=0}var b=new ProduitsBonDeLivraisonValid();var e=b.validAjout(d);if(e.valid){d.fonction="enregistrer";$.post("./index.php?m=GestionCommande&v=BonDeLivraison","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g.valid){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.dialogExportBonDeLivraison()}else{var h=new TemplateVR();h.valid=false;h.log.valid=false;var f=new VRerreur();f.code=ERR_301_CODE;f.message=ERR_301_MSG;h.log.erreurs.push(f);Infobulle.generer(h,"")}}}else{Infobulle.generer(g,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}},"json")}else{Infobulle.generer(e,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}};this.affectExportBonDeLivraison=function(b){var c=this;b.find("#btn-export-bcom").click(function(){if(c.mEtatEdition){c.mSuiteEdition=2;c.dialogEnregistrer()}else{c.dialogExportBonDeLivraison()}});return b};this.affectChangementEtatEdition=function(b){var c=this;b.find(".com-input-text").keyup(function(){c.mEtatEdition=true});b.find(":input[name=typepaiement]").change(function(){c.mEtatEdition=true});return b};this.dialogExportBonDeLivraison=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogExportBonDeLivraison;$(d.template({comNumero:c.mComNumero})).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var e=$(this).find(":input[name=format]:checked").val();var g=new ExportBonLivraisonVO();g.id_commande=c.mIdCommande;g.format=e;g.fonction="export";var f=new ExportBonLivraisonValid();var h=f.validAjout(g);Infobulle.init();if(h.valid){$.download("./index.php?m=GestionCommande&v=BonDeLivraison",g)}else{Infobulle.generer(h,"")}},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.dialogEnregistrer=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogEnregistrement;$(d).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Enregistrer:function(){c.enregistrer();$(this).dialog("close")},Annuler:function(){if(c.mSuiteEdition==1){$("#select-prdt").selectOptions(c.mIdCompteProducteur)}$(this).dialog("close")},"Ne pas Enregistrer":function(){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.changementProducteur();c.dialogExportBonDeLivraison()}}$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.construct(a)}function InfoCommandeArchiveVue(a){this.mCommunVue=new CommunVue();this.construct=function(b){var c=this;b.fonction="afficherCommande";$.post("./index.php?m=GestionCommande&v=InfoCommandeArchive","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(e){var d=this;var b=new GestionCommandeTemplate();var g=b.infoCommandeArchive;e.sigleMonetaire=gSigleMonetaire;var c=0;var f=0;$(e.infoCommande).each(function(){if(this.stoQuantite==null){this.stoQuantite=0}if(this.opeMontant==null){this.opeMontant=0}if(this.stoQuantiteLivraison==null){this.stoQuantiteLivraison=0}if(this.opeMontantLivraison==null){this.opeMontantLivraison=0}if(this.stoQuantiteSolidaire==null){this.stoQuantiteSolidaire=0}if(this.stoQuantiteVente==null){this.stoQuantiteVente=0}if(this.opeMontantVente==null){this.opeMontantVente=0}if(this.stoQuantiteVenteSolidaire==null){this.stoQuantiteVenteSolidaire=0}if(this.opeMontantVenteSolidaire==null){this.opeMontantVenteSolidaire=0}c-=parseFloat(this.opeMontantLivraison);c+=parseFloat(this.opeMontantVente);f+=parseFloat(this.opeMontantVenteSolidaire);this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");this.opeMontant=this.opeMontant.nombreFormate(2,","," ");this.stoQuantiteLivraison=this.stoQuantiteLivraison.nombreFormate(2,","," ");this.opeMontantLivraison=this.opeMontantLivraison.nombreFormate(2,","," ");this.stoQuantiteSolidaire=this.stoQuantiteSolidaire.nombreFormate(2,","," ");this.stoQuantiteVente=this.stoQuantiteVente.nombreFormate(2,","," ");this.opeMontantVente=this.opeMontantVente.nombreFormate(2,","," ");this.stoQuantiteVenteSolidaire=this.stoQuantiteVenteSolidaire.nombreFormate(2,","," ");this.opeMontantVenteSolidaire=this.opeMontantVenteSolidaire.nombreFormate(2,","," ")});e.total=c.nombreFormate(2,","," ");e.totalSolidaire=f.nombreFormate(2,","," ");e.numero=e.detailMarche.numero;$("#contenu").replaceWith(d.affect($(g.template(e))))};this.affect=function(b){return b};this.construct(a)}function BonDeCommandeVue(a){this.mCommunVue=new CommunVue();this.mIdCommande=null;this.mComNumero=null;this.mEtatEdition=false;this.mListeProduit=[];this.mSuiteEdition=0;this.mIdCompteProducteur=0;this.construct=function(b){var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=BonDeCommande","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mEtatEdition=false;c.afficher(d)}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(c){var d=this;var b=new GestionCommandeTemplate();var e=b.bonDeCommande;this.mIdCommande=c.producteurs[0].proIdCommande;this.mComNumero=c.comNumero;$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affect=function(b){b=this.mCommunVue.comHoverBtn(b);b=this.affectBtnRetourMarche(b);b=this.affectChangementProducteur(b);b=this.affectExportBonCommande(b);return b};this.affectBtnRetourMarche=function(b){var c=this;b.find("#btn-editer-com").click(function(){EditerCommandeVue({id_commande:c.mIdCommande})});return b};this.affectChangementProducteur=function(b){var c=this;b.find("#select-prdt").change(function(){if(c.mEtatEdition){c.mSuiteEdition=1;c.dialogEnregistrer()}else{c.changementProducteur()}});return b};this.changementProducteur=function(){var c=this;var d=$("#select-prdt").val();if(d>0){var e={id_commande:c.mIdCommande,id_compte_producteur:d,fonction:"afficherProducteur"};$.post("./index.php?m=GestionCommande&v=BonDeCommande","pParam="+$.toJSON(e),function(h){Infobulle.init();if(h.valid){c.mIdCompteProducteur=d;c.mEtatEdition=false;$(h.produits).each(function(){c.mListeProduit[this.proId]=this.stoQuantite;this.stoQuantiteCommande="";this.dopeMontant="";var j=this.proId;var k=this;$(h.produitsCommande).each(function(){if(this.proId==j){k.stoQuantiteCommande=this.stoQuantite;k.dopeMontant=this.dopeMontant.nombreFormate(2,","," ")}});if(this.stoQuantiteCommande-this.stoQuantite<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}if(this.stoQuantiteCommande!=""){this.stoQuantiteCommande=this.stoQuantiteCommande.nombreFormate(2,","," ")}this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ")});h.sigleMonetaire=gSigleMonetaire;var g=new GestionCommandeTemplate();var i=g.listeProduitBonDeCommande;$("#liste-pdt").replaceWith(c.affectListeProduit($(i.template(h))))}else{Infobulle.generer(h,"")}},"json")}else{var b=new GestionCommandeTemplate();var f=b.listeProduitVide;$("#liste-pdt").replaceWith(f)}};this.affectListeProduit=function(b){b=this.mCommunVue.comNumeric(b);b=this.affectEtatCommande(b);b=this.mCommunVue.comHoverBtn(b);b=this.affectEnregistrer(b);return b};this.affectEtatCommande=function(b){var c=this;b.find(":input").keyup(function(){c.mEtatEdition=true;var d=$(this).prev(".pro-id").text();if(c.mListeProduit[d]){if($(this).val().numberFrToDb()-c.mListeProduit[d]<0){$("#etat-commande-"+d).removeClass("qte-reservation-ok").addClass("qte-reservation-ko")}else{$("#etat-commande-"+d).removeClass("qte-reservation-ko").addClass("qte-reservation-ok")}}});return b};this.affectEnregistrer=function(b){var c=this;b.find("#btn-enregistrer").click(function(){c.mSuiteEdition=0;c.enregistrer()});b.find(".qte-commande ,.prix-commande ").keyup(function(d){if(d.keyCode=="13"){c.mSuiteEdition=0;c.enregistrer()}});return b};this.enregistrer=function(){var c=this;var d=new ProduitsBonDeCommandeVO();d.id_commande=this.mIdCommande;d.id_compte_producteur=this.mIdCompteProducteur;d.export_type=0;$(".pro-id").each(function(){var f=$(this).text();var g=new ProduitBonDeCommandeVO();g={id:f,quantite:$(":input[name=qte-commande-"+f+"]").val().numberFrToDb(),prix:$(":input[name=prix-commande-"+f+"]").val().numberFrToDb()};d.produits.push(g)});var b=new ProduitsBonDeCommandeValid();var e=b.validAjout(d);if(e.valid){d.fonction="enregistrer";return $.post("./index.php?m=GestionCommande&v=BonDeCommande","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g.valid){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.dialogExportBonDeCommande()}else{var h=new TemplateVR();h.valid=false;h.log.valid=false;var f=new VRerreur();f.code=ERR_301_CODE;f.message=ERR_301_MSG;h.log.erreurs.push(f);Infobulle.generer(h,"")}}}else{Infobulle.generer(g,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}},"json")}else{Infobulle.generer(e,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}};this.affectExportBonCommande=function(b){var c=this;b.find("#btn-export-bcom").click(function(){if(c.mEtatEdition){c.mSuiteEdition=2;c.dialogEnregistrer()}else{c.dialogExportBonDeCommande()}});return b};this.dialogExportBonDeCommande=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogExportBonDeCommande;$(d.template({comNumero:c.mComNumero})).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var e=$(this).find(":input[name=format]:checked").val();var g=new ExportBonReservationVO();g.id_commande=c.mIdCommande;g.format=e;g.fonction="export";var f=new ExportBonReservationValid();var h=f.validAjout(g);Infobulle.init();if(h.valid){$.download("./index.php?m=GestionCommande&v=BonDeCommande",g)}else{Infobulle.generer(h,"")}},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.dialogEnregistrer=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogEnregistrement;$(d).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Enregistrer:function(){c.enregistrer();$(this).dialog("close")},Annuler:function(){if(c.mSuiteEdition==1){$("#select-prdt").selectOptions(c.mIdCompteProducteur)}$(this).dialog("close")},"Ne pas Enregistrer":function(){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.changementProducteur();c.dialogExportBonDeCommande()}}$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.construct(a)}function ReservationAdherentVue(a){this.mCommunVue=new CommunVue();this.mAdherent=null;this.infoCommande=new Object();this.pdtCommande=new Array();this.reservation=new Array();this.reservationModif=new Array();this.construct=function(b){var c=this;b.fonction="afficherReservation";$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mAdherent=d.adherent;c.infoCommande.comId=d.commande[0].comId;c.infoCommande.comNumero=d.commande[0].comNumero;c.infoCommande.comNom=d.commande[0].comNom;c.infoCommande.comDescription=d.commande[0].comDescription;c.infoCommande.dateTimeFinReservation=d.commande[0].comDateFinReservation;c.infoCommande.dateFinReservation=d.commande[0].comDateFinReservation.extractDbDate().dateDbToFr();c.infoCommande.heureFinReservation=d.commande[0].comDateFinReservation.extractDbHeure();c.infoCommande.minuteFinReservation=d.commande[0].comDateFinReservation.extractDbMinute();c.infoCommande.dateMarcheDebut=d.commande[0].comDateMarcheDebut.extractDbDate().dateDbToFr();c.infoCommande.heureMarcheDebut=d.commande[0].comDateMarcheDebut.extractDbHeure();c.infoCommande.minuteMarcheDebut=d.commande[0].comDateMarcheDebut.extractDbMinute();c.infoCommande.heureMarcheFin=d.commande[0].comDateMarcheFin.extractDbHeure();c.infoCommande.minuteMarcheFin=d.commande[0].comDateMarcheFin.extractDbMinute();c.infoCommande.comArchive=d.commande[0].comArchive;$(d.commande).each(function(){var f=new Object();f.dcomId=this.dcomId;f.dcomIdProduit=this.dcomIdProduit;f.dcomTaille=this.dcomTaille;f.dcomPrix=this.dcomPrix;if(c.pdtCommande[this.proId]){c.pdtCommande[this.proId].lot[f.dcomId]=f}else{var e=new Object();e.proId=this.proId;e.proUniteMesure=this.proUniteMesure;e.proMaxProduitCommande=this.proMaxProduitCommande;$(d.stock).each(function(){if(this.proId==e.proId){if(parseFloat(this.stoQuantite)<parseFloat(e.proMaxProduitCommande)){e.proMaxProduitCommande=this.stoQuantite}}});e.nproNom=this.nproNom;e.nproDescription=this.nproDescription;e.nproIdCategorie=this.nproIdCategorie;e.lot=new Array();e.lot[f.dcomId]=f;c.pdtCommande[e.proId]=e}});$(d.reservation).each(function(){this.stoQuantite=this.stoQuantite*-1;c.reservation[this.proId]=this});c.afficher()}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(){this.afficherDetailReservation()};this.afficherDetailReservation=function(){var e=this;var b=new GestionCommandeTemplate();var f=b.detailReservation;var c={};c.adhId=this.mAdherent.adhId;c.adhNumero=this.mAdherent.adhNumero;c.adhCompte=this.mAdherent.cptLabel;c.adhNom=this.mAdherent.adhNom;c.adhPrenom=this.mAdherent.adhPrenom;c.adhSolde=this.mAdherent.opeMontant.nombreFormate(2,","," ");c.sigleMonetaire=gSigleMonetaire;c.comNumero=this.infoCommande.comNumero;c.dateFinReservation=this.infoCommande.dateFinReservation;c.heureFinReservation=this.infoCommande.heureFinReservation;c.minuteFinReservation=this.infoCommande.minuteFinReservation;c.dateMarcheDebut=this.infoCommande.dateMarcheDebut;c.heureMarcheDebut=this.infoCommande.heureMarcheDebut;c.minuteMarcheDebut=this.infoCommande.minuteMarcheDebut;c.heureMarcheFin=this.infoCommande.heureMarcheFin;c.minuteMarcheFin=this.infoCommande.minuteMarcheFin;c.reservation=new Array();var d=0;$(this.pdtCommande).each(function(){if(e.reservation[this.proId]){var g=new Object;g.nproNom=this.nproNom;g.stoQuantite=parseFloat(e.reservation[this.proId].stoQuantite);g.proUniteMesure=this.proUniteMesure;g.prix=0;var h=e.reservation[this.proId].dcomId;$(this.lot).each(function(){if(this.dcomId==h){g.prix=(g.stoQuantite/this.dcomTaille)*this.dcomPrix}});d+=g.prix;g.stoQuantite=g.stoQuantite.nombreFormate(2,","," ");g.prix=g.prix.nombreFormate(2,","," ");c.reservation.push(g)}});c.total=parseFloat(d).nombreFormate(2,","," ");$("#contenu").replaceWith(e.affect($(f.template(c))))};this.afficherModifier=function(){var e=this;var b=new GestionCommandeTemplate();var f=b.modifierReservation;var c={};c.adhId=this.mAdherent.adhId;c.adhNumero=this.mAdherent.adhNumero;c.adhCompte=this.mAdherent.cptLabel;c.adhNom=this.mAdherent.adhNom;c.adhPrenom=this.mAdherent.adhPrenom;c.adhSolde=this.mAdherent.opeMontant.nombreFormate(2,","," ");c.adhNouveauSolde=0;c.sigleMonetaire=gSigleMonetaire;c.comNumero=this.infoCommande.comNumero;c.dateFinReservation=this.infoCommande.dateFinReservation;c.heureFinReservation=this.infoCommande.heureFinReservation;c.minuteFinReservation=this.infoCommande.minuteFinReservation;c.dateMarcheDebut=this.infoCommande.dateMarcheDebut;c.heureMarcheDebut=this.infoCommande.heureMarcheDebut;c.minuteMarcheDebut=this.infoCommande.minuteMarcheDebut;c.heureMarcheFin=this.infoCommande.heureMarcheFin;c.minuteMarcheFin=this.infoCommande.minuteMarcheFin;c.produit=new Array();var d=0;$(this.pdtCommande).each(function(){if(this.proId){var g={};g.proId=this.proId;g.nproNom=this.nproNom;g.proMaxProduitCommande=parseFloat(this.proMaxProduitCommande).nombreFormate(2,","," ");g.proUniteMesure=this.proUniteMesure;g.lot=new Array();var j=0;var h=-1;var k=-1;$(this.lot).each(function(){if(this.dcomId){var i={};i.dcomId=this.dcomId;i.dcomTaille=parseFloat(this.dcomTaille).nombreFormate(2,","," ");i.dcomPrix=parseFloat(this.dcomPrix).nombreFormate(2,","," ");i.prixReservation=parseFloat(this.dcomPrix);i.stoQuantiteReservation=parseFloat(this.dcomTaille);if(e.reservation[g.proId]&&(e.reservation[g.proId].dcomId==this.dcomId)){i.stoQuantiteReservation=parseFloat(e.reservation[g.proId].stoQuantite);i.prixReservation=(i.stoQuantiteReservation/this.dcomTaille)*this.dcomPrix;d+=i.prixReservation;h=this.dcomId;i.checked='checked="checked"'}g.prixUnitaire=(i.prixReservation/i.stoQuantiteReservation).nombreFormate(2,","," ");i.stoQuantiteReservation=i.stoQuantiteReservation.nombreFormate(2,","," ");i.prixReservation=i.prixReservation.nombreFormate(2,","," ");g.lot.push(i)}});c.total=parseFloat(d).nombreFormate(2,","," ");if(h!=-1){g.checked='checked="checked"'}else{if(g.lot[0]){g.lot[0].checked='checked="checked"'}}c.produit.push(g)}});this.reservationModif=new Array();$(this.reservation).each(function(){if(this.proId){e.reservationModif[this.proId]={comId:this.comId,proId:this.proId,dcomId:this.dcomId,stoId:this.stoId,stoQuantite:this.stoQuantite,stoType:this.stoType,stoIdCompte:this.stoIdCompte}}});$("#contenu").replaceWith(e.affectModifier($(f.template(c))))};this.affect=function(b){b=this.affectModifierReservation(b);b=this.affectAnnulerDetailReservation(b);b=this.mCommunVue.comHoverBtn(b);b=this.affectSupprimerReservation(b);return b};this.affectModifier=function(b){b=this.affectBtnQte(b);b=this.affectChangementLot(b);b=this.affectChangementProduit(b);b=this.preparerAffichageModifier(b);b=this.affectValiderReservation(b);b=this.affectAnnulerReservation(b);b=this.affectNouveauSolde(b);b=this.mCommunVue.comHoverBtn(b);b=this.supprimerSelect(b);b=this.affectInitLot(b);return b};this.affectBtnQte=function(b){var c=this;b.find(".btn-plus").click(function(){var d=$(this).parent().parent().find(".pdt-id").text();c.nouvelleQuantite(d,$(this).parent().parent().find("#lot-"+d).val(),1)});b.find(".btn-moins").click(function(){var d=$(this).parent().parent().find(".pdt-id").text();c.nouvelleQuantite(d,$(this).parent().parent().find("#lot-"+d).val(),-1)});return b};this.affectChangementLot=function(b){var c=this;b.find(".pdt select").change(function(){c.changerLot($(this).parent().parent().find(".pdt-id").text(),$(this).val())});return b};this.affectChangementProduit=function(b){var c=this;b.find(".pdt :checkbox").click(function(){c.changerProduit($(this).parent().parent().find(".pdt-id").text())});return b};this.affectValiderReservation=function(b){var c=this;b.find("#btn-valider").click(function(){c.validerReservation()});return b};this.affectAnnulerReservation=function(b){var c=this;b.find("#btn-annuler").click(function(){c.afficherDetailReservation()});return b};this.affectModifierReservation=function(b){var c=this;b.find("#btn-modifier").click(function(){c.afficherModifier()});return b};this.affectAnnulerDetailReservation=function(b){var c=this;b.find("#btn-annuler").click(function(){EditerCommandeVue({id_commande:c.infoCommande.comId})});return b};this.affectInitLot=function(b){var c=this;b.find(".pdt select").each(function(){var d=$(this).parent().parent().find(".pdt-id").text();var g=$(this).val();var e=c.pdtCommande[d].lot[g].dcomPrix;var h=c.pdtCommande[d].lot[g].dcomTaille;var f=(e/h).nombreFormate(2,","," ");$(b).find("#prix-unitaire-"+d).text(f)});return b};this.nouvelleQuantite=function(f,k,b){var h=this.pdtCommande[f].proMaxProduitCommande;var l=this.pdtCommande[f].lot[k].dcomTaille;var j=this.pdtCommande[f].lot[k].dcomPrix;var d=0;if(this.reservationModif[f]&&(this.reservationModif[f].dcomId==k)){d=this.reservationModif[f].stoQuantite/l}d+=b;var c=0;c=d*l;if(c>0&&c<=h){var e=0;e=d*j;this.reservationModif[f].stoQuantite=c;$("#qte-pdt-"+f).text(parseFloat(c).nombreFormate(2,","," "));$("#prix-pdt-"+f).text(parseFloat(e).nombreFormate(2,","," "));this.majTotal()}else{if(c>h){var g=new TemplateVR();g.valid=false;g.log.valid=false;var i=new VRerreur();i.code=ERR_304_CODE;i.message=ERR_304_MSG;g.log.erreurs.push(i);Infobulle.generer(g,"")}}};this.changerLot=function(b,c){var d=this.pdtCommande[b].lot[c].dcomPrix;var f=this.pdtCommande[b].lot[c].dcomTaille;var e=(d/f).nombreFormate(2,","," ");$("#prix-unitaire-"+b).text(e);if(this.reservationModif[b]){this.reservationModif[b].dcomId=c;this.reservationModif[b].stoQuantite=f;$("#qte-pdt-"+b).text(f.nombreFormate(2,","," "));$("#prix-pdt-"+b).text(d.nombreFormate(2,","," "))}this.majTotal()};this.changerProduit=function(b){if(this.reservationModif[b]!=null){$(".resa-pdt-"+b).hide();$("#qte-pdt-"+b).text("");$("#prix-pdt-"+b).text("");this.reservationModif[b]=null}else{var e=$("#lot-"+b).val();var f=this.pdtCommande[b].lot[e].dcomTaille;var d={};d.comId=this.infoCommande.comId;d.proId=b;d.dcomId=e;d.stoQuantite=f;this.reservationModif[b]=d;$("#qte-pdt-"+b).text(f.nombreFormate(2,","," "));var c=this.pdtCommande[b].lot[e].dcomPrix.nombreFormate(2,","," ");$("#prix-pdt-"+b).text(c);$(".resa-pdt-"+b).show()}this.majTotal()};this.majTotal=function(){$("#total").text(this.calculTotal().nombreFormate(2,","," "));this.majNouveauSolde()};this.majNouveauSolde=function(){var b=this.mAdherent.opeMontant-this.calculTotal();if(b<=0){$("#nouveau-solde").addClass("com-nombre-negatif");$("#nouveau-solde-sigle").addClass("com-nombre-negatif")}else{$("#nouveau-solde").removeClass("com-nombre-negatif");$("#nouveau-solde-sigle").removeClass("com-nombre-negatif")}$("#nouveau-solde").text(b.nombreFormate(2,","," "))};this.affectNouveauSolde=function(c){var b=this.mAdherent.opeMontant-this.calculTotal();if(b<=0){c.find("#nouveau-solde").addClass("com-nombre-negatif");c.find("#nouveau-solde-sigle").addClass("com-nombre-negatif")}else{c.find("#nouveau-solde").removeClass("com-nombre-negatif");c.find("#nouveau-solde-sigle").removeClass("com-nombre-negatif")}c.find("#nouveau-solde").text(b.nombreFormate(2,","," "));return c};this.calculTotal=function(){var c=this;var b=0;$(this.reservationModif).each(function(){var d=this;if(d.stoQuantite){if(c.pdtCommande[d.proId]){$(c.pdtCommande[d.proId].lot).each(function(){if(d.dcomId==this.dcomId){b+=(d.stoQuantite/this.dcomTaille)*this.dcomPrix}})}}});return b};this.preparerAffichageModifier=function(b){var c=this;$(b).find(".pdt").each(function(){var d=$(this).find(".pdt-id").text();if(c.reservation[d]!=null){var g=c.reservation[d];var f=g.dcomId;var h=g.stoQuantite;$(b).find("#qte-pdt-"+d).text(h.nombreFormate(2,","," "));var e=((c.pdtCommande[d].lot[f].dcomPrix*g.stoQuantite)/c.pdtCommande[d].lot[f].dcomTaille).nombreFormate(2,","," ");$(b).find("#prix-pdt-"+d).text(e);$(b).find("#lot-"+d).selectOptions(f);$(b).find(".resa-pdt-"+d).show()}});return b};this.validerReservation=function(){var e=this;Infobulle.init();var c=new ListeReservationCommandeVO();var f=0;$(this.reservationModif).each(function(){if(this.stoQuantite){var h=new ReservationCommandeVO();h.id="";h.stoQuantite=this.stoQuantite*-1;h.stoIdDetailCommande=this.dcomId;c.commandes.push(h);f++}});if(f>0){var d=new ListeReservationCommandeValid();var g=d.validAjout(c);if(!g.valid){Infobulle.generer(g,"")}else{lParam={reservation:c,id_compte:this.mAdherent.adhIdCompte,fonction:"modifierReservation"};$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(lParam),function(h){Infobulle.init();if(h.valid){e.reservation=new Array();$(e.reservationModif).each(function(){if(this.proId){e.reservation[this.proId]={comId:this.comId,proId:this.proId,dcomId:this.dcomId,stoId:this.stoId,stoQuantite:this.stoQuantite,stoType:this.stoType,stoIdCompte:this.stoIdCompte}}});e.afficher()}else{Infobulle.generer(h,"")}},"json")}}else{var g=new TemplateVR();g.valid=false;g.log.valid=false;var b=new VRerreur();b.code=ERR_207_CODE;b.message=ERR_207_MSG;g.log.erreurs.push(b);Infobulle.generer(g,"")}};this.affectSupprimerReservation=function(b){var c=this;b.find("#btn-supprimer").click(function(){var d=new GestionCommandeTemplate();var e=d.supprimerReservationDialog;$(e).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var f={id_commande:c.infoCommande.comId,id_adherent:c.mAdherent.adhId,fonction:"supprimerReservation"};var g=this;$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(f),function(i){Infobulle.init();if(i.valid){var j=new TemplateVR();j.valid=false;j.log.valid=false;var h=new VRerreur();h.code=ERR_303_CODE;h.message=ERR_303_MSG;j.log.erreurs.push(h);EditerCommandeVue({id_commande:c.infoCommande.comId,vr:j});$(g).dialog("close")}else{Infobulle.generer(i,"")}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove()}})});return b};this.supprimerSelect=function(b){b.find(".pdt select").each(function(){if($(this).find("option").size()==1){var e=new CommandeTemplate();var d=e.lotUnique;var c={};c.IdPdt=$(this).parent().parent().find(".pdt-id").text();c.valeur=$(this).val();c.text=$(this).text();$(this).replaceWith(d.template(c))}});return b};this.construct(a)}function EditerCommandeVue(a){this.mNiveau=[];this.mIdCommande=null;this.mCommande=null;this.construct=function(b){var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){c.afficher(d);if(b.vr){Infobulle.generer(b.vr,"")}}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(e){var f=this;var d={};d.comId=e.marche.id;this.mIdCommande=d.comId;d.comNumero=e.marche.numero;d.comDescription=e.marche.description;d.dateTimeFinReservation=e.marche.dateFinReservation;d.dateFinReservation=e.marche.dateFinReservation.extractDbDate().dateDbToFr();d.heureFinReservation=e.marche.dateFinReservation.extractDbHeure();d.minuteFinReservation=e.marche.dateFinReservation.extractDbMinute();d.dateMarcheDebut=e.marche.dateMarcheDebut.extractDbDate().dateDbToFr();d.heureMarcheDebut=e.marche.dateMarcheDebut.extractDbHeure();d.minuteMarcheDebut=e.marche.dateMarcheDebut.extractDbMinute();d.heureMarcheFin=e.marche.dateMarcheFin.extractDbHeure();d.minuteMarcheFin=e.marche.dateMarcheFin.extractDbMinute();d.pdtCommande=[];$.each(e.marche.produits,function(){var h={};h.proId=this.id;h.nproNom=this.nom;h.quantiteCommande=parseFloat(this.stockInitial)-parseFloat(this.stockReservation);h.quantiteInit=parseFloat(this.stockInitial);h.unite=this.unite;f.mNiveau.push({id:this.id,quantite:parseInt(h.quantiteCommande*100/h.quantiteInit)});d.pdtCommande.push(h)});d.listeAdherentCommande=e.listeAdherentCommande;d.sigleMonetaire=gSigleMonetaire;this.mCommande=d;var c=new GestionCommandeTemplate();var g=c.editerCommandePage;var b=f.affect($(g.template(d)));if(!(e.listeAdherentCommande.length>0&&e.listeAdherentCommande[0].adhId!=null)){b.find("#edt-com-recherche").hide();b.find("#edt-com-liste-resa").replaceWith(c.listeReservationVide)}$("#contenu").replaceWith(b)};this.affect=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectNiveau(b);b=this.affectReservation(b);b=this.affectModifier(b);b=this.affectCloturer(b);b=this.affectExportReservation(b);b=this.affectBonDeCommande(b);b=this.affectBonDeLivraison(b);b=gCommunVue.comHoverBtn(b);return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[2,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectNiveau=function(b){$(this.mNiveau).each(function(){var c=this.id;var d=this.quantite;if(d<1){d=1}b.find("#pdt-"+c).progressbar({value:d})});return b};this.affectReservation=function(b){var c=this;b.find(".edt-com-reservation-ligne").click(function(){ReservationAdherentVue({id_commande:c.mIdCommande,id_adherent:$(this).find(".id-adherent").text()})});return b};this.affectModifier=function(b){var c=this;b.find("#btn-modif-com").click(function(){ModifierCommandeVue({id_commande:c.mIdCommande})});return b};this.affectBonDeCommande=function(b){var c=this;b.find("#btn-bon-com").click(function(){BonDeCommandeVue({id_commande:c.mIdCommande})});return b};this.affectBonDeLivraison=function(b){var c=this;b.find("#btn-livraison-com").click(function(){BonDeLivraisonVue({id_commande:c.mIdCommande})});return b};this.affectCloturer=function(b){var c=this;b.find("#btn-cloture-com").click(function(){var d=new GestionCommandeTemplate();var e=d.dialogClotureCommande;$(e.template(c.mCommande)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Cloturer:function(){var f={id_commande:c.mIdCommande};var g=this;$.post("./index.php?m=GestionCommande&v=CloturerCommande","pParam="+$.toJSON(f),function(i){Infobulle.init();if(i.valid){var h=new GestionCommandeTemplate();var j=h.cloturerCommandeSucces;$("#contenu").replaceWith(j.template(i));$(g).dialog("close")}else{Infobulle.generer(i,"")}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}})});return b};this.affectExportReservation=function(b){var c=this;b.find("#btn-export-resa").click(function(){var d=new GestionCommandeTemplate();var e=d.dialogExportListeReservation;$(e.template(c.mCommande)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var h="";$(this).find(":input[name=id_produits]:checked").each(function(){h+=$(this).val()+","});h=h.substr(0,h.length-1);var f=$(this).find(":input[name=format]:checked").val();var i=new ExportListeReservationVO();i={fonction:"exportReservation",id_commande:c.mIdCommande,id_produits:h,format:f};var g=new ExportListeReservationValid();var j=g.validAjout(i);Infobulle.init();if(j.valid){$.download("./index.php?m=GestionCommande&v=EditerCommande",i)}else{Infobulle.generer(j,"")}},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}})});return b};this.construct(a)};