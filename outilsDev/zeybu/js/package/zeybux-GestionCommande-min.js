function GestionCommandeTemplate(){this.dialogAjoutProduitAjoutMarche='<div id="dialog-ajout-pro" title="Produit"><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Le Produit</div><div id="pro-idFerme" class="com-float-left"><select name="ferme"><option value="0" >== Choisir une ferme ==</option><!-- BEGIN listeFerme --><option value="{listeFerme.ferId}" >{listeFerme.ferNom}</option><!-- END listeFerme --></select></div><div id="pro-idCategorie" class="com-float-left"><select name="categorie" disabled="disabled"><option value="0" >== Choisir une catégorie ==</option></select></div><div id="pro-idProduit" class="com-float-left"><select name="produit" disabled="disabled"><option value="0" >== Choisir un produit ==</option></select></div></div><div id="prix-stock-produit"></div></div>';this.ajoutProduitSelectCategorie='<div id="pro-idCategorie" class="com-float-left"><select name="categorie"><option value="0" >== Choisir une catégorie ==</option><!-- BEGIN listeCategorie --><option value="{listeCategorie.cproId}" >{listeCategorie.cproNom}</option><!-- END listeCategorie --></select></div>';this.ajoutProduitSelectProduit='<div id="pro-idProduit" class="com-float-left"><select name="produit"><option value="0" >== Choisir un produit ==</option><!-- BEGIN listeProduit --><option value="{listeProduit.nproId}" >{listeProduit.nproNom}</option><!-- END listeProduit --></select></div>';this.prixAjoutProduit='<div id="div-lot"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-form" id="table-pro-prix"><tr><td class="catalogue-entete-lot">Quantité</td><td class="catalogue-entete-lot">Unité</td><td>Prix</td><td></td><td></td></tr><tr class="btn-lot"><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-quantite" maxlength="13" id="pro-lot-quantite"/></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all" type="text" name="lot-unite" maxlength="20" id="pro-lot-unite"/></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-prix" maxlength="13" id="pro-lot-prix"/> {sigleMonetaire}</td><td colspan="2"><button type="button" id="btn-ajout-lot" class="ui-state-default ui-corner-all com-button com-center">Ajouter un prix de vente</button></td></tr></table><table class="com-table" id="lot-liste"><!-- BEGIN modelesLot --><tr class="ligne-lot" id="ligne-lot-{modelesLot.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLot.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{modelesLot.id}" name="pro-lot" id="pro-lot-{modelesLot.id}-id" class="modele-lot"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLot.id} lot-quantite" id="lot-{modelesLot.id}-quantite">{modelesLot.quantite}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLot.id}-quantite" maxlength="13" id="pro-lot-{modelesLot.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLot.id} lot-unite" id="lot-{modelesLot.id}-unite">{modelesLot.unite}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLot.id}-unite" maxlength="20" id="pro-lot-{modelesLot.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLot.id} lot-prix" id="lot-{modelesLot.id}-prix">{modelesLot.prix}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLot.id}-prix" maxlength="13" id="pro-lot-{modelesLot.id}-prix"/> {modelesLot.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot" id="btn-valider-lot-{modelesLot.id}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot" id="btn-annuler-lot-{modelesLot.id}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLot --></table></div>';this.prixAbonnementAjoutProduit='<div id="div-lot-abonnement"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-form" id="table-pro-abonnement-prix"><tr><td class="catalogue-entete-lot">Quantité</td><td class="catalogue-entete-lot">Unité</td><td>Prix</td><td></td><td></td></tr><tr class="btn-lot-abonnement"><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-abo-quantite" maxlength="13" id="pro-abo-lot-quantite"/></td><td><span id="pro-abo-lot-unite">{uniteAbonnement}</span></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-abo-prix" maxlength="13" id="pro-abo-lot-prix"/> {sigleMonetaire}</td><td colspan="2"><button type="button" id="btn-ajout-lot-abonnement" class="ui-state-default ui-corner-all com-button com-center">Ajouter un prix de vente</button></td></tr></table><table class="com-table" id="lot-liste-abonnement"><!-- BEGIN modelesLotAbonnementReservation --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnementReservation.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnementReservation.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" checked="checked" disabled="disabled" value="{modelesLotAbonnementReservation.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnementReservation.id}-id" class="modele-lot-reservation"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnementReservation.id}-quantite-abonnement">{modelesLotAbonnementReservation.quantite}</span></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-unite" id="lot-{modelesLotAbonnementReservation.id}-unite-abonnement">{modelesLotAbonnementReservation.unite}</span></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-prix" id="lot-{modelesLotAbonnementReservation.id}-prix-abonnement">{modelesLotAbonnementReservation.prix}</span> {modelesLotAbonnementReservation.sigleMonetaire}</td><td class="com-table-td-med td-edt"></td><td class="com-table-td-fin td-edt"></td></tr><!-- END modelesLotAbonnementReservation --><!-- BEGIN modelesLotAbonnement --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnement.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnement.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{modelesLotAbonnement.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnement.id}-id" class="modele-lot"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnement.id}-quantite-abonnement">{modelesLotAbonnement.quantite}</span><input class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-quantite" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnement.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-unite" id="lot-{modelesLotAbonnement.id}-unite-abonnement">{modelesLotAbonnement.unite}</span><input disabled="disabled" class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-unite" maxlength="20" id="pro-lot-abonnement{modelesLotAbonnement.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-prix" id="lot-{modelesLotAbonnement.id}-prix-abonnement">{modelesLotAbonnement.prix}</span><input class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-prix" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnement.id}-prix"/> {modelesLotAbonnement.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot-abonnement" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot-abonnement" id="btn-valider-lot-{modelesLotAbonnement.id}-abonnement" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot-abonnement" id="btn-annuler-lot-{modelesLotAbonnement.id}-abonnement" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot-abonnement" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLotAbonnement --></table></div>';this.stockAjoutProduit='<div id="id-stock" class="{visibleSolidaire} pro-detail"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Stock</div><table class="com-table-form"><tr><th class="com-table-form-th">Limite de stock : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-stock-choix" value="0" checked="checked"/>Pas de limite</td></tr><tr><th class="com-table-form-th"></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-stock-choix" value="1"/><input disabled="disabled" class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="pro-stock" maxlength="13" id="pro-qteRestante"/> <span class="unite-stock">{unite}</span></td></tr><tr><th class="com-table-form-th">Quantité max par adhérent : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-qte-max-choix" value="0" checked="checked"/>Pas de limite</td></tr><tr><th class="com-table-form-th"></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-qte-max-choix" value="1" /><input disabled="disabled" class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="pro-qte-max" maxlength="13" id="pro-qteMaxCommande"/> <span class="unite-stock">{unite}</span></td></tr></table></div>';this.stockAbonnementAjoutProduit='<div id="id-stock-abonnement"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Stock</div><table class="com-table-form"><tr><th class="com-table-form-th">Limite de stock : </th><td class="com-table-form-td"><span id="stock-abonnement">{stockInitialAbonnement}</span> {uniteAbonnement}</td></tr><tr><th class="com-table-form-th">Quantité max par adhérent : </th><td class="com-table-form-td"><span>{qMaxAbonnement}</span><span id="max-abonnement" class="ui-helper-hidden">{qMaxAbonnementValue}</span></td></tr></table></div>';this.typeProduitAjoutProduit='<div id="pro-typeProduit"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Type de produit</div><input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitNormal" value="0" {typeNormalSelected} /> Normal<input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitSolidaire" value="1" {typeSolidaireSelected}/> Solidaire{typeProduitAbonnement}</div>';this.typeProduitAbonnementAjoutProduit='<input class="ui-widget-content ui-corner-all" type="radio" name="typeProduit" id="pro-typeProduitAbonnement" value="2" {typeAbonnementSelected} /> Abonnement';this.prixEtStockAjoutProduit='<div id="prix-stock-produit">{divTypeProduit}<div id="pro-normal" class="{visibleNormal} pro-detail">{divLot}{divStock}</div><div id="pro-abonnement" class="{visibleAbonnement} pro-detail">{divLotAbonnement}{divStockAbonnement}</div></div>';this.modeleLot='<tr class="ligne-lot" id="ligne-lot-{id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{id}" name="pro-lot" id="pro-lot-{id}-id"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{id} lot-quantite" id="lot-{id}-quantite">{quantite}</span><input class="champ-lot-{id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-quantite" maxlength="13" id="pro-lot-{id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{id} lot-unite" id="lot-{id}-unite">{unite}</span><input class="champ-lot-{id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{id}-unite" maxlength="20" id="pro-lot-{id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{id} lot-prix" id="lot-{id}-prix">{prix}</span><input class="champ-lot-{id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-prix" maxlength="13" id="pro-lot-{id}-prix"/> {sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot" id="btn-valider-lot-{id}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot" id="btn-annuler-lot-{id}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot" id="btn-supprimer-lot-abonnement-{id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr>';this.modeleLotAbonnement='<tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{id}" name="pro-lot" id="pro-lot-{id}-id"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{id}-abonnement lot-quantite" id="lot-{id}-quantite-abonnement">{quantite}</span><input class="champ-lot-{id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-quantite" maxlength="13" id="pro-lot-abonnement{id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{id}-abonnement lot-unite" id="lot-{id}-unite-abonnement">{unite}</span><input disabled="disabled" class="champ-lot-{id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{id}-unite" maxlength="20" id="pro-lot-abonnement{id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{id}-abonnement lot-prix" id="lot-{id}-prix-abonnement">{prix}</span><input class="champ-lot-{id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-prix" maxlength="13" id="pro-lot-abonnement{id}-prix"/> {sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot-abonnement" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot-abonnement" id="btn-valider-lot-{id}-abonnement" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot-abonnement" id="btn-annuler-lot-{id}-abonnement" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot-abonnement" id="btn-supprimer-lot-abonnement-{id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr>';this.btnValiderAjoutMarche='<div id="btn-gestion-marche" class="com-widget-window ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-modifier-creation-commande" class="com-btn-edt-multiples ui-helper-hidden ui-state-default ui-corner-all com-button com-center">Modifier</button><button type="button" id="btn-creer-marche" class="ui-state-default ui-corner-all com-button com-center">Valider</button></div>';this.ajoutMarcheListeProduit='<div id="liste-ferme"><!-- BEGIN fermes --><div class="com-widget-window ui-widget ui-widget-content ui-corner-all" id="ferme-{fermes.ferId}"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">{fermes.ferNom}</div><!-- BEGIN fermes.categories --><table class="com-table"><tr class="ui-widget-header" ><td class="com-table-td-debut">{fermes.categories.cproNom}</td><td class="com-table-td-med"></td><td class="com-table-td-med"></td><td class="com-table-td-fin"></td></tr><!-- BEGIN fermes.categories.produits --><tr><td class="com-table-td-debut">{fermes.categories.produits.nproNom}</td><td class="com-table-td-med edt-marche-pro-unite">{fermes.categories.produits.abonnement}</td><td class="com-table-td-med td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-produit" title="Modifier" id-produit="{fermes.categories.produits.nproId}" typeProduit="{fermes.categories.produits.type}"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-produit" title="Supprimer" id-produit="{fermes.categories.produits.nproId}" typeProduit="{fermes.categories.produits.type}"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END fermes.categories.produits --></table><!-- END fermes.categories --></div><!-- END fermes --></div>';this.flagAbonnement='<span class="com-widget-header ui-widget ui-widget-header ui-corner-all">Abonnement</span>';this.flagSolidaire='<span class="com-widget-header ui-widget ui-widget-header ui-corner-all">Solidaire</span>';this.dialogModifProduitAjoutMarche='<div id="dialog-modif-pro" title="Produit"><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Le Produit</div><div id="pro-idFerme" class="com-float-left" id-ferme="{ferId}">{ferNom}</div><div id="pro-idCategorie" class="com-float-left" id-categorie="{cproId}">{cproNom}</div><div id="pro-idProduit" class="com-float-left" id-produit="{nproId}">{nproNom}</div></div><div id="prix-stock-produit"><div id="pro-typeProduit"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Type de produit</div>{typeProduitLabel}</div>{divLot}{divStock}</div></div>';this.prixModifProduit='<div id="div-lot"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-form" id="table-pro-prix"><tr><td class="catalogue-entete-lot">Quantité</td><td class="catalogue-entete-lot">Unité</td><td>Prix</td><td></td><td></td></tr><tr class="btn-lot"><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-quantite" maxlength="13" id="pro-lot-quantite"/></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all" type="text" name="lot-unite" maxlength="20" id="pro-lot-unite"/></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-prix" maxlength="13" id="pro-lot-prix"/> {sigleMonetaire}</td><td colspan="2"><button type="button" id="btn-ajout-lot" class="ui-state-default ui-corner-all com-button com-center">Ajouter un prix de vente</button></td></tr></table><table class="com-table" id="lot-liste"><!-- BEGIN modelesLotReservation --><tr class="ligne-lot" id="ligne-lot-{modelesLotReservation.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotReservation.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" checked="checked" disabled="disabled" value="{modelesLotReservation.id}" name="pro-lot" id="pro-lot-{modelesLotReservation.id}-id" {modelesLotReservation.checked} class="{modelesLotReservation.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotReservation.id} lot-quantite" id="lot-{modelesLotReservation.id}-quantite">{modelesLotReservation.quantite}</span><input class="champ-lot-{modelesLotReservation.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotReservation.id}-quantite" maxlength="13" id="pro-lot-{modelesLotReservation.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotReservation.id} lot-unite" id="lot-{modelesLotReservation.id}-unite">{modelesLotReservation.unite}</span><input class="champ-lot-{modelesLotReservation.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLotReservation.id}-unite" maxlength="20" id="pro-lot-{modelesLotReservation.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotReservation.id} lot-prix" id="lot-{modelesLotReservation.id}-prix">{modelesLotReservation.prix}</span><input class="champ-lot-{modelesLotReservation.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotReservation.id}-prix" maxlength="13" id="pro-lot-{modelesLotReservation.id}-prix"/> {modelesLotReservation.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot" id="btn-valider-lot-{modelesLotReservation.id}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot" id="btn-annuler-lot-{modelesLotReservation.id}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot"  id="btn-supprimer-lot-{modelesLotReservation.id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLotReservation --><!-- BEGIN modelesLot --><tr class="ligne-lot" id="ligne-lot-{modelesLot.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLot.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{modelesLot.id}" name="pro-lot" id="pro-lot-{modelesLot.id}-id" {modelesLot.checked} class="{modelesLot.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLot.id} lot-quantite" id="lot-{modelesLot.id}-quantite">{modelesLot.quantite}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLot.id}-quantite" maxlength="13" id="pro-lot-{modelesLot.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLot.id} lot-unite" id="lot-{modelesLot.id}-unite">{modelesLot.unite}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLot.id}-unite" maxlength="20" id="pro-lot-{modelesLot.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLot.id} lot-prix" id="lot-{modelesLot.id}-prix">{modelesLot.prix}</span><input class="champ-lot-{modelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLot.id}-prix" maxlength="13" id="pro-lot-{modelesLot.id}-prix"/> {modelesLot.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot" id="btn-valider-lot-{modelesLot.id}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot" id="btn-annuler-lot-{modelesLot.id}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot"  id="btn-supprimer-lot-{modelesLot.id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLot --><!-- BEGIN listeModelesLot --><tr class="ligne-lot" id="ligne-lot-modele-{listeModelesLot.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{listeModelesLot.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{listeModelesLot.id}" name="pro-lot" id="pro-lot-{listeModelesLot.id}-id" {listeModelesLot.checked} class="{listeModelesLot.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{listeModelesLot.id} lot-quantite" id="lot-{listeModelesLot.id}-quantite">{listeModelesLot.quantite}</span><input class="champ-lot-{listeModelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{listeModelesLot.id}-quantite" maxlength="13" id="pro-lot-{listeModelesLot.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{listeModelesLot.id} lot-unite" id="lot-{listeModelesLot.id}-unite">{listeModelesLot.unite}</span><input class="champ-lot-{listeModelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{listeModelesLot.id}-unite" maxlength="20" id="pro-lot-{listeModelesLot.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{listeModelesLot.id} lot-prix" id="lot-{listeModelesLot.id}-prix">{listeModelesLot.prix}</span><input class="champ-lot-{listeModelesLot.id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{listeModelesLot.id}-prix" maxlength="13" id="pro-lot-{listeModelesLot.id}-prix"/> {listeModelesLot.sigleMonetaire}</td><td class="com-table-td-med td-edt"></td><td class="com-table-td-fin td-edt"></td></tr><!-- END listeModelesLot --></table></div>';this.prixAbonnementModifProduit='<div id="div-lot-abonnement"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-form" id="table-pro-abonnement-prix"><tr><td class="catalogue-entete-lot">Quantité</td><td class="catalogue-entete-lot">Unité</td><td>Prix</td><td></td><td></td></tr><tr class="btn-lot-abonnement"><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-abo-quantite" maxlength="13" id="pro-abo-lot-quantite"/></td><td><span id="pro-abo-lot-unite">{uniteAbonnement}</span></td><td><input class="pro-form-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-abo-prix" maxlength="13" id="pro-abo-lot-prix"/> {sigleMonetaire}</td><td colspan="2"><button type="button" id="btn-ajout-lot-abonnement" class="ui-state-default ui-corner-all com-button com-center">Ajouter un prix de vente</button></td></tr></table><table class="com-table" id="lot-liste-abonnement"><!-- BEGIN modelesLotAbonnementReservation --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnementReservation.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnementReservation.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" checked="checked" disabled="disabled" value="{modelesLotAbonnementReservation.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnementReservation.id}-id" class="modele-lot-reservation"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnementReservation.id}-quantite-abonnement">{modelesLotAbonnementReservation.quantite}</span></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-unite" id="lot-{modelesLotAbonnementReservation.id}-unite-abonnement">{modelesLotAbonnementReservation.unite}</span></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnementReservation.id}-abonnement lot-prix" id="lot-{modelesLotAbonnementReservation.id}-prix-abonnement">{modelesLotAbonnementReservation.prix}</span> {modelesLotAbonnementReservation.sigleMonetaire}</td><td class="com-table-td-med td-edt"></td><td class="com-table-td-fin td-edt"></td></tr><!-- END modelesLotAbonnementReservation --><!-- BEGIN modelesLotAbonnementReservationModif --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnementReservationModif.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnementReservationModif.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" checked="checked" disabled="disabled" value="{modelesLotAbonnementReservationModif.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnementReservationModif.id}-id" {modelesLotAbonnementReservationModif.checked} class="{modelesLotAbonnementReservationModif.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnementReservationModif.id}-quantite-abonnement">{modelesLotAbonnementReservationModif.quantite}</span><input class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnementReservationModif.id}-quantite" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnementReservationModif.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement lot-unite" id="lot-{modelesLotAbonnementReservationModif.id}-unite-abonnement">{modelesLotAbonnementReservationModif.unite}</span><input disabled="disabled" class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLotAbonnementReservationModif.id}-unite" maxlength="20" id="pro-lot-abonnement{modelesLotAbonnementReservationModif.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement lot-prix" id="lot-{modelesLotAbonnementReservationModif.id}-prix-abonnement">{modelesLotAbonnementReservationModif.prix}</span><input class="champ-lot-{modelesLotAbonnementReservationModif.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnementReservationModif.id}-prix" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnementReservationModif.id}-prix"/> {modelesLotAbonnementReservationModif.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot-abonnement" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot-abonnement" id="btn-valider-lot-{modelesLotAbonnementReservationModif.id}-abonnement" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot-abonnement" id="btn-annuler-lot-{modelesLotAbonnementReservationModif.id}-abonnement" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot-abonnement" id="btn-supprimer-lot-abonnement-{modelesLotAbonnementReservationModif.id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLotAbonnementReservationModif --><!-- BEGIN modelesLotAbonnement --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-{modelesLotAbonnement.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{modelesLotAbonnement.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{modelesLotAbonnement.id}" name="pro-lot" id="pro-lot-{modelesLotAbonnement.id}-id" {modelesLotAbonnement.checked} class="{modelesLotAbonnement.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-quantite" id="lot-{modelesLotAbonnement.id}-quantite-abonnement">{modelesLotAbonnement.quantite}</span><input class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-quantite" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnement.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-unite" id="lot-{modelesLotAbonnement.id}-unite-abonnement">{modelesLotAbonnement.unite}</span><input disabled="disabled" class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-unite" maxlength="20" id="pro-lot-abonnement{modelesLotAbonnement.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{modelesLotAbonnement.id}-abonnement lot-prix" id="lot-{modelesLotAbonnement.id}-prix-abonnement">{modelesLotAbonnement.prix}</span><input class="champ-lot-{modelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{modelesLotAbonnement.id}-prix" maxlength="13" id="pro-lot-abonnement{modelesLotAbonnement.id}-prix"/> {modelesLotAbonnement.sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot-abonnement" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot-abonnement" id="btn-valider-lot-{modelesLotAbonnement.id}-abonnement" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot-abonnement" id="btn-annuler-lot-{modelesLotAbonnement.id}-abonnement" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot-abonnement com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot-abonnement" id="btn-supprimer-lot-abonnement-{modelesLotAbonnement.id}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END modelesLotAbonnement --><!-- BEGIN listeModelesLotAbonnement --><tr class="ligne-lot-abonnement" id="ligne-lot-abonnement-modele-{listeModelesLotAbonnement.id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{listeModelesLotAbonnement.id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="checkbox" value="{listeModelesLotAbonnement.id}" name="pro-lot" id="pro-lot-{listeModelesLotAbonnement.id}-id" {listeModelesLotAbonnement.checked} class="{listeModelesLotAbonnement.modele}"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{listeModelesLotAbonnement.id}-abonnement lot-quantite" id="lot-{listeModelesLotAbonnement.id}-quantite-abonnement">{listeModelesLotAbonnement.quantite}</span><input class="champ-lot-{listeModelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{listeModelesLotAbonnement.id}-quantite" maxlength="13" id="pro-lot-abonnement{listeModelesLotAbonnement.id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{listeModelesLotAbonnement.id}-abonnement lot-unite" id="lot-{listeModelesLotAbonnement.id}-unite-abonnement">{listeModelesLotAbonnement.unite}</span><input disabled="disabled" class="champ-lot-{listeModelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{listeModelesLotAbonnement.id}-unite" maxlength="20" id="pro-lot-abonnement{listeModelesLotAbonnement.id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{listeModelesLotAbonnement.id}-abonnement lot-prix" id="lot-{listeModelesLotAbonnement.id}-prix-abonnement">{listeModelesLotAbonnement.prix}</span><input class="champ-lot-{listeModelesLotAbonnement.id}-abonnement catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{listeModelesLotAbonnement.id}-prix" maxlength="13" id="pro-lot-abonnement{listeModelesLotAbonnement.id}-prix"/> {listeModelesLotAbonnement.sigleMonetaire}</td><td class="com-table-td-med td-edt"></td><td class="com-table-td-fin td-edt"></td></tr><!-- END listeModelesLotAbonnement --></table></div>';this.stockModifProduit='<div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Stock</div><table class="com-table-form"><tr><th class="com-table-form-th">Limite de stock : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-stock-choix" value="0" {nproStockCheckedNoLimit} />Pas de limite</td></tr><tr><th class="com-table-form-th"></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-stock-choix" value="1" {nproStockCheckedLimit} /><input {nproStockDisabled} class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" value="{nproStock}" name="pro-stock" maxlength="13" id="pro-qteRestante"/> <span class="unite-stock">{unite}</span></td></tr><tr><th class="com-table-form-th">Quantité max par adhérent : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-qte-max-choix" value="0" {nproQteMaxCheckedNoLimit} />Pas de limite</td></tr><tr><th class="com-table-form-th"></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="pro-qte-max-choix" value="1" {nproQteMaxCheckedLimit} /><input {nproQteMaxDisabled} class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" value="{nproQteMax}" name="pro-qte-max" maxlength="13" id="pro-qteMaxCommande"/> <span class="unite-stock">{unite}</span></td></tr></table>';this.dialogSupprimerLotModifierMarche='<div id="dialog-supp-lot" title="Supprimer le prix de vente"><div id="information-detail-producteur">Des réservations sont positionnées sur ce prix de vente.<br/>Veuillez préciser le nouveau prix de vente sur lequel se baseront ces réservations.</div><div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Prix de vente</div><table class="com-table-100" id="lot-liste"><!-- BEGIN modelesLot --><tr class="ligne-lot" id="ligne-lot-{modelesLot.id}"><td class="com-table-td-debut catalogue-ligne-lot-quantite td-edt"><input type="radio" value="{modelesLot.id}" name="pro-lot" id="pro-lot-{modelesLot.id}-id"/></td><td class="com-table-td-med catalogue-ligne-lot-quantite"><span class="champ-lot-{modelesLot.id} lot-quantite" id="lot-{modelesLot.id}-quantite">{modelesLot.quantite}</span></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{modelesLot.id} lot-unite" id="lot-{modelesLot.id}-unite">{modelesLot.unite}</span></td><td class="com-table-td-fin">à <span class="champ-lot-{modelesLot.id} lot-prix" id="lot-{modelesLot.id}-prix">{modelesLot.prix}</span> {modelesLot.sigleMonetaire}</td></tr><!-- END modelesLot --></table></div></div>';this.formulaireAjoutMarche='<div id="contenu"><div id="formulaire_ajout_commande_ext"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Nouveau Marché</div><div class="com-widget-content"><form id="formulaire-information-creation-commande"><table class="com-table-form"><tr><th class="com-table-form-th">Nom du Marché : </th><td class="com-table-form-td"><span id="nom-marche-span" class="ui-helper-hidden informations-marche"></span><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="nom" id="marche-nom" maxlength="100" /></td></tr><tr><th class="com-table-form-th">Début des Réservations * : </th><td class="com-table-form-td"><span id="date-debut-reservation-marche-span" class="ui-helper-hidden informations-marche"></span><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-debut-reservation" id="marche-dateDebutReservation" /></td><td class="com-table-form-td">à <span id="time-debut-reservation-marche-span" class="ui-helper-hidden informations-marche"></span><select name="heure-debut-reservation" id="marche-timeDebutReservation" class="informations-marche" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><span class="informations-marche">H</span> <select name="minute-debut-reservation" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Fin des Réservations * : </th><td class="com-table-form-td"><span id="date-fin-reservation-marche-span" class="ui-helper-hidden informations-marche"></span><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-fin-reservation" id="marche-dateFinReservation" /></td><td class="com-table-form-td">à <span id="time-fin-reservation-marche-span" class="ui-helper-hidden informations-marche"></span><select name="heure-fin-reservation" id="marche-timeFinReservation" class="informations-marche" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><span class="informations-marche">H</span> <select name="minute-fin-reservation" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Jour du marché * : </th><td class="com-table-form-td"><span id="date-debut-marche-span" class="ui-helper-hidden informations-marche"></span><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-debut" id="marche-dateMarcheDebut"/></td><td class="com-table-form-td">de <span id="time-debut-marche-span" class="ui-helper-hidden informations-marche"></span><select name="heure-debut" id="marche-timeMarcheDebut" class="informations-marche"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option selected="selected" value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><span class="informations-marche">H</span> <select name="minute-debut" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option selected="selected" value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td><td class="com-table-form-td">à <span id="time-fin-marche-span" class="ui-helper-hidden informations-marche"></span><select name="heure-fin" id="marche-timeMarcheFin" class="informations-marche"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option selected="selected" value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><span class="informations-marche">H</span> <select name="minute-fin" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Description : </th><td class="com-table-form-td"><span id="description-marche-span" class="ui-helper-hidden informations-marche"></span><textarea class="com-input-text ui-widget-content ui-corner-all informations-marche" name="description" id="marche-description" ></textarea></td></tr></table></form></div></div><div id="btn-ajout-produit-div" class="com-widget-window ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-ajout-produit" class="ui-state-default ui-corner-all com-button com-center">Ajouter un produit</button></div><div id="liste-ferme"></div></div></div>';this.listeCommandePage='<div id="contenu"><div id="liste_commande_int"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-archive"><span class="com-float-left">Les Marchés cloturés</span><span class="com-float-left ui-icon ui-icon-arrowthick-1-e"></span></button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés en cours<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-nv-marche" title="Ajouter un marché"><span class="ui-icon ui-icon-plusthick"></span></span></div><table class="com-table"><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut lst-resa-th-num">N°</th><th class="com-table-th-med">Marché</th>	<th class="com-table-th-med">Date de cloture des Réservations</th><th class="com-table-th-fin"></th></tr><!-- BEGIN commande --><tr class="com-cursor-pointer btn-marche" id="{commande.id}"><td class="com-table-td-debut com-text-align-right">{commande.numero} :</td><td class="com-table-td-med">Le {commande.dateMarcheDebut} de {commande.heureMarcheDebut}H{commande.minuteMarcheDebut} à {commande.heureMarcheFin}H{commande.minuteMarcheFin}</td><td class="com-table-td-med">Le {commande.dateFinReservation} à {commande.heureFinReservation}H{commande.minuteFinReservation}</td><td class="com-table-td-fin"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END commande --></table></div></div></div></div>';this.listeCommandeArchivePage='<div id="contenu"><div id="liste_commande_int"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-encours"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Les Marchés en cours</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés cloturés</div><div id="content-nav-liste-operation" class="ui-helper-clearfix ui-state-default ui-corner-all"><form>	<span id="icone-nav-liste-operation-w" class="prev ui-helper-hidden ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-w"></span></span>	<span id="page-compteur">Page : <span type="text" class="pagedisplay"></span></span>	<span id="icone-nav-liste-operation-e" class="next ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-e"></span></span>	<input type="hidden" class="pagesize" value="15"></form></div><table class="com-table" id="table-marche-archive"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut lst-resa-th-num com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th-med com-underline-hover com-cursor-pointer" ><span class="ui-icon span-icon"></span>Date de cloture des Réservations</th><th class="com-table-th-med com-underline-hover com-cursor-pointer" ><span class="ui-icon span-icon"></span>Marché</th>	<th class="com-table-th-fin"></th>	</tr></thead><tbody><!-- BEGIN commande --><tr class="com-cursor-pointer detail-commande-ligne" ><td class="com-table-td-debut com-text-align-right"><span class="ui-helper-hidden id-commande">{commande.id}</span>{commande.numero} :</td><td class="com-table-td-med"><span class="ui-helper-hidden">{commande.dateTimeFinResa}</span>Le {commande.dateFinReservation} à {commande.heureFinReservation}H{commande.minuteFinReservation}</td><td class="com-table-td-med"><span class="ui-helper-hidden">{commande.dateTimeMarche}</span>Le {commande.dateMarcheDebut} de {commande.heureMarcheDebut}H{commande.minuteMarcheDebut} à {commande.heureMarcheFin}H{commande.minuteMarcheFin}</td><td class="com-table-td-fin"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END commande --></tbody></table></div></div></div></div>';this.lotUnique='<input type="hidden" id="lot-{IdPdt}" value="{valeur}" /><span>{text}</span>';this.dialogClotureCommande='<div id="dialog-cloturer-com" title="Cloture du Marché n°{comNumero}"><p>Vous allez cloturer le Marché n°{comNumero}</p></div>';this.dialogExportListeAchatEtReservation='<div id="dialog-cloturer-com" title="Export des Achats et Réservations du marché n°{comNumero}"><p>Vous allez exporter les Achats et Réservations du Marché n°{comNumero}.<br/>Cette action peut être longue.</p></div>';this.dialogExportListeReservation='<div id="dialog-export-liste-reservation" title="Export des réservations en cours."><form><table><tr><td>Format de sortie : </td><td><input type="radio" name="format" value="0" checked="checked" />Pdf</td><td><input type="radio" name="format" value="1" />CSV</td></tr></table><div>Sélectionner les produits : </div><table class="com-table-100"><!-- BEGIN fermes --><tr class="ui-widget-header" ><td colspan="3" class="com-table-td">{fermes.ferNom}</td></tr><!-- BEGIN fermes.categories --><tr><td colspan="3" class="com-table-td">{fermes.categories.cproNom}</td></tr><!-- BEGIN fermes.categories.produits --><tr><td class="com-table-td-debut td-edt"><input type="checkbox" value="{fermes.categories.produits.id}" name="id_produits"/></td><td class="com-table-td-med">{fermes.categories.produits.nproNom}</td><td class="com-table-td-fin">{fermes.categories.produits.abonnement}</td></tr><!-- END fermes.categories.produits --><!-- END fermes.categories --><!-- END fermes --></table></form></div>';this.editerMarcheMenu='<div id="edt-com-nav-resa-achat"><span class="{infoMarcheSelected} com-cursor-pointer ui-widget-header ui-corner-tl com-btn-hover" id="btn-information-marche">Information</span><span class="{listeReservationSelected} com-cursor-pointer ui-widget-header com-btn-hover" id="btn-liste-resa">Reservations</span><span class="{listeAchatSelected} com-cursor-pointer ui-widget-header com-btn-hover" id="btn-liste-achat-resa">Achats</span><span class="{resumeMarcheSelected} com-cursor-pointer ui-widget-header ui-corner-tr com-btn-hover" id="btn-resume-marche">Resumé</span></div>';this.editerCommandePage='<div id="contenu">{editerMenu}<div id="edt-com-liste"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero}<span class="ui-helper-hidden marche-archive-1 com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-cloture-com" title="Cloturer"><span class="ui-icon ui-icon-locked"></span></span><span class="ui-helper-hidden marche-archive-1 com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-play-com" title="Ouvrir les ventes et réservations"><span class="ui-icon ui-icon-play"></span></span><span class="ui-helper-hidden marche-archive-0  com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-pause-com" title="Arrêter les ventes et réservations"><span class="ui-icon ui-icon-pause"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-modif-com" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-dupliquer-com" title="Dupliquer le marché"><span class="ui-icon ui-icon-copy"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-livraison-com" title="Bon de livraison"><span class="ui-icon ui-icon-cart"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-bon-com" title="Bon de commande"><span class="ui-icon ui-icon-document"></span></span></div><div>Réservations : Du <span id="edt-marche-dateDebutReservation">{dateDebutReservation}</span> à <span id="edt-marche-heureDebutReservation">{heureDebutReservation}</span>H<span id="edt-marche-minuteDebutReservation">{minuteDebutReservation}</span> au <span id="edt-marche-dateFinReservation">{dateFinReservation}</span> à <span id="edt-marche-heureFinReservation">{heureFinReservation}</span>H<span id="edt-marche-minuteFinReservation">{minuteFinReservation}</span> <br/>Marché : Le <span id="edt-marche-dateMarcheDebut">{dateMarcheDebut}</span> de <span id="edt-marche-heureMarcheDebut">{heureMarcheDebut}</span>H<span id="edt-marche-minuteMarcheDebut">{minuteMarcheDebut}</span> à <span id="edt-marche-heureMarcheFin">{heureMarcheFin}</span>H<span id="edt-marche-minuteMarcheFin">{minuteMarcheFin}</span></div></div><div id="btn-ajout-produit-div" class="com-widget-window ui-widget ui-widget-header ui-corner-all com-center"><button type="button" id="btn-ajout-produit" class="ui-state-default ui-corner-all com-button com-center">Ajouter un produit</button></div><div id="liste-ferme"></div></div></div>';this.listeReservation='<div id="contenu">{editerMenu}<div id="edt-com-liste" ><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Gestion des réservations<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-resa" title="Exporter les réservations"><span class="ui-icon ui-icon-print"></span></span></div><div id="edt-com-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></form></div><table class="com-table" id="edt-com-liste-resa"><thead><tr class="ui-widget ui-widget-header com-cursor-pointer"><th class="com-table-th-debut com-underline-hover"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th-med com-underline-hover"><span class="ui-icon span-icon"></span>Compte</th><th class="com-table-th-med com-underline-hover"><span class="ui-icon span-icon"></span>Nom</th>	<th class="com-table-th-med com-underline-hover"><span class="ui-icon span-icon"></span>Prénom</th><th class="com-table-th-fin"></th></tr></thead><tbody><!-- BEGIN listeAdherent --><tr class="com-cursor-pointer edt-com-reservation-ligne" ><td class="com-table-td-debut com-underline-hover"><span class="ui-helper-hidden">{listeAdherent.adhIdTri}</span><span class="ui-helper-hidden id-adherent">{listeAdherent.adhId}</span>{listeAdherent.adhNumero}</td><td class="com-table-td-med com-underline-hover">{listeAdherent.cptLabel}</td><td class="com-table-td-med com-underline-hover">{listeAdherent.adhNom}</td><td class="com-table-td-med com-underline-hover">{listeAdherent.adhPrenom}</td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END listeAdherent --></tbody></table></div></div></div>';this.listeAchatEtReservation='<div id="contenu">{editerMenu}<div id="edt-com-liste" ><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Liste des Achats et Réservations<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-achat" title="Exporter les Achats et les réservations"><span class="ui-icon ui-icon-print"></span></span></div><div id="edt-com-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></form></div><table class="com-table" id="edt-com-liste-resa"><thead><tr class="ui-widget ui-widget-header com-cursor-pointer"><th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Compte</th><th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Nom</th>	<th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Prénom</th><th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Réservation</th><th class="com-table-th com-underline-hover"><span class="ui-icon span-icon"></span>Achat</th></tr></thead><tbody><!-- BEGIN listeAchatEtReservation --><tr class="com-cursor-pointer edt-com-achat-ligne" ><td class="com-table-td com-underline-hover"><span class="ui-helper-hidden">{listeAchatEtReservation.adhIdTri}</span><span class="ui-helper-hidden id-adherent">{listeAchatEtReservation.adhId}</span>{listeAchatEtReservation.adhNumero}</td><td class="com-table-td com-underline-hover">{listeAchatEtReservation.cptLabel}</td><td class="com-table-td com-underline-hover">{listeAchatEtReservation.adhNom}</td><td class="com-table-td com-underline-hover">{listeAchatEtReservation.adhPrenom}</td><td class="com-table-td com-underline-hover">{listeAchatEtReservation.reservation}</td><td class="com-table-td com-underline-hover">{listeAchatEtReservation.achat}</td></tr><!-- END listeAchatEtReservation --></tbody></table></div></div></div>';this.listeAchatEtReservationVide='<div id="contenu">{editerMenu}<div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Liste des Achats et Réservations</div><p id="texte-liste-vide">Aucun adhérent sur ce marché.</p></div></div></div>';this.detailAchatEtReservation='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-annuler"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero}</div><div>Fin des réservations : Le {dateFinReservation} à {heureFinReservation}H{minuteFinReservation} <br/>Marché : Le {dateMarcheDebut} de {heureMarcheDebut}H{minuteMarcheDebut} à {heureMarcheFin}H{minuteMarcheFin}</div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Adhérent</div><div class="com-widget-content"><div id="resa-info-commande">{adhNumero} :  {adhPrenom} {adhNom}<br/>N° de Compte : {adhCompte}</div><div><span>Solde : </span><span>{adhSolde} {sigleMonetaire}</span></div><div class="com-clear-float-left"></div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">La réservation : <span class="resa-etat" id="reservation-etat-label">{etatReservation}</span><span class="resa-etat ui-helper-hidden"><select id="reservation-etat"><!-- BEGIN typeEtatReservation --><option value="{typeEtatReservation.value}" {typeEtatReservation.selected}>{typeEtatReservation.label}</option><!-- END typeEtatReservation --></select></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all modif-resa ui-helper-hidden" id="btn-modif-resa" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden modif-resa" id="btn-check-resa" title="Valider"><span class="ui-icon ui-icon-check"></span></span></div><table><!-- BEGIN reservation --><tr class="ligne-produit-reservation"><td class="detail-resa-npro"><span class="ui-helper-hidden produit-id">{reservation.id}</span>{reservation.nproNom}</td><td>{reservation.flagType}</td><td class="com-text-align-right detail-resa-qte" id="reservation-{reservation.id}-quantite">{reservation.stoQuantite}</td><td class="com-text-align-right detail-resa-qte ui-helper-hidden"><input type="text" value="{reservation.stoQuantite}" class="com-numeric produit-quantite com-input-text ui-widget-content ui-corner-all" id="reservation-produits{reservation.id}quantite" maxlength="12" size="3"/></td><td class="detail-resa-unite">{reservation.proUniteMesure}</td><td class="com-text-align-right detail-resa-prix" id="reservation-{reservation.id}-prix">{reservation.prix}</td><td class="com-text-align-right detail-resa-prix ui-helper-hidden"><input type="text" value="{reservation.prix}" class="com-numeric produit-prix com-input-text ui-widget-content ui-corner-all" id="reservation-produits{reservation.id}prix" maxlength="12" size="3"/></td><td>{sigleMonetaire}</td></tr><!-- END reservation --><tr><td class="com-text-align-right" colspan="4">Total : </td><td class="com-text-align-right resa-total" id="reservation-total-label">{totalReservation}</td><td class="com-text-align-right resa-total ui-helper-hidden"><input type="text" value="{totalReservation}" class="com-numeric com-input-text ui-widget-content ui-corner-all" id="reservation-total" maxlength="12" size="3"/></td><td>{sigleMonetaire}</td></tr></table></div><!-- BEGIN achats --><div class="achat com-widget-window ui-widget ui-widget-content ui-corner-all" id="achat-{achats.idAchat}"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Achat <span class="achat-id ui-helper-hidden">{achats.idAchat}</span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all modif-achat-{achats.idAchat}" id="btn-supp-achat-{achats.idAchat}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all modif-achat-{achats.idAchat}" id="btn-modif-achat-{achats.idAchat}" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden modif-achat-{achats.idAchat}" id="btn-annuler-achat-{achats.idAchat}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden modif-achat-{achats.idAchat}" id="btn-check-achat-{achats.idAchat}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></div><table><!-- BEGIN achats.achat --><tr class="ligne-produit-achat-{achats.idAchat}"><td class="detail-resa-npro"><span class="ui-helper-hidden produit-id">{achats.achat.id}</span>{achats.achat.nproNom}</td><td>{achats.achat.flagType}</td><td class="com-text-align-right detail-achat-{achats.idAchat}-qte" id="achat-{achats.idAchat}-{achats.achat.id}-quantite">{achats.achat.stoQuantite}</td><td class="com-text-align-right detail-achat-{achats.idAchat}-qte ui-helper-hidden"><input type="text" value="{achats.achat.stoQuantite}" class="com-numeric produit-quantite com-input-text ui-widget-content ui-corner-all" id="achat-{achats.idAchat}-produits{achats.achat.id}quantite" maxlength="12" size="3"/></td><td class="detail-resa-unite">{achats.achat.proUniteMesure}</td><td class="com-text-align-right detail-achat-{achats.idAchat}-prix" id="achat-{achats.idAchat}-{achats.achat.id}-prix">{achats.achat.prix}</td><td class="com-text-align-right detail-achat-{achats.idAchat}-prix ui-helper-hidden"><input type="text" value="{achats.achat.prix}" class="com-numeric produit-prix com-input-text ui-widget-content ui-corner-all" id="achat-{achats.idAchat}-produits{achats.achat.id}prix" maxlength="12" size="3"/></td><td>{sigleMonetaire}</td></tr><!-- END achats.achat --><tr><td class="com-text-align-right" colspan="4">Total : </td><td class="com-text-align-right achat-{achats.idAchat}-total" id="achat-{achats.idAchat}-total-label">{achats.total}</td><td class="com-text-align-right achat-{achats.idAchat}-total ui-helper-hidden"><input type="text" value="{achats.total}" class="com-numeric com-input-text ui-widget-content ui-corner-all" id="achat-{achats.idAchat}-total" maxlength="12" size="3"/></td><td>{sigleMonetaire}</td></tr></table></div><!-- END achats --><!-- BEGIN achatsSolidaire --><div class="achatSolidaire com-widget-window ui-widget ui-widget-content ui-corner-all" id="achat-{achatsSolidaire.idAchat}"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Achat Solidaire <span class="achat-id ui-helper-hidden">{achatsSolidaire.idAchat}</span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all modif-achat-{achatsSolidaire.idAchat}" id="btn-supp-achat-{achatsSolidaire.idAchat}" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all modif-achat-{achatsSolidaire.idAchat}" id="btn-modif-achat-{achatsSolidaire.idAchat}" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden modif-achat-{achatsSolidaire.idAchat}" id="btn-annuler-achat-{achatsSolidaire.idAchat}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden modif-achat-{achatsSolidaire.idAchat}" id="btn-check-achat-{achatsSolidaire.idAchat}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></div><table><!-- BEGIN achatsSolidaire.achat --><tr class="ligne-produit-achat-{achatsSolidaire.idAchat}"><td class="detail-resa-npro"><span class="ui-helper-hidden produit-id">{achatsSolidaire.achat.id}</span>{achatsSolidaire.achat.nproNom}</td><td>{achatsSolidaire.achat.flagType}</td><td class="com-text-align-right detail-achat-{achatsSolidaire.idAchat}-qte" id="achat-{achatsSolidaire.idAchat}-{achatsSolidaire.achat.id}-quantite">{achatsSolidaire.achat.stoQuantite}</td><td class="com-text-align-right detail-achat-{achatsSolidaire.idAchat}-qte ui-helper-hidden"><input type="text" value="{achatsSolidaire.achat.stoQuantite}" class="com-numeric produit-quantite com-input-text ui-widget-content ui-corner-all" id="achat-{achatsSolidaire.idAchat}-produits{achatsSolidaire.achat.id}quantite" maxlength="12" size="3"/></td><td class="detail-resa-unite">{achatsSolidaire.achat.proUniteMesure}</td><td class="com-text-align-right detail-achat-{achatsSolidaire.idAchat}-prix" id="achat-{achatsSolidaire.idAchat}-{achatsSolidaire.achat.id}-prix">{achatsSolidaire.achat.prix}</td><td class="com-text-align-right detail-achat-{achatsSolidaire.idAchat}-prix ui-helper-hidden"><input type="text" value="{achatsSolidaire.achat.prix}" class="com-numeric produit-prix com-input-text ui-widget-content ui-corner-all" id="achat-{achatsSolidaire.idAchat}-produits{achatsSolidaire.achat.id}prix" maxlength="12" size="3"/></td><td>{sigleMonetaire}</td></tr><!-- END achatsSolidaire.achat --><tr><td class="com-text-align-right" colspan="4">Total : </td><td class="com-text-align-right achat-{achatsSolidaire.idAchat}-total" id="achat-{achatsSolidaire.idAchat}-total-label">{achatsSolidaire.totalSolidaire}</td><td class="com-text-align-right achat-{achatsSolidaire.idAchat}-total ui-helper-hidden"><input type="text" value="{achatsSolidaire.totalSolidaire}" class="com-numeric com-input-text ui-widget-content ui-corner-all" id="achat-{achatsSolidaire.idAchat}-total" maxlength="12" size="3"/></td><td>{sigleMonetaire}</td></tr></table></div><!-- END achatsSolidaire --></div>';this.supprimerReservationDialog='<div id="dialog-supprimer-reservation" title="Supprimer la réservation"><p>Voulez-vous supprimer la réservation ?</p></div>';this.dialogSupprimerAchat='<div title="Supprimer la réservation"><p>Voulez-vous supprimer cet achat ?</p></div>';this.detailReservation='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-annuler"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero}</div><div>Fin des réservations : Le {dateFinReservation} à {heureFinReservation}H{minuteFinReservation} <br/>Marché : Le {dateMarcheDebut} de {heureMarcheDebut}H{minuteMarcheDebut} à {heureMarcheFin}H{minuteMarcheFin}</div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Adhérent</div><div class="com-widget-content"><div id="resa-info-commande">{adhNumero} :  {adhPrenom} {adhNom}<br/>N° de Compte : {adhCompte}</div><div><span>Solde Actuel : </span><span>{adhSolde} {sigleMonetaire}</span></div><div class="com-clear-float-left"></div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">La réservation</div><table><!-- BEGIN categories --><td class="ui-widget-header ui-corner-all com-center">{categories.nom}</td><td colspan="6"></td><!-- BEGIN categories.produits --><tr ><td class="detail-resa-npro">{categories.produits.nproNom}</td><td class="td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-info-produit" title="Information sur le produit" id-produit="{categories.produits.proId}"><span class="ui-icon ui-icon-info"></span></span></td><td>{categories.produits.flagType}</td><td class="com-text-align-right detail-resa-qte">{categories.produits.stoQuantite}</td><td class="detail-resa-unite">{categories.produits.proUniteMesure}</td><td class="com-text-align-right detail-resa-prix">{categories.produits.prix}</td><td>{sigleMonetaire}</td></tr><!-- END categories.produits --><!-- END categories --><tr><td class="com-text-align-right" colspan="5">Total : </td><td class="com-text-align-right">{total}</td><td>{sigleMonetaire}</td></tr></table></div><div class="boutons-edition com-widget-header ui-widget ui-widget-header ui-corner-all com-center"><button class="com-btn-edt-multiples ui-state-default ui-corner-all com-button com-center" id="btn-modifier">Modifier</button><button class="ui-state-default ui-corner-all com-button com-center" id="btn-supprimer">Supprimer</button></div></div>';this.modifierReservation='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Marché n°{comNumero}</div><div>Fin des réservations : Le {dateFinReservation} à {heureFinReservation}H{minuteFinReservation} <br/>Marché : Le {dateMarcheDebut} de {heureMarcheDebut}H{minuteMarcheDebut} à {heureMarcheFin}H{minuteMarcheFin}</div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Adhérent</div><div class="com-widget-content"><div id="resa-info-commande">{adhNumero} :  {adhPrenom} {adhNom}<br/>N° de Compte : {adhCompte}</div><div><span>Solde Actuel : </span><span>{adhSolde} {sigleMonetaire}</span><br/><span>Nouveau Solde : </span><span id="nouveau-solde">{adhNouveauSolde}</span> <span id="nouveau-solde-sigle">{sigleMonetaire}</span></div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">La réservation</div><div><table><!-- BEGIN categories --><tr><td colspan="4" class="ui-widget-header ui-corner-all com-center">{categories.nom}</td><td colspan="7"></td></tr><!-- BEGIN categories.produits -->{categories.produits.detailProduit}<!-- END categories.produits --><!-- END categories --><tr><td colspan="10" class="com-text-align-right">Total : </td><td class="com-text-align-right detail-resa-prix"><span id="total">{total}</span> {sigleMonetaire}</td></tr></table></div></div><div class="boutons-edition-modification com-widget-header ui-widget ui-widget-header ui-corner-all com-center"><button class="com-btn-edt-multiples ui-state-default ui-corner-all com-button com-center" id="btn-annuler">Annuler</button><button class="ui-state-default ui-corner-all com-button com-center" id="btn-valider">Valider</button></div></div>';this.formReservationProduit='<tr class="pdt"><td><input type="checkbox" {checked}/></td><td><span class="ui-helper-hidden"><span class="pdt-id">{proId}</span></span></td><td id="commandes{proId}stoQuantite" >{nproNom}</td><td class="td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-info-produit" title="Information sur le produit" id-produit="{proId}"><span class="ui-icon ui-icon-info"></span></span></td><td><select id="lot-{proId}"><!-- BEGIN lot --><option value="{lot.dcomId}">par {lot.dcomTaille} {proUniteMesure}</option><!-- END lot --></select></td><td>à <span id="prix-unitaire-{proId}">{prixUnitaire}</span> {sigleMonetaire}/{proUniteMesure}</td><td>{flagType}</td><td class="ui-helper-hidden resa-pdt-{proId}"><button class="btn-moins">-</button></td><td class="ui-helper-hidden resa-pdt-{proId}"><span id="qte-pdt-{proId}"></span> {proUniteMesure}</td><td class="ui-helper-hidden resa-pdt-{proId}"><button class="btn-plus">+</button></td><td class="ui-helper-hidden resa-pdt-{proId} com-text-align-right"><span id="prix-pdt-{proId}"></span> {sigleMonetaire}</td></tr>';this.formReservationProduitInfo='<tr class="pdt"><td></td><td><span class="ui-helper-hidden"><span class="pdt-id">{proId}</span></span></td><td id="commandes{proId}stoQuantite" >{nproNom}</td><td class="td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-info-produit" title="Information sur le produit" id-produit="{proId}"><span class="ui-icon ui-icon-info"></span></span></td><td><select id="lot-{proId}"><!-- BEGIN lot --><option value="{lot.dcomId}">par {lot.dcomTaille} {proUniteMesure}</option><!-- END lot --></select></td><td>à <span id="prix-unitaire-{proId}">{prixUnitaire}</span> {sigleMonetaire}/{proUniteMesure}</td><td>{flagType}</td><td></td><td></td><td></td><td></td></tr>';this.formReservationProduitAbonnementInfo='<tr class="pdt"><td></td><td><span class="ui-helper-hidden"><span class="pdt-id">{proId}</span></span></td><td id="commandes{proId}stoQuantite" >{nproNom}</td><td class="td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-info-produit" title="Information sur le produit" id-produit="{proId}"><span class="ui-icon ui-icon-info"></span></span></td><td><select id="lot-{proId}"><!-- BEGIN lot --><option value="{lot.dcomId}">par {lot.dcomTaille} {proUniteMesure}</option><!-- END lot --></select></td><td>à <span id="prix-unitaire-{proId}">{prixUnitaire}</span> {sigleMonetaire}/{proUniteMesure}</td><td>{flagType}</td><td></td><td>{stoQuantiteReservation} {proUniteMesure}</td><td></td><td class="com-text-align-right">{prixReservation} {sigleMonetaire}</td></tr>';this.listeCommandeVide='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-archive"><span class="com-float-left">Les Marchés cloturés</span><span class="com-float-left ui-icon ui-icon-arrowthick-1-e"></span></button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés en cours<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-nv-marche" title="Ajouter un marché"><span class="ui-icon ui-icon-plusthick"></span></span></div><p id="texte-liste-vide">Aucun Marché en cours.</p></div></div>';this.listeCommandeArchiveVide='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="lien-marche-encours"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Les Marchés en cours</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Marchés en cloturés</div><p id="texte-liste-vide">Aucun Marché cloturé.</p></div></div>';this.listeReservationVide='<div id="contenu">{editerMenu}<div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Gestion des réservations</div><p id="texte-liste-vide">Aucune réservation.</p></div></div></div>';this.dialogEnregistrement='<div title="Enregistrer les modifications"><p>Vous n\'avez pas enregistré vos modifications.</p></div>';this.dialogExportBonDeCommande='<div id="dialog-export-bon-commande" title="Export du Bon de Commande du Marché n°{comNumero}"><form><table><tr><td>Format de sortie : </td><td><input type="radio" name="format" value="0" checked="checked" />Pdf</td><td><input type="radio" name="format" value="1" />CSV</td></tr></table></form></div>';this.bonDeCommande='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-editer-com"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Bon de commande du Marché n°{comNumero}<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-bcom" title="Exporter le bon de commande"><span class="ui-icon ui-icon-print"></span></span></div><div><form><span>Producteur : <select id="select-prdt"><option value="0" >== Choisir une ferme ==</option><!-- BEGIN producteurs --><option value="{producteurs.proIdCompteFerme}">{producteurs.ferNom}</option><!-- END producteurs --></select></span></form></div><div id="liste-pdt"></div></div></div>';this.listeProduitVide='<div id="liste-pdt"></div>';this.listeProduitBonDeCommande='<div id="liste-pdt"><table class="com-table-100"><thead><tr><th>Ref</th><th>Produit</th><th colspan="2" class="com-center">Réservation</th><th colspan="2" class="com-center">Commande</th><th colspan="2" class="com-center">Prix</th><th>État</th></tr></thead><tbody><!-- BEGIN produits --><tr><td>{produits.nproNumero}</td><td>{produits.nproNom}</td><td class="com-text-align-right">{produits.stoQuantite}</td><td> {produits.proUniteMesure}</td><td class="com-text-align-right"><span class="pro-id ui-helper-hidden">{produits.proId}</span><input class="formulaire qte-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" size="3" name="qte-commande-{produits.proId}" maxlength="11" value="{produits.stoQuantiteCommande}" id="produits{produits.proId}quantite"/><span class="detail">{produits.stoQuantiteCommande}</span></td><td> {produits.proUniteMesure}</td><td class="com-text-align-right"><input class="formulaire prix-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" size="3" name="prix-commande-{produits.proId}" maxlength="11" value="{produits.dopeMontant}" id="produits{produits.proId}prix" /><span class="detail">{produits.dopeMontant}</span></td><td> {sigleMonetaire}</td><td><div id="etat-commande-{produits.proId}" class="{produits.classEtat} ui-corner-all"></div></td></tr><!-- END produits --></tbody></table><div class="com-center"><button class="ui-helper-hidden com-btn-edt-multiples ui-state-default ui-corner-all com-button" id="btn-annuler">Annuler</button><button class="formulaire ui-state-default ui-corner-all com-button" id="btn-enregistrer">Enregistrer</button><button class="detail ui-state-default ui-corner-all com-button" id="btn-modifier">Modifier</button></div></div>';this.dialogExportBonDeLivraison='<div id="dialog-export-livraison" title="Export du bon de livraison du Marché n°{comNumero}"><form><table><tr><td>Format de sortie : </td><td><input type="radio" name="format" value="0" checked="checked" />Pdf</td><td><input type="radio" name="format" value="1" />CSV</td></tr></table></form></div>';this.bonDeLivraison='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-editer-com"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Retour au Marché</button></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Bon de Livraison du Marché n°{comNumero}<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-export-bcom" title="Exporter le bon de livraison"><span class="ui-icon ui-icon-print"></span></span></div><div><form><span>Producteur : <select id="select-prdt"><option value="0" >== Choisir une ferme ==</option><!-- BEGIN producteurs --><option value="{producteurs.proIdCompteFerme}">{producteurs.ferNom}</option><!-- END producteurs --></select></span></form></div><div id="liste-pdt"></div></div></div>';this.listeProduitLivraison='<div id="liste-pdt"><table class="com-table-100"><thead><tr><th>Ref</th><th>Produit</th><th colspan="2" class="com-center">Réservation</th><th colspan="2" class="com-center">Commande</th><th colspan="2" class="com-center">Prix</th><th colspan="2" class="com-center">Livraison</th><th colspan="2" class="com-center">Prix</th><th colspan="2" class="com-center">Solidaire</th><th>État</th></tr></thead><tbody><!-- BEGIN produits --><tr><td>{produits.nproNumero}</td><td>{produits.nproNom}</td><td class="com-text-align-right">{produits.stoQuantite}</td><td> {produits.proUniteMesure}</td><td class="com-text-align-right">{produits.stoQuantiteCommande}</td><td> {produits.proUniteMesure}</td><td class="com-text-align-right">{produits.opeMontantCommande}</td><td> {sigleMonetaire}</td><td class="com-text-align-right"><span class="pro-id pro-id-etat ui-helper-hidden">{produits.proId}</span><input class="{produits.masquerNormal} formulaire input-bon-livraison qte-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="qte-commande-{produits.proId}" maxlength="11" value="{produits.stoQuantiteLivraison}" id="produits{produits.proId}quantite"/><span class="detail {produits.masquerNormal}">{produits.stoQuantiteLivraison}</span></td><td> <span class="{produits.masquerNormal}">{produits.proUniteMesure}</span></td><td class="com-text-align-right"><input class="{produits.masquerNormal} formulaire input-bon-livraison prix-commande com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="prix-commande-{produits.proId}" maxlength="11" value="{produits.opeMontantLivraison}" id="produits{produits.proId}prix" /><span class="detail {produits.masquerNormal}">{produits.opeMontantLivraison}</span></td><td> <span class="{produits.masquerNormal}">{sigleMonetaire}</span></td><td><span class="pro-id-etat ui-helper-hidden">{produits.proId}</span><input class="formulaire qte-solidaire-commande input-bon-livraison com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="qte-solidaire-commande-{produits.proId}" maxlength="11" value="{produits.stoQuantiteSolidaire}" id="produits{produits.proId}quantiteSolidaire" /><span class="detail">{produits.stoQuantiteSolidaire}</span></td><td> {produits.proUniteMesure}</td><td><div id="etat-commande-{produits.proId}" class="{produits.classEtat} ui-corner-all"></div></td></tr><!-- END produits --></tbody><tfoot><tr><td colspan="4"></td><td colspan="2">Total :</td><td>{totalCommande}</td><td> {sigleMonetaire}</td><td></td><td></td><td><input class="formulaire input-bon-livraison com-numeric com-input-text ui-widget-content ui-corner-all" type="text" name="total" maxlength="11" value="{total}" id="total" /><span class="detail">{total}</span></td><td> {sigleMonetaire}</td><td colspan="3"><select class="formulaire" name="typepaiement" id="typePaiement"><option value="0">== Choisir le paiement ==</option><!-- BEGIN typePaiement --><option value="{typePaiement.tppId}">{typePaiement.tppType}</option><!-- END typePaiement --></select><span class="detail">{tppType}</span></td></tr><tr id="tr-champ-complementaire"><td colspan="10"></td><td colspan="2"><span id="label-champ-complementaire" ></span></td><td colspan="3"><input type="text" name="champ-complementaire" value="{champComplementaire}" class="formulaire com-input-text ui-widget-content ui-corner-all" id="typePaiementChampComplementaire" maxlength="50" size="15"/><span class="detail">{champComplementaire}</span></td></tr></tfoot></table><div class="com-center"><button class="ui-helper-hidden com-btn-edt-multiples ui-state-default ui-corner-all com-button" id="btn-annuler">Annuler</button><button class="formulaire ui-state-default ui-corner-all com-button" id="btn-enregistrer">Enregistrer</button><button class="detail ui-state-default ui-corner-all com-button" id="btn-modifier">Modifier</button></div></div>';this.infoCommandeArchive='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Détail du Marché n°{numero}<span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all" id="btn-dupliquer-com" title="Dupliquer le marché"><span class="ui-icon ui-icon-copy"></span></span></div><div><div class="com-center" id="resultat-marche-archive"><span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Marché : {total} {sigleMonetaire}</span>    <span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Solidaire : {totalSolidaire} {sigleMonetaire}</span></div><table class="com-table" id="info-marche-archive"><thead><tr><th></th><th class="com-table-th ui-widget ui-widget-header" colspan="5">Achat</th><th class="com-table-th ui-widget ui-widget-header" colspan="4">Vente</th></tr><tr class="ui-widget ui-widget-header"><th class="com-table-th">Produit</th><th class="com-table-th">Qté Commande</th><th class="com-table-th">Prix Commande</th><th class="com-table-th">Qté Livraison</th><th class="com-table-th">Prix Livraison</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Qté Vente</th><th class="com-table-th">Prix Vente</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Prix Solidaire</th></tr></thead><tbody><!-- BEGIN infoCommande --><tr><td class="com-table-td">{infoCommande.nproNom}</td><td class="com-table-td">{infoCommande.stoQuantite} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontant} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteLivraison} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantLivraison} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.stoQuantiteVente} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVente} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteVenteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVenteSolidaire} {sigleMonetaire}</td></tr><!-- END infoCommande --></tbody></table></div></div></div>';this.resumeMarche='<div id="contenu">{editerMenu}<div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Détail du Marché n°{numero}</div><div><div class="com-center" id="resultat-marche-archive"><span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Marché : {total} {sigleMonetaire}</span>    <span class="ui-widget ui-widget-header com-table-th">Résultat Zeybu Solidaire : {totalSolidaire} {sigleMonetaire}</span></div><table class="com-table" id="info-marche-archive"><thead><tr><th></th><th class="com-table-th ui-widget ui-widget-header" colspan="5">Achat</th><th class="com-table-th ui-widget ui-widget-header" colspan="4">Vente</th></tr><tr class="ui-widget ui-widget-header"><th class="com-table-th">Produit</th><th class="com-table-th">Qté Commande</th><th class="com-table-th">Prix Commande</th><th class="com-table-th">Qté Livraison</th><th class="com-table-th">Prix Livraison</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Qté Vente</th><th class="com-table-th">Prix Vente</th><th class="com-table-th">Qté Solidaire</th><th class="com-table-th">Prix Solidaire</th></tr></thead><tbody><!-- BEGIN infoCommande --><tr><td class="com-table-td">{infoCommande.nproNom}</td><td class="com-table-td">{infoCommande.stoQuantite} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontant} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteLivraison} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantLivraison} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.stoQuantiteVente} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVente} {sigleMonetaire}</td><td class="com-table-td">{infoCommande.stoQuantiteVenteSolidaire} {infoCommande.proUniteMesure}</td><td class="com-table-td">{infoCommande.opeMontantVenteSolidaire} {sigleMonetaire}</td></tr><!-- END infoCommande --></tbody></table></div></div></div>';this.produitIndisponible='<tr><td colspan="11">Le produit {nom} n\'est plus disponible.</td></tr>';this.lotUnique='<input type="hidden" id="lot-{IdPdt}" value="{valeur}" /><span>{text}</span>';this.editerMarcheListeProduit='<div id="liste-ferme"><!-- BEGIN fermes --><div class="com-widget-window ui-widget ui-widget-content ui-corner-all" id="ferme-{fermes.ferId}"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">{fermes.ferNom}</div><!-- BEGIN fermes.categories --><table class="com-table-100"><tr class="ui-widget-header" ><td class="com-table-td-debut">{fermes.categories.cproNom}</td><td class="com-table-td-med"></td><td class="com-table-td-med"></td><td class="com-table-td-med"></td><td class="com-table-td-fin"></td></tr><!-- BEGIN fermes.categories.produits --><tr><td class="com-table-td-debut">{fermes.categories.produits.nproNom}</td><td class="com-table-td-med edt-marche-pro-unite">{fermes.categories.produits.abonnement}</td><td class="com-table-td-med edt-marche-pro-unite">{fermes.categories.produits.qteReservation} {fermes.categories.produits.nproUnite}</td><td class="com-table-td-med td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-produit" title="Modifier" id-produit="{fermes.categories.produits.id}" typeProduit="{fermes.categories.produits.type}"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-produit" title="Supprimer" id-produit="{fermes.categories.produits.id}" qte-reservation="{fermes.categories.produits.qteReservation}" typeProduit="{fermes.categories.produits.type}" ><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END fermes.categories.produits --></table><!-- END fermes.categories --></div><!-- END fermes --></div>';"<!-- END fermes --></div>";this.dialogModifierInfoMarche='<div id="dialog-modif-pro" title="Produit"><div class="com-widget-content"><form id="formulaire-information-creation-commande"><table class="com-table-form"><tr><th class="com-table-form-th">Nom du Marché : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="nom" id="marche-nom" maxlength="100" value="{nom}"/></td></tr><tr><th class="com-table-form-th">Début des Réservations * : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-debut-reservation" id="marche-dateDebutReservation" value="{dateDebutReservation}"/></td><td class="com-table-form-td">à <select name="heure-debut-reservation" id="marche-timeDebutReservation" class="informations-marche" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><select name="minute-debut-reservation" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Fin des Réservations * : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-fin-reservation" id="marche-dateFinReservation" value="{dateFinReservation}"/></td><td class="com-table-form-td">à <select name="heure-fin-reservation" id="marche-timeFinReservation" class="informations-marche" ><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><select name="minute-fin-reservation" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Jour du marché * : </th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all informations-marche" type="text" name="date-debut" id="marche-dateMarcheDebut" value="{dateMarcheDebut}"/></td><td class="com-table-form-td">de <select name="heure-debut" id="marche-timeMarcheDebut" class="informations-marche"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><select name="minute-debut" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td><td class="com-table-form-td">à <select name="heure-fin" id="marche-timeMarcheFin" class="informations-marche"><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select><select name="minute-fin" class="informations-marche"><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></td></tr><tr><th class="com-table-form-th">Description : </th><td class="com-table-form-td"><textarea class="com-input-text ui-widget-content ui-corner-all informations-marche" name="description" id="marche-description" >{comDescription}</textarea></td></tr></table></form></div></div>';this.dialogSupprimerProduit='<div id="dialog-supprimer-produit" title="Supprimer le produit du marché"><p>Des réservations sont présentes sur ce produit.<br/>Voulez-vous toujours le supprimer ?</p></div>';this.dialogInfoProduit='<div id="dialog-info-pro" title="Produit"><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Informations</div><div class="com-widget-content"><table class="com-table-form"><tr><th class="com-table-form-th">Nom : </th><td class="com-table-form-td">{nom}</td></tr><tr><th class="com-table-form-th">Catégorie : </th><td class="com-table-form-td">{cproNom}</td></tr><tr><th class="com-table-form-th">Description : </th><td class="com-table-form-td">{description}</td></tr></table></div></div><div id="pro-prdt"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Producteurs</div><table class="com-table-form"><!-- BEGIN producteurs --><tr><td class="com-table-form-td">{producteurs.prdtPrenom} {producteurs.prdtNom}</td></tr><!-- END producteurs --></table></div><div id="pro-car"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Caractéristiques</div><table class="com-table-form"><!-- BEGIN caracteristiques --><tr><td class="com-table-form-td">{caracteristiques.carNom}</td></tr><!-- END caracteristiques --></table></div></div>'}function GestionListeCommandeVue(a){this.construct=function(b){$.history({vue:function(){GestionListeCommandeVue(b)}});var c=this;$.post("./index.php?m=GestionCommande&v=ListeCommande",function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var c=this;var b=new GestionCommandeTemplate();if(d.listeCommande.length>0&&d.listeCommande[0].comId!=null){var e=new Object;e.commande=new Array();$(d.listeCommande).each(function(){var g=new Object();g.id=this.comId;g.numero=this.comNumero;g.dateFinReservation=this.comDateFinReservation.extractDbDate().dateDbToFr();g.heureFinReservation=this.comDateFinReservation.extractDbHeure();g.minuteFinReservation=this.comDateFinReservation.extractDbMinute();g.dateMarcheDebut=this.comDateMarcheDebut.extractDbDate().dateDbToFr();g.heureMarcheDebut=this.comDateMarcheDebut.extractDbHeure();g.minuteMarcheDebut=this.comDateMarcheDebut.extractDbMinute();g.heureMarcheFin=this.comDateMarcheFin.extractDbHeure();g.minuteMarcheFin=this.comDateMarcheFin.extractDbMinute();e.commande.push(g)});var f=b.listeCommandePage;$("#contenu").replaceWith(c.affect($(f.template(e))))}else{$("#contenu").replaceWith(c.affect($(b.listeCommandeVide)))}};this.affect=function(b){b=this.affectLienEditer(b);b=this.affectLienListeCommandeArchive(b);b=this.affectNouveauMarche(b);b=gCommunVue.comHoverBtn(b);return b};this.affectNouveauMarche=function(b){b.find("#btn-nv-marche").click(function(){AjoutCommandeVue()});return b};this.affectLienEditer=function(b){b.find(".btn-marche").click(function(){EditerCommandeVue({id_marche:$(this).attr("id")})});return b};this.affectLienListeCommandeArchive=function(b){b.find("#lien-marche-archive").click(function(){ListeCommandeArchiveVue()});return b};this.construct(a)}function ResumeMarcheVue(a){this.mIdMarche=0;this.construct=function(b){$.history({vue:function(){ResumeMarcheVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=ResumeMarche","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var e=this;var b=new GestionCommandeTemplate();var g=b.resumeMarche;c.infoMarcheSelected="";c.listeReservationSelected="";c.listeAchatSelected="";c.resumeMarcheSelected="ui-state-active";c.editerMenu=b.editerMarcheMenu.template(c);c.sigleMonetaire=gSigleMonetaire;var d=0;var f=0;$(c.infoCommande).each(function(){e.mIdMarche=this.comId;if(this.proType==1){this.nproNom+=" (Solidaire)"}else{if(this.proType==2){this.nproNom+=" (Abonnement)"}}if(this.stoQuantite==null){this.stoQuantite=0}if(this.opeMontant==null){this.opeMontant=0}if(this.stoQuantiteLivraison==null){this.stoQuantiteLivraison=0}if(this.opeMontantLivraison==null){this.opeMontantLivraison=0}if(this.stoQuantiteSolidaire==null){this.stoQuantiteSolidaire=0}if(this.stoQuantiteVente==null){this.stoQuantiteVente=0}if(this.opeMontantVente==null){this.opeMontantVente=0}if(this.stoQuantiteVenteSolidaire==null){this.stoQuantiteVenteSolidaire=0}if(this.opeMontantVenteSolidaire==null){this.opeMontantVenteSolidaire=0}d-=parseFloat(this.opeMontantLivraison);d+=parseFloat(this.opeMontantVente);f+=parseFloat(this.opeMontantVenteSolidaire);this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");this.opeMontant=this.opeMontant.nombreFormate(2,","," ");this.stoQuantiteLivraison=this.stoQuantiteLivraison.nombreFormate(2,","," ");this.opeMontantLivraison=this.opeMontantLivraison.nombreFormate(2,","," ");this.stoQuantiteSolidaire=this.stoQuantiteSolidaire.nombreFormate(2,","," ");this.stoQuantiteVente=this.stoQuantiteVente.nombreFormate(2,","," ");this.opeMontantVente=this.opeMontantVente.nombreFormate(2,","," ");this.stoQuantiteVenteSolidaire=this.stoQuantiteVenteSolidaire.nombreFormate(2,","," ");this.opeMontantVenteSolidaire=this.opeMontantVenteSolidaire.nombreFormate(2,","," ")});c.total=d.nombreFormate(2,","," ");c.totalSolidaire=f.nombreFormate(2,","," ");c.numero=c.detailMarche.numero;$("#contenu").replaceWith(e.affect($(g.template(c))))};this.affect=function(b){b=this.affectMenu(b);b=gCommunVue.comHoverBtn(b);return b};this.affectMenu=function(b){var c=this;b.find("#btn-information-marche").click(function(){EditerCommandeVue(c.mParam)});b.find("#btn-liste-achat-resa").click(function(){ListeAchatMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-liste-resa").click(function(){ListeReservationMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-resume-marche").click(function(){ResumeMarcheVue({id_marche:c.mIdMarche})});return b};this.construct(a)}function AjoutCommandeVue(a){this.mListeFerme={};this.mProduits=[];this.mMarche=new MarcheVO();this.mAffichageMarche=[];this.mNbProduit=0;this.mEditionLot=false;this.mIdLot=0;this.mIdLotAbonnement=0;this.mEtapeCreationMarche=0;this.construct=function(b){$.history({vue:function(){AjoutCommandeVue(b)}});var d=$.extend(d,b);d.fonction="afficher";var c=this;$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(d),function(e){Infobulle.init();if(e){if(e.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}delete c.mProduits;c.mProduits=[];c.afficher(e)}else{Infobulle.generer(e,"")}}},"json")};this.afficher=function(c){var d=this;this.mListeFerme=c.listeFerme;var b=new GestionCommandeTemplate();var e=b.formulaireAjoutMarche;$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affect=function(b){b=this.affectDialogAjoutProduit(b);b=this.affectControleDatepicker(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);return b};this.affectDialogAjoutProduit=function(b){var c=this;b.find("#btn-ajout-produit").click(function(){var d=new GestionCommandeTemplate();var f=d.dialogAjoutProduitAjoutMarche;var e={listeFerme:c.mListeFerme};$(c.affectAjoutProduitSelectFerme($(f.template(e)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,position:"top",buttons:{Ajouter:function(){c.ajouterProduit($(this))},Annuler:function(){c.mEditionLot=false;$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})});return b};this.affectAjoutProduitSelectFerme=function(b){var c=this;b.find("#pro-idFerme select").change(function(){var e=$(this).val();$("#pro-idCategorie select, #pro-idProduit select").attr("disabled","disabled").selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');if(e>0){var d={fonction:"listeProduit",id:e};$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(d),function(j){if(j){if(j.valid){Infobulle.init();if(j.listeProduit.length>0&&j.listeProduit[0].nproId!=null){c.mProduits=[];var h=0;var l=[];$.each(j.listeProduit,function(){if(c.mProduits[this.cproId]){c.mProduits[this.cproId].listeProduit.push(this)}else{c.mProduits[this.cproId]={nom:this.cproNom,listeProduit:[this]}}if(h!=this.cproId){l.push({cproId:this.cproId,cproNom:this.cproNom});h=this.cproId}});var f=new GestionCommandeTemplate();var k=f.ajoutProduitSelectCategorie;$("#pro-idCategorie").replaceWith(c.affectAjoutProduitSelectCategorie($(k.template({listeCategorie:l}))))}else{var m=new TemplateVR();m.valid=false;m.log.valid=false;var g=new VRerreur();g.code=ERR_332_CODE;g.message=ERR_332_MSG;m.log.erreurs.push(g);Infobulle.generer(m,"")}}else{Infobulle.generer(j,"")}}},"json")}});return b};this.affectAjoutProduitSelectCategorie=function(b){var c=this;b.find("select").change(function(){var f=$(this).val();$("#pro-idProduit select").attr("disabled","disabled").selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');if(f>0){var d=new GestionCommandeTemplate();var e=d.ajoutProduitSelectProduit;$("#pro-idProduit").replaceWith(c.affectAjoutProduitSelectProduit($(e.template(c.mProduits[f]))))}});return b};this.affectAjoutProduitSelectProduit=function(b){var c=this;b.find("select").change(function(){var g=$(this).val();if(g>0){if(!c.mMarche.produits[g]||!c.mMarche.produitsAbonnement[g]){var e={fonction:"listeModeleLot",idNomProduit:g};$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(e),function(l){if(l){if(l.valid){Infobulle.init();if((!c.mMarche.produitsAbonnement[g]&&l.detailAbonnement.idNomProduit==g)||!c.mMarche.produits[g]){var h=new GestionCommandeTemplate();var k={sigleMonetaire:gSigleMonetaire};if(l.modelesLot.length>0&&l.modelesLot[0].mLotId!=null){k.modelesLot=[];$(l.modelesLot).each(function(){if(this.mLotId!=null){this.id=this.mLotId;this.quantite=this.mLotQuantite.nombreFormate(2,","," ");this.unite=this.mLotUnite;this.prix=this.mLotPrix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;k.modelesLot.push(this);k.unite=this.mLotUnite}})}if(l.detailAbonnement.idNomProduit==g){k.modelesLotAbonnement=[];k.modelesLotAbonnementReservation=[];k.uniteAbonnement=l.detailAbonnement.unite;$(l.detailAbonnement.lots).each(function(){this.id=this.id;this.quantite=this.taille.nombreFormate(2,","," ");this.unite=k.uniteAbonnement;this.prix=this.prix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;if(this.reservation){k.modelesLotAbonnementReservation.push(this)}else{k.modelesLotAbonnement.push(this)}})}if(c.mMarche.produits[g]){k.typeNormalSelected='disabled="disabled"';k.typeSolidaireSelected='disabled="disabled"';k.typeAbonnementSelected='checked="checked"';k.visibleSolidaire="ui-helper-hidden";k.visibleNormal="ui-helper-hidden";k.visibleAbonnement=""}else{if(c.mMarche.produitsAbonnement[g]){k.typeNormalSelected='checked="checked"';k.typeAbonnementSelected='disabled="disabled"';k.visibleSolidaire="";k.visibleNormal="";k.visibleAbonnement="ui-helper-hidden"}else{k.typeNormalSelected='checked="checked"';k.visibleSolidaire="";k.visibleNormal="";k.visibleAbonnement="ui-helper-hidden"}}if(l.detailAbonnement.idNomProduit==g){k.stockInitialAbonnement=l.detailAbonnement.stockInitial.nombreFormate(2,","," ");if(parseFloat(l.detailAbonnement.max)==-1){k.qMaxAbonnement="Pas de limite"}else{k.qMaxAbonnement=l.detailAbonnement.max.nombreFormate(2,","," ")+" "+k.uniteAbonnement}k.qMaxAbonnementValue=l.detailAbonnement.max;k.typeProduitAbonnement=h.typeProduitAbonnementAjoutProduit.template(k);k.divLotAbonnement=h.prixAbonnementAjoutProduit.template(k);k.divStockAbonnement=h.stockAbonnementAjoutProduit.template(k)}k.divTypeProduit=h.typeProduitAjoutProduit.template(k);k.divLot=h.prixAjoutProduit.template(k);k.divStock=h.stockAjoutProduit.template(k);var n=h.prixEtStockAjoutProduit;$("#prix-stock-produit").replaceWith(c.affectPrixEtStock($(n.template(k))))}else{var m=new Object();var j=new VRerreur();j.code=ERR_211_CODE;j.message=ERR_211_MSG;m.valid=false;m.log=new VRelement();m.log.valid=false;m.log.erreurs.push(j);Infobulle.generer(m,"")}}else{Infobulle.generer(l,"")}}},"json")}else{var f=new Object();var d=new VRerreur();d.code=ERR_211_CODE;d.message=ERR_211_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(d);Infobulle.generer(f,"")}}else{$("#prix-stock-produit").replaceWith($('<div id="prix-stock-produit">'))}});return b};this.affectPrixEtStock=function(b){b=this.affectAjoutLotGestion(b);b=this.affectAjoutLotAbonnementGestion(b);b=this.affectAjoutLot(b);b=this.affectLimiteStock(b);b=this.affectChangeTypeProduit(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectChangeTypeProduit=function(b){var c=this;b.find(":input[name=typeProduit]").click(function(){return c.testChangeTypeProduit()}).change(function(){c.changeTypeProduit($(":input[name=typeProduit]:checked").val())});return b};this.testChangeTypeProduit=function(){if(this.mEditionLot){var c=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;c.valid=false;c.log=new VRelement();c.log.valid=false;c.log.erreurs.push(b);Infobulle.generer(c,"");return false}return true};this.changeTypeProduit=function(c){if(!this.mEditionLot){$(".pro-detail").hide();if(c==0){$("#pro-normal,#id-stock").show()}else{if(c==1){$("#pro-normal").show()}else{$("#pro-abonnement").show()}}}else{var d=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;d.valid=false;d.log=new VRelement();d.log.valid=false;d.log.erreurs.push(b);Infobulle.generer(d,"");return false}};this.affectLimiteStock=function(b){b.find(":input[name=pro-stock-choix]").change(function(){if($(":input[name=pro-stock-choix]:checked").val()==1){$(":input[name=pro-stock]").attr("disabled","").val("")}else{$(":input[name=pro-stock]").attr("disabled","disabled").val("")}});b.find(":input[name=pro-qte-max-choix]").change(function(){if($(":input[name=pro-qte-max-choix]:checked").val()==1){$(":input[name=pro-qte-max]").attr("disabled","").val("")}else{$(":input[name=pro-qte-max]").attr("disabled","disabled").val("")}});return b};this.affectAjoutLot=function(b){var c=this;b.find("#btn-ajout-lot").click(function(){c.ajoutLot(1)});b.find("#table-pro-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(1)}});b.find("#btn-ajout-lot-abonnement").click(function(){c.ajoutLot(2)});b.find("#table-pro-abonnement-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(2)}});return b};this.ajoutLot=function(d){var c=new ModeleLotVO();if(d==1){c.quantite=$(":input[name=lot-quantite]").val().numberFrToDb();c.unite=$(":input[name=lot-unite]").val();c.prix=$(":input[name=lot-prix]").val().numberFrToDb()}else{c.quantite=$(":input[name=lot-abo-quantite]").val().numberFrToDb();c.unite=$("#pro-abo-lot-unite").text();c.prix=$(":input[name=lot-abo-prix]").val().numberFrToDb()}var e=new ModeleLotValid();var g=e.validAjout(c);if(g.valid){Infobulle.init();var b=new GestionCommandeTemplate();if(d==1){var f=b.modeleLot;this.mIdLot--;c.id=this.mIdLot;c.sigleMonetaire=gSigleMonetaire;c.quantite=c.quantite.nombreFormate(2,","," ");c.prix=c.prix.nombreFormate(2,","," ");$("#lot-liste").append(this.affectLot($(f.template(c))));$(":input[name=lot-quantite], :input[name=lot-unite], :input[name=lot-prix]").val("")}else{var f=b.modeleLotAbonnement;this.mIdLotAbonnement--;c.id=this.mIdLotAbonnement;c.sigleMonetaire=gSigleMonetaire;c.quantite=c.quantite.nombreFormate(2,","," ");c.prix=c.prix.nombreFormate(2,","," ");$("#lot-liste-abonnement").append(this.affectLotAbonnement($(f.template(c))));$(":input[name=lot-abo-quantite], :input[name=lot-abo-unite], :input[name=lot-abo-prix]").val("")}}else{if(d==1){Infobulle.generer(g,"pro-lot-")}else{Infobulle.generer(g,"pro-abo-lot-")}}};this.affectLot=function(b){b=this.affectAjoutLotGestion(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectLotAbonnement=function(b){b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);b=this.affectAjoutLotAbonnementGestion(b);return b};this.affectAjoutLotGestion=function(b){var c=this;b.find(".btn-modifier-lot").click(function(){c.ajoutLotModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot").click(function(){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot").click(function(){c.ajoutLotAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot").click(function(){c.ajoutLotSupprimer($(this).closest("tr").find("#id-lot").text())});b.find(":checkbox").change(function(){if(!c.majUnite()){if($(this).attr("checked")){$(this).removeAttr("checked")}else{$(this).attr("checked","checked")}}});return b};this.affectAjoutLotAbonnementGestion=function(b){var c=this;b.find(".btn-modifier-lot-abonnement").click(function(){c.ajoutLotAbonnementModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot-abonnement").click(function(){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot-abonnement").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot-abonnement").click(function(){c.ajoutLotAbonnementAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot-abonnement").click(function(){c.ajoutLotAbonnementSupprimer($(this).closest("tr").find("#id-lot").text())});return b};this.majUnite=function(){var d=true;var c=0;var e="";$(".ligne-lot :checkbox:checked").each(function(){var g=$(this).closest(".ligne-lot").find(".lot-unite").text();if(e!=""&&e!=g){d=false}else{e=g}c++});if(d){if(c>0){$(".unite-stock").text(e)}}else{var f=new Object();var b=new VRerreur();b.code=ERR_333_CODE;b.message=ERR_333_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(b);Infobulle.generer(f,"")}return d};this.ajoutLotModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();$("#pro-lot-"+b+"-quantite").val($("#lot-"+b+"-quantite").text());$("#pro-lot-"+b+"-unite").val($("#lot-"+b+"-unite").text());$("#pro-lot-"+b+"-prix").val($("#lot-"+b+"-prix").text());this.mEditionLot=true};this.ajoutLotAbonnementModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();$("#pro-lot-abonnement"+b+"-quantite").val($("#lot-"+b+"-quantite-abonnement").text());$("#pro-lot-abonnement"+b+"-unite").val($("#lot-"+b+"-unite-abonnement").text());$("#pro-lot-abonnement"+b+"-prix").val($("#lot-"+b+"-prix-abonnement").text());this.mEditionLot=true};this.ajoutLotValiderModification=function(c){var b=new ModeleLotVO();b.quantite=$("#pro-lot-"+c+"-quantite").val().numberFrToDb();b.unite=$("#pro-lot-"+c+"-unite").val();b.prix=$("#pro-lot-"+c+"-prix").val().numberFrToDb();var d=new ModeleLotValid();var e=d.validAjout(b);if(e.valid){Infobulle.init();$("#lot-"+c+"-quantite").text(b.quantite.nombreFormate(2,","," "));$("#lot-"+c+"-unite").text(b.unite);$("#lot-"+c+"-prix").text(b.prix.nombreFormate(2,","," "));$(".btn-lot, #btn-annuler-lot-"+c+", #btn-valider-lot-"+c+", .champ-lot-"+c).toggle();this.mEditionLot=false;this.majUnite()}else{Infobulle.generer(e,"pro-lot-"+c+"-")}};this.ajoutLotAbonnementValiderModification=function(c){var b=new ModeleLotVO();b.quantite=$("#pro-lot-abonnement"+c+"-quantite").val().numberFrToDb();b.unite=$("#pro-lot-abonnement"+c+"-unite").val();b.prix=$("#pro-lot-abonnement"+c+"-prix").val().numberFrToDb();var d=new ModeleLotValid();var e=d.validAjout(b);if(e.valid){Infobulle.init();$("#lot-"+c+"-quantite-abonnement").text(b.quantite.nombreFormate(2,","," "));$("#lot-"+c+"-unite-abonnement").text(b.unite);$("#lot-"+c+"-prix-abonnement").text(b.prix.nombreFormate(2,","," "));$(".btn-lot-abonnement, #btn-annuler-lot-"+c+"-abonnement, #btn-valider-lot-"+c+"-abonnement, .champ-lot-"+c+"-abonnement").toggle();this.mEditionLot=false}else{Infobulle.generer(e,"pro-lot-abonnement"+c+"-")}};this.ajoutLotAnnulerModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();this.mEditionLot=false};this.ajoutLotAbonnementAnnulerModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();this.mEditionLot=false};this.ajoutLotSupprimer=function(b){$("#ligne-lot-"+b).remove()};this.ajoutLotAbonnementSupprimer=function(b){$("#ligne-lot-abonnement-"+b).remove()};this.ajouterProduit=function(k){var h=this;if(!this.mEditionLot){var r=k.find(":input[name=ferme]").val();var p=k.find(":input[name=categorie]").val();var f=k.find(":input[name=produit]").val();var e=k.find(":input[name=typeProduit]:checked").val();if(f!=0){if(e==2){var o=k.find("#stock-abonnement").text().numberFrToDb()}else{var o=k.find(":input[name=pro-stock]").val().numberFrToDb()}if(k.find(":input[name=pro-stock-choix]:checked").val()==1&&o==""&&e==0){var s=new Object();var m=new VRerreur();m.code=ERR_201_CODE;m.message=ERR_201_MSG;s.valid=false;s.qteRestante=new VRelement();s.qteRestante.valid=false;s.qteRestante.erreurs.push(m);Infobulle.generer(s,"pro-")}else{var n=0;if(e==2){n=k.find("#max-abonnement").text().numberFrToDb()}else{if(e==0){n=k.find(":input[name=pro-qte-max]").val().numberFrToDb()}}if(k.find(":input[name=pro-qte-max-choix]:checked").val()==1&&n==""&&e==0){var s=new Object();var m=new VRerreur();m.code=ERR_201_CODE;m.message=ERR_201_MSG;s.valid=false;s.qteMaxCommande=new VRelement();s.qteMaxCommande.valid=false;s.qteMaxCommande.erreurs.push(m);Infobulle.generer(s,"pro-")}else{if(e==2){var b=k.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{var b=k.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}if(e==2&&this.mMarche.produitsAbonnement[f]){var s=new Object();var m=new VRerreur();m.code=ERR_253_CODE;m.message=ERR_253_MSG;s.valid=false;s.qteMaxCommande=new VRelement();s.qteMaxCommande.valid=false;s.qteMaxCommande.erreurs.push(m);Infobulle.generer(s,"pro-")}else{if(e<2&&this.mMarche.produits[f]){var s=new Object();var m=new VRerreur();m.code=ERR_211_CODE;m.message=ERR_211_MSG;s.valid=false;s.qteMaxCommande=new VRelement();s.qteMaxCommande.valid=false;s.qteMaxCommande.erreurs.push(m);Infobulle.generer(s,"pro-")}else{var l="";if(o!=""){l=o}else{o=-1}var g="";if(n!=""){g=n}else{n=-1}var d={nproId:f,nproNom:k.find(":input[name=produit] option:selected").text(),nproStock:l,nproQteMax:g,nproUnite:b,type:e,modelesLot:[],modelesLotReservation:[]};if(e==2){k.find(".ligne-lot-abonnement :checkbox").each(function(){var t=false;if($(this).hasClass("modele-lot")){t=true}var x=false;if($(this).hasClass("modele-lot-reservation")){x=true}var v=false;if($(this).attr("checked")){v=true}if(t||v){var u=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();var w={id:u,taille:$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot-abonnement").find(".lot-unite").text(),selected:v,modele:t};if(x){d.modelesLotReservation[u]=w}else{d.modelesLot[u]=w}}})}else{k.find(".ligne-lot :checkbox").each(function(){var t=false;if($(this).hasClass("modele-lot")){t=true}var v=false;if($(this).attr("checked")){v=true}if(t||v){var u=$(this).closest(".ligne-lot").find(".lot-id").text();var w={id:u,taille:$(this).closest(".ligne-lot").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot").find(".lot-unite").text(),selected:v,modele:t};d.modelesLot[u]=w}})}if(!this.mAffichageMarche[r]){this.mAffichageMarche[r]={ferId:r,ferNom:k.find(":input[name=ferme] option:selected").text(),categories:[]}}if(!this.mAffichageMarche[r].categories[p]){this.mAffichageMarche[r].categories[p]={cproId:p,cproNom:k.find(":input[name=categorie] option:selected").text(),produits:[],produitsAbonnement:[]}}var c=new ProduitMarcheVO();c.idNom=f;c.unite=b;c.qteMaxCommande=n;c.qteRestante=o;c.type=e;if(e==2){k.find(".ligne-lot-abonnement :checkbox:checked").each(function(){var u=new DetailCommandeVO();var t=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();if(t>0){u.id=t}u.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();u.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();c.lots.push(u)})}else{k.find(".ligne-lot :checkbox:checked").each(function(){var t=new DetailCommandeVO();t.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();t.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();c.lots.push(t)})}c.idFerme=r;c.idCategorie=p;if(e==1){c.qteMaxCommande=-1;c.qteRestante=-1}var q=new ProduitMarcheValid();var j=q.validAjout(c);if(j.valid){Infobulle.init();if(e==2){this.mMarche.produitsAbonnement[f]=c;this.mAffichageMarche[r].categories[p].produitsAbonnement[f]=d}else{this.mMarche.produits[f]=c;this.mAffichageMarche[r].categories[p].produits[f]=d}this.mNbProduit++;h.majListeFerme();k.dialog("close")}else{if(e==2){Infobulle.generer(j,"pro-abo-")}else{Infobulle.generer(j,"pro-")}}}}}}}}else{var s=new Object();var m=new VRerreur();m.code=ERR_112_CODE;m.message=ERR_112_MSG;s.valid=false;s.log=new VRelement();s.log.valid=false;s.log.erreurs.push(m);Infobulle.generer(s,"")}};this.majListeFerme=function(){var d=this;var b=new GestionCommandeTemplate();var e=[];$(d.mAffichageMarche).each(function(){if(this.ferId){var g=[];$(this.categories).each(function(){if(this.cproId){var h=[];$(this.produits).each(function(){if(this.nproId){h.push([this.nproNom,this.nproId,this.type])}});$(this.produitsAbonnement).each(function(){if(this.nproId){h.push([this.nproNom,this.nproId,this.type])}});h.sort(sortABC);g.push([this.cproNom,this.cproId,h])}});g.sort(sortABC);e.push([this.ferNom,this.ferId,g])}});e.sort(sortABC);var c={fermes:[]};$(e).each(function(h,l){var m=l[1];var k=l[2];if(d.mAffichageMarche[m]){var j=false;var g={ferId:d.mAffichageMarche[m].ferId,ferNom:d.mAffichageMarche[m].ferNom,categories:[]};$(k).each(function(n,r){var o=r[1];var s=r[2];if(d.mAffichageMarche[m].categories[o]){var q=false;var p={cproId:d.mAffichageMarche[m].categories[o].cproId,cproNom:d.mAffichageMarche[m].categories[o].cproNom,produits:[]};$(s).each(function(v,x){var w=x[1];var u=x[2];var t="";if(u==2){t=b.flagAbonnement;if(d.mAffichageMarche[m].categories[o].produitsAbonnement[w]){p.produits.push({nproId:d.mAffichageMarche[m].categories[o].produitsAbonnement[w].nproId,nproNom:d.mAffichageMarche[m].categories[o].produitsAbonnement[w].nproNom,type:u,abonnement:t});j=true;q=true}}else{if(d.mAffichageMarche[m].categories[o].produits[w].type==1){t=b.flagSolidaire}if(d.mAffichageMarche[m].categories[o].produits[w]){p.produits.push({nproId:d.mAffichageMarche[m].categories[o].produits[w].nproId,nproNom:d.mAffichageMarche[m].categories[o].produits[w].nproNom,type:u,abonnement:t});j=true;q=true}}});if(q){g.categories.push(p)}}});if(j){c.fermes.push(g)}}});var f=b.ajoutMarcheListeProduit;$("#liste-ferme").replaceWith(this.affectListeProduit($(f.template(c))));if(this.mNbProduit>0){if($("#btn-gestion-marche").length<1){$("#liste-ferme").after(this.affectCeerMarche($(b.btnValiderAjoutMarche)))}}else{$("#btn-gestion-marche").remove()}};this.affectListeProduit=function(b){b=this.affectModifierProduit(b);b=this.affectSupprimerProduit(b);b=gCommunVue.comHoverBtn(b);return b};this.affectModifierProduit=function(b){var c=this;b.find(".btn-modifier-produit").click(function(){c.dialogModifierProduit($(this).attr("id-produit"),$(this).attr("typeProduit"))});return b};this.dialogModifierProduit=function(j,e){var h=this;var c=new GestionCommandeTemplate();if(e==0||e==1){var m=this.mMarche.produits[j].idFerme;var l=this.mMarche.produits[j].idCategorie;var f={ferId:m,ferNom:this.mAffichageMarche[m].ferNom,cproId:l,cproNom:this.mAffichageMarche[m].categories[l].cproNom,nproId:j,nproNom:this.mAffichageMarche[m].categories[l].produits[j].nproNom,nproStock:this.mAffichageMarche[m].categories[l].produits[j].nproStock.nombreFormate(2,","," "),nproQteMax:this.mAffichageMarche[m].categories[l].produits[j].nproQteMax.nombreFormate(2,","," "),modelesLot:[]};f.typeProduitLabel="Solidaire";for(i in this.mAffichageMarche[m].categories[l].produits[j].modelesLot){var k=this.mAffichageMarche[m].categories[l].produits[j].modelesLot[i];if(k.id){var g={id:k.id,quantite:k.taille,prix:k.prix,unite:k.unite,sigleMonetaire:gSigleMonetaire};if(k.selected){g.checked='checked="checked"';f.unite=k.unite}else{g.checked=""}if(k.modele){g.modele="modele-lot"}else{g.modele=""}f.modelesLot.push(g)}}if(e==0){f.typeProduitLabel="Normal";if(this.mMarche.produits[j].qteRestante==-1){f.nproStockCheckedNoLimit='checked="checked"';f.nproStockDisabled='disabled="disabled"';f.nproStock=""}else{f.nproStockCheckedLimit='checked="checked"'}if(this.mMarche.produits[j].qteMaxCommande==-1){f.nproQteMaxCheckedNoLimit='checked="checked"';f.nproQteMaxDisabled='disabled="disabled"';f.nproQteMax=""}else{f.nproQteMaxCheckedLimit='checked="checked"'}f.divStock=c.stockModifProduit.template(f)}f.divLot=c.prixModifProduit.template(f)}else{var m=this.mMarche.produitsAbonnement[j].idFerme;var l=this.mMarche.produitsAbonnement[j].idCategorie;var f={ferId:m,ferNom:this.mAffichageMarche[m].ferNom,cproId:l,cproNom:this.mAffichageMarche[m].categories[l].cproNom,nproId:j,nproNom:this.mAffichageMarche[m].categories[l].produitsAbonnement[j].nproNom,stockInitialAbonnement:this.mAffichageMarche[m].categories[l].produitsAbonnement[j].nproStock.nombreFormate(2,","," "),modelesLotAbonnement:[],modelesLotAbonnementReservation:[]};for(i in this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLot){var k=this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLot[i];if(k.id){var g={id:k.id,quantite:k.taille,prix:k.prix,unite:k.unite,sigleMonetaire:gSigleMonetaire};if(k.selected){g.checked='checked="checked"';f.uniteAbonnement=k.unite}else{g.checked=""}if(k.modele){g.modele="modele-lot"}else{g.modele=""}f.modelesLotAbonnement.push(g)}}for(i in this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLotReservation){var k=this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLotReservation[i];if(k.id){var g={id:k.id,quantite:k.taille,prix:k.prix,unite:k.unite,sigleMonetaire:gSigleMonetaire};if(k.selected){g.checked='checked="checked"';f.uniteAbonnement=k.unite}else{g.checked=""}if(k.modele){g.modele="modele-lot"}else{g.modele=""}f.modelesLotAbonnementReservation.push(g)}}var b=this.mAffichageMarche[m].categories[l].produitsAbonnement[j].nproQteMax;if(parseFloat(b)==-1){f.qMaxAbonnement="Pas de limite"}else{f.qMaxAbonnement=b.nombreFormate(2,","," ")+" "+f.uniteAbonnement}f.qMaxAbonnementValue=b;f.divStock=c.stockAbonnementAjoutProduit.template(f);f.typeProduitLabel="Abonnement";f.divLot=c.prixAbonnementModifProduit.template(f)}var d=c.dialogModifProduitAjoutMarche;$(h.affectPrixEtStock($(d.template(f)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Modifier:function(){h.modifierProduit($(this),e)},Annuler:function(){h.mEditionLot=false;$(this).dialog("close")}},close:function(n,o){$(this).remove();Infobulle.init()}})};this.modifierProduit=function(k,n){var j=this;if(!this.mEditionLot){var r=k.find("#pro-idFerme").attr("id-ferme");var c=k.find("#pro-idCategorie").attr("id-categorie");var d=k.find("#pro-idProduit").attr("id-produit");var o=0;if(n==2){o=k.find("#stock-abonnement").text().numberFrToDb()}else{if(n==0){o=k.find(":input[name=pro-stock]").val().numberFrToDb()}}if(k.find(":input[name=pro-stock-choix]:checked").val()==1&&o==""&&n==0){var h=new Object();var t=new VRerreur();t.code=ERR_201_CODE;t.message=ERR_201_MSG;h.valid=false;h.qteRestante=new VRelement();h.qteRestante.valid=false;h.qteRestante.erreurs.push(t);Infobulle.generer(h,"pro-")}else{var m=0;if(n==0){m=k.find(":input[name=pro-qte-max]").val().numberFrToDb()}else{if(n==2){m=k.find("#max-abonnement").text().numberFrToDb()}}if(k.find(":input[name=pro-qte-max-choix]:checked").val()==1&&m==""&&n==0){var h=new Object();var t=new VRerreur();t.code=ERR_201_CODE;t.message=ERR_201_MSG;h.valid=false;h.qteMaxCommande=new VRelement();h.qteMaxCommande.valid=false;h.qteMaxCommande.erreurs.push(t);Infobulle.generer(h,"pro-")}else{if(n==2){var l=k.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{var l=k.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}var b="";if(o!=""){b=o.nombreFormate(2,","," ")}else{o=-1}var s="";if(m!=""){s=m.nombreFormate(2,","," ")}else{m=-1}var f="";if(n==2){f=this.mAffichageMarche[r].categories[c].produitsAbonnement[d].nproNom}else{f=this.mAffichageMarche[r].categories[c].produits[d].nproNom}var q={nproId:d,nproNom:f,nproStock:b,nproQteMax:s,nproUnite:l,type:n,modelesLot:[],modelesLotReservation:[]};if(n==2){k.find(".ligne-lot-abonnement :checkbox").each(function(){var u=false;if($(this).hasClass("modele-lot")){u=true}var y=false;if($(this).hasClass("modele-lot-reservation")){y=true}var w=false;if($(this).attr("checked")){w=true}if(u||w){var v=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();var x={id:v,taille:$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot-abonnement").find(".lot-unite").text(),selected:w,modele:u};if(y){q.modelesLotReservation[v]=x}else{q.modelesLot[v]=x}}})}else{k.find(".ligne-lot :checkbox").each(function(){var u=false;if($(this).hasClass("modele-lot")){u=true}var w=false;if($(this).attr("checked")){w=true}if(u||w){var v=$(this).closest(".ligne-lot").find(".lot-id").text();var x={id:v,taille:$(this).closest(".ligne-lot").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot").find(".lot-unite").text(),selected:w,modele:u};q.modelesLot[v]=x}})}var g=new ProduitMarcheVO();g.idNom=d;g.unite=l;g.qteMaxCommande=m;g.qteRestante=o;g.type=n;if(n==2){k.find(".ligne-lot-abonnement :checkbox:checked").each(function(){var v=new DetailCommandeVO();var u=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();if(u>0){v.id=u}v.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();v.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();g.lots.push(v)})}else{k.find(".ligne-lot :checkbox:checked").each(function(){var u=new DetailCommandeVO();u.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();u.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();g.lots.push(u)})}if(n==1){g.qteMaxCommande=-1;g.qteRestante=-1}g.idFerme=r;g.idCategorie=c;var e=new ProduitMarcheValid();var p=e.validAjout(g);if(p.valid){Infobulle.init();if(n==2){this.mMarche.produitsAbonnement[d]=g;this.mAffichageMarche[r].categories[c].produitsAbonnement[d]=q}else{this.mMarche.produits[d]=g;this.mAffichageMarche[r].categories[c].produits[d]=q}j.majListeFerme();k.dialog("close")}else{if(n==2){Infobulle.generer(p,"pro-abo-")}else{Infobulle.generer(p,"pro-")}}}}}else{var h=new Object();var t=new VRerreur();t.code=ERR_112_CODE;t.message=ERR_112_MSG;h.valid=false;h.log=new VRelement();h.log.valid=false;h.log.erreurs.push(t);Infobulle.generer(h,"")}};this.affectSupprimerProduit=function(b){var c=this;b.find(".btn-supprimer-produit").click(function(){c.supprimerProduit($(this).attr("id-produit"),$(this).attr("typeProduit"))});return b};this.supprimerProduit=function(c,b){if(b==0||b==1){var e=this.mMarche.produits[c].idFerme;var d=this.mMarche.produits[c].idCategorie;this.mMarche.produits.splice(c,1,null);this.mAffichageMarche[e].categories[d].produits.splice(c,1,null)}else{var e=this.mMarche.produitsAbonnement[c].idFerme;var d=this.mMarche.produitsAbonnement[c].idCategorie;this.mMarche.produitsAbonnement.splice(c,1,null);this.mAffichageMarche[e].categories[d].produitsAbonnement.splice(c,1,null)}this.mNbProduit--;this.majListeFerme()};this.affectCeerMarche=function(b){var c=this;b.find("#btn-creer-marche").click(function(){c.creerMarche()});b.find("#btn-modifier-creation-commande").click(function(){c.editerMarche()});return b};this.creerMarche=function(){var f=this;if(!this.mEditionLot){this.mMarche.nom=$(":input[name=nom]").val();this.mMarche.description=$(":input[name=description]").val();this.mMarche.dateMarcheDebut=$(":input[name=date-debut]").val().dateFrToDb();this.mMarche.timeMarcheDebut=$(":input[name=heure-debut]").val()+":"+$(":input[name=minute-debut]").val()+":00";this.mMarche.dateMarcheFin=$(":input[name=date-debut]").val().dateFrToDb();this.mMarche.timeMarcheFin=$(":input[name=heure-fin]").val()+":"+$(":input[name=minute-fin]").val()+":00";this.mMarche.dateDebutReservation=$(":input[name=date-debut-reservation]").val().dateFrToDb();this.mMarche.timeDebutReservation=$(":input[name=heure-debut-reservation]").val()+":"+$(":input[name=minute-debut-reservation]").val()+":00";this.mMarche.dateFinReservation=$(":input[name=date-fin-reservation]").val().dateFrToDb();this.mMarche.timeFinReservation=$(":input[name=heure-fin-reservation]").val()+":"+$(":input[name=minute-fin-reservation]").val()+":00";this.mMarche.archive="0";if(this.mEtapeCreationMarche==0){var e=new MarcheValid();var g=e.validAjout(this.mMarche);if(g.valid){this.mEtapeCreationMarche=1;Infobulle.init();$("#nom-marche-span").text(this.mMarche.nom);$("#date-debut-reservation-marche-span").text($(":input[name=date-debut-reservation]").val());$("#time-debut-reservation-marche-span").text($(":input[name=heure-debut-reservation]").val()+"H"+$(":input[name=minute-debut-reservation]").val());$("#date-fin-reservation-marche-span").text($(":input[name=date-fin-reservation]").val());$("#time-fin-reservation-marche-span").text($(":input[name=heure-fin-reservation]").val()+"H"+$(":input[name=minute-fin-reservation]").val());$("#date-debut-marche-span").text($(":input[name=date-debut]").val());$("#time-debut-marche-span").text($(":input[name=heure-debut]").val()+"H"+$(":input[name=minute-debut]").val());$("#time-fin-marche-span").text($(":input[name=heure-fin]").val()+"H"+$(":input[name=minute-fin]").val());$("#description-marche-span").text(this.mMarche.description);$("#btn-ajout-produit-div, .informations-marche, #btn-modifier-creation-commande, .btn-modifier-produit, .btn-supprimer-produit").toggle()}else{Infobulle.generer(g,"marche-")}}else{if(this.mEtapeCreationMarche==1){var d=new MarcheVO();d.nom=this.mMarche.nom;d.description=this.mMarche.description;d.dateMarcheDebut=this.mMarche.dateMarcheDebut;d.timeMarcheDebut=this.mMarche.timeMarcheDebut;d.dateMarcheFin=this.mMarche.dateMarcheFin;d.timeMarcheFin=this.mMarche.timeMarcheFin;d.dateDebutReservation=this.mMarche.dateDebutReservation;d.timeDebutReservation=this.mMarche.timeDebutReservation;d.dateFinReservation=this.mMarche.dateFinReservation;d.timeFinReservation=this.mMarche.timeFinReservation;d.archive=this.mMarche.archive;var h=[];$(this.mMarche.produits).each(function(){if(this.idNom){var j=[];$(this.lots).each(function(){if(this.taille){j.push(this)}});this.lots=j;h.push(this)}});d.produits=h;var b=[];$(this.mMarche.produitsAbonnement).each(function(){if(this.idNom){var j=[];$(this.lots).each(function(){if(this.taille){j.push(this)}});this.lots=j;b.push(this)}});d.produitsAbonnement=b;d.fonction="ajouter";$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(d),function(k){if(k){if(k.valid){var l=new Object();var j=new VRerreur();j.code=ERR_334_CODE;j.message=ERR_334_MSG;l.valid=false;l.log=new VRelement();l.log.valid=false;l.log.erreurs.push(j);EditerCommandeVue({id_marche:k.id,vr:l})}else{f.editerMarche();Infobulle.generer(k,"marche-")}}},"json")}}}else{var g=new Object();var c=new VRerreur();c.code=ERR_112_CODE;c.message=ERR_112_MSG;g.valid=false;g.log=new VRelement();g.log.valid=false;g.log.erreurs.push(c);Infobulle.generer(g,"")}};this.editerMarche=function(){this.mEtapeCreationMarche=0;$("#btn-ajout-produit-div, .informations-marche, #btn-modifier-creation-commande, .btn-modifier-produit, .btn-supprimer-produit").toggle()};this.affectControleDatepicker=function(b){b=gCommunVue.lienDatepickerMarche("marche-dateDebutReservation","marche-dateFinReservation","marche-dateMarcheDebut",b);b.find("#marche-dateDebutReservation").datepicker("setDate",getDateAujourdhuiDb().dateDbToFr());b.find("#marche-dateFinReservation").datepicker("option","minDate",new Date());b.find("#marche-dateMarcheDebut").datepicker("option","minDate",new Date());return b};this.construct(a)}function ListeAchatMarcheVue(a){this.mIdMarche=null;this.construct=function(b){$.history({vue:function(){ListeAchatMarcheVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=ListeAchatMarche","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){c.mIdMarche=b.id_marche;c.afficher(d);if(b&&b.vr){Infobulle.generer(b.vr,"")}}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var d=this;$(c.listeAchatEtReservation).each(function(){if(this.reservation==null){this.reservation=""}if(this.achat==null){this.achat=""}this.adhIdTri=this.adhNumero.replace("Z","")});var b=new GestionCommandeTemplate();c.infoMarcheSelected="";c.listeReservationSelected="";c.listeAchatSelected="ui-state-active";c.resumeMarcheSelected="";c.editerMenu=b.editerMarcheMenu.template(c);if(c.listeAchatEtReservation.length>0&&c.listeAchatEtReservation[0].adhId!=null){var e=b.listeAchatEtReservation;$("#contenu").replaceWith(d.affectAchatEtReservation($(e.template(c))))}else{$("#contenu").replaceWith(d.affectAchatEtReservation($(b.listeAchatEtReservationVide.template(c))))}};this.affectAchatEtReservation=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectAchat(b);b=this.affectExportDataEtReservation(b);b=this.affectMenu(b);return b};this.affectMenu=function(b){var c=this;b.find("#btn-information-marche").click(function(){EditerCommandeVue(c.mParam)});b.find("#btn-liste-achat-resa").click(function(){ListeAchatMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-liste-resa").click(function(){ListeReservationMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-resume-marche").click(function(){ResumeMarcheVue({id_marche:c.mIdMarche})});return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[2,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectExportDataEtReservation=function(b){var c=this;b.find("#btn-export-achat").click(function(){var d=new GestionCommandeTemplate();var e=d.dialogExportListeAchatEtReservation;$(e.template(c.mMarche)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){lParam={fonction:"exportAchatEtReservation",id_marche:c.mIdMarche};$.download("./index.php?m=GestionCommande&v=ListeAchatMarche",lParam)},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}})});return b};this.affectAchat=function(b){var c=this;b.find(".edt-com-achat-ligne").click(function(){AchatAdherentVue({id_marche:c.mIdMarche,id_adherent:$(this).find(".id-adherent").text()})});return b};this.construct(a)}function ListeCommandeArchiveVue(a){this.construct=function(b){$.history({vue:function(){ListeCommandeArchiveVue(b)}});var c=this;var d={archive:1};$.post("./index.php?m=GestionCommande&v=ListeCommande","pParam="+$.toJSON(d),function(e){Infobulle.init();if(e){if(e.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(e)}else{Infobulle.generer(e,"")}}},"json")};this.afficher=function(e){var d=this;var c=new GestionCommandeTemplate();if(e.listeCommande.length>0&&e.listeCommande[0].comId!=null){var f=new Object;f.commande=new Array();$(e.listeCommande).each(function(){var h=new Object();h.id=this.comId;h.numero=this.comNumero;h.dateFinReservation=this.comDateFinReservation.extractDbDate().dateDbToFr();h.heureFinReservation=this.comDateFinReservation.extractDbHeure();h.minuteFinReservation=this.comDateFinReservation.extractDbMinute();h.dateMarcheDebut=this.comDateMarcheDebut.extractDbDate().dateDbToFr();h.heureMarcheDebut=this.comDateMarcheDebut.extractDbHeure();h.minuteMarcheDebut=this.comDateMarcheDebut.extractDbMinute();h.heureMarcheFin=this.comDateMarcheFin.extractDbHeure();h.minuteMarcheFin=this.comDateMarcheFin.extractDbMinute();h.dateTimeFinResa=this.comDateFinReservation.replace("-","").replace(" ","").replace(":","");h.dateTimeMarche=this.comDateMarcheDebut.replace("-","").replace(" ","").replace(":","");f.commande.push(h)});var g=c.listeCommandeArchivePage;var b=$(g.template(f));if(e.listeCommande.length<16){b=this.masquerPagination(b)}else{b=this.paginnation(b)}$("#contenu").replaceWith(d.affect(b))}else{$("#contenu").replaceWith(d.affect($(c.listeCommandeArchiveVide)))}};this.affect=function(b){b=this.affectLienListeCommandeArchive(b);b=this.affectLienDetail(b);b=gCommunVue.comHoverBtn(b);return b};this.affectLienListeCommandeArchive=function(b){b.find("#lien-marche-encours").click(function(){GestionListeCommandeVue()});return b};this.paginnation=function(b){b.find("#table-marche-archive").tablesorter({sortList:[[2,1]],headers:{3:{sorter:false}}}).tablesorterPager({container:b.find("#content-nav-liste-operation"),positionFixed:false,size:15});return b};this.masquerPagination=function(b){b.find("#content-nav-liste-operation").hide();b.find("#table-marche-archive").tablesorter({sortList:[[2,1]],headers:{3:{sorter:false}}});return b};this.affectLienDetail=function(b){b.find(".detail-commande-ligne").click(function(){var c={id_marche:$(this).find(".id-commande").text()};EditerCommandeVue(c)});return b};this.construct(a)}function BonDeLivraisonVue(a){this.mCommunVue=new CommunVue();this.mIdCommande=null;this.mComNumero=null;this.mEtatEdition=false;this.mListeProduit=[];this.mSuiteEdition=0;this.mIdCompteProducteur=0;this.mTypePaiement=[];this.mResponse;this.mArchive=-1;this.construct=function(b){$.history({vue:function(){BonDeLivraisonVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=BonDeLivraison","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mEtatEdition=false;c.mArchive=d.archive;c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var d=this;var b=new GestionCommandeTemplate();var e=b.bonDeLivraison;this.mIdCommande=c.producteurs[0].proIdCommande;this.mComNumero=c.comNumero;$(c.typePaiement).each(function(){d.mTypePaiement[this.tppId]=this});$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affectDroitArchive=function(b){b.find("#btn-annuler").remove();b.find("#btn-enregistrer").remove();b.find("#btn-modifier").remove();return b};this.affect=function(b){b=this.mCommunVue.comHoverBtn(b);b=this.affectBtnRetourMarche(b);b=this.affectChangementProducteur(b);b=this.affectExportBonDeLivraison(b);return b};this.affectBtnRetourMarche=function(b){var c=this;b.find("#btn-editer-com").click(function(){EditerCommandeVue({id_marche:c.mIdCommande})});return b};this.affectChangementProducteur=function(b){var c=this;b.find("#select-prdt").change(function(){if(c.mEtatEdition){c.mSuiteEdition=1;c.dialogEnregistrer()}else{c.changementProducteur()}});return b};this.changementProducteur=function(){var c=this;var d=$("#select-prdt").val();if(d>0){var e={id_commande:c.mIdCommande,id_compte_ferme:d,fonction:"afficherProducteur"};$.post("./index.php?m=GestionCommande&v=BonDeLivraison","pParam="+$.toJSON(e),function(g){Infobulle.init();if(g){if(g.valid){c.mIdCompteProducteur=d;c.mEtatEdition=false;c.mResponse=g;if(g.operationProducteur&&g.operationProducteur.idCompte!=null){c.afficherDetail(g)}else{c.afficherFormulaire(g,1)}if(a&&a.vr){Infobulle.generer(a.vr,"")}}else{Infobulle.generer(g,"")}}},"json")}else{var b=new GestionCommandeTemplate();var f=b.listeProduitVide;$("#liste-pdt").replaceWith(f)}};this.afficherDetail=function(e){var g=this;var f=0;$(e.produits).each(function(){g.mListeProduit[this.proId]=parseFloat(this.stoQuantite);this.stoQuantiteCommande="";this.opeMontant="";var m=0;var k=this.proId;var l=this;l.stoQuantiteCommande="0".nombreFormate(2,","," ");l.opeMontantCommande="0".nombreFormate(2,","," ");l.stoQuantiteLivraison="";l.opeMontantLivraison="";l.stoQuantiteSolidaire="";$(e.produitsCommande).each(function(){if(this.proId==k){var n=0;if(this.stoQuantite!=null){l.stoQuantiteCommande=this.stoQuantite.nombreFormate(2,","," ")}if(this.dopeMontant!=null){l.opeMontantCommande=this.dopeMontant.nombreFormate(2,","," ");n=parseFloat(this.dopeMontant)}f+=n}});$(e.produitsLivraison).each(function(){if(this.proId==k){if(this.stoQuantite!=null){l.stoQuantiteLivraison=this.stoQuantite.nombreFormate(2,","," ");m+=parseFloat(this.stoQuantite)}if(this.dopeMontant!=null){l.opeMontantLivraison=this.dopeMontant.nombreFormate(2,","," ")}}});$(e.produitsSolidaire).each(function(){if(this.proId==k){if(this.stoQuantite!=null){l.stoQuantiteSolidaire=this.stoQuantite.nombreFormate(2,","," ");m+=parseFloat(this.stoQuantite)}}});if(m-parseFloat(this.stoQuantite)<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");this.masquerNormal="";if(this.proType==1){this.masquerNormal="ui-helper-hidden"}});e.total="";if(e.operationProducteur){if(e.operationProducteur.montant!=null){e.total=(e.operationProducteur.montant).nombreFormate(2,","," ")}if(e.operationProducteur.typePaiementChampComplementaire!=null){e.champComplementaire=e.operationProducteur.typePaiementChampComplementaire}}e.sigleMonetaire=gSigleMonetaire;e.totalCommande=f.nombreFormate(2,","," ");e.typePaiement=g.mTypePaiement;var c=new GestionCommandeTemplate();var j=c.listeProduitLivraison;if(e.operationProducteur&&e.operationProducteur.typePaiement!=null){e.tppType=g.mTypePaiement[e.operationProducteur.typePaiement].tppType}var b=g.affectListeProduit($(j.template(e)));if(e.operationProducteur&&e.operationProducteur.typePaiement!=null){var h=e.operationProducteur.typePaiement;b.find(":input[name=typepaiement]").selectOptions(h);var d=g.getLabelChamComplementaire(h);if(d!=null){b.find("#label-champ-complementaire").text(d);b.find("#tr-champ-complementaire").show()}else{b.find("#label-champ-complementaire").text("");b.find("#tr-champ-complementaire").hide()}}else{b.find("#label-champ-complementaire").text("");b.find("#tr-champ-complementaire").hide()}$("#liste-pdt").replaceWith(b)};this.afficherFormulaire=function(g,d){var f=this;var h=0;$(g.produits).each(function(){f.mListeProduit[this.proId]=parseFloat(this.stoQuantite);this.stoQuantiteCommande="";this.opeMontant="";var n=0;var l=this.proId;var m=this;m.stoQuantiteCommande="0".nombreFormate(2,","," ");m.opeMontantCommande="0".nombreFormate(2,","," ");m.stoQuantiteLivraison="";m.opeMontantLivraison="";m.stoQuantiteSolidaire="";$(g.produitsCommande).each(function(){if(this.proId==l){var o=0;if(this.stoQuantite!=null){m.stoQuantiteCommande=this.stoQuantite.nombreFormate(2,","," ")}if(this.dopeMontant!=null){m.opeMontantCommande=this.dopeMontant.nombreFormate(2,","," ");o=parseFloat(this.dopeMontant)}h+=o}});$(g.produitsLivraison).each(function(){if(this.proId==l){if(this.stoQuantite!=null){m.stoQuantiteLivraison=this.stoQuantite.nombreFormate(2,","," ");n+=parseFloat(this.stoQuantite)}if(this.dopeMontant!=null){m.opeMontantLivraison=this.dopeMontant.nombreFormate(2,","," ")}}});$(g.produitsSolidaire).each(function(){if(this.proId==l){if(this.stoQuantite!=null){m.stoQuantiteSolidaire=this.stoQuantite.nombreFormate(2,","," ");n+=parseFloat(this.stoQuantite)}}});if(n-parseFloat(this.stoQuantite)<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");this.masquerNormal="";if(this.proType==1){this.masquerNormal="ui-helper-hidden"}});g.total="";if(g.operationProducteur){if(g.operationProducteur.montant!=null){g.total=(g.operationProducteur.montant).nombreFormate(2,","," ")}if(g.operationProducteur.typePaiementChampComplementaire!=null){g.champComplementaire=g.operationProducteur.typePaiementChampComplementaire}}g.sigleMonetaire=gSigleMonetaire;g.totalCommande=h.nombreFormate(2,","," ");g.typePaiement=f.mTypePaiement;var b=new GestionCommandeTemplate();var c=b.listeProduitLivraison;var e=f.affectListeProduitFormulaire($(c.template(g)));if(g.operationProducteur&&g.operationProducteur.typePaiement!=null){var k=g.operationProducteur.typePaiement;e.find(":input[name=typepaiement]").selectOptions(k);var j=f.getLabelChamComplementaire(k);if(j!=null){e.find("#label-champ-complementaire").text(j);e.find("#tr-champ-complementaire").show()}else{e.find("#label-champ-complementaire").text("");e.find("#tr-champ-complementaire").hide()}}else{e.find("#label-champ-complementaire").text("");e.find("#tr-champ-complementaire").hide()}if(d==2){e.find("#btn-annuler").show()}$("#liste-pdt").replaceWith(e)};this.affectListeProduit=function(b){b=this.affectEtatCommande(b);b=this.affectEnregistrer(b);b=this.affectModifier(b);b=this.affectTypePaiement(b);b=this.affectChangementEtatEdition(b);b=this.affectMasquerFormulaire(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectListeProduitFormulaire=function(b){b=this.affectEtatCommande(b);b=this.affectEnregistrer(b);b=this.affectModifier(b);b=this.affectTypePaiement(b);b=this.affectChangementEtatEdition(b);b=this.affectMasquerDetail(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectMasquerDetail=function(b){b.find(".detail").hide();return b};this.affectMasquerFormulaire=function(b){b.find(".formulaire").hide();return b};this.affectTypePaiement=function(b){var c=this;b.find(":input[name=typepaiement]").change(function(){c.changerTypePaiement($(this))});return b};this.changerTypePaiement=function(d){var c=d.val();var b=this.getLabelChamComplementaire(c);if(b!=null){$("#label-champ-complementaire").text(b);$("#tr-champ-complementaire").show()}else{$("#label-champ-complementaire").text("");$(":input[name=champ-complementaire]").val("");$("#tr-champ-complementaire").hide()}};this.getLabelChamComplementaire=function(c){var b=this.mTypePaiement;if(b[c]){if(b[c].tppChampComplementaire==1){return b[c].tppLabelChampComplementaire}}return null};this.affectEtatCommande=function(b){var c=this;b.find(".qte-commande ,.qte-solidaire-commande ").keyup(function(){c.mEtatEdition=true;var e=$(this).prev(".pro-id-etat").text();if(c.mListeProduit[e]){var g=0;var f=$(":input[name=qte-commande-"+e+"]").val().numberFrToDb();var d=$(":input[name=qte-solidaire-commande-"+e+"]").val().numberFrToDb();if(!isNaN(f)&&!f.isEmpty()){g+=parseFloat(f)}if(!isNaN(d)&&!d.isEmpty()){g+=parseFloat(d)}if(g-c.mListeProduit[e]<0){$("#etat-commande-"+e).removeClass("qte-reservation-ok").addClass("qte-reservation-ko")}else{$("#etat-commande-"+e).removeClass("qte-reservation-ko").addClass("qte-reservation-ok")}}});return b};this.affectEnregistrer=function(b){var c=this;b.find("#btn-enregistrer").click(function(){c.mSuiteEdition=0;c.enregistrer()});b.find(".qte-commande ,.prix-commande ").keyup(function(d){if(d.keyCode=="13"){c.mSuiteEdition=0;c.enregistrer()}});return b};this.affectModifier=function(b){var c=this;b.find("#btn-modifier").click(function(){c.afficherFormulaire(c.mResponse,2)});b.find("#btn-annuler").click(function(){c.changementProducteur()});return b};this.enregistrer=function(){var c=this;var d=new ProduitsBonDeLivraisonVO();d.id_commande=this.mIdCommande;d.id_compte_ferme=this.mIdCompteProducteur;$(".pro-id").each(function(){var f=$(this).text();var g=new ProduitBonDeLivraisonVO();g.id=f;g.quantite=$(":input[name=qte-commande-"+f+"]").val().numberFrToDb();g.quantiteSolidaire=$(":input[name=qte-solidaire-commande-"+f+"]").val().numberFrToDb();g.prix=$(":input[name=prix-commande-"+f+"]").val().numberFrToDb();d.produits.push(g)});d.typePaiement=$(":input[name=typepaiement]").val();d.total=$(":input[name=total]").val().numberFrToDb();if(this.getLabelChamComplementaire(d.typePaiement)!=null){d.typePaiementChampComplementaireObligatoire=1;d.typePaiementChampComplementaire=$(":input[name=champ-complementaire]").val()}else{d.typePaiementChampComplementaireObligatoire=0}var b=new ProduitsBonDeLivraisonValid();var e=b.validAjout(d);if(e.valid){d.fonction="enregistrer";$.post("./index.php?m=GestionCommande&v=BonDeLivraison","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g){if(g.valid){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.dialogExportBonDeLivraison()}else{var h=new TemplateVR();h.valid=false;h.log.valid=false;var f=new VRerreur();f.code=ERR_301_CODE;f.message=ERR_301_MSG;h.log.erreurs.push(f);c.changementProducteur({vr:h})}}}else{Infobulle.generer(g,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}}},"json")}else{Infobulle.generer(e,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}};this.affectExportBonDeLivraison=function(b){var c=this;b.find("#btn-export-bcom").click(function(){if(c.mEtatEdition){c.mSuiteEdition=2;c.dialogEnregistrer()}else{c.dialogExportBonDeLivraison()}});return b};this.affectChangementEtatEdition=function(b){var c=this;b.find(".com-input-text").keyup(function(){c.mEtatEdition=true});b.find(":input[name=typepaiement]").change(function(){c.mEtatEdition=true});return b};this.dialogExportBonDeLivraison=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogExportBonDeLivraison;$(d.template({comNumero:c.mComNumero})).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var e=$(this).find(":input[name=format]:checked").val();var g=new ExportBonLivraisonVO();g.id_commande=c.mIdCommande;g.format=e;g.fonction="export";var f=new ExportBonLivraisonValid();var h=f.validAjout(g);Infobulle.init();if(h.valid){$.download("./index.php?m=GestionCommande&v=BonDeLivraison",g)}else{Infobulle.generer(h,"")}},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.dialogEnregistrer=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogEnregistrement;$(d).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Enregistrer:function(){c.enregistrer();$(this).dialog("close")},Annuler:function(){if(c.mSuiteEdition==1){$("#select-prdt").selectOptions(c.mIdCompteProducteur)}$(this).dialog("close")},"Ne pas Enregistrer":function(){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.changementProducteur();c.dialogExportBonDeLivraison()}}$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.construct(a)}function AchatAdherentVue(a){this.mAdherent=null;this.infoCommande=new Object();this.pdtCommande=new Array();this.reservation=[];this.achats=[];this.achatsSolidaire=[];this.infoReservation={};this.stockSolidaire=[];this.pParam={};this.construct=function(b){$.history({vue:function(){AchatAdherentVue(b)}});var c=this;this.pParam=b;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mAdherent=d.adherent;c.infoCommande.comId=d.marche.id;c.infoCommande.comNumero=d.marche.numero;c.infoCommande.comNom=d.marche.nom;c.infoCommande.comDescription=d.marche.description;c.infoCommande.dateTimeFinReservation=d.marche.dateFinReservation;c.infoCommande.dateFinReservation=d.marche.dateFinReservation.extractDbDate().dateDbToFr();c.infoCommande.heureFinReservation=d.marche.dateFinReservation.extractDbHeure();c.infoCommande.minuteFinReservation=d.marche.dateFinReservation.extractDbMinute();c.infoCommande.dateMarcheDebut=d.marche.dateMarcheDebut.extractDbDate().dateDbToFr();c.infoCommande.heureMarcheDebut=d.marche.dateMarcheDebut.extractDbHeure();c.infoCommande.minuteMarcheDebut=d.marche.dateMarcheDebut.extractDbMinute();c.infoCommande.heureMarcheFin=d.marche.dateMarcheFin.extractDbHeure();c.infoCommande.minuteMarcheFin=d.marche.dateMarcheFin.extractDbMinute();c.infoCommande.comArchive=d.marche.archive;c.pdtCommande=d.marche.produits;c.infoReservation=d.reservation;c.stockSolidaire=d.stockSolidaire;$.each(c.pdtCommande,function(){if(this.id){var e=this.id;$.each(this.lots,function(){if(this.id){var f=this.id;$(d.reservation.detailReservation).each(function(){if(this.idDetailCommande==f){this.stoQuantite=this.quantite*-1;this.dcomId=this.idDetailCommande;this.proId=e;this.montant=this.montant*-1;c.reservation[e]=this}})}})}});c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(k){var j=this;var c=new GestionCommandeTemplate();var e=c.detailAchatEtReservation;var f={};f.adhId=this.mAdherent.adhId;f.adhNumero=this.mAdherent.adhNumero;f.adhCompte=this.mAdherent.cptLabel;f.adhNom=this.mAdherent.adhNom;f.adhPrenom=this.mAdherent.adhPrenom;f.adhSolde=this.mAdherent.cptSolde.nombreFormate(2,","," ");f.sigleMonetaire=gSigleMonetaire;f.comNumero=this.infoCommande.comNumero;f.dateFinReservation=this.infoCommande.dateFinReservation;f.heureFinReservation=this.infoCommande.heureFinReservation;f.minuteFinReservation=this.infoCommande.minuteFinReservation;f.dateMarcheDebut=this.infoCommande.dateMarcheDebut;f.heureMarcheDebut=this.infoCommande.heureMarcheDebut;f.minuteMarcheDebut=this.infoCommande.minuteMarcheDebut;f.heureMarcheFin=this.infoCommande.heureMarcheFin;f.minuteMarcheFin=this.infoCommande.minuteMarcheFin;f.totalReservation=(this.infoReservation.total*-1).nombreFormate(2,","," ");f.reservation=[];var h=false;$.each(this.pdtCommande,function(){h=true;var o=this.id;var n={};n.id=this.id;n.nproNom=this.nom;n.proUniteMesure=this.unite;n.prix=0;n.stoQuantite=0;if(j.reservation[o]){n.stoQuantite=parseFloat(j.reservation[o].stoQuantite);n.prix=parseFloat(j.reservation[o].montant)}n.stoQuantite=n.stoQuantite.nombreFormate(2,","," ");n.prix=n.prix.nombreFormate(2,","," ");n.flagType="";if(this.type==2){n.flagType=c.flagAbonnement}f.reservation.push(n)});f.achats=[];f.achatsSolidaire=[];var g=0;$(k.achats).each(function(){var n=this;var q=[];var p=false;$.each(j.pdtCommande,function(){if(this.id){var s=this.id;var r={};r.id=this.id;r.nproNom=this.nom;r.proUniteMesure=this.unite;r.prix=0;r.stoQuantite=0;$.each(this.lots,function(){if(this.id){var t=this.id;$(n.detailAchat).each(function(){if(this.idDetailCommande==t){r.stoQuantite=this.quantite*-1;r.prix=this.montant*-1;g++;p=true}})}});r.flagType="";if(this.type==2){r.flagType=c.flagAbonnement}r.stoQuantite=r.stoQuantite.nombreFormate(2,","," ");r.prix=r.prix.nombreFormate(2,","," ");q.push(r)}});if(p){var o={achat:q,idAchat:this.id.idAchat,total:(this.total*-1).nombreFormate(2,","," ")};f.achats.push(o)}});if(g==0&&h){var m=[];$.each(j.pdtCommande,function(){if(this.id){var o=this.id;var n={};n.id=this.id;n.nproNom=this.nom;n.proUniteMesure=this.unite;n.stoQuantite="0".nombreFormate(2,","," ");n.prix="0".nombreFormate(2,","," ");n.flagType="";if(this.type==2){n.flagType=c.flagAbonnement}m.push(n)}});var d={achat:m,idAchat:"-1",total:"0".nombreFormate(2,","," ")};f.achats.push(d)}var b=0;$(k.achats).each(function(){var n=this;var q=[];var o=false;$.each(j.pdtCommande,function(){if(this.id){var s=false;var u=this;var t=this.id;var r={};r.id=this.id;r.nproNom=this.nom;r.proUniteMesure=this.unite;r.prix=0;r.stoQuantite=0;$(k.stockSolidaire).each(function(){if(r.id==this.proId){$.each(u.lots,function(){if(this.id){var v=this.id;$(n.detailAchatSolidaire).each(function(){if(this.idDetailCommande==v){r.stoQuantite=this.quantite*-1;r.prix=this.montant*-1;b++;o=true}})}});s=true}});if(s){r.flagType="";if(this.type==2){r.flagType=c.flagAbonnement}r.stoQuantite=r.stoQuantite.nombreFormate(2,","," ");r.prix=r.prix.nombreFormate(2,","," ");q.push(r)}}});if(o){var p={achat:q,idAchat:this.id.idAchat,totalSolidaire:(this.totalSolidaire*-1).nombreFormate(2,","," ")};f.achatsSolidaire.push(p)}});if(b==0&&k.stockSolidaire.length>0&&k.stockSolidaire[0].proId!=null){var m=[];$.each(j.pdtCommande,function(){if(this.id){var o=this.id;var n={};n.id=this.id;n.nproNom=this.nom;n.proUniteMesure=this.unite;n.stoQuantite="0".nombreFormate(2,","," ");n.prix="0".nombreFormate(2,","," ");n.flagType="";if(this.type==2){n.flagType=c.flagAbonnement}$(k.stockSolidaire).each(function(){if(n.id==this.proId){m.push(n)}})}});var d={achat:m,idAchat:"-2",totalSolidaire:"0".nombreFormate(2,","," ")};f.achatsSolidaire.push(d)}f.typeEtatReservation=[];var l={};l.value="-1";l.label="Aucune Réservation";l.selected="";f.typeEtatReservation[-1]=l;var l={};l.value="0";l.label="En réservation";l.selected="";f.typeEtatReservation[0]=l;var l={};l.value="7";l.label="Achetée";l.selected="";f.typeEtatReservation[7]=l;var l={};l.value="15";l.label="Non Récupérée";l.selected="";f.typeEtatReservation[15]=l;var l={};l.value="16";l.label="Supprimée";l.selected="";f.typeEtatReservation[16]=l;switch(this.infoReservation.etat){case"0":f.etatReservation="En réservation";f.typeEtatReservation[0].selected='selected="selected"';break;case"7":f.etatReservation="Achetée";f.typeEtatReservation[7].selected='selected="selected"';break;case"15":f.etatReservation="Non Récupérée";f.typeEtatReservation[15].selected='selected="selected"';break;case"16":f.etatReservation="Supprimée";f.typeEtatReservation[16].selected='selected="selected"';break;default:f.etatReservation="Aucune Réservation";f.typeEtatReservation[-1].selected='selected="selected"';break}$("#contenu").replaceWith(j.affect($(e.template(f))))};this.affectDroitArchive=function(b){b.find(".com-btn-header-multiples").remove();return b};this.affect=function(b){b=this.affectAnnulerDetailReservation(b);b=this.affectModifierReservation(b);b=this.affectValiderModifierReservation(b);b=this.affectModifierAchat(b);b=this.affectSupprimerAchat(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);if(this.infoCommande.comArchive==2){b=this.affectDroitArchive(b)}return b};this.affectAnnulerDetailReservation=function(b){var c=this;b.find("#btn-annuler").click(function(){ListeAchatMarcheVue({id_marche:c.infoCommande.comId})});return b};this.affectModifierReservation=function(b){var c=this;b.find("#btn-modif-resa").click(function(){c.modifierReservation()});return b};this.affectValiderModifierReservation=function(b){var c=this;b.find("#btn-check-resa").click(function(){c.validerModifierReservation()});return b};this.affectSupprimerAchat=function(b){var c=this;b.find(".achat, .achatSolidaire").each(function(){var d=$(this).find(".achat-id").text();b.find("#btn-supp-achat-"+d).click(function(){c.supprimerAchat(d)})});return b};this.affectModifierAchat=function(b){var c=this;b.find(".achat, .achatSolidaire").each(function(){var d=$(this).find(".achat-id").text();b.find("#btn-annuler-achat-"+d+", #btn-modif-achat-"+d).click(function(){c.modifierAchat(d)});b.find("#btn-check-achat-"+d).click(function(){c.validerModifierAchat(d)})});return b};this.modifierReservation=function(){$(".modif-resa, .resa-etat, .detail-resa-prix, .detail-resa-qte, .resa-total").toggle()};this.validerModifierReservation=function(){var b={};b.total=$("#reservation-total").val().numberFrToDb();b.etat=$("#reservation-etat").val();b.produits=[];var e=[];$(".ligne-produit-reservation").each(function(){var g=new ProduitAchatVO();g.id=$(this).find(".produit-id").text();var h=$(this).find(".produit-quantite").val().numberFrToDb();if(!isNaN(h)&&!h.isEmpty()&&h!=0){h=parseFloat(h);g.quantite=h*-1;var f=$(this).find(".produit-prix").val().numberFrToDb();if(!isNaN(f)&&!f.isEmpty()&&f!=0){f=parseFloat(f);g.prix=f*-1}b.produits.push(g)}else{var f=$(this).find(".produit-prix").val().numberFrToDb();if(!isNaN(f)&&!f.isEmpty()&&f!=0){f=parseFloat(f);g.prix=f*-1;b.produits.push(g)}}e.push(g)});b.id=this.infoReservation.id;var c=new ReservationAdherentValid();var d=c.validUpdate(b);Infobulle.init();if(d.valid){$(e).each(function(){if(isNaN(this.quantite)||this.quantite.isEmpty()){this.quantite=0}$("#reservation-"+this.id+"-quantite").text((this.quantite*-1).nombreFormate(2,","," "));if(isNaN(this.prix)||this.quantite.isEmpty()){this.prix=0}$("#reservation-"+this.id+"-prix").text((this.prix*-1).nombreFormate(2,","," "))});switch(b.etat){case"0":$("#reservation-etat-label").text("En réservation");break;case"7":$("#reservation-etat-label").text("Achetée");break;case"15":$("#reservation-etat-label").text("Non Récupérée");break;case"16":$("#reservation-etat-label").text("Supprimée");break;default:$("#reservation-etat-label").text("Aucune Réservation");break}if(isNaN(b.total)||b.total.isEmpty()){b.total=0}$("#reservation-total-label").text(b.total.nombreFormate(2,","," "));$(".modif-resa, .resa-etat, .detail-resa-prix, .detail-resa-qte, .resa-total").toggle()}else{Infobulle.generer(d,"reservation-")}};this.modifierAchat=function(b){$(".modif-achat-"+b+", .detail-achat-"+b+"-prix, .detail-achat-"+b+"-qte, .achat-"+b+"-total").toggle()};this.validerModifierAchat=function(e){var d=this;var b={};b.idAchat=e;b.total=$("#achat-"+e+"-total").val().numberFrToDb()*-1;b.produits=[];var h=[];$(".ligne-produit-achat-"+e).each(function(){var k=new ProduitAchatVO();k.id=$(this).find(".produit-id").text();var l=$(this).find(".produit-quantite").val().numberFrToDb();if(!isNaN(l)&&!l.isEmpty()&&l!=0){l=parseFloat(l);k.quantite=l*-1;var j=$(this).find(".produit-prix").val().numberFrToDb();if(!isNaN(j)&&!j.isEmpty()&&j!=0){j=parseFloat(j);k.prix=j*-1}b.produits.push(k)}else{var j=$(this).find(".produit-prix").val().numberFrToDb();if(!isNaN(j)&&!j.isEmpty()&&j!=0){j=parseFloat(j);k.prix=j*-1;b.produits.push(k)}}h.push(k)});if(parseInt(e)<0){b.idCompte=d.mAdherent.adhIdCompte;b.idMarche=d.pParam.id_marche}var c=new AchatAdherentValid();var g=c.validUpdate(b);Infobulle.init();if(g.valid){var f={fonction:"modifierAchat",achat:b};$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(f),function(l){Infobulle.init();if(l){if(l&&l.valid){var j=new TemplateVR();j.valid=false;j.log.valid=false;var k=new VRerreur();k.code=ERR_314_CODE;k.message=ERR_314_MSG;j.log.erreurs.push(k);if(b.idAchat<0){d.pParam.vr=j;d.construct(d.pParam)}else{$(h).each(function(){if(isNaN(this.quantite)||this.quantite.isEmpty()){this.quantite=0}$("#achat-"+e+"-"+this.id+"-quantite").text((this.quantite*-1).nombreFormate(2,","," "));if(isNaN(this.prix)||this.prix.isEmpty()){this.prix=0}$("#achat-"+e+"-"+this.id+"-prix").text((this.prix*-1).nombreFormate(2,","," "))});if(isNaN(b.total)||b.total.isEmpty()){b.total=0}$("#achat-"+e+"-total-label").text((b.total*-1).nombreFormate(2,","," "));$(".modif-achat-"+e+", .detail-achat-"+e+"-prix, .detail-achat-"+e+"-qte, .achat-"+e+"-total").toggle();Infobulle.generer(j,"")}}else{Infobulle.generer(l,"")}}},"json")}else{Infobulle.generer(g,"achat-"+e+"-")}};this.supprimerAchat=function(d){var c=this;var b=new GestionCommandeTemplate();var e=b.dialogSupprimerAchat;$(e).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var g=this;var f={fonction:"supprimerAchat",idAchat:d};$.post("./index.php?m=GestionCommande&v=AchatAdherent","pParam="+$.toJSON(f),function(k){Infobulle.init();if(k){if(k&&k.valid){var h=new TemplateVR();h.valid=false;h.log.valid=false;var j=new VRerreur();j.code=ERR_315_CODE;j.message=ERR_315_MSG;h.log.erreurs.push(j);c.pParam.vr=h;c.construct(c.pParam);$(g).dialog("close")}else{Infobulle.generer(k,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}})};this.construct(a)}function BonDeCommandeVue(a){this.mIdCommande=null;this.mComNumero=null;this.mEtatEdition=false;this.mListeProduit=[];this.mSuiteEdition=0;this.mIdCompteProducteur=0;this.mArchive=-1;this.construct=function(b){$.history({vue:function(){BonDeCommandeVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=BonDeCommande","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mEtatEdition=false;c.mArchive=d.archive;c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var d=this;var b=new GestionCommandeTemplate();var e=b.bonDeCommande;this.mIdCommande=c.producteurs[0].proIdCommande;this.mComNumero=c.comNumero;$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affectDroitArchive=function(b){b.find("#btn-annuler").remove();b.find("#btn-enregistrer").remove();b.find("#btn-modifier").remove();return b};this.affect=function(b){b=gCommunVue.comHoverBtn(b);b=this.affectBtnRetourMarche(b);b=this.affectChangementProducteur(b);b=this.affectExportBonCommande(b);return b};this.affectBtnRetourMarche=function(b){var c=this;b.find("#btn-editer-com").click(function(){EditerCommandeVue({id_marche:c.mIdCommande})});return b};this.affectChangementProducteur=function(b){var c=this;b.find("#select-prdt").change(function(){if(c.mEtatEdition){c.mSuiteEdition=1;c.dialogEnregistrer()}else{c.changementProducteur()}});return b};this.changementProducteur=function(c){var d=this;var e=$("#select-prdt").val();if(e>0){var f={id_commande:d.mIdCommande,id_compte_ferme:e,fonction:"afficherProducteur"};$.post("./index.php?m=GestionCommande&v=BonDeCommande","pParam="+$.toJSON(f),function(h){Infobulle.init();if(h){if(h.valid){d.mIdCompteProducteur=e;d.mEtatEdition=false;if(h.produitsCommande[0]&&h.produitsCommande[0].proIdCommande!=null){d.afficherDetail(h)}else{d.afficherFormulaire(h)}if(c&&c.vr){Infobulle.generer(c.vr,"")}}else{Infobulle.generer(h,"")}}},"json")}else{var b=new GestionCommandeTemplate();var g=b.listeProduitVide;$("#liste-pdt").replaceWith(g)}};this.afficherDetail=function(c){var d=this;$(c.produits).each(function(){d.mListeProduit[this.proId]=this.stoQuantite;this.stoQuantiteCommande="0";this.dopeMontant="0";var f=this.proId;var g=this;$(c.produitsCommande).each(function(){if(this.proId==f){g.stoQuantiteCommande=this.stoQuantite;g.dopeMontant=this.dopeMontant}});if(this.stoQuantiteCommande-this.stoQuantite<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}if(this.stoQuantiteCommande!=""){this.stoQuantiteCommande=this.stoQuantiteCommande.nombreFormate(2,","," ")}this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ");this.dopeMontant=this.dopeMontant.nombreFormate(2,","," ")});c.sigleMonetaire=gSigleMonetaire;var b=new GestionCommandeTemplate();var e=b.listeProduitBonDeCommande;$("#liste-pdt").replaceWith(d.affectListeProduit($(e.template(c))))};this.afficherFormulaire=function(c){var d=this;$(c.produits).each(function(){d.mListeProduit[this.proId]=this.stoQuantite;this.stoQuantiteCommande=this.stoQuantite;this.dopeMontant=(this.dopeMontant*-1).nombreFormate(2,","," ");if(this.stoQuantiteCommande-this.stoQuantite<0){this.classEtat="qte-reservation-ko"}else{this.classEtat="qte-reservation-ok"}if(this.stoQuantiteCommande!=""){this.stoQuantiteCommande=this.stoQuantiteCommande.nombreFormate(2,","," ")}this.stoQuantite=this.stoQuantite.nombreFormate(2,","," ")});c.sigleMonetaire=gSigleMonetaire;var b=new GestionCommandeTemplate();var e=b.listeProduitBonDeCommande;$("#liste-pdt").replaceWith(d.affectListeProduitFormulaire($(e.template(c))))};this.affectListeProduit=function(b){b=this.affectEtatCommande(b);b=this.affectEnregistrer(b);b=this.affectModifier(b);b=this.affectMasquerFormulaire(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectListeProduitFormulaire=function(b){b=this.affectEtatCommande(b);b=this.affectEnregistrer(b);b=this.affectModifier(b);b=this.affectMasquerDetail(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectMasquerDetail=function(b){b.find(".detail").hide();return b};this.affectMasquerFormulaire=function(b){b.find(".formulaire").hide();return b};this.affectEtatCommande=function(b){var c=this;b.find(":input").keyup(function(){c.mEtatEdition=true;var d=$(this).prev(".pro-id").text();if(c.mListeProduit[d]){if($(this).val().numberFrToDb()-c.mListeProduit[d]<0){$("#etat-commande-"+d).removeClass("qte-reservation-ok").addClass("qte-reservation-ko")}else{$("#etat-commande-"+d).removeClass("qte-reservation-ko").addClass("qte-reservation-ok")}}});return b};this.affectEnregistrer=function(b){var c=this;b.find("#btn-enregistrer").click(function(){c.mSuiteEdition=0;c.enregistrer()});b.find(".qte-commande ,.prix-commande ").keyup(function(d){if(d.keyCode=="13"){c.mSuiteEdition=0;c.enregistrer()}});return b};this.affectModifier=function(b){var c=this;b.find("#btn-modifier").click(function(){$(".detail").hide();$(".formulaire, #btn-annuler").show()});b.find("#btn-annuler").click(function(){c.changementProducteur()});return b};this.enregistrer=function(){var c=this;var d=new ProduitsBonDeCommandeVO();d.id_commande=this.mIdCommande;d.id_compte_ferme=this.mIdCompteProducteur;d.export_type=0;$(".pro-id").each(function(){var f=$(this).text();var g=new ProduitBonDeCommandeVO();g={id:f,quantite:$(":input[name=qte-commande-"+f+"]").val().numberFrToDb(),prix:$(":input[name=prix-commande-"+f+"]").val().numberFrToDb()};d.produits.push(g)});var b=new ProduitsBonDeCommandeValid();var e=b.validAjout(d);if(e.valid){d.fonction="enregistrer";return $.post("./index.php?m=GestionCommande&v=BonDeCommande","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g){if(g.valid){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.dialogExportBonDeCommande()}else{var h=new TemplateVR();h.valid=false;h.log.valid=false;var f=new VRerreur();f.code=ERR_301_CODE;f.message=ERR_301_MSG;h.log.erreurs.push(f);c.changementProducteur({vr:h})}}}else{Infobulle.generer(g,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}}},"json")}else{Infobulle.generer(e,"");$("#select-prdt").selectOptions(c.mIdCompteProducteur)}};this.affectExportBonCommande=function(b){var c=this;b.find("#btn-export-bcom").click(function(){if(c.mEtatEdition){c.mSuiteEdition=2;c.dialogEnregistrer()}else{c.dialogExportBonDeCommande()}});return b};this.dialogExportBonDeCommande=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogExportBonDeCommande;$(d.template({comNumero:c.mComNumero})).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var e=$(this).find(":input[name=format]:checked").val();var g=new ExportBonReservationVO();g.id_commande=c.mIdCommande;g.format=e;g.fonction="export";var f=new ExportBonReservationValid();var h=f.validAjout(g);Infobulle.init();if(h.valid){$.download("./index.php?m=GestionCommande&v=BonDeCommande",g)}else{Infobulle.generer(h,"")}},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.dialogEnregistrer=function(){var c=this;var b=new GestionCommandeTemplate();var d=b.dialogEnregistrement;$(d).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Enregistrer:function(){c.enregistrer();$(this).dialog("close")},Annuler:function(){if(c.mSuiteEdition==1){$("#select-prdt").selectOptions(c.mIdCompteProducteur)}$(this).dialog("close")},"Ne pas Enregistrer":function(){c.mEtatEdition=false;if(c.mSuiteEdition==1){c.changementProducteur()}else{if(c.mSuiteEdition==2){c.changementProducteur();c.dialogExportBonDeCommande()}}$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.construct(a)}function ReservationAdherentVue(a){this.mAdherent=null;this.infoCommande=new Object();this.pdtCommande=new Array();this.reservation=new Array();this.reservationModif=new Array();this.solde=0;this.soldeNv=0;this.mPremiereReservation=true;this.construct=function(b){$.history({vue:function(){ReservationAdherentVue(b)}});var c=this;b.fonction="afficherReservation";$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mAdherent=d.adherent;c.infoCommande.comId=d.marche.id;c.infoCommande.comNumero=d.marche.numero;c.infoCommande.comNom=d.marche.nom;c.infoCommande.comDescription=d.marche.description;c.infoCommande.dateTimeFinReservation=d.marche.dateFinReservation;c.infoCommande.dateFinReservation=d.marche.dateFinReservation.extractDbDate().dateDbToFr();c.infoCommande.heureFinReservation=d.marche.dateFinReservation.extractDbHeure();c.infoCommande.minuteFinReservation=d.marche.dateFinReservation.extractDbMinute();c.infoCommande.dateMarcheDebut=d.marche.dateMarcheDebut.extractDbDate().dateDbToFr();c.infoCommande.heureMarcheDebut=d.marche.dateMarcheDebut.extractDbHeure();c.infoCommande.minuteMarcheDebut=d.marche.dateMarcheDebut.extractDbMinute();c.infoCommande.heureMarcheFin=d.marche.dateMarcheFin.extractDbHeure();c.infoCommande.minuteMarcheFin=d.marche.dateMarcheFin.extractDbMinute();c.infoCommande.comArchive=d.marche.archive;c.pdtCommande=d.marche.produits;$.each(c.pdtCommande,function(){if(this.id){var e=this.id;$.each(this.lots,function(){if(this.id){var f=this.id;$(d.reservation).each(function(){if(this.idDetailCommande==f){this.stoQuantite=this.quantite*-1;this.dcomId=this.idDetailCommande;this.proId=e;c.reservation[e]=this}})}})}});if(d.reservation.length>0){c.mPremiereReservation=false;c.afficher(1)}else{c.afficher(2)}}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(b){if(b==1){this.afficherDetailReservation()}else{this.afficherModifier()}};this.afficherDetailReservation=function(){var e=this;var b=new GestionCommandeTemplate();var f=b.detailReservation;var c={};c.adhId=this.mAdherent.adhId;c.adhNumero=this.mAdherent.adhNumero;c.adhCompte=this.mAdherent.cptLabel;c.adhNom=this.mAdherent.adhNom;c.adhPrenom=this.mAdherent.adhPrenom;c.adhSolde=this.mAdherent.cptSolde.nombreFormate(2,","," ");c.sigleMonetaire=gSigleMonetaire;c.comNumero=this.infoCommande.comNumero;c.dateFinReservation=this.infoCommande.dateFinReservation;c.heureFinReservation=this.infoCommande.heureFinReservation;c.minuteFinReservation=this.infoCommande.minuteFinReservation;c.dateMarcheDebut=this.infoCommande.dateMarcheDebut;c.heureMarcheDebut=this.infoCommande.heureMarcheDebut;c.minuteMarcheDebut=this.infoCommande.minuteMarcheDebut;c.heureMarcheFin=this.infoCommande.heureMarcheFin;c.minuteMarcheFin=this.infoCommande.minuteMarcheFin;c.categories=[];var d=0;$.each(this.pdtCommande,function(){var h=this;if(e.reservation[this.id]){var g=new Object;g.proId=h.id;g.nproNom=this.nom;g.stoQuantite=parseFloat(e.reservation[this.id].stoQuantite);g.proUniteMesure=this.unite;g.prix=0;var j=e.reservation[this.id].dcomId;$.each(this.lots,function(){if(this.id==j){g.prix=(g.stoQuantite/this.taille)*this.prix}});d+=g.prix;g.stoQuantite=g.stoQuantite.nombreFormate(2,","," ");g.prix=g.prix.nombreFormate(2,","," ");if(!c.categories[this.idCategorie]){c.categories[this.idCategorie]={nom:this.cproNom,produits:[]}}g.flagType="";if(h.type==2){g.flagType=b.flagAbonnement}c.categories[this.idCategorie].produits.push(g)}});c.total=parseFloat(d).nombreFormate(2,","," ");$("#contenu").replaceWith(e.affect($(f.template(c))))};this.afficherModifier=function(){var e=this;var b=new GestionCommandeTemplate();var f=b.modifierReservation;var c={};c.adhId=this.mAdherent.adhId;c.adhNumero=this.mAdherent.adhNumero;c.adhCompte=this.mAdherent.cptLabel;c.adhNom=this.mAdherent.adhNom;c.adhPrenom=this.mAdherent.adhPrenom;c.adhSolde=this.mAdherent.cptSolde.nombreFormate(2,","," ");c.adhNouveauSolde=0;c.sigleMonetaire=gSigleMonetaire;c.comNumero=this.infoCommande.comNumero;c.dateFinReservation=this.infoCommande.dateFinReservation;c.heureFinReservation=this.infoCommande.heureFinReservation;c.minuteFinReservation=this.infoCommande.minuteFinReservation;c.dateMarcheDebut=this.infoCommande.dateMarcheDebut;c.heureMarcheDebut=this.infoCommande.heureMarcheDebut;c.minuteMarcheDebut=this.infoCommande.minuteMarcheDebut;c.heureMarcheFin=this.infoCommande.heureMarcheFin;c.minuteMarcheFin=this.infoCommande.minuteMarcheFin;c.categories=[];var d=0;$.each(this.pdtCommande,function(){if(this.id){var h={};h.proId=this.id;h.nproNom=this.nom;h.proUniteMesure=this.unite;h.proMaxProduitCommande=parseFloat(this.qteMaxCommande);h.flagType="";if(e.reservation[this.id]){h.stock=parseFloat(this.stockReservation)+parseFloat(e.reservation[this.id].stoQuantite)}else{h.stock=parseFloat(this.stockReservation)}h.lot=new Array();var m=false;if(parseFloat(this.qteMaxCommande)==-1&&parseFloat(this.stockInitial)==-1){m=true}else{if(parseFloat(this.stockInitial)==-1){h.max=h.proMaxProduitCommande}else{if(parseFloat(this.qteMaxCommande)==-1){h.max=h.stock}else{if(parseFloat(h.proMaxProduitCommande)<parseFloat(h.stock)){h.max=h.proMaxProduitCommande}else{h.max=h.stock}}}}var k=0;var j=-1;var l=-1;h.stoQuantiteReservation=0;h.prixReservation=0;$.each(this.lots,function(){if(this.id){if(m||(!m&&parseFloat(this.taille)<=h.max)){var n={};n.dcomId=this.id;n.dcomTaille=parseFloat(this.taille).nombreFormate(2,","," ");n.dcomPrix=parseFloat(this.prix).nombreFormate(2,","," ");n.prixReservation=parseFloat(this.prix);n.stoQuantiteReservation=parseFloat(this.taille);if(e.reservation[h.proId]&&(e.reservation[h.proId].dcomId==this.id)){n.stoQuantiteReservation=parseFloat(e.reservation[h.proId].stoQuantite);n.prixReservation=(n.stoQuantiteReservation/this.taille)*this.prix;d+=n.prixReservation;j=this.id;n.checked='checked="checked"';h.stoQuantiteReservation=n.stoQuantiteReservation.nombreFormate(2,","," ");h.prixReservation=n.prixReservation.nombreFormate(2,","," ")}if(h.prixReservation==0){h.stoQuantiteReservation=n.stoQuantiteReservation.nombreFormate(2,","," ");h.prixReservation=n.prixReservation.nombreFormate(2,","," ")}h.prixUnitaire=(n.prixReservation/n.stoQuantiteReservation).nombreFormate(2,","," ");h.lot.push(n)}}});c.total=parseFloat(d).nombreFormate(2,","," ");if(j!=-1){h.checked='checked="checked"'}else{h.checked=""}if(!c.categories[this.idCategorie]){c.categories[this.idCategorie]={nom:this.cproNom,produits:[]}}h.sigleMonetaire=gSigleMonetaire;var g=true;if(this.type==0){if(h.lot.length==0){h.nom=this.nom;h.detailProduit=b.produitIndisponible.template(h)}else{h.detailProduit=b.formReservationProduit.template(h)}}else{if(this.type==1){h.flagType=b.flagSolidaire;h.detailProduit=b.formReservationProduitInfo.template(h)}else{if(this.type==2){h.flagType=b.flagAbonnement;if(h.lot.length==0){g=false}else{h.detailProduit=b.formReservationProduit.template(h)}}}}if(g){c.categories[this.idCategorie].produits.push(h)}}});this.reservationModif=[];$(this.reservation).each(function(){if(this.proId){e.reservationModif[this.proId]={proId:this.proId,dcomId:this.dcomId,stoQuantite:this.stoQuantite}}});$("#contenu").replaceWith(e.affectModifier($(f.template(c))));this.majNouveauSolde()};this.affectDroitArchive=function(b){b.find(".boutons-edition").remove();b.find(".boutons-edition-modification").remove();return b};this.affect=function(b){b=this.affectModifierReservation(b);b=this.affectAnnulerDetailReservation(b);b=this.affectSupprimerReservation(b);b=this.affectInfoProduit(b);b=gCommunVue.comHoverBtn(b);if(this.infoCommande.comArchive==2){b=this.affectDroitArchive(b)}return b};this.affectModifier=function(b){b=this.affectBtnQte(b);b=this.affectChangementLot(b);b=this.affectChangementProduit(b);b=this.preparerAffichageModifier(b);b=this.affectValiderReservation(b);b=this.affectAnnulerReservation(b);b=this.supprimerSelect(b);b=this.affectNouveauSolde(b);b=this.affectInitLot(b);b=this.affectInfoProduit(b);b=gCommunVue.comHoverBtn(b);if(this.infoCommande.comArchive==2){b=this.affectDroitArchive(b)}return b};this.affectInfoProduit=function(b){var c=this;b.find(".btn-info-produit").click(function(){var e=$(this).attr("id-produit");var d={id:e,fonction:"detailProduit"};$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(d),function(h){Infobulle.init();if(h){if(h.valid){var g=new GestionCommandeTemplate();var j=g.dialogInfoProduit;h.produit.sigleMonetaire=gSigleMonetaire;var f=$(j.template(h.produit));if(h.produit.producteurs.length>0&&h.produit.producteurs[0].nPrdtIdNomProduit==null){f.find("#pro-prdt").remove()}if(h.produit.caracteristiques.length>0&&h.produit.caracteristiques[0].carProIdNomProduit==null){f.find("#pro-car").remove()}$(f).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,close:function(k,l){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(h,"")}}},"json")});return b};this.affectBtnQte=function(b){var c=this;b.find(".btn-plus").click(function(){Infobulle.init();var d=$(this).parent().parent().find(".pdt-id").text();c.nouvelleQuantite(d,$(this).parent().parent().find("#lot-"+d).val(),1)});b.find(".btn-moins").click(function(){Infobulle.init();var d=$(this).parent().parent().find(".pdt-id").text();c.nouvelleQuantite(d,$(this).parent().parent().find("#lot-"+d).val(),-1)});return b};this.affectChangementLot=function(b){var c=this;b.find(".pdt select").change(function(){Infobulle.init();c.changerLot($(this).parent().parent().find(".pdt-id").text(),$(this).val())});return b};this.affectChangementProduit=function(b){var c=this;b.find(".pdt :checkbox").click(function(){Infobulle.init();c.changerProduit($(this).parent().parent().find(".pdt-id").text())});return b};this.affectValiderReservation=function(b){var c=this;b.find("#btn-valider").click(function(){c.validerReservation()});return b};this.affectAnnulerReservation=function(b){var c=this;b.find("#btn-annuler").click(function(){if(c.mPremiereReservation){ListeReservationMarcheVue({id_marche:c.infoCommande.comId})}else{c.afficherDetailReservation()}});return b};this.affectModifierReservation=function(b){var c=this;b.find("#btn-modifier").click(function(){c.afficherModifier()});return b};this.affectAnnulerDetailReservation=function(b){var c=this;b.find("#btn-annuler").click(function(){ListeReservationMarcheVue({id_marche:c.infoCommande.comId})});return b};this.affectInitLot=function(b){var c=this;b.find(".pdt select").each(function(){var d=$(this).parent().parent().find(".pdt-id").text();var g=$(this).val();if(c.pdtCommande[d]&&c.pdtCommande[d].lots[g]){var e=c.pdtCommande[d].lots[g].prix;var h=c.pdtCommande[d].lots[g].taille;var f=(e/h).nombreFormate(2,","," ");$(b).find("#prix-unitaire-"+d).text(f)}});return b};this.nouvelleQuantite=function(g,o,b){var k=parseFloat(this.pdtCommande[g].qteMaxCommande);if(this.reservation[g]){var m=parseFloat(this.pdtCommande[g].stockReservation)+parseFloat(this.reservation[g].stoQuantite)}else{var m=parseFloat(this.pdtCommande[g].stockReservation)}var h=false;if(parseFloat(this.pdtCommande[g].qteMaxCommande)==-1&&parseFloat(this.pdtCommande[g].stockInitial)==-1){h=true}else{if(parseFloat(this.pdtCommande[g].stockInitial)==-1){k=this.pdtCommande[g].qteMaxCommande}else{if(parseFloat(this.pdtCommande[g].qteMaxCommande)==-1){k=m}else{if(parseFloat(m)<parseFloat(k)){k=m}}}}var p=this.pdtCommande[g].lots[o].taille;var n=this.pdtCommande[g].lots[o].prix;var e=0;if(this.reservationModif[g]&&(this.reservationModif[g].dcomId==o)){e=parseFloat(this.reservationModif[g].stoQuantite)/parseFloat(p)}e+=b;var c=0;c=e*p;if((h&&c>0)||(!h&&c>0&&c<=k)){var f=0;f=(e*n).toFixed(2);this.reservationModif[g].stoQuantite=c;$("#qte-pdt-"+g).text(parseFloat(c).nombreFormate(2,","," "));$("#prix-pdt-"+g).text(parseFloat(f).nombreFormate(2,","," "));this.majTotal()}else{if(c>k&&k!=-1){var j=new TemplateVR();j.valid=false;j.commandes=[];var d=new ReservationCommandeVR();d.valid=false;d.stoQuantite.valid=false;var l=new VRerreur();l.code=ERR_304_CODE;l.message=ERR_304_MSG;d.stoQuantite.erreurs.push(l);j.commandes[g]=d;Infobulle.generer(j,"")}}};this.changerLot=function(b,c){var d=this.pdtCommande[b].lots[c].prix;var f=this.pdtCommande[b].lots[c].taille;var e=(d/f).nombreFormate(2,","," ");$("#prix-unitaire-"+b).text(e);if(this.reservationModif[b]){this.reservationModif[b].dcomId=c;this.reservationModif[b].stoQuantite=f;$("#qte-pdt-"+b).text(f.nombreFormate(2,","," "));$("#prix-pdt-"+b).text(d.nombreFormate(2,","," "))}this.majTotal()};this.changerProduit=function(b){if(this.reservationModif[b]!=null){$(".resa-pdt-"+b).hide();$("#qte-pdt-"+b).text("");$("#prix-pdt-"+b).text("");this.reservationModif[b]=null}else{var e=$("#lot-"+b).val();var f=this.pdtCommande[b].lots[e].taille;var d={};d.comId=this.infoCommande.comId;d.proId=b;d.dcomId=e;d.stoQuantite=f;this.reservationModif[b]=d;$("#qte-pdt-"+b).text(f.nombreFormate(2,","," "));var c=this.pdtCommande[b].lots[e].prix.nombreFormate(2,","," ");$("#prix-pdt-"+b).text(c);$(".resa-pdt-"+b).show()}this.majTotal()};this.majTotal=function(){$("#total").text(this.calculTotal().nombreFormate(2,","," "));this.majNouveauSolde()};this.majNouveauSolde=function(){var b=this.mAdherent.cptSolde-this.calculTotal();if(b<=0){$("#nouveau-solde").addClass("com-nombre-negatif");$("#nouveau-solde-sigle").addClass("com-nombre-negatif")}else{$("#nouveau-solde").removeClass("com-nombre-negatif");$("#nouveau-solde-sigle").removeClass("com-nombre-negatif")}$("#nouveau-solde").text(b.nombreFormate(2,","," "))};this.affectNouveauSolde=function(c){var b=this.mAdherent.cptSolde-this.calculTotal();if(b<=0){c.find("#nouveau-solde").addClass("com-nombre-negatif");c.find("#nouveau-solde-sigle").addClass("com-nombre-negatif")}else{c.find("#nouveau-solde").removeClass("com-nombre-negatif");c.find("#nouveau-solde-sigle").removeClass("com-nombre-negatif")}c.find("#nouveau-solde").text(b.nombreFormate(2,","," "));return c};this.calculTotal=function(){var c=this;var b=0;$(this.reservationModif).each(function(){var d=this;if(d.stoQuantite){if(c.pdtCommande[d.proId]){$.each(c.pdtCommande[d.proId].lots,function(){if(d.dcomId==this.id){b+=(d.stoQuantite/this.taille)*this.prix}})}}});return b};this.preparerAffichageModifier=function(b){var c=this;$(b).find(".pdt").each(function(){var d=$(this).find(".pdt-id").text();if(c.reservation[d]!=null){var g=c.reservation[d];var f=g.dcomId;var h=g.stoQuantite;$(b).find("#qte-pdt-"+d).text(h.nombreFormate(2,","," "));var e=((c.pdtCommande[d].lots[f].prix*g.stoQuantite)/c.pdtCommande[d].lots[f].taille).nombreFormate(2,","," ");$(b).find("#prix-pdt-"+d).text(e);$(b).find("#lot-"+d).selectOptions(f);$(b).find(".resa-pdt-"+d).css("display","table-cell")}});return b};this.validerReservation=function(){var e=this;Infobulle.init();var c=new ListeReservationCommandeVO();var f=0;$(this.reservationModif).each(function(){if(this.stoQuantite){var h=new ReservationCommandeVO();h.stoQuantite=this.stoQuantite*-1;h.stoIdDetailCommande=this.dcomId;c.detailReservation.push(h);f++}});if(f>0){var d=new ListeReservationCommandeValid();var g=d.validAjout(c);if(!g.valid){Infobulle.generer(g,"")}else{c.fonction="modifierReservation";c.id_compte=this.mAdherent.adhIdCompte;$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(c),function(j){Infobulle.init();if(j){if(j.valid){e.reservation=[];$(e.reservationModif).each(function(){if(this.proId){e.reservation[this.proId]={proId:this.proId,dcomId:this.dcomId,stoQuantite:this.stoQuantite}}});if(e.mPremiereReservation){e.mPremiereReservation=false;var k=new TemplateVR();k.valid=false;k.log.valid=false;var h=new VRerreur();h.code=ERR_350_CODE;h.message=ERR_350_MSG;k.log.erreurs.push(h);Infobulle.generer(k,"")}else{var k=new TemplateVR();k.valid=false;k.log.valid=false;var h=new VRerreur();h.code=ERR_337_CODE;h.message=ERR_337_MSG;k.log.erreurs.push(h);Infobulle.generer(k,"")}e.afficher(1)}else{Infobulle.generer(j,"")}}},"json")}}else{var g=new TemplateVR();g.valid=false;g.log.valid=false;var b=new VRerreur();b.code=ERR_207_CODE;b.message=ERR_207_MSG;g.log.erreurs.push(b);Infobulle.generer(g,"")}};this.affectSupprimerReservation=function(b){var c=this;b.find("#btn-supprimer").click(function(){var d=new GestionCommandeTemplate();var e=d.supprimerReservationDialog;$(e).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var f={id_commande:c.infoCommande.comId,id_compte:c.mAdherent.adhIdCompte,fonction:"supprimerReservation"};var g=this;$.post("./index.php?m=GestionCommande&v=ReservationAdherent","pParam="+$.toJSON(f),function(j){Infobulle.init();if(j){if(j.valid){var k=new TemplateVR();k.valid=false;k.log.valid=false;var h=new VRerreur();h.code=ERR_303_CODE;h.message=ERR_303_MSG;k.log.erreurs.push(h);ListeReservationMarcheVue({id_marche:c.infoCommande.comId,vr:k});$(g).dialog("close")}else{Infobulle.generer(j,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove()}})});return b};this.supprimerSelect=function(b){b.find(".pdt select").each(function(){if($(this).find("option").size()==1){var c=new GestionCommandeTemplate();var e=c.lotUnique;var d={};d.IdPdt=$(this).parent().parent().find(".pdt-id").text();d.valeur=$(this).val();d.text=$(this).text();$(this).replaceWith(e.template(d))}});return b};this.construct(a)}function DupliquerMarcheVue(a){this.mListeFerme={};this.mProduits=[];this.mMarche=new MarcheVO();this.mAffichageMarche=[];this.mNbProduit=0;this.mEditionLot=false;this.mIdLot=0;this.mIdLotAbonnement=0;this.mEtapeCreationMarche=0;this.construct=function(b){$.history({vue:function(){DupliquerMarcheVue(b)}});var d=$.extend(d,b);d.fonction="dupliquer";var c=this;$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(d),function(e){Infobulle.init();if(e){if(e.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(e)}else{Infobulle.generer(e,"")}}},"json")};this.afficher=function(c){var d=this;$.each(c.marche.produits,function(){if(this.id){var q=this.ferId;var p=this.idCategorie;var k=this.idNom;var j=this.type;var n="";var m="";if(parseFloat(this.stockInitial)!=-1){n=this.stockInitial;m=this.stockInitial.nombreFormate(2,","," ")}var o="";var l="";if(parseFloat(this.qteMaxCommande)!=-1){o=this.qteMaxCommande;l=this.qteMaxCommande.nombreFormate(2,","," ")}var f=this.unite;var h={nproId:k,nproNom:this.nom,nproStock:m,nproQteMax:l,nproUnite:f,type:j,modelesLot:[]};var g=new ProduitMarcheVO();g.idNom=k;g.unite=f;g.qteMaxCommande=o;g.qteRestante=n;g.type=j;$.each(this.lots,function(){var r=this.id;var s={id:r,taille:this.taille.nombreFormate(2,","," "),prix:this.prix.nombreFormate(2,","," "),unite:f,selected:true,modele:true};h.modelesLot[r]=s;var s=new DetailCommandeVO();s.taille=this.taille;s.prix=this.prix;g.lots.push(s)});if(!d.mAffichageMarche[q]){d.mAffichageMarche[q]={ferId:q,ferNom:this.ferNom,categories:[]}}if(!d.mAffichageMarche[q].categories[p]){d.mAffichageMarche[q].categories[p]={cproId:p,cproNom:this.cproNom,produits:[],produitsAbonnement:[]}}g.idFerme=q;g.idCategorie=p;if(j==2){d.mAffichageMarche[q].categories[p].produitsAbonnement[k]=h;d.mMarche.produitsAbonnement[k]=g}else{d.mAffichageMarche[q].categories[p].produits[k]=h;d.mMarche.produits[k]=g}d.mNbProduit++}});this.mListeFerme=c.listeFerme;var b=new GestionCommandeTemplate();var e=b.formulaireAjoutMarche;$("#contenu").replaceWith(d.affect($(e.template(c))))};this.affect=function(b){b=this.affectDialogAjoutProduit(b);b=this.affectControleDatepicker(b);b=this.affectInitListeFerme(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);return b};this.affectDialogAjoutProduit=function(b){var c=this;b.find("#btn-ajout-produit").click(function(){var d=new GestionCommandeTemplate();var e=d.dialogAjoutProduitAjoutMarche;$(c.affectAjoutProduitSelectFerme($(e.template({listeFerme:c.mListeFerme})))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Ajouter:function(){c.ajouterProduit($(this))},Annuler:function(){c.mEditionLot=false;$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}})});return b};this.affectAjoutProduitSelectFerme=function(b){var c=this;b.find("#pro-idFerme select").change(function(){var e=$(this).val();$("#pro-idCategorie select, #pro-idProduit select").attr("disabled","disabled").selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');if(e>0){var d={fonction:"listeProduit",id:e};$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(d),function(j){if(j){if(j.valid){Infobulle.init();if(j.listeProduit.length>0&&j.listeProduit[0].nproId!=null){c.mProduits=[];var h=0;var l=[];$.each(j.listeProduit,function(){if(c.mProduits[this.cproId]){c.mProduits[this.cproId].listeProduit.push(this)}else{c.mProduits[this.cproId]={nom:this.cproNom,listeProduit:[this]}}if(h!=this.cproId){l.push({cproId:this.cproId,cproNom:this.cproNom});h=this.cproId}});var f=new GestionCommandeTemplate();var k=f.ajoutProduitSelectCategorie;$("#pro-idCategorie").replaceWith(c.affectAjoutProduitSelectCategorie($(k.template({listeCategorie:l}))))}else{var m=new TemplateVR();m.valid=false;m.log.valid=false;var g=new VRerreur();g.code=ERR_332_CODE;g.message=ERR_332_MSG;m.log.erreurs.push(g);Infobulle.generer(m,"")}}else{Infobulle.generer(j,"")}}},"json")}});return b};this.affectAjoutProduitSelectCategorie=function(b){var c=this;b.find("select").change(function(){var f=$(this).val();$("#pro-idProduit select").attr("disabled","disabled").selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');if(f>0){var d=new GestionCommandeTemplate();var e=d.ajoutProduitSelectProduit;$("#pro-idProduit").replaceWith(c.affectAjoutProduitSelectProduit($(e.template(c.mProduits[f]))))}});return b};this.affectAjoutProduitSelectProduit=function(b){var c=this;b.find("select").change(function(){var g=$(this).val();if(g>0){if(!c.mMarche.produits[g]||!c.mMarche.produitsAbonnement[g]){var e={fonction:"listeModeleLot",idNomProduit:g};$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(e),function(k){if(k){if(k.valid){Infobulle.init();var h=new GestionCommandeTemplate();var j={sigleMonetaire:gSigleMonetaire};if(k.detailAbonnement.idNomProduit==g){j.uniteAbonnement=k.detailAbonnement.unite}if(k.modelesLot.length>0&&k.modelesLot[0].mLotId!=null){j.modelesLot=[];j.modelesLotAbonnement=[];$(k.modelesLot).each(function(){if(this.mLotId!=null){this.id=this.mLotId;this.quantite=this.mLotQuantite.nombreFormate(2,","," ");this.unite=this.mLotUnite;this.prix=this.mLotPrix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;j.modelesLot.push(this);j.unite=this.mLotUnite;if(j.uniteAbonnement==this.mLotUnite){j.modelesLotAbonnement.push(this)}}})}if(c.mMarche.produits[g]){j.typeNormalSelected='disabled="disabled"';j.typeSolidaireSelected='disabled="disabled"';j.typeAbonnementSelected='checked="checked"';j.visibleSolidaire="ui-helper-hidden";j.visibleNormal="ui-helper-hidden";j.visibleAbonnement=""}else{if(c.mMarche.produitsAbonnement[g]){j.typeNormalSelected='checked="checked"';j.typeAbonnementSelected='disabled="disabled"';j.visibleSolidaire="";j.visibleNormal="";j.visibleAbonnement="ui-helper-hidden"}else{j.typeNormalSelected='checked="checked"';j.visibleSolidaire="";j.visibleNormal="";j.visibleAbonnement="ui-helper-hidden"}}if(k.detailAbonnement.idNomProduit==g){j.stockInitialAbonnement=k.detailAbonnement.stockInitial.nombreFormate(2,","," ");if(parseFloat(k.detailAbonnement.max)==-1){j.qMaxAbonnement="Pas de limite"}else{j.qMaxAbonnement=k.detailAbonnement.max.nombreFormate(2,","," ")+" "+j.uniteAbonnement}j.qMaxAbonnementValue=k.detailAbonnement.max;j.typeProduitAbonnement=h.typeProduitAbonnementAjoutProduit.template(j);j.divLotAbonnement=h.prixAbonnementAjoutProduit.template(j);j.divStockAbonnement=h.stockAbonnementAjoutProduit.template(j)}j.divTypeProduit=h.typeProduitAjoutProduit.template(j);j.divLot=h.prixAjoutProduit.template(j);j.divStock=h.stockAjoutProduit.template(j);var l=h.prixEtStockAjoutProduit;$("#prix-stock-produit").replaceWith(c.affectPrixEtStock($(l.template(j))))}else{Infobulle.generer(k,"")}}},"json")}else{var f=new Object();var d=new VRerreur();d.code=ERR_211_CODE;d.message=ERR_211_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(d);Infobulle.generer(f,"")}}else{$("#prix-stock-produit").replaceWith($('<div id="prix-stock-produit">'))}});return b};this.affectPrixEtStock=function(b){b=this.affectAjoutLotGestion(b);b=this.affectAjoutLotAbonnementGestion(b);b=this.affectAjoutLot(b);b=this.affectLimiteStock(b);b=this.affectChangeTypeProduit(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectChangeTypeProduit=function(b){var c=this;b.find(":input[name=typeProduit]").click(function(){return c.testChangeTypeProduit($(":input[name=typeProduit]:checked").val())}).change(function(){c.changeTypeProduit($(":input[name=typeProduit]:checked").val())});return b};this.testChangeTypeProduit=function(c){if(this.mEditionLot){var d=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;d.valid=false;d.log=new VRelement();d.log.valid=false;d.log.erreurs.push(b);Infobulle.generer(d,"");return false}return true};this.changeTypeProduit=function(c){if(!this.mEditionLot){$(".pro-detail").hide();if(c==0){$("#pro-normal,#id-stock").show()}else{if(c==1){$("#pro-normal").show()}else{$("#pro-abonnement").show()}}}else{var d=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;d.valid=false;d.log=new VRelement();d.log.valid=false;d.log.erreurs.push(b);Infobulle.generer(d,"");return false}};this.affectLimiteStock=function(b){b.find(":input[name=pro-stock-choix]").change(function(){if($(":input[name=pro-stock-choix]:checked").val()==1){$(":input[name=pro-stock]").attr("disabled","").val("")}else{$(":input[name=pro-stock]").attr("disabled","disabled").val("")}});b.find(":input[name=pro-qte-max-choix]").change(function(){if($(":input[name=pro-qte-max-choix]:checked").val()==1){$(":input[name=pro-qte-max]").attr("disabled","").val("")}else{$(":input[name=pro-qte-max]").attr("disabled","disabled").val("")}});return b};this.affectAjoutLot=function(b){var c=this;b.find("#btn-ajout-lot").click(function(){c.ajoutLot(1)});b.find("#table-pro-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(1)}});b.find("#btn-ajout-lot-abonnement").click(function(){c.ajoutLot(2)});b.find("#table-pro-abonnement-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(2)}});return b};this.ajoutLot=function(d){var c=new ModeleLotVO();if(d==1){c.quantite=$(":input[name=lot-quantite]").val().numberFrToDb();c.unite=$(":input[name=lot-unite]").val();c.prix=$(":input[name=lot-prix]").val().numberFrToDb()}else{c.quantite=$(":input[name=lot-abo-quantite]").val().numberFrToDb();c.unite=$("#pro-abo-lot-unite").text();c.prix=$(":input[name=lot-abo-prix]").val().numberFrToDb()}var e=new ModeleLotValid();var g=e.validAjout(c);if(g.valid){Infobulle.init();var b=new GestionCommandeTemplate();if(d==1){var f=b.modeleLot;this.mIdLot--;c.id=this.mIdLot;c.sigleMonetaire=gSigleMonetaire;c.quantite=c.quantite.nombreFormate(2,","," ");c.prix=c.prix.nombreFormate(2,","," ");$("#lot-liste").append(this.affectLot($(f.template(c))));$(":input[name=lot-quantite], :input[name=lot-unite], :input[name=lot-prix]").val("")}else{var f=b.modeleLotAbonnement;this.mIdLotAbonnement--;c.id=this.mIdLotAbonnement;c.sigleMonetaire=gSigleMonetaire;c.quantite=c.quantite.nombreFormate(2,","," ");c.prix=c.prix.nombreFormate(2,","," ");$("#lot-liste-abonnement").append(this.affectLotAbonnement($(f.template(c))));$(":input[name=lot-abo-quantite], :input[name=lot-abo-unite], :input[name=lot-abo-prix]").val("")}}else{if(d==1){Infobulle.generer(g,"pro-lot-")}else{Infobulle.generer(g,"pro-abo-lot-")}}};this.affectLot=function(b){b=this.affectAjoutLotGestion(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectLotAbonnement=function(b){b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);b=this.affectAjoutLotAbonnementGestion(b);return b};this.affectAjoutLotGestion=function(b){var c=this;b.find(".btn-modifier-lot").click(function(){c.ajoutLotModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot").click(function(){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot").click(function(){c.ajoutLotAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot").click(function(){c.ajoutLotSupprimer($(this).closest("tr").find("#id-lot").text())});b.find(":checkbox").change(function(){if(!c.majUnite()){if($(this).attr("checked")){$(this).removeAttr("checked")}else{$(this).attr("checked","checked")}}});return b};this.affectAjoutLotAbonnementGestion=function(b){var c=this;b.find(".btn-modifier-lot-abonnement").click(function(){c.ajoutLotAbonnementModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot-abonnement").click(function(){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot-abonnement").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot-abonnement").click(function(){c.ajoutLotAbonnementAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot-abonnement").click(function(){c.ajoutLotAbonnementSupprimer($(this).closest("tr").find("#id-lot").text())});return b};this.majUnite=function(){var d=true;var c=0;var e="";$(".ligne-lot :checkbox:checked").each(function(){var g=$(this).closest(".ligne-lot").find(".lot-unite").text();if(e!=""&&e!=g){d=false}else{e=g}c++});if(d){if(c>0){$(".unite-stock").text(e)}}else{var f=new Object();var b=new VRerreur();b.code=ERR_333_CODE;b.message=ERR_333_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(b);Infobulle.generer(f,"")}return d};this.ajoutLotModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();$("#pro-lot-"+b+"-quantite").val($("#lot-"+b+"-quantite").text());$("#pro-lot-"+b+"-unite").val($("#lot-"+b+"-unite").text());$("#pro-lot-"+b+"-prix").val($("#lot-"+b+"-prix").text());this.mEditionLot=true};this.ajoutLotAbonnementModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();$("#pro-lot-abonnement"+b+"-quantite").val($("#lot-"+b+"-quantite-abonnement").text());$("#pro-lot-abonnement"+b+"-unite").val($("#lot-"+b+"-unite-abonnement").text());$("#pro-lot-abonnement"+b+"-prix").val($("#lot-"+b+"-prix-abonnement").text());this.mEditionLot=true};this.ajoutLotValiderModification=function(c){var b=new ModeleLotVO();b.quantite=$("#pro-lot-"+c+"-quantite").val().numberFrToDb();b.unite=$("#pro-lot-"+c+"-unite").val();b.prix=$("#pro-lot-"+c+"-prix").val().numberFrToDb();var d=new ModeleLotValid();var e=d.validAjout(b);if(e.valid){Infobulle.init();$("#lot-"+c+"-quantite").text(b.quantite.nombreFormate(2,","," "));$("#lot-"+c+"-unite").text(b.unite);$("#lot-"+c+"-prix").text(b.prix.nombreFormate(2,","," "));$(".btn-lot, #btn-annuler-lot-"+c+", #btn-valider-lot-"+c+", .champ-lot-"+c).toggle();this.mEditionLot=false;this.majUnite()}else{Infobulle.generer(e,"pro-lot-"+c+"-")}};this.ajoutLotAbonnementValiderModification=function(c){var b=new ModeleLotVO();b.quantite=$("#pro-lot-abonnement"+c+"-quantite").val().numberFrToDb();b.unite=$("#pro-lot-abonnement"+c+"-unite").val();b.prix=$("#pro-lot-abonnement"+c+"-prix").val().numberFrToDb();var d=new ModeleLotValid();var e=d.validAjout(b);if(e.valid){Infobulle.init();$("#lot-"+c+"-quantite-abonnement").text(b.quantite.nombreFormate(2,","," "));$("#lot-"+c+"-unite-abonnement").text(b.unite);$("#lot-"+c+"-prix-abonnement").text(b.prix.nombreFormate(2,","," "));$(".btn-lot-abonnement, #btn-annuler-lot-"+c+"-abonnement, #btn-valider-lot-"+c+"-abonnement, .champ-lot-"+c+"-abonnement").toggle();this.mEditionLot=false}else{Infobulle.generer(e,"pro-lot-abonnement"+c+"-")}};this.ajoutLotAnnulerModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();this.mEditionLot=false};this.ajoutLotAbonnementAnnulerModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();this.mEditionLot=false};this.ajoutLotSupprimer=function(b){$("#ligne-lot-"+b).remove()};this.ajoutLotAbonnementSupprimer=function(b){$("#ligne-lot-abonnement-"+b).remove()};this.ajouterProduit=function(j){var g=this;if(!this.mEditionLot){var p=j.find(":input[name=ferme]").val();var n=j.find(":input[name=categorie]").val();var f=j.find(":input[name=produit]").val();var e=j.find(":input[name=typeProduit]:checked").val();if(f!=0){if(e==2){var m=j.find("#stock-abonnement").text().numberFrToDb()}else{var m=j.find(":input[name=pro-stock]").val().numberFrToDb()}if(j.find(":input[name=pro-stock-choix]:checked").val()==1&&m==""&&e==0){var q=new Object();var k=new VRerreur();k.code=ERR_201_CODE;k.message=ERR_201_MSG;q.valid=false;q.qteRestante=new VRelement();q.qteRestante.valid=false;q.qteRestante.erreurs.push(k);Infobulle.generer(q,"pro-")}else{var l=0;if(e==2){l=j.find("#max-abonnement").text().numberFrToDb()}else{if(e==0){l=j.find(":input[name=pro-qte-max]").val().numberFrToDb()}}if(j.find(":input[name=pro-qte-max-choix]:checked").val()==1&&l==""&&e==0){var q=new Object();var k=new VRerreur();k.code=ERR_201_CODE;k.message=ERR_201_MSG;q.valid=false;q.qteMaxCommande=new VRelement();q.qteMaxCommande.valid=false;q.qteMaxCommande.erreurs.push(k);Infobulle.generer(q,"pro-")}else{if(e==2){var b=j.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{var b=j.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}if(e==2&&this.mMarche.produitsAbonnement[f]){var q=new Object();var k=new VRerreur();k.code=ERR_253_CODE;k.message=ERR_253_MSG;q.valid=false;q.qteMaxCommande=new VRelement();q.qteMaxCommande.valid=false;q.qteMaxCommande.erreurs.push(k);Infobulle.generer(q,"pro-")}else{if(e<2&&this.mMarche.produits[f]){var q=new Object();var k=new VRerreur();k.code=ERR_211_CODE;k.message=ERR_211_MSG;q.valid=false;q.qteMaxCommande=new VRelement();q.qteMaxCommande.valid=false;q.qteMaxCommande.erreurs.push(k);Infobulle.generer(q,"pro-")}else{var d={nproId:f,nproNom:j.find(":input[name=produit] option:selected").text(),nproStock:m,nproQteMax:l,nproUnite:b,type:e,modelesLot:[]};if(e==2){j.find(".ligne-lot-abonnement :checkbox").each(function(){var r=false;if($(this).hasClass("modele-lot")){r=true}var t=false;if($(this).attr("checked")){t=true}if(r||t){var s=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();var u={id:s,taille:$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot-abonnement").find(".lot-unite").text(),selected:t,modele:r};d.modelesLot[s]=u}})}else{j.find(".ligne-lot :checkbox").each(function(){var r=false;if($(this).hasClass("modele-lot")){r=true}var t=false;if($(this).attr("checked")){t=true}if(r||t){var s=$(this).closest(".ligne-lot").find(".lot-id").text();var u={id:s,taille:$(this).closest(".ligne-lot").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot").find(".lot-unite").text(),selected:t,modele:r};d.modelesLot[s]=u}})}if(!this.mAffichageMarche[p]){this.mAffichageMarche[p]={ferId:p,ferNom:j.find(":input[name=ferme] option:selected").text(),categories:[]}}if(!this.mAffichageMarche[p].categories[n]){this.mAffichageMarche[p].categories[n]={cproId:n,cproNom:j.find(":input[name=categorie] option:selected").text(),produits:[],produitsAbonnement:[]}}var c=new ProduitMarcheVO();c.idNom=f;c.unite=b;c.qteMaxCommande=l;c.qteRestante=m;c.type=e;if(e==2){j.find(".ligne-lot-abonnement :checkbox:checked").each(function(){var r=new DetailCommandeVO();r.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();r.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();c.lots.push(r)})}else{j.find(".ligne-lot :checkbox:checked").each(function(){var r=new DetailCommandeVO();r.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();r.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();c.lots.push(r)})}c.idFerme=p;c.idCategorie=n;if(e==1){c.qteMaxCommande=-1;c.qteRestante=-1}var o=new ProduitMarcheValid();var h=o.validAjout(c);if(h.valid){Infobulle.init();if(e==2){this.mMarche.produitsAbonnement[f]=c;this.mAffichageMarche[p].categories[n].produitsAbonnement[f]=d}else{this.mMarche.produits[f]=c;this.mAffichageMarche[p].categories[n].produits[f]=d}this.mNbProduit++;g.affectInitListeFerme();j.dialog("close")}else{if(e==2){Infobulle.generer(h,"pro-abo-")}else{Infobulle.generer(h,"pro-")}}}}}}}}else{var q=new Object();var k=new VRerreur();k.code=ERR_112_CODE;k.message=ERR_112_MSG;q.valid=false;q.log=new VRelement();q.log.valid=false;q.log.erreurs.push(k);Infobulle.generer(q,"")}};this.affectInitListeFerme=function(d){var e=this;var b=new GestionCommandeTemplate();var f=[];$(e.mAffichageMarche).each(function(){if(this.ferId){var h=[];$(this.categories).each(function(){if(this.cproId){var j=[];$(this.produits).each(function(){if(this.nproId){j.push([this.nproNom,this.nproId,this.type])}});$(this.produitsAbonnement).each(function(){if(this.nproId){j.push([this.nproNom,this.nproId,this.type])}});j.sort(sortABC);h.push([this.cproNom,this.cproId,j])}});h.sort(sortABC);f.push([this.ferNom,this.ferId,h])}});f.sort(sortABC);var c={fermes:[]};$(f).each(function(j,m){var n=m[1];var l=m[2];if(e.mAffichageMarche[n]){var k=false;var h={ferId:e.mAffichageMarche[n].ferId,ferNom:e.mAffichageMarche[n].ferNom,categories:[]};$(l).each(function(o,s){var p=s[1];var t=s[2];if(e.mAffichageMarche[n].categories[p]){var r=false;var q={cproId:e.mAffichageMarche[n].categories[p].cproId,cproNom:e.mAffichageMarche[n].categories[p].cproNom,produits:[]};$(t).each(function(w,y){var x=y[1];var v=y[2];var u="";if(v==2){u=b.flagAbonnement;if(e.mAffichageMarche[n].categories[p].produitsAbonnement[x]){q.produits.push({nproId:e.mAffichageMarche[n].categories[p].produitsAbonnement[x].nproId,nproNom:e.mAffichageMarche[n].categories[p].produitsAbonnement[x].nproNom,type:v,abonnement:u});k=true;r=true}}else{if(e.mAffichageMarche[n].categories[p].produits[x].type==1){u=b.flagSolidaire}if(e.mAffichageMarche[n].categories[p].produits[x]){q.produits.push({nproId:e.mAffichageMarche[n].categories[p].produits[x].nproId,nproNom:e.mAffichageMarche[n].categories[p].produits[x].nproNom,type:v,abonnement:u});k=true;r=true}}});if(r){h.categories.push(q)}}});if(k){c.fermes.push(h)}}});var g=b.ajoutMarcheListeProduit;if(d){d.find("#liste-ferme").replaceWith(this.affectListeProduit($(g.template(c))))}else{$("#liste-ferme").replaceWith(this.affectListeProduit($(g.template(c))))}if(this.mNbProduit>0){if($("#btn-gestion-marche").length<1){if(d){d.find("#liste-ferme").after(this.affectCeerMarche($(b.btnValiderAjoutMarche)))}else{$("#liste-ferme").after(this.affectCeerMarche($(b.btnValiderAjoutMarche)))}}}else{if(d){d.find("#btn-gestion-marche").remove()}else{$("#btn-gestion-marche").remove()}}if(d){return d}};this.affectListeProduit=function(b){b=this.affectModifierProduit(b);b=this.affectSupprimerProduit(b);b=gCommunVue.comHoverBtn(b);return b};this.affectModifierProduit=function(b){var c=this;b.find(".btn-modifier-produit").click(function(){c.dialogModifierProduit($(this).attr("id-produit"),$(this).attr("typeProduit"))});return b};this.dialogModifierProduit=function(j,e){var h=this;var c=new GestionCommandeTemplate();if(e==0||e==1){var m=this.mMarche.produits[j].idFerme;var l=this.mMarche.produits[j].idCategorie;var f={ferId:m,ferNom:this.mAffichageMarche[m].ferNom,cproId:l,cproNom:this.mAffichageMarche[m].categories[l].cproNom,nproId:j,nproNom:this.mAffichageMarche[m].categories[l].produits[j].nproNom,nproStock:this.mAffichageMarche[m].categories[l].produits[j].nproStock.nombreFormate(2,","," "),nproQteMax:this.mAffichageMarche[m].categories[l].produits[j].nproQteMax.nombreFormate(2,","," "),modelesLot:[]};f.typeProduitLabel="Solidaire";for(i in this.mAffichageMarche[m].categories[l].produits[j].modelesLot){var k=this.mAffichageMarche[m].categories[l].produits[j].modelesLot[i];if(k.id){var g={id:k.id,quantite:k.taille,prix:k.prix,unite:k.unite,sigleMonetaire:gSigleMonetaire};if(k.selected){g.checked='checked="checked"';f.unite=k.unite}else{g.checked=""}if(k.modele){g.modele="modele-lot"}else{g.modele=""}f.modelesLot.push(g)}}if(e==0){f.typeProduitLabel="Normal";if(this.mMarche.produits[j].qteRestante==""){f.nproStockCheckedNoLimit='checked="checked"';f.nproStockDisabled='disabled="disabled"';f.nproStock=""}else{f.nproStockCheckedLimit='checked="checked"'}if(this.mMarche.produits[j].qteMaxCommande==""){f.nproQteMaxCheckedNoLimit='checked="checked"';f.nproQteMaxDisabled='disabled="disabled"';f.nproQteMax=""}else{f.nproQteMaxCheckedLimit='checked="checked"'}f.divStock=c.stockModifProduit.template(f)}f.divLot=c.prixModifProduit.template(f)}else{var m=this.mMarche.produitsAbonnement[j].idFerme;var l=this.mMarche.produitsAbonnement[j].idCategorie;var f={ferId:m,ferNom:this.mAffichageMarche[m].ferNom,cproId:l,cproNom:this.mAffichageMarche[m].categories[l].cproNom,nproId:j,nproNom:this.mAffichageMarche[m].categories[l].produitsAbonnement[j].nproNom,stockInitialAbonnement:this.mAffichageMarche[m].categories[l].produitsAbonnement[j].nproStock.nombreFormate(2,","," "),modelesLotAbonnement:[]};for(i in this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLot){var k=this.mAffichageMarche[m].categories[l].produitsAbonnement[j].modelesLot[i];if(k.id){var g={id:k.id,quantite:k.taille,prix:k.prix,unite:k.unite,sigleMonetaire:gSigleMonetaire};if(k.selected){g.checked='checked="checked"';f.uniteAbonnement=k.unite}else{g.checked=""}if(k.modele){g.modele="modele-lot"}else{g.modele=""}f.modelesLotAbonnement.push(g)}}var b=this.mAffichageMarche[m].categories[l].produitsAbonnement[j].nproQteMax;if(parseFloat(b)==-1){f.qMaxAbonnement="Pas de limite"}else{f.qMaxAbonnement=b.nombreFormate(2,","," ")+" "+f.uniteAbonnement}f.qMaxAbonnementValue=b;f.divStock=c.stockAbonnementAjoutProduit.template(f);f.typeProduitLabel="Abonnement";f.divLot=c.prixAbonnementModifProduit.template(f)}var d=c.dialogModifProduitAjoutMarche;$(h.affectPrixEtStock($(d.template(f)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Modifier:function(){h.modifierProduit($(this),e)},Annuler:function(){h.mEditionLot=false;$(this).dialog("close")}},close:function(n,o){$(this).remove();Infobulle.init()}})};this.modifierProduit=function(j,f){var g=this;if(!this.mEditionLot){var q=j.find("#pro-idFerme").attr("id-ferme");var o=j.find("#pro-idCategorie").attr("id-categorie");var e=j.find("#pro-idProduit").attr("id-produit");var m=0;if(f==2){m=j.find("#stock-abonnement").text().numberFrToDb()}else{if(f==0){m=j.find(":input[name=pro-stock]").val().numberFrToDb()}}if(j.find(":input[name=pro-stock-choix]:checked").val()==1&&m==""&&f==0){var r=new Object();var k=new VRerreur();k.code=ERR_201_CODE;k.message=ERR_201_MSG;r.valid=false;r.qteRestante=new VRelement();r.qteRestante.valid=false;r.qteRestante.erreurs.push(k);Infobulle.generer(r,"pro-")}else{var l=0;if(f==0){l=j.find(":input[name=pro-qte-max]").val().numberFrToDb()}else{if(f==2){l=j.find("#max-abonnement").text().numberFrToDb()}}if(j.find(":input[name=pro-qte-max-choix]:checked").val()==1&&l==""&&f==0){var r=new Object();var k=new VRerreur();k.code=ERR_201_CODE;k.message=ERR_201_MSG;r.valid=false;r.qteMaxCommande=new VRelement();r.qteMaxCommande.valid=false;r.qteMaxCommande.erreurs.push(k);Infobulle.generer(r,"pro-")}else{if(f==2){var b=j.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{var b=j.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}var n="";if(f==2){n=this.mAffichageMarche[q].categories[o].produitsAbonnement[e].nproNom}else{n=this.mAffichageMarche[q].categories[o].produits[e].nproNom}var d={nproId:e,nproNom:n,nproStock:m,nproQteMax:l,nproUnite:b,type:f,modelesLot:[]};if(f==2){j.find(".ligne-lot-abonnement :checkbox").each(function(){var s=false;if($(this).hasClass("modele-lot")){s=true}var u=false;if($(this).attr("checked")){u=true}if(s||u){var t=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();var v={id:t,taille:$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot-abonnement").find(".lot-unite").text(),selected:u,modele:s};d.modelesLot[t]=v}})}else{j.find(".ligne-lot :checkbox").each(function(){var s=false;if($(this).hasClass("modele-lot")){s=true}var u=false;if($(this).attr("checked")){u=true}if(s||u){var t=$(this).closest(".ligne-lot").find(".lot-id").text();var v={id:t,taille:$(this).closest(".ligne-lot").find(".lot-quantite").text(),prix:$(this).closest(".ligne-lot").find(".lot-prix").text(),unite:$(this).closest(".ligne-lot").find(".lot-unite").text(),selected:u,modele:s};d.modelesLot[t]=v}})}var c=new ProduitMarcheVO();c.idNom=e;c.unite=b;c.qteMaxCommande=l;c.qteRestante=m;c.type=f;if(f==2){j.find(".ligne-lot-abonnement :checkbox:checked").each(function(){var s=new DetailCommandeVO();s.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();s.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();c.lots.push(s)})}else{j.find(".ligne-lot :checkbox:checked").each(function(){var s=new DetailCommandeVO();s.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();s.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();c.lots.push(s)})}if(f==1){c.qteMaxCommande=-1;c.qteRestante=-1}c.idFerme=q;c.idCategorie=o;var p=new ProduitMarcheValid();var h=p.validAjout(c);if(h.valid){Infobulle.init();if(f==2){this.mMarche.produitsAbonnement[e]=c;this.mAffichageMarche[q].categories[o].produitsAbonnement[e]=d}else{this.mMarche.produits[e]=c;this.mAffichageMarche[q].categories[o].produits[e]=d}g.affectInitListeFerme();j.dialog("close")}else{if(f==2){Infobulle.generer(h,"pro-abo-")}else{Infobulle.generer(h,"pro-")}}}}}else{var r=new Object();var k=new VRerreur();k.code=ERR_112_CODE;k.message=ERR_112_MSG;r.valid=false;r.log=new VRelement();r.log.valid=false;r.log.erreurs.push(k);Infobulle.generer(r,"")}};this.affectSupprimerProduit=function(b){var c=this;b.find(".btn-supprimer-produit").click(function(){c.supprimerProduit($(this).attr("id-produit"),$(this).attr("typeProduit"))});return b};this.supprimerProduit=function(c,b){if(b==0||b==1){var e=this.mMarche.produits[c].idFerme;var d=this.mMarche.produits[c].idCategorie;this.mMarche.produits.splice(c,1,null);this.mAffichageMarche[e].categories[d].produits.splice(c,1,null)}else{var e=this.mMarche.produitsAbonnement[c].idFerme;var d=this.mMarche.produitsAbonnement[c].idCategorie;this.mMarche.produitsAbonnement.splice(c,1,null);this.mAffichageMarche[e].categories[d].produitsAbonnement.splice(c,1,null)}this.mNbProduit--;this.affectInitListeFerme()};this.affectCeerMarche=function(b){var c=this;b.find("#btn-creer-marche").click(function(){c.creerMarche()});b.find("#btn-modifier-creation-commande").click(function(){c.editerMarche()});return b};this.creerMarche=function(){var f=this;if(!this.mEditionLot){this.mMarche;this.mMarche.nom=$(":input[name=nom]").val();this.mMarche.description=$(":input[name=description]").val();this.mMarche.dateMarcheDebut=$(":input[name=date-debut]").val().dateFrToDb();this.mMarche.timeMarcheDebut=$(":input[name=heure-debut]").val()+":"+$(":input[name=minute-debut]").val()+":00";this.mMarche.dateMarcheFin=$(":input[name=date-debut]").val().dateFrToDb();this.mMarche.timeMarcheFin=$(":input[name=heure-fin]").val()+":"+$(":input[name=minute-fin]").val()+":00";this.mMarche.dateDebutReservation=$(":input[name=date-debut-reservation]").val().dateFrToDb();this.mMarche.timeDebutReservation=$(":input[name=heure-debut-reservation]").val()+":"+$(":input[name=minute-debut-reservation]").val()+":00";this.mMarche.dateFinReservation=$(":input[name=date-fin-reservation]").val().dateFrToDb();this.mMarche.timeFinReservation=$(":input[name=heure-fin-reservation]").val()+":"+$(":input[name=minute-fin-reservation]").val()+":00";this.mMarche.archive="0";if(this.mEtapeCreationMarche==0){var e=new MarcheValid();var g=e.validAjout(this.mMarche);if(g.valid){this.mEtapeCreationMarche=1;Infobulle.init();$("#nom-marche-span").text(this.mMarche.nom);$("#date-debut-reservation-marche-span").text($(":input[name=date-debut-reservation]").val());$("#time-debut-reservation-marche-span").text($(":input[name=heure-debut-reservation]").val()+"H"+$(":input[name=minute-debut-reservation]").val());$("#date-fin-reservation-marche-span").text($(":input[name=date-fin-reservation]").val());$("#time-fin-reservation-marche-span").text($(":input[name=heure-fin-reservation]").val()+"H"+$(":input[name=minute-fin-reservation]").val());$("#date-debut-marche-span").text($(":input[name=date-debut]").val());$("#time-debut-marche-span").text($(":input[name=heure-debut]").val()+"H"+$(":input[name=minute-debut]").val());$("#time-fin-marche-span").text($(":input[name=heure-fin]").val()+"H"+$(":input[name=minute-fin]").val());$("#description-marche-span").text(this.mMarche.description);$("#btn-ajout-produit-div, .informations-marche, #btn-modifier-creation-commande, .btn-modifier-produit, .btn-supprimer-produit").toggle()}else{Infobulle.generer(g,"marche-")}}else{if(this.mEtapeCreationMarche==1){var h=[];$(this.mMarche.produits).each(function(){if(this.idNom){var j=[];$(this.lots).each(function(){if(this.taille){j.push(this)}});this.lots=j;h.push(this)}});this.mMarche.produits=h;var b=[];$(this.mMarche.produitsAbonnement).each(function(){if(this.idNom){var j=[];$(this.lots).each(function(){if(this.taille){j.push(this)}});this.lots=j;b.push(this)}});this.mMarche.produitsAbonnement=b;var d=this.mMarche;d.fonction="ajouter";$.post("./index.php?m=GestionCommande&v=AjoutCommande","pParam="+$.toJSON(d),function(k){if(k){if(k.valid){var l=new Object();var j=new VRerreur();j.code=ERR_334_CODE;j.message=ERR_334_MSG;l.valid=false;l.log=new VRelement();l.log.valid=false;l.log.erreurs.push(j);EditerCommandeVue({id_marche:k.id,vr:l})}else{f.editerMarche();Infobulle.generer(k,"marche-")}}},"json")}}}else{var g=new Object();var c=new VRerreur();c.code=ERR_112_CODE;c.message=ERR_112_MSG;g.valid=false;g.log=new VRelement();g.log.valid=false;g.log.erreurs.push(c);Infobulle.generer(g,"")}};this.editerMarche=function(){this.mEtapeCreationMarche=0;$("#btn-ajout-produit-div, .informations-marche, #btn-modifier-creation-commande, .btn-modifier-produit, .btn-supprimer-produit").toggle()};this.affectControleDatepicker=function(b){b=gCommunVue.lienDatepickerMarche("marche-dateDebutReservation","marche-dateFinReservation","marche-dateMarcheDebut",b);b.find("#marche-dateDebutReservation").datepicker("setDate",getDateAujourdhuiDb().dateDbToFr());b.find("#marche-dateFinReservation").datepicker("option","minDate",new Date());b.find("#marche-dateMarcheDebut").datepicker("option","minDate",new Date());return b};this.construct(a)}function ListeReservationMarcheVue(a){this.mIdMarche=null;this.construct=function(b){$.history({vue:function(){ListeReservationMarcheVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=ListeReservationMarche","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b.vr){Infobulle.generer(b.vr,"")}c.mIdMarche=b.id_marche;c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var e=this;var c=new GestionCommandeTemplate();if(d.listeAdherent[0].adhId&&d.listeAdherent[0].adhId!=null){var f=c.listeReservation;$.each(d.listeAdherent,function(){this.adhIdTri=this.adhNumero.replace("Z","")})}else{var f=c.listeReservationVide}d.infoMarcheSelected="";d.listeReservationSelected="ui-state-active";d.listeAchatSelected="";d.resumeMarcheSelected="";d.editerMenu=c.editerMarcheMenu.template(d);var b=e.affectReservationAction($(f.template(d)));$("#contenu").replaceWith(b)};this.affectReservationAction=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectExportReservation(b);b=this.affectReservation(b);b=this.affectMenu(b);b=gCommunVue.comHoverBtn(b);return b};this.affectMenu=function(b){var c=this;b.find("#btn-information-marche").click(function(){EditerCommandeVue({id_marche:c.mIdMarche})});b.find("#btn-liste-achat-resa").click(function(){ListeAchatMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-liste-resa").click(function(){ListeReservationMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-resume-marche").click(function(){ResumeMarcheVue({id_marche:c.mIdMarche})});return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[2,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectReservation=function(b){var c=this;b.find(".edt-com-reservation-ligne").click(function(){ReservationAdherentVue({id_commande:c.mIdMarche,id_adherent:$(this).find(".id-adherent").text()})});return b};this.affectExportReservation=function(b){var c=this;b.find("#btn-export-resa").click(function(){var d=new GestionCommandeTemplate();var f=d.dialogExportListeReservation;var e={fermes:[]};$(c.mListeFerme.fermes).each(function(h,k){var j=false;var g={ferId:this.ferId,ferNom:this.ferNom,categories:[]};$(this.categories).each(function(l,o){var n=false;var m={cproId:this.cproId,cproNom:this.cproNom,produits:[]};$(this.produits).each(function(p,q){if(this.type==2||this.type==0){m.produits.push(this);j=true;n=true}});if(n){g.categories.push(m)}});if(j){e.fermes.push(g)}});$(f.template(e)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Exporter:function(){var j="";$(this).find(":input[name=id_produits]:checked").each(function(){j+=$(this).val()+","});j=j.substr(0,j.length-1);var g=$(this).find(":input[name=format]:checked").val();var k=new ExportListeReservationVO();k={fonction:"exportReservation",id_commande:c.mIdMarche,id_produits:j,format:g};var h=new ExportListeReservationValid();var l=h.validAjout(k);Infobulle.init();if(l.valid){$.download("./index.php?m=GestionCommande&v=ListeReservationMarche",k)}else{Infobulle.generer(l,"")}},Annuler:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})});return b};this.construct(a)}function EditerCommandeVue(a){this.mArchive=-1;this.mIdMarche=null;this.mMarche=new MarcheVO();this.mListeFerme=null;this.mEditionLot=false;this.mIdLot=0;this.mIdLotAbonnement=0;this.mNbProduit=0;this.mProduits=[];this.mParam=null;this.mLotRemplacement=[];this.mLotReservation=[];this.mTailleLotResaMax=-1;this.mQuantiteReservation=-1;this.construct=function(b){$.history({vue:function(){EditerCommandeVue(b)}});this.mParam=b;var c=this;b.fonction="afficher";$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b.vr){Infobulle.generer(b.vr,"")}delete c.mProduits;c.mProduits=[];c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(e){var f=this;var b=new GestionCommandeTemplate();var d={};d.comId=e.marche.id;this.mIdMarche=d.comId;d.comNumero=e.marche.numero;d.nom=e.marche.nom;d.comDescription=e.marche.description;d.dateTimeDebutReservation=e.marche.dateDebutReservation;d.dateDebutReservation=e.marche.dateDebutReservation.extractDbDate().dateDbToFr();d.heureDebutReservation=e.marche.dateDebutReservation.extractDbHeure();d.minuteDebutReservation=e.marche.dateDebutReservation.extractDbMinute();d.dateTimeFinReservation=e.marche.dateFinReservation;d.dateFinReservation=e.marche.dateFinReservation.extractDbDate().dateDbToFr();d.heureFinReservation=e.marche.dateFinReservation.extractDbHeure();d.minuteFinReservation=e.marche.dateFinReservation.extractDbMinute();d.dateMarcheDebut=e.marche.dateMarcheDebut.extractDbDate().dateDbToFr();d.heureMarcheDebut=e.marche.dateMarcheDebut.extractDbHeure();d.minuteMarcheDebut=e.marche.dateMarcheDebut.extractDbMinute();d.heureMarcheFin=e.marche.dateMarcheFin.extractDbHeure();d.minuteMarcheFin=e.marche.dateMarcheFin.extractDbMinute();d.archive=e.marche.archive;var c=[];$.each(e.marche.produits,function(){var o=this.ferId;var l=this.idCategorie;var k=this.idNom;var j=this.type;if(j==0||j==2){var m=parseFloat(this.stockInitial)-parseFloat(this.stockReservation);if(this.stockInitial==-1){m++}}else{m=0}var n={id:this.id,nproId:k,nproNom:this.nom,nproStock:this.stockInitial,nproQteMax:this.qteMaxCommande,nproUnite:this.unite,type:j,qteReservation:m.nombreFormate(2,","," ")};if(!c[o]){c[o]={ferId:o,ferNom:this.ferNom,categories:[]}}if(!c[o].categories[l]){c[o].categories[l]={cproId:l,cproNom:this.cproNom,produits:[],produitsAbonnement:[]}}if(j==2){c[o].categories[l].produitsAbonnement[k]=n}else{c[o].categories[l].produits[k]=n}f.mNbProduit++});var g=[];$(c).each(function(){if(this.ferId){var j=[];$(this.categories).each(function(){if(this.cproId){var k=[];$(this.produits).each(function(){if(this.nproId){k.push([this.nproNom,this.nproId,this.type])}});$(this.produitsAbonnement).each(function(){if(this.nproId){k.push([this.nproNom,this.nproId,this.type])}});k.sort(sortABC);j.push([this.cproNom,this.cproId,k])}});j.sort(sortABC);g.push([this.ferNom,this.ferId,j])}});g.sort(sortABC);this.mListeFerme={fermes:[]};$(g).each(function(k,n){var o=n[1];var m=n[2];if(c[o]){var l=false;var j={ferId:c[o].ferId,ferNom:c[o].ferNom,categories:[]};$(m).each(function(p,t){var q=t[1];var u=t[2];if(c[o].categories[q]){var s=false;var r={cproId:c[o].categories[q].cproId,cproNom:c[o].categories[q].cproNom,produits:[]};$(u).each(function(x,z){var y=z[1];var w=z[2];var v="";if(w==2){v=b.flagAbonnement;if(c[o].categories[q].produitsAbonnement[y]){r.produits.push({id:c[o].categories[q].produitsAbonnement[y].id,nproId:c[o].categories[q].produitsAbonnement[y].nproId,nproNom:c[o].categories[q].produitsAbonnement[y].nproNom,nproUnite:c[o].categories[q].produitsAbonnement[y].nproUnite,qteReservation:c[o].categories[q].produitsAbonnement[y].qteReservation,type:w,abonnement:v});l=true;s=true}}else{if(c[o].categories[q].produits[y].type==1){v=b.flagSolidaire}if(c[o].categories[q].produits[y]){r.produits.push({id:c[o].categories[q].produits[y].id,nproId:c[o].categories[q].produits[y].nproId,nproNom:c[o].categories[q].produits[y].nproNom,nproUnite:c[o].categories[q].produits[y].nproUnite,qteReservation:c[o].categories[q].produits[y].qteReservation,type:w,abonnement:v});l=true;s=true}}});if(s){j.categories.push(r)}}});if(l){f.mListeFerme.fermes.push(j)}}});d.sigleMonetaire=gSigleMonetaire;this.mMarche=$.extend(f.mMarche,d);this.mMarche.produits=[];this.mMarche.produitsAbonnement=[];$.each(e.marche.produits,function(){if(this.type==2){f.mMarche.produitsAbonnement[this.idNom]=1}else{f.mMarche.produits[this.idNom]=1}});var h=b.editerCommandePage;d.infoMarcheSelected="ui-state-active";d.listeReservationSelected="";d.listeAchatSelected="";e.resumeMarcheSelected="";d.editerMenu=b.editerMarcheMenu.template(d);this.mArchive=e.marche.archive;$("#contenu").replaceWith(f.affect($(h.template(d))))};this.affectDroitArchive=function(b){b.find("#btn-ajout-produit-div").remove();b.find("#btn-modif-com").remove();b.find(".btn-modifier-produit").remove();b.find(".btn-supprimer-produit").remove();b.find("#btn-pause-com").remove();b.find("#btn-play-com").remove();b.find("#btn-cloture-com").remove();return b};this.affect=function(b){b=this.affectModifier(b);b=this.affectDupliquerMarche(b);b=this.affectBonDeCommande(b);b=this.affectBonDeLivraison(b);b=this.affectArchive(b);b=this.affectMajListeFerme(b);b=this.affectDialogAjoutProduit(b);b=this.affectMenu(b);b=gCommunVue.comHoverBtn(b);if(this.mArchive==2){b=this.affectDroitArchive(b)}return b};this.affectMenu=function(b){var c=this;b.find("#btn-information-marche").click(function(){EditerCommandeVue(c.mParam)});b.find("#btn-liste-achat-resa").click(function(){ListeAchatMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-liste-resa").click(function(){ListeReservationMarcheVue({id_marche:c.mIdMarche})});b.find("#btn-resume-marche").click(function(){ResumeMarcheVue({id_marche:c.mIdMarche})});return b};this.affectModifier=function(b){var c=this;b.find("#btn-modif-com").click(function(){c.dialogModifierInformationMarche()});return b};this.affectBonDeCommande=function(b){var c=this;b.find("#btn-bon-com").click(function(){BonDeCommandeVue({id_commande:c.mIdMarche})});return b};this.affectBonDeLivraison=function(b){var c=this;b.find("#btn-livraison-com").click(function(){BonDeLivraisonVue({id_commande:c.mIdMarche})});return b};this.affectDupliquerMarche=function(b){var c=this;b.find("#btn-dupliquer-com").click(function(){DupliquerMarcheVue({id_marche:c.mIdMarche})});return b};this.affectArchive=function(b){if(this.mMarche.archive==0){b.find(".marche-archive-0").show()}else{if(this.mMarche.archive==1){b.find(".marche-archive-1").show()}}b=this.affectPause(b);b=this.affectPlay(b);b=this.affectCloturer(b);return b};this.modifierArchive=function(){if(this.mMarche.archive==0){$(".marche-archive-0").show();$(".marche-archive-1").hide()}else{if(this.mMarche.archive==1){$(".marche-archive-0").hide();$(".marche-archive-1").show()}}};this.affectCloturer=function(b){var c=this;b.find("#btn-cloture-com").click(function(){var d=new GestionCommandeTemplate();var e=d.dialogClotureCommande;$(e.template(c.mMarche)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Cloturer:function(){var f={id_marche:c.mIdMarche,fonction:"cloturer"};var g=this;$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(f),function(k){Infobulle.init();if(k){if(k.valid){var l=new TemplateVR();l.valid=false;l.log.valid=false;var j=new VRerreur();j.code=ERR_313_CODE;j.message=ERR_313_MSG;l.log.erreurs.push(j);var h={id_marche:c.mIdMarche,vr:l};InfoCommandeArchiveVue(h);$(g).dialog("close")}else{Infobulle.generer(k,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}})});return b};this.affectPause=function(b){var c=this;b.find("#btn-pause-com").click(function(){var d={id_marche:c.mIdMarche,fonction:"pause"};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(f){Infobulle.init();if(f){if(f.valid){c.mMarche.archive=1;c.modifierArchive();var g=new TemplateVR();g.valid=false;g.log.valid=false;var e=new VRerreur();e.code=ERR_311_CODE;e.message=ERR_311_MSG;g.log.erreurs.push(e);Infobulle.generer(g,"")}else{Infobulle.generer(f,"")}}},"json")});return b};this.affectPlay=function(b){var c=this;b.find("#btn-play-com").click(function(){var d={id_marche:c.mIdMarche,fonction:"play"};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(f){Infobulle.init();if(f){if(f.valid){c.mMarche.archive=0;c.modifierArchive();var g=new TemplateVR();g.valid=false;g.log.valid=false;var e=new VRerreur();e.code=ERR_312_CODE;e.message=ERR_312_MSG;g.log.erreurs.push(e);Infobulle.generer(g,"")}else{Infobulle.generer(f,"")}}},"json")});return b};this.affectMajListeFerme=function(c){var d=this;var b=new GestionCommandeTemplate();var e=b.editerMarcheListeProduit;c.find("#liste-ferme").replaceWith(d.affectGestionProduit($(e.template(d.mListeFerme))));return c};this.affectGestionProduit=function(b){b=this.affectModifierProduit(b);b=this.affectSupprimerProduit(b);return b};this.affectModifierProduit=function(b){var c=this;b.find(".btn-modifier-produit").click(function(){c.dialogModifierProduit($(this).attr("id-produit"),$(this).attr("typeProduit"))});return b};this.dialogModifierProduit=function(b){var c=this;var d={fonction:"detailProduitMarche",id:b};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(m){if(m){if(m.valid){var g=new GestionCommandeTemplate();var o=m.produit.ferId;var n=m.produit.idCategorie;var e=parseInt(m.produit.type);c.mQuantiteReservation=-1;var l="";if(parseFloat(m.produit.stockInitial)!=-1){c.mQuantiteReservation=parseFloat(m.produit.stockInitial)-parseFloat(m.produit.stockReservation);l=m.produit.stockInitial.nombreFormate(2,","," ")}else{c.mQuantiteReservation=parseFloat(m.produit.stockReservation)*-1}var j="";if(parseFloat(m.produit.qteMaxCommande)!=-1){j=m.produit.qteMaxCommande.nombreFormate(2,","," ")}var k={ferId:o,ferNom:m.produit.ferNom,cproId:n,cproNom:m.produit.cproNom,nproId:b,nproNom:m.produit.nom,unite:m.produit.unite,nproStock:l,nproQteMax:j,modelesLot:[],modelesLotReservation:[],modelesLotAbonnement:[],modelesLotAbonnementReservationModif:[],listeModelesLot:[],listeModelesLotAbonnement:[]};c.mLotReservation=[];c.mTailleLotResaMax=-1;switch(e){case 0:k.typeProduitLabel="Normal";$(m.modelesLot).each(function(){if(this.mLotId!=null){c.mIdLot--;var p={id:c.mIdLot,quantite:this.mLotQuantite.nombreFormate(2,","," "),prix:this.mLotPrix.nombreFormate(2,","," "),unite:this.mLotUnite,sigleMonetaire:gSigleMonetaire,modele:"modele-lot",checked:""};k.listeModelesLot.push(p)}});$(m.produit.lots).each(function(){var p={id:this.id,quantite:this.taille.nombreFormate(2,","," "),prix:this.prix.nombreFormate(2,","," "),unite:m.produit.unite,sigleMonetaire:gSigleMonetaire,modele:"",checked:'checked="checked"'};if(this.reservation){k.modelesLotReservation.push(p);c.mLotReservation[this.id]={id:this.id,quantite:this.taille};if(this.taille>c.mTailleLotResaMax){c.mTailleLotResaMax=this.taille}}else{k.modelesLot.push(p)}});if(m.produit.qteRestante==""||m.produit.stockInitial==-1){k.nproStockCheckedNoLimit='checked="checked"';k.nproStockDisabled='disabled="disabled"'}else{k.nproStockCheckedLimit='checked="checked"'}if(m.produit.qteMaxCommande==""||m.produit.qteMaxCommande==-1){k.nproQteMaxCheckedNoLimit='checked="checked"';k.nproQteMaxDisabled='disabled="disabled"'}else{k.nproQteMaxCheckedLimit='checked="checked"'}k.divStock=g.stockModifProduit.template(k);k.divLot=g.prixModifProduit.template(k);break;case 1:k.typeProduitLabel="Solidaire";$(m.modelesLot).each(function(){if(this.mLotId!=null){c.mIdLot--;var p={id:c.mIdLot,quantite:this.mLotQuantite.nombreFormate(2,","," "),prix:this.mLotPrix.nombreFormate(2,","," "),unite:this.mLotUnite,sigleMonetaire:gSigleMonetaire,modele:"modele-lot",checked:""};k.listeModelesLot.push(p)}});$(m.produit.lots).each(function(){var p={id:this.id,quantite:this.taille.nombreFormate(2,","," "),prix:this.prix.nombreFormate(2,","," "),unite:m.produit.unite,sigleMonetaire:gSigleMonetaire,modele:"",checked:'checked="checked"'};k.modelesLot.push(p)});k.divLot=g.prixModifProduit.template(k);break;case 2:$(m.modelesLot).each(function(){if(this.mLotId!=null&&this.mLotUnite==m.produit.unite){c.mIdLotAbonnement--;var p={id:c.mIdLotAbonnement,quantite:this.mLotQuantite.nombreFormate(2,","," "),prix:this.mLotPrix.nombreFormate(2,","," "),unite:this.mLotUnite,sigleMonetaire:gSigleMonetaire,modele:"modele-lot",checked:""};k.listeModelesLotAbonnement.push(p)}});$(m.produit.lots).each(function(){var p={id:this.id,quantite:this.taille.nombreFormate(2,","," "),prix:this.prix.nombreFormate(2,","," "),unite:m.produit.unite,sigleMonetaire:gSigleMonetaire,modele:"",checked:'checked="checked"'};if(this.reservation){k.modelesLotAbonnementReservationModif.push(p);c.mLotReservation[this.id]={id:this.id,quantite:this.taille}}else{k.modelesLotAbonnement.push(p)}});k.typeProduitLabel="Abonnement";k.stockInitialAbonnement=l;k.uniteAbonnement=m.produit.unite;var f=m.produit.qteMaxCommande;if(parseFloat(f)==-1){k.qMaxAbonnement="Pas de limite"}else{k.qMaxAbonnement=f.nombreFormate(2,","," ")+" "+k.uniteAbonnement}k.qMaxAbonnementValue=f;k.divStock=g.stockAbonnementAjoutProduit.template(k);k.divLot=g.prixAbonnementModifProduit.template(k);break}var h=g.dialogModifProduitAjoutMarche;c.mLotRemplacement=[];$(c.affectModifierPrixEtStock($(h.template(k)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Modifier:function(){c.modifierProduit($(this),e)},Annuler:function(){c.mEditionLot=false;$(this).dialog("close")}},close:function(p,q){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(m,"marche-")}}},"json")};this.affectPrixEtStock=function(b){b=this.affectAjoutLotGestion(b);b=this.affectAjoutLotAbonnementGestion(b);b=this.affectAjoutLot(b);b=this.affectLimiteStock(b);b=this.affectChangeTypeProduit(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectModifierPrixEtStock=function(b){b=this.affectAjoutLotGestionModifier(b);b=this.affectAjoutLotAbonnementGestionModifier(b);b=this.affectAjoutLot(b);b=this.affectLimiteStock(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectChangeTypeProduit=function(b){var c=this;b.find(":input[name=typeProduit]").click(function(){return c.testChangeTypeProduit($(":input[name=typeProduit]:checked").val())}).change(function(){c.changeTypeProduit($(":input[name=typeProduit]:checked").val())});return b};this.testChangeTypeProduit=function(c){if(this.mEditionLot){var d=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;d.valid=false;d.log=new VRelement();d.log.valid=false;d.log.erreurs.push(b);Infobulle.generer(d,"");return false}return true};this.changeTypeProduit=function(c){if(!this.mEditionLot){$(".pro-detail").hide();if(c==0){$("#pro-normal,#id-stock").show()}else{if(c==1){$("#pro-normal").show()}else{$("#pro-abonnement").show()}}}else{var d=new Object();var b=new VRerreur();b.code=ERR_112_CODE;b.message=ERR_112_MSG;d.valid=false;d.log=new VRelement();d.log.valid=false;d.log.erreurs.push(b);Infobulle.generer(d,"");return false}};this.affectLimiteStock=function(b){b.find(":input[name=pro-stock-choix]").change(function(){if($(":input[name=pro-stock-choix]:checked").val()==1){$(":input[name=pro-stock]").attr("disabled","").val("")}else{$(":input[name=pro-stock]").attr("disabled","disabled").val("")}});b.find(":input[name=pro-qte-max-choix]").change(function(){if($(":input[name=pro-qte-max-choix]:checked").val()==1){$(":input[name=pro-qte-max]").attr("disabled","").val("")}else{$(":input[name=pro-qte-max]").attr("disabled","disabled").val("")}});return b};this.affectAjoutLot=function(b){var c=this;b.find("#btn-ajout-lot").click(function(){c.ajoutLot(1)});b.find("#table-pro-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(1)}});b.find("#btn-ajout-lot-abonnement").click(function(){c.ajoutLot(2)});b.find("#table-pro-abonnement-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot(2)}});return b};this.ajoutLot=function(d){var h=new ModeleLotVO();if(d==1){h.quantite=$(":input[name=lot-quantite]").val().numberFrToDb();h.unite=$(":input[name=lot-unite]").val();h.prix=$(":input[name=lot-prix]").val().numberFrToDb()}else{h.quantite=$(":input[name=lot-abo-quantite]").val().numberFrToDb();h.unite=$("#pro-abo-lot-unite").text();h.prix=$(":input[name=lot-abo-prix]").val().numberFrToDb()}var k=new ModeleLotValid();var f=k.validAjout(h);if(f.valid){Infobulle.init();var l=new TemplateVR();var b=new GestionCommandeTemplate();if(d==1){var j=$("#pro-qteRestante").val();if(j!=undefined&&j!=""){j=j.numberFrToDb();if(j!=-1&&h.quantite>parseFloat(j)){l.valid=false;l.log.valid=false;var g=new VRerreur();g.code=ERR_241_CODE;g.message=ERR_241_MSG;l.log.erreurs.push(g)}}var e=$("#pro-qteMaxCommande").val();if(e!=undefined&&e!=""){e=e.numberFrToDb();if(e!=-1&&h.quantite>parseFloat(e)){l.valid=false;l.log.valid=false;var g=new VRerreur();g.code=ERR_241_CODE;g.message=ERR_241_MSG;l.log.erreurs.push(g)}}if(l.valid){var c=b.modeleLot;this.mIdLot--;h.id=this.mIdLot;h.sigleMonetaire=gSigleMonetaire;h.quantite=h.quantite.nombreFormate(2,","," ");h.prix=h.prix.nombreFormate(2,","," ");$("#lot-liste").append(this.affectLot($(c.template(h))));$(":input[name=lot-quantite], :input[name=lot-unite], :input[name=lot-prix]").val("")}else{Infobulle.generer(l,"pro-lot-")}}else{var j=$("#stock-abonnement").text().numberFrToDb();var e=$("#max-abonnement").text().numberFrToDb();if(e!=-1&&parseFloat(h.quantite)>parseFloat(e)){l.valid=false;l.log.valid=false;var g=new VRerreur();g.code=ERR_241_CODE;g.message=ERR_241_MSG;l.log.erreurs.push(g)}if(j!=-1&&parseFloat(h.quantite)>parseFloat(j)){l.valid=false;l.log.valid=false;var g=new VRerreur();g.code=ERR_241_CODE;g.message=ERR_241_MSG;l.log.erreurs.push(g)}if(l.valid){var c=b.modeleLotAbonnement;this.mIdLotAbonnement--;h.id=this.mIdLotAbonnement;h.sigleMonetaire=gSigleMonetaire;h.quantite=h.quantite.nombreFormate(2,","," ");h.prix=h.prix.nombreFormate(2,","," ");$("#lot-liste-abonnement").append(this.affectLotAbonnement($(c.template(h))));$(":input[name=lot-abo-quantite], :input[name=lot-abo-unite], :input[name=lot-abo-prix]").val("")}else{Infobulle.generer(l,"pro-abo-lot-")}}}else{if(d==1){Infobulle.generer(f,"pro-lot-")}else{Infobulle.generer(f,"pro-abo-lot-")}}};this.affectLot=function(b){b=this.affectAjoutLotGestion(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectLotAbonnement=function(b){b=this.affectAjoutLotAbonnementGestion(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectAjoutLotGestion=function(b){var c=this;b.find(".btn-modifier-lot").click(function(){c.ajoutLotModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot").click(function(){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot").click(function(){c.ajoutLotAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot").click(function(){c.ajoutLotSupprimer($(this).closest("tr").find("#id-lot").text())});b.find(":checkbox").change(function(){var d=c.majUnite();if(!c.majUnite()){if($(this).attr("checked")){$(this).removeAttr("checked")}else{$(this).attr("checked","checked")}}});return b};this.affectAjoutLotGestionModifier=function(b){var c=this;b.find(".btn-modifier-lot").click(function(){c.ajoutLotModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot").click(function(){c.ajoutLotModifierValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotModifierValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot").click(function(){c.ajoutLotAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot").click(function(){c.modifierLotSupprimer($(this).closest("tr").find("#id-lot").text())});b.find(":checkbox").change(function(){if(!c.majUnite()){if($(this).attr("checked")){$(this).removeAttr("checked")}else{$(this).attr("checked","checked")}}});return b};this.affectAjoutLotAbonnementGestion=function(b){var c=this;b.find(".btn-modifier-lot-abonnement").click(function(){c.ajoutLotAbonnementModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot-abonnement").click(function(){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot-abonnement").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot-abonnement").click(function(){c.ajoutLotAbonnementAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot-abonnement").click(function(){c.ajoutLotAbonnementSupprimer($(this).closest("tr").find("#id-lot").text())});return b};this.affectAjoutLotAbonnementGestionModifier=function(b){var c=this;b.find(".btn-modifier-lot-abonnement").click(function(){c.ajoutLotAbonnementModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot-abonnement").click(function(){c.ajoutLotModifierAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot-abonnement").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotModifierAbonnementValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot-abonnement").click(function(){c.ajoutLotAbonnementAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot-abonnement").click(function(){c.modifierLotAbonnementSupprimer($(this).closest("tr").find("#id-lot").text())});return b};this.majUnite=function(){var d=true;var c=0;var e="";$(".ligne-lot :checkbox:checked").each(function(){var g=$(this).closest(".ligne-lot").find(".lot-unite").text();if(e!=""&&e!=g){d=false}else{e=g}c++});if(d){if(c>0){$(".unite-stock").text(e)}}else{var f=new Object();var b=new VRerreur();b.code=ERR_333_CODE;b.message=ERR_333_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(b);Infobulle.generer(f,"")}return d};this.ajoutLotModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();$("#pro-lot-"+b+"-quantite").val($("#lot-"+b+"-quantite").text());$("#pro-lot-"+b+"-unite").val($("#lot-"+b+"-unite").text());$("#pro-lot-"+b+"-prix").val($("#lot-"+b+"-prix").text());this.mEditionLot=true};this.ajoutLotAbonnementModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();$("#pro-lot-abonnement"+b+"-quantite").val($("#lot-"+b+"-quantite-abonnement").text());$("#pro-lot-abonnement"+b+"-unite").val($("#lot-"+b+"-unite-abonnement").text());$("#pro-lot-abonnement"+b+"-prix").val($("#lot-"+b+"-prix-abonnement").text());this.mEditionLot=true};this.ajoutLotValiderModification=function(e){var d=new ModeleLotVO();d.quantite=$("#pro-lot-"+e+"-quantite").val().numberFrToDb();d.unite=$("#pro-lot-"+e+"-unite").val();d.prix=$("#pro-lot-"+e+"-prix").val().numberFrToDb();var f=new ModeleLotValid();var j=f.validAjout(d);if(j.valid){Infobulle.init();var h=new TemplateVR();var g=$("#pro-qteRestante").val();if(g!=undefined&&g!=""){g=g.numberFrToDb();if(g!=-1&&d.quantite>parseFloat(g)){h.valid=false;h.log.valid=false;var c=new VRerreur();c.code=ERR_241_CODE;c.message=ERR_241_MSG;h.log.erreurs.push(c)}}var b=$("#pro-qteMaxCommande").val();if(b!=undefined&&b!=""){b=b.numberFrToDb();if(b!=-1&&d.quantite>parseFloat(b)){h.valid=false;h.log.valid=false;var c=new VRerreur();c.code=ERR_241_CODE;c.message=ERR_241_MSG;h.log.erreurs.push(c)}}if(h.valid){$("#lot-"+e+"-quantite").text(d.quantite.nombreFormate(2,","," "));$("#lot-"+e+"-unite").text(d.unite);$("#lot-"+e+"-prix").text(d.prix.nombreFormate(2,","," "));$(".btn-lot, #btn-annuler-lot-"+e+", #btn-valider-lot-"+e+", .champ-lot-"+e).toggle();this.mEditionLot=false;this.majUnite()}else{Infobulle.generer(h,"pro-lot-"+e+"-")}}else{Infobulle.generer(j,"pro-lot-"+e+"-")}};this.ajoutLotModifierValiderModification=function(e){var d=new ModeleLotVO();d.id=e;d.quantite=$("#pro-lot-"+e+"-quantite").val().numberFrToDb();d.unite=$("#pro-lot-"+e+"-unite").val();d.prix=$("#pro-lot-"+e+"-prix").val().numberFrToDb();var f=new ModeleLotValid();if(this.autorisationSupprimerLot(e)){var j=f.validAjout(d)}else{var j=f.validUpdateAvecReservation(d,this.mLotReservation[e].quantite)}if(j.valid){Infobulle.init();var h=new TemplateVR();var g=$("#pro-qteRestante").val();if(g!=undefined&&g!=""){g=g.numberFrToDb();if(g!=-1&&d.quantite>parseFloat(g)){h.valid=false;h.log.valid=false;var c=new VRerreur();c.code=ERR_241_CODE;c.message=ERR_241_MSG;h.log.erreurs.push(c)}}var b=$("#pro-qteMaxCommande").val();if(b!=undefined&&b!=""){b=b.numberFrToDb();if(b!=-1&&d.quantite>parseFloat(b)){h.valid=false;h.log.valid=false;var c=new VRerreur();c.code=ERR_241_CODE;c.message=ERR_241_MSG;h.log.erreurs.push(c)}}if(h.valid){$("#lot-"+e+"-quantite").text(d.quantite.nombreFormate(2,","," "));$("#lot-"+e+"-unite").text(d.unite);$("#lot-"+e+"-prix").text(d.prix.nombreFormate(2,","," "));$(".btn-lot, #btn-annuler-lot-"+e+", #btn-valider-lot-"+e+", .champ-lot-"+e).toggle();this.mEditionLot=false;this.majUnite()}else{Infobulle.generer(h,"pro-lot-"+e+"-")}}else{Infobulle.generer(j,"pro-lot-"+e+"-")}};this.ajoutLotAbonnementValiderModification=function(e){var d=new ModeleLotVO();d.quantite=$("#pro-lot-abonnement"+e+"-quantite").val().numberFrToDb();d.unite=$("#pro-lot-abonnement"+e+"-unite").val();d.prix=$("#pro-lot-abonnement"+e+"-prix").val().numberFrToDb();var f=new ModeleLotValid();var j=f.validAjout(d);if(j.valid){Infobulle.init();var h=new TemplateVR();var g=$("#stock-abonnement").text().numberFrToDb();var c=$("#max-abonnement").text().numberFrToDb();if(c!=-1&&d.quantite>parseFloat(c)){h.valid=false;h.log.valid=false;var b=new VRerreur();b.code=ERR_241_CODE;b.message=ERR_241_MSG;h.log.erreurs.push(b)}if(g!=-1&&d.quantite>parseFloat(g)){h.valid=false;h.log.valid=false;var b=new VRerreur();b.code=ERR_241_CODE;b.message=ERR_241_MSG;h.log.erreurs.push(b)}if(h.valid){Infobulle.init();$("#lot-"+e+"-quantite-abonnement").text(d.quantite.nombreFormate(2,","," "));$("#lot-"+e+"-unite-abonnement").text(d.unite);$("#lot-"+e+"-prix-abonnement").text(d.prix.nombreFormate(2,","," "));$(".btn-lot-abonnement, #btn-annuler-lot-"+e+"-abonnement, #btn-valider-lot-"+e+"-abonnement, .champ-lot-"+e+"-abonnement").toggle();this.mEditionLot=false}else{Infobulle.generer(h,"pro-lot-abonnement"+e+"-")}}else{Infobulle.generer(j,"pro-lot-abonnement"+e+"-")}};this.ajoutLotModifierAbonnementValiderModification=function(e){var d=new ModeleLotVO();d.quantite=$("#pro-lot-abonnement"+e+"-quantite").val().numberFrToDb();d.unite=$("#pro-lot-abonnement"+e+"-unite").val();d.prix=$("#pro-lot-abonnement"+e+"-prix").val().numberFrToDb();var f=new ModeleLotValid();if(this.autorisationSupprimerLot(e)){var j=f.validAjout(d)}else{var j=f.validUpdateAvecReservation(d,this.mLotReservation[e].quantite)}if(j.valid){Infobulle.init();var h=new TemplateVR();var g=$("#stock-abonnement").text().numberFrToDb();var c=$("#max-abonnement").text().numberFrToDb();if(c!=-1&&d.quantite>parseFloat(c)){h.valid=false;h.log.valid=false;var b=new VRerreur();b.code=ERR_241_CODE;b.message=ERR_241_MSG;h.log.erreurs.push(b)}if(g!=-1&&d.quantite>parseFloat(g)){h.valid=false;h.log.valid=false;var b=new VRerreur();b.code=ERR_241_CODE;b.message=ERR_241_MSG;h.log.erreurs.push(b)}if(h.valid){Infobulle.init();$("#lot-"+e+"-quantite-abonnement").text(d.quantite.nombreFormate(2,","," "));$("#lot-"+e+"-unite-abonnement").text(d.unite);$("#lot-"+e+"-prix-abonnement").text(d.prix.nombreFormate(2,","," "));$(".btn-lot-abonnement, #btn-annuler-lot-"+e+"-abonnement, #btn-valider-lot-"+e+"-abonnement, .champ-lot-"+e+"-abonnement").toggle();this.mEditionLot=false}else{Infobulle.generer(h,"pro-lot-abonnement"+e+"-")}}else{Infobulle.generer(j,"pro-lot-abonnement"+e+"-")}};this.ajoutLotAnnulerModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();this.mEditionLot=false};this.ajoutLotAbonnementAnnulerModification=function(b){$(".btn-lot-abonnement, #btn-annuler-lot-"+b+"-abonnement, #btn-valider-lot-"+b+"-abonnement, .champ-lot-"+b+"-abonnement").toggle();this.mEditionLot=false};this.ajoutLotSupprimer=function(b){$("#ligne-lot-"+b).remove()};this.autorisationSupprimerLot=function(b){if(this.mLotReservation[b]){return false}return true};this.modifierLotSupprimer=function(b){if(this.autorisationSupprimerLot(b)){$("#ligne-lot-"+b).remove()}else{this.dialogSupprimerLot(b)}};this.ajoutLotAbonnementSupprimer=function(b){$("#ligne-lot-abonnement-"+b).remove()};this.modifierLotAbonnementSupprimer=function(b){if(this.autorisationSupprimerLot(b)){$("#ligne-lot-abonnement-"+b).remove()}else{this.dialogSupprimerLotAbonnement(b)}};this.dialogSupprimerLot=function(e){var f=this;var b=new GestionCommandeTemplate();var c={modelesLot:[]};var d=$("#dialog-modif-pro").find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text();var g=this.mLotReservation[e].quantite;$("#dialog-modif-pro").find(".ligne-lot").each(function(){var l=$(this).find(".lot-id").text();var h=parseFloat($(this).find(".lot-quantite").text().numberFrToDb());var j=parseFloat($(this).find(".lot-prix").text().numberFrToDb());var k=$(this).find(".lot-unite").text();if(l!=null&&l!=e&&k==d&&h<=g&&(g%h)==0){var m={id:l,quantite:h.nombreFormate(2,","," "),prix:j.nombreFormate(2,","," "),unite:d,sigleMonetaire:gSigleMonetaire};c.modelesLot.push(m)}});$(b.dialogSupprimerLotModifierMarche.template(c)).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Valider:function(){f.supprimerLotModifierReservation($(this),e)},Annuler:function(){$(this).dialog("close")}},close:function(h,j){$(this).remove();Infobulle.init()}})};this.dialogSupprimerLotAbonnement=function(e){var f=this;var b=new GestionCommandeTemplate();var c={modelesLot:[]};var d=$("#dialog-modif-pro").find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text();var g=this.mLotReservation[e].quantite;$("#dialog-modif-pro").find(".ligne-lot-abonnement").each(function(){var l=$(this).find(".lot-id").text();var h=parseFloat($(this).find(".lot-quantite").text().numberFrToDb());var j=parseFloat($(this).find(".lot-prix").text().numberFrToDb());var k=$(this).find(".lot-unite").text();if(l!=null&&l!=e&&k==d&&h<=g&&(g%h)==0){var m={id:l,quantite:h.nombreFormate(2,","," "),prix:j.nombreFormate(2,","," "),unite:d,sigleMonetaire:gSigleMonetaire};c.modelesLot.push(m)}});$(b.dialogSupprimerLotModifierMarche.template(c)).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,buttons:{Valider:function(){f.supprimerLotModifierReservation($(this),e)},Annuler:function(){$(this).dialog("close")}},close:function(h,j){$(this).remove();Infobulle.init()}})};this.supprimerLotModifierReservation=function(b,d){var e=b.find(":input[name=pro-lot]:checked").val();Infobulle.init();if(e==undefined){var f=new Object();var c=new VRerreur();c.code=ERR_254_CODE;c.message=ERR_254_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(c);Infobulle.generer(f,"")}else{this.mLotRemplacement[d]=e;$("#ligne-lot-abonnement-"+d+", #ligne-lot-"+d+", #btn-supprimer-lot-abonnement-"+e+", #btn-supprimer-lot-"+e).remove();$("#pro-lot-"+e+"-id").attr("checked","checked").attr("disabled","disabled");b.dialog("close")}};this.modifierProduit=function(g,d){var e=this;if(!this.mEditionLot){var j=-1;if(d==2){j=g.find("#stock-abonnement").text().numberFrToDb()}else{if(d==0){j=g.find(":input[name=pro-stock]").val().numberFrToDb()}}if(g.find(":input[name=pro-stock-choix]:checked").val()==1&&j==""&&d==0){var m=new Object();var h=new VRerreur();h.code=ERR_201_CODE;h.message=ERR_201_MSG;m.valid=false;m.qteRestante=new VRelement();m.qteRestante.valid=false;m.qteRestante.erreurs.push(h);Infobulle.generer(m,"pro-")}else{var k=-1;if(d==0){k=g.find(":input[name=pro-qte-max]").val().numberFrToDb()}else{if(d==2){k=g.find("#max-abonnement").text().numberFrToDb()}}if(g.find(":input[name=pro-qte-max-choix]:checked").val()==1&&k==""&&d==0){var m=new Object();var h=new VRerreur();h.code=ERR_201_CODE;h.message=ERR_201_MSG;m.valid=false;m.qteMaxCommande=new VRelement();m.qteMaxCommande.valid=false;m.qteMaxCommande.erreurs.push(h);Infobulle.generer(m,"pro-")}else{if(d==2){var b=g.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{var b=g.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}if(j==""){j=-1}if(k==""){k=-1}var c=new ProduitMarcheVO();c.id=g.find("#pro-idProduit").attr("id-produit");c.unite=b;c.qteMaxCommande=k;c.qteRestante=j;c.type=d;c.lotRemplacement=this.mLotRemplacement;if(d==2){g.find(".ligne-lot-abonnement :checkbox:checked").each(function(){var n=new DetailCommandeVO();n.id=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();n.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();n.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();c.lots.push(n)})}else{g.find(".ligne-lot :checkbox:checked").each(function(){var n=new DetailCommandeVO();n.id=$(this).closest(".ligne-lot").find(".lot-id").text();n.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();n.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();c.lots.push(n)})}if(d==1){c.qteMaxCommande=-1;c.qteRestante=-1}c.tailleLotResaMax=this.mTailleLotResaMax;c.quantiteReservation=this.mQuantiteReservation;var l=new ProduitMarcheValid();var f=l.validUpdate(c);if(f.valid){Infobulle.init();c.fonction="modifierProduitMarche";$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(c),function(o){if(o){if(o.valid){var p=new Object();var n=new VRerreur();n.code=ERR_330_CODE;n.message=ERR_330_MSG;p.valid=false;p.log=new VRelement();p.log.valid=false;p.log.erreurs.push(n);Infobulle.generer(p,"");g.dialog("close");e.construct({id_marche:e.mIdMarche,vr:p})}else{Infobulle.generer(o,"pro-")}}},"json")}else{Infobulle.generer(f,"pro-")}}}}else{var m=new Object();var h=new VRerreur();h.code=ERR_112_CODE;h.message=ERR_112_MSG;m.valid=false;m.log=new VRelement();m.log.valid=false;m.log.erreurs.push(h);Infobulle.generer(m,"")}};this.affectSupprimerProduit=function(b){var c=this;b.find(".btn-supprimer-produit").click(function(){var d=$(this).attr("id-produit");if($(this).attr("qte-reservation")>0){c.dialogConfirmationSupprimerProduit(d)}else{c.supprimerProduit(d)}});return b};this.dialogConfirmationSupprimerProduit=function(c){var d=this;var b=new GestionCommandeTemplate();$(b.dialogSupprimerProduit).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){d.supprimerProduit(c)},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.supprimerProduit=function(b){var c=this;var d={fonction:"supprimerProduitMarche",id:b};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){c.mNbProduit--;var g=new Object();var e=new VRerreur();e.code=ERR_331_CODE;e.message=ERR_331_MSG;g.valid=false;g.log=new VRelement();g.log.valid=false;g.log.erreurs.push(e);Infobulle.generer(g,"");$("#dialog-supprimer-produit").dialog("close");c.construct({id_marche:c.mIdMarche,vr:g})}else{Infobulle.generer(f,"marche-")}}},"json")};this.dialogModifierInformationMarche=function(){var d=this;var c=new GestionCommandeTemplate();var b=$(c.dialogModifierInfoMarche.template(d.mMarche));b.find(":input[name=heure-debut]").selectOptions(d.mMarche.heureMarcheDebut);b.find(":input[name=minute-debut]").selectOptions(d.mMarche.minuteMarcheDebut);b.find(":input[name=heure-fin]").selectOptions(d.mMarche.heureMarcheFin);b.find(":input[name=minute-fin]").selectOptions(d.mMarche.minuteMarcheFin);b.find(":input[name=heure-debut-reservation]").selectOptions(d.mMarche.heureDebutReservation);b.find(":input[name=minute-debut-reservation]").selectOptions(d.mMarche.minuteDebutReservation);b.find(":input[name=heure-fin-reservation]").selectOptions(d.mMarche.heureFinReservation);b.find(":input[name=minute-fin-reservation]").selectOptions(d.mMarche.minuteFinReservation);b=gCommunVue.lienDatepickerMarche("marche-dateDebutReservation","marche-dateFinReservation","marche-dateMarcheDebut",b);b.find("#marche-dateDebutReservation").datepicker("option","maxDate",d.mMarche.dateFinReservation);b.find("#marche-dateFinReservation").datepicker("option","minDate",d.mMarche.dateDebutReservation).datepicker("option","maxDate",d.mMarche.dateMarcheDebut);b.find("#marche-dateMarcheDebut").datepicker("option","minDate",d.mMarche.dateFinReservation);$(b).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:800,buttons:{Modifier:function(){d.modifierInformationMarche($(this))},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove();Infobulle.init()}})};this.modifierInformationMarche=function(b){var e=this;var c=new MarcheVO();c.id=this.mMarche.comId;c.nom=b.find(":input[name=nom]").val();c.description=b.find(":input[name=description]").val();c.dateMarcheDebut=b.find(":input[name=date-debut]").val().dateFrToDb();c.timeMarcheDebut=b.find(":input[name=heure-debut]").val()+":"+b.find(":input[name=minute-debut]").val()+":00";c.dateMarcheFin=b.find(":input[name=date-debut]").val().dateFrToDb();c.timeMarcheFin=b.find(":input[name=heure-fin]").val()+":"+b.find(":input[name=minute-fin]").val()+":00";c.dateDebutReservation=b.find(":input[name=date-debut-reservation]").val().dateFrToDb();c.timeDebutReservation=b.find(":input[name=heure-debut-reservation]").val()+":"+b.find(":input[name=minute-debut-reservation]").val()+":00";c.dateFinReservation=b.find(":input[name=date-fin-reservation]").val().dateFrToDb();c.timeFinReservation=b.find(":input[name=heure-fin-reservation]").val()+":"+b.find(":input[name=minute-fin-reservation]").val()+":00";var d=new MarcheValid();var f=d.validUpdateInformation(c);if(f.valid){c.fonction="modifierInformationMarche";$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(c),function(j){if(j){if(j.valid){e.mMarche.nom=c.nom;e.mMarche.comDescription=c.description;var g=c.dateDebutReservation+" "+c.timeDebutReservation;e.mMarche.dateDebutReservation=g.extractDbDate().dateDbToFr();e.mMarche.heureDebutReservation=g.extractDbHeure();e.mMarche.minuteDebutReservation=g.extractDbMinute();g=c.dateFinReservation+" "+c.timeFinReservation;e.mMarche.dateFinReservation=g.extractDbDate().dateDbToFr();e.mMarche.heureFinReservation=g.extractDbHeure();e.mMarche.minuteFinReservation=g.extractDbMinute();g=c.dateMarcheDebut+" "+c.timeMarcheDebut;e.mMarche.dateMarcheDebut=g.extractDbDate().dateDbToFr();e.mMarche.heureMarcheDebut=g.extractDbHeure();e.mMarche.minuteMarcheDebut=g.extractDbMinute();g=c.dateMarcheDebut+" "+c.timeMarcheFin;e.mMarche.heureMarcheFin=g.extractDbHeure();e.mMarche.minuteMarcheFin=g.extractDbMinute();$("#edt-marche-dateDebutReservation").text(e.mMarche.dateDebutReservation);$("#edt-marche-heureDebutReservation").text(e.mMarche.heureDebutReservation);$("#edt-marche-minuteDebutReservation").text(e.mMarche.minuteDebutReservation);$("#edt-marche-dateFinReservation").text(e.mMarche.dateFinReservation);$("#edt-marche-heureFinReservation").text(e.mMarche.heureFinReservation);$("#edt-marche-minuteFinReservation").text(e.mMarche.minuteFinReservation);$("#edt-marche-dateMarcheDebut").text(e.mMarche.dateMarcheDebut);$("#edt-marche-heureMarcheDebut").text(e.mMarche.heureMarcheDebut);$("#edt-marche-minuteMarcheDebut").text(e.mMarche.minuteMarcheDebut);$("#edt-marche-heureMarcheFin").text(e.mMarche.heureMarcheFin);$("#edt-marche-minuteMarcheFin").text(e.mMarche.minuteMarcheFin);b.dialog("close");var k=new Object();var h=new VRerreur();h.code=ERR_335_CODE;h.message=ERR_335_MSG;k.valid=false;k.log=new VRelement();k.log.valid=false;k.log.erreurs.push(h);Infobulle.generer(k,"")}else{Infobulle.generer(j,"marche-")}}},"json")}else{Infobulle.generer(f,"marche-")}};this.affectDialogAjoutProduit=function(b){var c=this;b.find("#btn-ajout-produit").click(function(){var d={fonction:"listeFerme"};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();var e=new GestionCommandeTemplate();var g=e.dialogAjoutProduitAjoutMarche;$(c.affectAjoutProduitSelectFerme($(g.template(f)))).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:900,position:"top",buttons:{Ajouter:function(){c.ajouterProduit($(this))},Annuler:function(){c.mEditionLot=false;$(this).dialog("close")}},close:function(h,j){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(f,"")}}},"json")});return b};this.affectAjoutProduitSelectFerme=function(b){var c=this;b.find("#pro-idFerme select").change(function(){var e=$(this).val();$("#pro-idCategorie select, #pro-idProduit select").attr("disabled","disabled").selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');if(e>0){var d={fonction:"listeProduit",id:e};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(d),function(j){if(j){if(j.valid){Infobulle.init();if(j.listeProduit.length>0&&j.listeProduit[0].nproId!=null){c.mProduits=[];var h=0;var l=[];$.each(j.listeProduit,function(){if(c.mProduits[this.cproId]){c.mProduits[this.cproId].listeProduit.push(this)}else{c.mProduits[this.cproId]={nom:this.cproNom,listeProduit:[this]}}if(h!=this.cproId){l.push({cproId:this.cproId,cproNom:this.cproNom});h=this.cproId}});var f=new GestionCommandeTemplate();var k=f.ajoutProduitSelectCategorie;$("#pro-idCategorie").replaceWith(c.affectAjoutProduitSelectCategorie($(k.template({listeCategorie:l}))))}else{var m=new TemplateVR();m.valid=false;m.log.valid=false;var g=new VRerreur();g.code=ERR_332_CODE;g.message=ERR_332_MSG;m.log.erreurs.push(g);Infobulle.generer(m,"")}}else{Infobulle.generer(j,"")}}},"json")}});return b};this.affectAjoutProduitSelectCategorie=function(b){var c=this;b.find("select").change(function(){$("#pro-idProduit select").attr("disabled","disabled").selectOptions("0");$("#prix-stock-produit").replaceWith('<div id="prix-stock-produit"></div>');var f=$(this).val();if(f>0){var d=new GestionCommandeTemplate();var e=d.ajoutProduitSelectProduit;$("#pro-idProduit").replaceWith(c.affectAjoutProduitSelectProduit($(e.template(c.mProduits[f]))))}});return b};this.affectAjoutProduitSelectProduit=function(b){var c=this;b.find("select").change(function(){var g=$(this).val();if(g>0){if(!c.mMarche.produits[g]||!c.mMarche.produitsAbonnement[g]){var e={fonction:"listeModeleLot",idNomProduit:g};$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(e),function(l){if(l){if(l.valid){Infobulle.init();if((!c.mMarche.produitsAbonnement[g]&&l.detailAbonnement.idNomProduit==g)||!c.mMarche.produits[g]){var h=new GestionCommandeTemplate();var k={sigleMonetaire:gSigleMonetaire};if(l.modelesLot.length>0&&l.modelesLot[0].mLotId!=null){k.modelesLot=[];$(l.modelesLot).each(function(){if(this.mLotId!=null){this.id=this.mLotId;this.quantite=this.mLotQuantite.nombreFormate(2,","," ");this.unite=this.mLotUnite;this.prix=this.mLotPrix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;k.modelesLot.push(this);k.unite=this.mLotUnite}})}if(l.detailAbonnement.idNomProduit==g){k.modelesLotAbonnement=[];k.modelesLotAbonnementReservation=[];k.uniteAbonnement=l.detailAbonnement.unite;$(l.detailAbonnement.lots).each(function(){this.id=this.id;this.quantite=this.taille.nombreFormate(2,","," ");this.unite=k.uniteAbonnement;this.prix=this.prix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;if(this.reservation){k.modelesLotAbonnementReservation.push(this)}else{k.modelesLotAbonnement.push(this)}})}if(c.mMarche.produits[g]){k.typeNormalSelected='disabled="disabled"';k.typeSolidaireSelected='disabled="disabled"';k.typeAbonnementSelected='checked="checked"';k.visibleSolidaire="ui-helper-hidden";k.visibleNormal="ui-helper-hidden";k.visibleAbonnement=""}else{if(c.mMarche.produitsAbonnement[g]){k.typeNormalSelected='checked="checked"';k.typeAbonnementSelected='disabled="disabled"';k.visibleSolidaire="";k.visibleNormal="";k.visibleAbonnement="ui-helper-hidden"}else{k.typeNormalSelected='checked="checked"';k.visibleSolidaire="";k.visibleNormal="";k.visibleAbonnement="ui-helper-hidden"}}if(l.detailAbonnement.idNomProduit==g){k.stockInitialAbonnement=l.detailAbonnement.stockInitial.nombreFormate(2,","," ");if(parseFloat(l.detailAbonnement.max)==-1){k.qMaxAbonnement="Pas de limite"}else{k.qMaxAbonnement=l.detailAbonnement.max.nombreFormate(2,","," ")+" "+k.uniteAbonnement}k.qMaxAbonnementValue=l.detailAbonnement.max;k.typeProduitAbonnement=h.typeProduitAbonnementAjoutProduit.template(k);k.divLotAbonnement=h.prixAbonnementAjoutProduit.template(k);k.divStockAbonnement=h.stockAbonnementAjoutProduit.template(k)}k.divTypeProduit=h.typeProduitAjoutProduit.template(k);k.divLot=h.prixAjoutProduit.template(k);k.divStock=h.stockAjoutProduit.template(k);var n=h.prixEtStockAjoutProduit;$("#prix-stock-produit").replaceWith(c.affectPrixEtStock($(n.template(k))))}else{var m=new Object();var j=new VRerreur();j.code=ERR_211_CODE;j.message=ERR_211_MSG;m.valid=false;m.log=new VRelement();m.log.valid=false;m.log.erreurs.push(j);Infobulle.generer(m,"")}}else{Infobulle.generer(l,"")}}},"json")}else{var f=new Object();var d=new VRerreur();d.code=ERR_211_CODE;d.message=ERR_211_MSG;f.valid=false;f.log=new VRelement();f.log.valid=false;f.log.erreurs.push(d);Infobulle.generer(f,"")}}else{$("#prix-stock-produit").replaceWith($('<div id="prix-stock-produit">'))}});return b};this.ajouterProduit=function(h){var f=this;if(!this.mEditionLot){var o=h.find(":input[name=ferme]").val();var m=h.find(":input[name=categorie]").val();var e=h.find(":input[name=produit]").val();var d=h.find(":input[name=typeProduit]:checked").val();if(e!=0){var l=-1;if(d==2){l=h.find("#stock-abonnement").text().numberFrToDb()}else{if(d==0){l=h.find(":input[name=pro-stock]").val().numberFrToDb()}}if(h.find(":input[name=pro-stock-choix]:checked").val()==1&&l==""&&d==0){var p=new Object();var j=new VRerreur();j.code=ERR_201_CODE;j.message=ERR_201_MSG;p.valid=false;p.qteRestante=new VRelement();p.qteRestante.valid=false;p.qteRestante.erreurs.push(j);Infobulle.generer(p,"pro-")}else{var k=-1;if(d==2){k=h.find("#max-abonnement").text().numberFrToDb()}else{if(d==0){k=h.find(":input[name=pro-qte-max]").val().numberFrToDb()}}if(h.find(":input[name=pro-qte-max-choix]:checked").val()==1&&k==""&&d==0){var p=new Object();var j=new VRerreur();j.code=ERR_201_CODE;j.message=ERR_201_MSG;p.valid=false;p.qteMaxCommande=new VRelement();p.qteMaxCommande.valid=false;p.qteMaxCommande.erreurs.push(j);Infobulle.generer(p,"pro-")}else{if(d==2){var b=h.find(".ligne-lot-abonnement :checkbox:checked").first().closest(".ligne-lot-abonnement").find(".lot-unite").text()}else{var b=h.find(".ligne-lot :checkbox:checked").first().closest(".ligne-lot").find(".lot-unite").text()}if(d==2&&this.mMarche.produitsAbonnement[e]){var p=new Object();var j=new VRerreur();j.code=ERR_253_CODE;j.message=ERR_253_MSG;p.valid=false;p.qteMaxCommande=new VRelement();p.qteMaxCommande.valid=false;p.qteMaxCommande.erreurs.push(j);Infobulle.generer(p,"pro-")}else{if(d<2&&this.mMarche.produits[e]){var p=new Object();var j=new VRerreur();j.code=ERR_211_CODE;j.message=ERR_211_MSG;p.valid=false;p.qteMaxCommande=new VRelement();p.qteMaxCommande.valid=false;p.qteMaxCommande.erreurs.push(j);Infobulle.generer(p,"pro-")}else{if(l==""){l=-1}if(k==""){k=-1}var c=new ProduitMarcheVO();c.id=f.mIdMarche;c.idNom=e;c.unite=b;c.qteMaxCommande=k;c.qteRestante=l;c.type=d;if(d==2){h.find(".ligne-lot-abonnement :checkbox").each(function(){var r=new DetailCommandeVO();var q=$(this).closest(".ligne-lot-abonnement").find(".lot-id").text();if(q>0){r.id=q}r.taille=$(this).closest(".ligne-lot-abonnement").find(".lot-quantite").text().numberFrToDb();r.prix=$(this).closest(".ligne-lot-abonnement").find(".lot-prix").text().numberFrToDb();c.lots.push(r)})}else{h.find(".ligne-lot :checkbox").each(function(){var q=new DetailCommandeVO();q.taille=$(this).closest(".ligne-lot").find(".lot-quantite").text().numberFrToDb();q.prix=$(this).closest(".ligne-lot").find(".lot-prix").text().numberFrToDb();c.lots.push(q)})}var n=new CommandeCompleteValid();var g=n.validAjoutProduit(c);if(g.valid){Infobulle.init();c.fonction="ajouterProduitMarche";$.post("./index.php?m=GestionCommande&v=EditerCommande","pParam="+$.toJSON(c),function(r){if(r){if(r.valid){var s=new Object();var q=new VRerreur();q.code=ERR_329_CODE;q.message=ERR_329_MSG;s.valid=false;s.log=new VRelement();s.log.valid=false;s.log.erreurs.push(q);Infobulle.generer(s,"");h.dialog("close");f.construct({id_marche:f.mIdMarche,vr:s})}else{Infobulle.generer(r,"pro-")}}},"json")}else{Infobulle.generer(g,"pro-")}}}}}}}else{var p=new Object();var j=new VRerreur();j.code=ERR_112_CODE;j.message=ERR_112_MSG;p.valid=false;p.log=new VRelement();p.log.valid=false;p.log.erreurs.push(j);Infobulle.generer(p,"")}};this.construct(a)};