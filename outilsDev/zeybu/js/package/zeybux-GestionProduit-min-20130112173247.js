function GestionProduitTemplate(){this.listeCategorie='<div id="contenu"><div id="liste_adherent_solde_int"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les catégories de produit<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-cat" title="Ajouter une catégorie"><span class="ui-icon ui-icon-plusthick"></span></span></div><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th><th class="com-table-th-med com-underline-hover"></th><th class="com-table-th-fin com-underline-hover"></th></tr></thead><tbody><!-- BEGIN listeCategorie --><tr class="com-cursor-pointer" id="{listeCategorie.cproId}"><td class="compte-ligne com-table-td-debut com-underline-hover">{listeCategorie.cproNom}</td><td class="com-table-td-med com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-edt-modifier" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-edt-supprimer" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END listeCategorie --></tbody></table></div></div></div>';this.listeCategorieVide='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les catégories de produit<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-cat" title="Ajouter une catégorie"><span class="ui-icon ui-icon-plusthick"></span></span></div><p id="texte-liste-vide">Aucune catégorie dans la base.</p></div></div>';this.dialogAjoutCategorie='<div id="dialog-form-cat" title="Catégorie"><form><table><tr><td>Nom</td><td><input type="hidden" name="id" id="cat-id" value="{cproId}"/><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom" id="cat-nom" value="{cproNom}"/></td></tr><tr><td>Description</td><td><textarea class="com-input-text ui-widget-content ui-corner-all" name="description" id="cat-description">{cproDescription}</textarea></td></tr></table></form></div>';this.dialogSupprimerCategorie='<div id="dialog-cat" title="Catégorie"><p>Voulez-vous supprimer la catégorie : {cproNom}</p></div>';this.dialogRefusSupprimerCategorie='<div id="dialog-cat" title="Catégorie"><p>Il existe {nbProduit} produits liés à cette catégorie. Vous devez les supprimer ou les changer de catégorie pour pouvoir supprimer la catégorie : {cproNom}</p></div>';this.dialogInfoCategorie='<div id="dialog-info-cat" title="Détail de la catégorie"><div>Nom : {cproNom}</div><div>Description : {cproDescription}</div></div>';this.listeCaracteristique='<div id="contenu"><div id="liste_adherent_solde_int"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les caractéristiques de produit<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-car" title="Ajouter une caractéristique"><span class="ui-icon ui-icon-plusthick"></span></span></div><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th><th class="com-table-th-med com-underline-hover"></th><th class="com-table-th-fin com-underline-hover"></th></tr></thead><tbody><!-- BEGIN listeCaracteristique --><tr class="com-cursor-pointer" id="{listeCaracteristique.carId}"><td class="compte-ligne com-table-td-debut com-underline-hover">{listeCaracteristique.carNom}</td><td class="com-table-td-med com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-edt-modifier" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-edt-supprimer" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END listeCaracteristique --></tbody></table></div></div></div>';this.listeCaracteristiqueVide='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les caractéristiques de produit<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-car" title="Ajouter une caractéristique"><span class="ui-icon ui-icon-plusthick"></span></span></div><p id="texte-liste-vide">Aucune caractéristique dans la base.</p></div></div>';this.dialogAjoutCaracteristique='<div id="dialog-form-car" title="Caractéristique"><form><table><tr><td>Nom</td><td><input type="hidden" name="id" id="car-id" value="{carId}"/><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom" id="car-nom" value="{carNom}"/></td></tr><tr><td>Description</td><td><textarea class="com-input-text ui-widget-content ui-corner-all" name="description" id="car-description">{carDescription}</textarea></td></tr></table></form></div>';this.dialogSupprimerCaracteristique='<div id="dialog-car" title="Caractéristique"><p>Voulez-vous supprimer la caractéristique : {carNom}</p></div>';this.dialogRefusSupprimerCaracteristique='<div id="dialog-car" title="Caractéristique"><p>Il existe {nbProduit} produits liés à cette caractéristique. Vous devez les supprimer ou les changer de caractéristique pour pouvoir supprimer la caractéristique : {carNom}</p></div>';this.dialogInfoCaracteristique='<div id="dialog-info-car" title="Détail de la caracréristique"><div>Nom : {carNom}</div><div>Description : {carDescription}</div></div>'}function GestionCategorieVue(a){this.mParam={};this.mCategories=[];this.construct=function(b){$.history({vue:function(){GestionCategorieVue(b)}});var c=this;this.mParam=$.extend(this.mParam,b);this.mParam.fonction="afficher";$.post("./index.php?m=GestionProduit&v=GestionCategorie","pParam="+$.toJSON(this.mParam),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var c=this;$.each(d.listeCategorie,function(){c.mCategories[this.cproId]=this});var b=new GestionProduitTemplate();if(d.listeCategorie.length>0&&d.listeCategorie[0].cproId!=null){$("#contenu").replaceWith(c.affect($(b.listeCategorie.template(d))))}else{$("#contenu").replaceWith(c.affect($(b.listeCategorieVide)))}};this.affect=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectLienCompte(b);b=this.affectDialogCreerCategorie(b);b=this.affectDialogModifierCategorie(b);b=this.affectDialogSupprimerCategorie(b);b=gCommunVue.comHoverBtn(b);return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[0,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectLienCompte=function(b){var c=this;b.find(".compte-ligne").click(function(){var e=$(this).closest("tr").attr("id");var d={id:e,fonction:"detailCategorie"};$.post("./index.php?m=GestionProduit&v=GestionCategorie","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g){if(g.valid){var f=new GestionProduitTemplate();var h=f.dialogInfoCategorie;$(h.template(g.categorie)).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,close:function(i,j){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(g,"")}}},"json")});return b};this.affectDialogCreerCategorie=function(b){var c=this;b.find("#btn-nv-cat").click(function(){var d=new GestionProduitTemplate();var e=d.dialogAjoutCategorie;$(e.template()).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{"Créer la categorie":function(){var f=$(this).children("form").first();c.CreerCategorie(f)},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}}).submit(function(){c.CreerCategorie($(this));return false})});return b};this.CreerCategorie=function(c){var e=this;var b=new CategorieProduitVO();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();var d=new CategorieProduitValid();var g=d.validAjout(b);if(g.valid){Infobulle.init();var f={fonction:"ajouter",categorieProduit:b};$.post("./index.php?m=GestionProduit&v=GestionCategorie","pParam="+$.toJSON(f),function(i){if(i){if(i.valid){Infobulle.init();$("#dialog-form-cat").dialog("close");var k=new TemplateVR();k.valid=false;k.log.valid=false;var h=new VRerreur();h.code=ERR_317_CODE;h.message=ERR_317_MSG;k.log.erreurs.push(h);var j={vr:k};e.construct(j)}else{Infobulle.generer(i,"cat-")}}},"json")}else{Infobulle.generer(g,"cat-")}};this.affectDialogModifierCategorie=function(b){var c=this;b.find(".btn-edt-modifier").click(function(){var d=new GestionProduitTemplate();var g=d.dialogAjoutCategorie;var f=$(this).closest("tr").attr("id");var e={id:f,fonction:"detailCategorie"};$.post("./index.php?m=GestionProduit&v=GestionCategorie","pParam="+$.toJSON(e),function(h){Infobulle.init();if(h){if(h.valid){$(g.template(h.categorie)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{"Modifier la categorie":function(){var i=$(this).children("form").first();c.ModifierCategorie(i)},Annuler:function(){$(this).dialog("close")}},close:function(i,j){$(this).remove();Infobulle.init()}}).submit(function(){c.ModifierCategorie($(this));return false})}else{Infobulle.generer(h,"")}}},"json")});return b};this.ModifierCategorie=function(c){var e=this;var b=new CategorieProduitVO();b.id=c.find(":input[name=id]").val();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();var d=new CategorieProduitValid();var g=d.validUpdate(b);if(g.valid){Infobulle.init();var f={fonction:"modifier",categorieProduit:b};$.post("./index.php?m=GestionProduit&v=GestionCategorie","pParam="+$.toJSON(f),function(i){if(i){if(i.valid){Infobulle.init();$("#dialog-form-cat").dialog("close");var k=new TemplateVR();k.valid=false;k.log.valid=false;var h=new VRerreur();h.code=ERR_318_CODE;h.message=ERR_318_MSG;k.log.erreurs.push(h);var j={vr:k};e.construct(j)}else{Infobulle.generer(i,"cat-")}}},"json")}else{Infobulle.generer(g,"cat-")}};this.affectDialogSupprimerCategorie=function(b){var c=this;b.find(".btn-edt-supprimer").click(function(){var e=$(this).closest("tr").attr("id");var d={fonction:"autorisationSupprimer",id:e};$.post("./index.php?m=GestionProduit&v=GestionCategorie","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();if(f.autorisation){c.dialogSupprimerCategorie(e)}else{f.id=e;c.refusSupprimerCategorie(f)}}else{Infobulle.generer(f,"")}}},"json")});return b};this.dialogSupprimerCategorie=function(c){var e=this;var d=new GestionProduitTemplate();var f=d.dialogSupprimerCategorie;var b=this.mCategories[c];$(f.template(b)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{"Supprimer la categorie":function(){e.supprimerCategorie(c)},Annuler:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})};this.supprimerCategorie=function(b){var c=this;var d={fonction:"supprimer",id:b};$.post("./index.php?m=GestionProduit&v=GestionCategorie","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();$("#dialog-cat").dialog("close");var h=new TemplateVR();h.valid=false;h.log.valid=false;var e=new VRerreur();e.code=ERR_319_CODE;e.message=ERR_319_MSG;h.log.erreurs.push(e);var g={vr:h};c.construct(g)}else{Infobulle.generer(f,"")}}},"json")};this.refusSupprimerCategorie=function(c){var e=this;var d=new GestionProduitTemplate();var f=d.dialogRefusSupprimerCategorie;var b=this.mCategories[c.id];b.nbProduit=c.nbProduit;$(f.template(b)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{"Exporter la liste des produits":function(){var g={fonction:"exportProduitCategorie",id:c.id};$.download("./index.php?m=GestionProduit&v=GestionCategorie",g)},Fermer:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})};this.construct(a)}function GestionCaracteristiqueVue(a){this.mParam={};this.mCaracteristiques=[];this.construct=function(b){$.history({vue:function(){GestionCaracteristiqueVue(b)}});var c=this;this.mParam=$.extend(this.mParam,b);this.mParam.fonction="afficher";$.post("./index.php?m=GestionProduit&v=GestionCaracteristique","pParam="+$.toJSON(this.mParam),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var c=this;$.each(d.listeCaracteristique,function(){c.mCaracteristiques[this.carId]=this});var b=new GestionProduitTemplate();if(d.listeCaracteristique.length>0&&d.listeCaracteristique[0].carId!=null){$("#contenu").replaceWith(c.affect($(b.listeCaracteristique.template(d))))}else{$("#contenu").replaceWith(c.affect($(b.listeCaracteristiqueVide)))}};this.affect=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectLienCompte(b);b=this.affectDialogCreerCaracteristique(b);b=this.affectDialogModifierCaracteristique(b);b=this.affectDialogSupprimerCaracteristique(b);b=gCommunVue.comHoverBtn(b);return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[0,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectLienCompte=function(b){var c=this;b.find(".compte-ligne").click(function(){var e=$(this).closest("tr").attr("id");var d={id:e,fonction:"detailCaracteristique"};$.post("./index.php?m=GestionProduit&v=GestionCaracteristique","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g){if(g.valid){var f=new GestionProduitTemplate();var h=f.dialogInfoCaracteristique;$(h.template(g.caracteristique)).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,close:function(i,j){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(g,"")}}},"json")});return b};this.affectDialogCreerCaracteristique=function(b){var c=this;b.find("#btn-nv-car").click(function(){var d=new GestionProduitTemplate();var e=d.dialogAjoutCaracteristique;$(e.template()).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{"Créer":function(){var f=$(this).children("form").first();c.CreerCaracteristique(f)},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}}).submit(function(){c.CreerCategorie($(this));return false})});return b};this.CreerCaracteristique=function(c){var e=this;var b=new CaracteristiqueVO();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();var d=new CaracteristiqueValid();var f=d.validAjout(b);if(f.valid){Infobulle.init();b.fonction="ajouter";$.post("./index.php?m=GestionProduit&v=GestionCaracteristique","pParam="+$.toJSON(b),function(h){if(h){if(h.valid){Infobulle.init();$("#dialog-form-car").dialog("close");var j=new TemplateVR();j.valid=false;j.log.valid=false;var g=new VRerreur();g.code=ERR_326_CODE;g.message=ERR_326_MSG;j.log.erreurs.push(g);var i={vr:j};e.construct(i)}else{Infobulle.generer(h,"car-")}}},"json")}else{Infobulle.generer(f,"car-")}};this.affectDialogModifierCaracteristique=function(b){var c=this;b.find(".btn-edt-modifier").click(function(){var d=new GestionProduitTemplate();var g=d.dialogAjoutCaracteristique;var f=$(this).closest("tr").attr("id");var e={id:f,fonction:"detailCaracteristique"};$.post("./index.php?m=GestionProduit&v=GestionCaracteristique","pParam="+$.toJSON(e),function(h){Infobulle.init();if(h){if(h.valid){$(g.template(h.caracteristique)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{Modifier:function(){var i=$(this).children("form").first();c.ModifierCaracteristique(i)},Annuler:function(){$(this).dialog("close")}},close:function(i,j){$(this).remove();Infobulle.init()}}).submit(function(){c.ModifierCaracteristique($(this));return false})}else{Infobulle.generer(h,"")}}},"json")});return b};this.ModifierCaracteristique=function(c){var e=this;var b=new CaracteristiqueVO();b.id=c.find(":input[name=id]").val();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();var d=new CaracteristiqueValid();var f=d.validUpdate(b);if(f.valid){Infobulle.init();b.fonction="modifier";$.post("./index.php?m=GestionProduit&v=GestionCaracteristique","pParam="+$.toJSON(b),function(h){if(h){if(h.valid){Infobulle.init();$("#dialog-form-car").dialog("close");var j=new TemplateVR();j.valid=false;j.log.valid=false;var g=new VRerreur();g.code=ERR_327_CODE;g.message=ERR_327_MSG;j.log.erreurs.push(g);var i={vr:j};e.construct(i)}else{Infobulle.generer(h,"car-")}}},"json")}else{Infobulle.generer(f,"car-")}};this.affectDialogSupprimerCaracteristique=function(b){var c=this;b.find(".btn-edt-supprimer").click(function(){var e=$(this).closest("tr").attr("id");var d={fonction:"autorisationSupprimer",id:e};$.post("./index.php?m=GestionProduit&v=GestionCaracteristique","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();if(f.autorisation){c.dialogSupprimerCaracteristique(e)}else{f.id=e;c.refusSupprimerCaracteristique(f)}}else{Infobulle.generer(f,"")}}},"json")});return b};this.dialogSupprimerCaracteristique=function(c){var e=this;var d=new GestionProduitTemplate();var f=d.dialogSupprimerCaracteristique;var b=this.mCaracteristiques[c];$(f.template(b)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){e.supprimerCaracteristique(c)},Annuler:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})};this.supprimerCaracteristique=function(b){var c=this;var d={fonction:"supprimer",id:b};$.post("./index.php?m=GestionProduit&v=GestionCaracteristique","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();$("#dialog-car").dialog("close");var h=new TemplateVR();h.valid=false;h.log.valid=false;var e=new VRerreur();e.code=ERR_328_CODE;e.message=ERR_328_MSG;h.log.erreurs.push(e);var g={vr:h};c.construct(g)}else{Infobulle.generer(f,"")}}},"json")};this.refusSupprimerCaracteristique=function(c){var e=this;var d=new GestionProduitTemplate();var f=d.dialogRefusSupprimerCaracteristique;var b=this.mCaracteristiques[c.id];b.nbProduit=c.nbProduit;$(f.template(b)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{"Exporter la liste des produits":function(){var g={fonction:"exportProduitCaracteristique",id:c.id};$.download("./index.php?m=GestionProduit&v=GestionCaracteristique",g)},Fermer:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})};this.construct(a)};