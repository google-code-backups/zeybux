function AjoutAdherentVue(){this.mCommunVue=new CommunVue();this.construct=function(){var a=this;$.post("./index.php?m=GestionAdherents&v=AjoutAdherent",function(b){Infobulle.init();if(b.valid){a.afficher(b)}else{Infobulle.generer(b,"")}},"json")};this.afficher=function(b){var a=this;$(b.modules).each(function(){if(this.defaut==1){this.checked='checked="checked"'}});var c=new GestionAdherentsTemplate();var d=c.formulaireAjoutAdherent;$("#contenu").replaceWith(a.affect($(d.template(b))))};this.affect=function(a){a=this.boutonLienCompte(a);a=this.mCommunVue.comNumeric(a);a=this.affectControleDatepicker(a);a=this.affectSubmit(a);return a};this.boutonLienCompte=function(a){a.find(":input[name=lien_numero_compte]").click(function(){if(a.find(":input[name=numero_compte]").attr("disabled")){a.find(":input[name=numero_compte]").removeAttr("disabled")}else{a.find(":input[name=numero_compte]").attr("disabled","disabled").val("")}});return a};this.affectControleDatepicker=function(a){a=this.mCommunVue.comLienDatepicker("dateNaissance","dateAdhesion",a);return a};this.affectSubmit=function(a){var b=this;a.find("form").submit(function(){b.ajoutAdherent();return false});return a};this.ajoutAdherent=function(){var a=new AdherentVO();a.motPasse=$(":input[name=pass]").val();a.motPasseConfirm=$(":input[name=pass_confirm]").val();a.compte=$(":input[name=numero_compte]").val();a.nom=$(":input[name=nom]").val();a.prenom=$(":input[name=prenom]").val();a.courrielPrincipal=$(":input[name=courriel_principal]").val();a.courrielSecondaire=$(":input[name=courriel_secondaire]").val();a.telephonePrincipal=$(":input[name=telephone_principal]").val();a.telephoneSecondaire=$(":input[name=telephone_secondaire]").val();a.adresse=$(":input[name=adresse]").val();a.codePostal=$(":input[name=code_postal]").val();a.ville=$(":input[name=ville]").val();a.dateNaissance=$(":input[name=date_naissance]").val().dateFrToDb();a.dateAdhesion=$(":input[name=date_adhesion]").val().dateFrToDb();a.commentaire=$(":input[name=commentaire]").val();$(":input[name=modules[]]:checked").each(function(){a.modules.push($(this).val())});var b=new AdherentValid();var c=b.validAjout(a);if(c.valid){Infobulle.init();$.post("./index.php?m=GestionAdherents&v=AjoutAdherent","pParam="+$.toJSON(a),function(d){Infobulle.init();if(d.valid){var e=new GestionAdherentsTemplate();var f=e.ajoutAdherentSucces;$("#contenu").replaceWith(f.template(d))}else{Infobulle.generer(d,"")}},"json")}else{Infobulle.generer(c,"")}};this.construct()}function CompteAdherentVue(a){this.mIdAdherent=null;this.construct=function(b){var c=this;$.post("./index.php?m=GestionAdherents&v=CompteAdherent","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){c.afficher(d)}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(f){var e=this;this.mIdAdherent=f.adherent.adhId;f.opeMontant=f.adherent.opeMontant.nombreFormate(2,","," ");f.sigleMonetaire=gSigleMonetaire;f.adherent.adhDateNaissance=f.adherent.adhDateNaissance.extractDbDate().dateDbToFr();f.adherent.adhDateAdhesion=f.adherent.adhDateAdhesion.extractDbDate().dateDbToFr();$(f.operationPassee).each(function(){this.opeDate=this.opeDate.extractDbDate().dateDbToFr();if(this.tppType==null){this.tppType=""}if(this.opeMontant<0){this.debit=(this.opeMontant*-1).nombreFormate(2,","," ")+" "+gSigleMonetaire;this.credit=""}else{this.debit="";this.credit=this.opeMontant.nombreFormate(2,","," ")+" "+gSigleMonetaire}});var d=parseFloat(f.adherent.opeMontant);var c=0;$(f.operationAvenir).each(function(){if(this.opeDate!=null){d+=parseFloat(this.opeMontant);this.nouveauSolde=d.nombreFormate(2,","," ");this.rechargement=(0).nombreFormate(2,","," ");var i=5;if(d<i){this.rechargement=(Math.ceil((i-d)/i)*i)-c}c+=this.rechargement;this.rechargement=this.rechargement.nombreFormate(2,","," ");this.opeDate=this.opeDate.extractDbDate().dateDbToFr();this.comDateMarche=this.comDateMarche.extractDbDate().dateDbToFr();this.opeMontant=(this.opeMontant*-1).nombreFormate(2,","," ")}});$(f.modules).each(function(){var i=this;this.classAutorisation="ui-icon-closethick";$(f.autorisations).each(function(){if(this.idModule==i.id){i.classAutorisation="ui-icon-check"}})});var g=new GestionAdherentsTemplate();var h=new CommunTemplate();var b=h.debutContenu;b+=g.infoCompteAdherentDebut.template(f.adherent);b+=g.infoCompteAdherentAutorisation.template(f);b+=g.infoCompteAdherentFin.template(f);b+=g.listeOperationAdherentDebut.template(f);b+=g.listeOperationPassee.template(f);if(isArray(f.operationAvenir)&&f.operationAvenir[0].opeLibelle!=null){b+=g.listeOperationAvenir.template(f)}b+=g.listeOperationAdherentFin.template(f);b+=h.finContenu;b=$(b);if(f.adherent.opeMontant<0){b=this.soldeNegatif(b)}if(f.operationPassee.length<11){b=this.masquerPagination(b)}else{b=this.paginnation(b)}$("#contenu").replaceWith(e.affect(b))};this.affect=function(b){b=this.nouveauSoldeNegatif(b);b=this.affectHover(b);b=this.affectLienModifier(b);b=this.affectDialogSuppAdherent(b);return b};this.paginnation=function(b){b.find("#table-operation").tablesorter({headers:{0:{sorter:false},1:{sorter:false},2:{sorter:false},3:{sorter:false},4:{sorter:false}}}).tablesorterPager({container:b.find("#content-nav-liste-operation"),positionFixed:false});return b};this.nouveauSoldeNegatif=function(b){b.find(".nouveau-solde-val").each(function(){if(parseFloat($(this).text().numberFrToDb())<0){$(this).closest(".nouveau-solde").addClass("com-nombre-negatif")}});return b};this.soldeNegatif=function(b){b.find("#solde").addClass("com-nombre-negatif");return b};this.affectHover=function(b){b.find("#icone-nav-liste-operation-w,#icone-nav-liste-operation-e").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});return b};this.masquerPagination=function(b){b.find("#content-nav-liste-operation").hide();return b};this.affectLienModifier=function(b){var c=this;b.find("#btn-edt").click(function(){ModificationAdherentVue({id_adherent:c.mIdAdherent})});return b};this.affectDialogSuppAdherent=function(b){var c=this;b.find("#dialog-supp-adh").dialog({autoOpen:false,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var d={id_adherent:c.mIdAdherent};var e=this;$.post("./index.php?m=GestionAdherents&v=SuppressionAdherent","pParam="+$.toJSON(d),function(f){Infobulle.init();if(f.valid){var g=new GestionAdherentsTemplate();var h=g.supprimerAdherentSucces;$("#contenu").replaceWith(h.template(f));$(e).dialog("close")}else{Infobulle.generer(f,"")}},"json")},Annuler:function(){$(this).dialog("close")}}});b.find("#btn-supp").click(function(){$("#dialog-supp-adh").dialog("open")});return b};this.construct(a)}function ListeAdherentVue(){this.construct=function(){var a=this;$.post("./index.php?m=GestionAdherents&v=ListeAdherent",function(b){Infobulle.init();if(b.valid){a.afficher(b)}else{Infobulle.generer(b,"")}},"json")};this.afficher=function(b){var a=this;var c=new GestionAdherentsTemplate();if(b.listeAdherent.length>0&&b.listeAdherent[0].adhId!=null){var d=c.listeAdherent;b.sigleMonetaire=gSigleMonetaire;$(b.listeAdherent).each(function(){this.classSolde="";if(this.opeMontant<0){this.classSolde="com-nombre-negatif"}this.opeMontant=this.opeMontant.nombreFormate(2,","," ")});$("#contenu").replaceWith(a.affect($(d.template(b))))}else{$("#contenu").replaceWith(c.listeAdherentVide)}};this.affect=function(a){a=this.affectTri(a);a=this.affectRecherche(a);a=this.affectLienCompte(a);return a};this.affectTri=function(a){a.find(".com-table").tablesorter({sortList:[[0,0]],headers:{4:{sorter:false}}});return a};this.affectRecherche=function(a){a.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});a.find("#filter-form").submit(function(){return false});return a};this.affectLienCompte=function(a){var b=this;a.find(".compte-ligne").click(function(){CompteAdherentVue({id_adherent:$(this).find(".id-adherent").text()})});return a};this.construct()}function ModificationAdherentVue(a){this.mCommunVue=new CommunVue();this.mIdAdherent=null;this.construct=function(b){var c=this;$.post("./index.php?m=GestionAdherents&v=ModificationAdherent","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d.valid){c.mIdAdherent=b.id_adherent;c.afficher(d)}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(d){var c=this;d.dateAdhesion=d.dateAdhesion.extractDbDate().dateDbToFr();d.dateNaissance=d.dateNaissance.extractDbDate().dateDbToFr();$(d.autorisations).each(function(){var g=this.idModule;$(d.modules).each(function(){if(this.id==g){this.checked='checked="checked"'}})});var e=new GestionAdherentsTemplate();var f=e.formulaireAjoutAdherent;var b=f.template(d);$("#contenu").replaceWith(c.affect($(f.template(d))))};this.affect=function(b){b=this.boutonLienCompte(b);b=this.mCommunVue.comNumeric(b);b=this.affectControleDatepicker(b);b=this.affectSubmit(b);return b};this.boutonLienCompte=function(b){b.find(":input[name=lien_numero_compte]").click(function(){if(b.find(":input[name=numero_compte]").attr("disabled")){b.find(":input[name=numero_compte]").removeAttr("disabled")}else{b.find(":input[name=numero_compte]").attr("disabled","disabled")}});return b};this.affectControleDatepicker=function(b){b=this.mCommunVue.comLienDatepicker("dateNaissance","dateAdhesion",b);return b};this.affectSubmit=function(b){var c=this;b.find("form").submit(function(){c.modifAdherent();return false});return b};this.modifAdherent=function(){var b=new AdherentVO();b.id=this.mIdAdherent;b.motPasse=$(":input[name=pass]").val();b.motPasseConfirm=$(":input[name=pass_confirm]").val();b.compte=$(":input[name=numero_compte]").val();b.nom=$(":input[name=nom]").val();b.prenom=$(":input[name=prenom]").val();b.courrielPrincipal=$(":input[name=courriel_principal]").val();b.courrielSecondaire=$(":input[name=courriel_secondaire]").val();b.telephonePrincipal=$(":input[name=telephone_principal]").val();b.telephoneSecondaire=$(":input[name=telephone_secondaire]").val();b.adresse=$(":input[name=adresse]").val();b.codePostal=$(":input[name=code_postal]").val();b.ville=$(":input[name=ville]").val();b.dateNaissance=$(":input[name=date_naissance]").val().dateFrToDb();b.dateAdhesion=$(":input[name=date_adhesion]").val().dateFrToDb();b.commentaire=$(":input[name=commentaire]").val();$(":input[name=modules[]]:checked").each(function(){b.modules.push($(this).val())});var c=new AdherentValid();var d=c.validUpdate(b);if(d.valid){Infobulle.init();$.post("./index.php?m=GestionAdherents&v=ModificationAdherent","pParam="+$.toJSON(b),function(e){Infobulle.init();if(e.valid){var f=new GestionAdherentsTemplate();var g=f.modifierAdherentSucces;$("#contenu").replaceWith(g.template(e))}else{Infobulle.generer(e,"")}},"json")}else{Infobulle.generer(d,"")}};this.construct(a)};