function ParametrageTemplate(){this.listeBanque='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Banques<span class="com-btn-header-text ui-widget-content ui-corner-all" id="btn-nv-banque" title="Ajouter une banque"><span class="com-float-left ui-icon ui-icon-plusthick"></span>Ajouter</span></div><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom Court</th><th class="com-table-th-med com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th><th class="com-table-th-med com-underline-hover"></th><th class="com-table-th-fin com-underline-hover"></th></tr></thead><tbody><!-- BEGIN liste --><tr class="com-cursor-pointer" id="{liste.id}"><td class="compte-ligne com-table-td-debut com-underline-hover">{liste.nomCourt}</td><td class="compte-ligne com-table-td-med com-underline-hover">{liste.nom}</td><td class="com-table-td-med com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-edt-modifier" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-edt-supprimer" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END liste --></tbody></table></div></div>';this.listeBanqueVide='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-widget-content-transparent ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Banques<span class="com-btn-header-text ui-widget-content ui-corner-all" id="btn-nv-banque" title="Ajouter une banque"><span class="com-float-left ui-icon ui-icon-plusthick"></span>Ajouter</span></div><p id="texte-liste-vide">Aucune Banque dans la base.</p></div></div>';this.dialogAjoutBanque='<div id="dialog-form-banque" title="Banque"><form><table><tr><td>Nom</td><td><input type="hidden" name="id" id="banque-id" value="{id}"/><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom" id="banque-nom" value="{nom}"/></td></tr><tr><td>Nom Court</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nomCourt" id="banque-nomCourt" value="{nomCourt}"/></td></tr><tr><td>Description</td><td><textarea class="com-input-text ui-widget-content ui-corner-all" name="description" id="banque-description">{description}</textarea></td></tr></table></form></div>';this.dialogSupprimerBanque='<div id="dialog-banque" title="Banque"><p>Voulez-vous supprimer la banque : {nom}</p></div>';this.dialogDetailBanque='<div id="dialog-detail-banque" title="Détail de la banque"><div>Nom : {nom}</div><div>Nom Court : {nomCourt}</div><div>Description : {description}</div></div>'}function ListeBanqueVue(a){this.mParam={};this.mBanques=[];this.construct=function(b){$.history({vue:function(){ListeBanqueVue(b)}});var c=this;this.mParam=$.extend(this.mParam,b);this.mParam.fonction="liste";$.post("./index.php?m=Parametrage&v=Banque","pParam="+$.toJSON(this.mParam),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(c){var b=this;$.each(c.liste,function(){b.mBanques[this.id]=this});var d=new ParametrageTemplate();if(c.liste.length>0&&c.liste[0].id!=null){$("#contenu").replaceWith(b.affect($(d.listeBanque.template(c))))}else{$("#contenu").replaceWith(b.affect($(d.listeBanqueVide)))}};this.affect=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectDetail(b);b=this.affectDialogAjout(b);b=this.affectDialogModifier(b);b=this.affectDialogSupprimer(b);b=gCommunVue.comHoverBtn(b);return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[0,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectDetail=function(b){b.find(".compte-ligne").click(function(){var d=$(this).closest("tr").attr("id");var c={id:d,fonction:"detail"};$.post("./index.php?m=Parametrage&v=Banque","pParam="+$.toJSON(c),function(e){Infobulle.init();if(e){if(e.valid){var g=new ParametrageTemplate();var f=g.dialogDetailBanque;$(f.template(e.detail)).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,close:function(h,i){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(e,"")}}},"json")});return b};this.affectDialogAjout=function(b){var c=this;b.find("#btn-nv-banque").click(function(){var e=new ParametrageTemplate();var d=e.dialogAjoutBanque;$(d.template()).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{"Créer la banque":function(){var f=$(this).children("form").first();c.ajoutBanque(f)},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}}).submit(function(){c.ajoutBanque($(this));return false})});return b};this.ajoutBanque=function(c){var e=this;var b=new BanqueVO();b.nom=c.find(':input[name="nom"]').val();b.nomCourt=c.find(':input[name="nomCourt"]').val();b.description=c.find(':input[name="description"]').val();var d=new BanqueValid();var f=d.validAjout(b);if(f.valid){Infobulle.init();b.fonction="ajouter";$.post("./index.php?m=Parametrage&v=Banque","pParam="+$.toJSON(b),function(h){if(h){if(h.valid){Infobulle.init();$("#dialog-form-banque").dialog("close");var j=new TemplateVR();j.valid=false;j.log.valid=false;var g=new VRerreur();g.code=ERR_358_CODE;g.message=ERR_358_MSG;j.log.erreurs.push(g);var i={vr:j};e.construct(i)}else{Infobulle.generer(h,"banque-")}}},"json")}else{Infobulle.generer(f,"banque-")}};this.affectDialogModifier=function(b){var c=this;b.find(".btn-edt-modifier").click(function(){var g=new ParametrageTemplate();var f=g.dialogAjoutBanque;var e=$(this).closest("tr").attr("id");var d={id:e,fonction:"detail"};$.post("./index.php?m=Parametrage&v=Banque","pParam="+$.toJSON(d),function(h){Infobulle.init();if(h){if(h.valid){$(f.template(h.detail)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{"Modifier la banque":function(){var i=$(this).children("form").first();c.modifierBanque(i)},Annuler:function(){$(this).dialog("close")}},close:function(i,j){$(this).remove();Infobulle.init()}}).submit(function(){c.modifierBanque($(this));return false})}else{Infobulle.generer(h,"")}}},"json")});return b};this.modifierBanque=function(c){var e=this;var b=new BanqueVO();b.id=c.find(':input[name="id"]').val();b.nom=c.find(':input[name="nom"]').val();b.nomCourt=c.find(':input[name="nomCourt"]').val();b.description=c.find(':input[name="description"]').val();var d=new BanqueValid();var f=d.validUpdate(b);if(f.valid){Infobulle.init();b.fonction="modifier";$.post("./index.php?m=Parametrage&v=Banque","pParam="+$.toJSON(b),function(h){if(h){if(h.valid){Infobulle.init();$("#dialog-form-banque").dialog("close");var j=new TemplateVR();j.valid=false;j.log.valid=false;var g=new VRerreur();g.code=ERR_359_CODE;g.message=ERR_359_MSG;j.log.erreurs.push(g);var i={vr:j};e.construct(i)}else{Infobulle.generer(h,"banque-")}}},"json")}else{Infobulle.generer(f,"banque-")}};this.affectDialogSupprimer=function(b){var c=this;b.find(".btn-edt-supprimer").click(function(){var f=$(this).closest("tr").attr("id");var g=new ParametrageTemplate();var e=g.dialogSupprimerBanque;var d=c.mBanques[f];$(e.template(d)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{"Supprimer la banque":function(){c.supprimerBanque(f)},Annuler:function(){$(this).dialog("close")}},close:function(h,i){$(this).remove();Infobulle.init()}})});return b};this.supprimerBanque=function(b){var c=this;var d={fonction:"supprimer",id:b};$.post("./index.php?m=Parametrage&v=Banque","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();$("#dialog-banque").dialog("close");var h=new TemplateVR();h.valid=false;h.log.valid=false;var e=new VRerreur();e.code=ERR_360_CODE;e.message=ERR_360_MSG;h.log.erreurs.push(e);var g={vr:h};c.construct(g)}else{Infobulle.generer(f,"")}}},"json")};this.construct(a)};