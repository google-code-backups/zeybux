function GestionProducteurTemplate(){this.dialogAjoutProducteur='<div id="dialog-form-prdt" title="Producteur"><form><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Information du producteur</div><div class="com-widget-content"><table class="com-table-form"><tr><th class="com-table-form-th">Nom *</th><td class="com-table-form-td"><input type="hidden" name="id" id="prdt-id" value="{prdtId}"/><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom" maxlength="50" id="prdt-nom" value="{prdtNom}"/></td></tr><tr><th class="com-table-form-th">Prénom *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="prenom" maxlength="50" id="prdt-prenom" value="{prdtPrenom}"/></td></tr><tr><th class="com-table-form-th">Date de Naissance (jj/mm/aaaa)</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="date_naissance" maxlength="10" id="prdt-dateNaissance" value="{prdtDateNaissance}"/></td></tr><tr><th class="com-table-form-th">Commentaire</th><td class="com-table-form-td"><textarea class="com-input-text ui-widget-content ui-corner-all" name="commentaire" id="prdt-commentaire">{prdtCommentaire}</textarea></td></tr></table></div></div><div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Coordonnées du producteur</div><div class="com-widget-content"><table class="com-table-form"><tr><th class="com-table-form-th">Courriel Principal</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="courriel_principal" maxlength="100" id="prdt-courrielPrincipal" value="{prdtCourrielPrincipal}"/></td></tr><tr><th class="com-table-form-th">Courriel Secondaire</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" ype="text" name="courriel_secondaire" maxlength="100" id="prdt-courrielSecondaire" value="{prdtCourrielSecondaire}"/></td></tr><tr><th class="com-table-form-th">Téléphone Principal</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="telephone_principal" maxlength="20" id="prdt-telephonePrincipal" value="{prdtTelephonePrincipal}"/></td></tr><tr><th class="com-table-form-th">Téléphone Secondaire</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="telephone_secondaire" maxlength="20" id="prdt-telephoneSecondaire" value="{prdtTelephoneSecondaire}"/></td></tr><tr><th class="com-table-form-th">Adresse</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="adresse" maxlength="300" id="prdt-adresse" value="{prdtAdresse}"/></td></tr><tr><th class="com-table-form-th">Code Postal</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="code_postal" maxlength="10" id="prdt-codePostal" value="{prdtCodePostal}"/></td></tr><tr><th class="com-table-form-th">Ville</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="ville" maxlength="100" id="prdt-ville" value="{prdtVille}"/></td></tr></table></div></div></form></div>';this.listeProducteur='<div id="contenu-ferme"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Producteurs<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-prdt" title="Ajouter un producteur"><span class="ui-icon ui-icon-plusthick"></span></span></div><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-underline-hover liste-adh-th-num com-cursor-pointer"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th-med com-underline-hover liste-adh-th-nom com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th><th class="com-table-th-med com-underline-hover liste-adh-th-nom com-cursor-pointer"><span class="ui-icon span-icon"></span>Prénom</th><th class="com-table-th-med com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Courriel</th><th class="com-table-th-med com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Téléphone</th><th class="com-table-th-med com-underline-hover"></th><th class="com-table-th-fin com-underline-hover"></th></tr></thead><tbody><!-- BEGIN listeProducteur --><tr class="com-cursor-pointer"><td class="com-table-td-debut com-underline-hover compte-ligne" id-producteur="{listeProducteur.prdtId}"><span class="ui-helper-hidden">{listeProducteur.prdtIdTri}</span><span class="numero-producteur">{listeProducteur.prdtNumero}</span></td><td class="com-table-td-med com-underline-hover compte-ligne" id-producteur="{listeProducteur.prdtId}">{listeProducteur.prdtNom}</td><td class="com-table-td-med com-underline-hover compte-ligne" id-producteur="{listeProducteur.prdtId}">{listeProducteur.prdtPrenom}</td><td class="com-table-td-med com-underline-hover compte-ligne" id-producteur="{listeProducteur.prdtId}">{listeProducteur.prdtCourrielPrincipal}</td><td class="com-table-td-med com-underline-hover compte-ligne" id-producteur="{listeProducteur.prdtId}">{listeProducteur.prdtTelephonePrincipal}</td><td class="com-table-td-med com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier" title="Modifier" id-producteur="{listeProducteur.prdtId}"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supp" title="Supprimer" id-producteur="{listeProducteur.prdtId}"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END listeProducteur --></tbody></table></div></div>';this.listeProducteurVide='<div id="contenu-ferme"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Producteurs<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-prdt" title="Ajouter un producteur"><span class="ui-icon ui-icon-plusthick"></span></span></div><p id="texte-liste-vide">Aucun producteur dans cette ferme.</p></div></div>';this.dialogSuppressionProducteur='<div id="dialog-supp-prdt" title="Supprimer le producteur {prdtNumero}"><p class="ui-state-error ui-corner-all"><span class="ui-icon ui-icon-alert com-float-left"></span>ATTENTION : Voulez-vous réellement supprimer le producteur : {prdtNumero}</p></div>';this.dialogInfoCompteProducteur='<div id="dialog-info-prdt" title="Détail du producteur : {prdtNumero}"><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Informations</div><div class="com-widget-content"><div>{prdtNumero} : {prdtPrenom} {prdtNom}</div><div>Date de naissance : {prdtDateNaissance}</div><div>Commentaire : {prdtCommentaire}</div></div></div><div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Coordonnées</div><div class="com-widget-content"><div>Courriel 1 : {prdtCourrielPrincipal}</div><div>Courriel 2 : {prdtCourrielSecondaire}</div><div>Téléphone 1 : {prdtTelephonePrincipal}</div><div>Téléphone 2 : {prdtTelephoneSecondaire}</div><div>Adresse : {prdtAdresse}</div><div>{prdtCodePostal} {prdtVille}</div></div></div></div>';this.listeFerme='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Fermes<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-fer" title="Ajouter une ferme"><span class="ui-icon ui-icon-plusthick"></span></span></div><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right" name="filter" id="filter" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-underline-hover liste-adh-th-num com-cursor-pointer"><span class="ui-icon span-icon"></span>N°</th><th class="com-table-th-med com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Compte</th><th class="com-table-th-med com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th><th class="com-table-th-fin liste-adh-th-solde"></th></tr></thead><tbody><!-- BEGIN listeFerme --><tr class="com-cursor-pointer compte-ligne" id-ferme="{listeFerme.ferId}"><td class="com-table-td-debut com-underline-hover"><span class="ui-helper-hidden">{listeFerme.ferIdTri}</span>{listeFerme.ferNumero}</td><td class="com-table-td-med com-underline-hover">{listeFerme.cptLabel}</td><td class="com-table-td-med com-underline-hover">{listeFerme.ferNom}</td><td class="com-table-td-fin com-underline-hover liste-adh-td-solde"><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span></span></td></tr><!-- END listeFerme --></tbody></table></div></div></div>';this.listeFermeVide='<div id="contenu"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les Fermes<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-fer" title="Ajouter une ferme"><span class="ui-icon ui-icon-plusthick"></span></span></div><p id="texte-liste-vide">Aucune ferme dans la base.</p></div></div>';this.dialogAjoutFerme='<div id="dialog-form-fer" title="Ajouter une ferme"><form><table><tr><td>Nom *</td><td><textarea class="com-input-text ui-widget-content ui-corner-all" name="nom" id="fer-nom"></textarea></td></tr><tr><td>SIREN</td><td><input class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="siren" maxlength="9" id="fer-siren"/></td></tr><tr><td>Adresse</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="adresse" maxlength="300" id="fer-adresse"/></td></tr><tr><td>Code Postal</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="code_postal" maxlength="10" id="fer-codePostal"/></td></tr><tr><td>Ville</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="ville" maxlength="100" id="fer-ville"/></td></tr><tr><td>Date d\'adhésion (jj/mm/aaaa) *</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="date_adhesion" value="{dateAdhesion}" maxlength="10" id="fer-dateAdhesion"/></td></tr><tr><td>Description</td><td><textarea class="com-input-text ui-widget-content ui-corner-all" name="description" id="fer-description"></textarea></td></tr></table></form></div>';this.informationFerme='<div id="contenu"><div class="com-barre-menu-2"><button class="ui-state-default ui-corner-top com-button" id="btn-liste-ferme"><span class="com-float-left ui-icon ui-icon-arrowthick-1-w"></span>Liste des Fermes</button></div><div id="menu-nav-ferme"><span class="com-cursor-pointer ui-widget-header ui-corner-tl ui-state-active" id="btn-information">Informations</span><span class="com-cursor-pointer ui-widget-header com-btn-hover" id="btn-liste-producteur" >Producteurs</span><span class="com-cursor-pointer ui-widget-header ui-corner-tr com-btn-hover" id="btn-catalogue" >Catalogue</span></div><div id="contenu-ferme"><!-- BEGIN ferme --><div class="com-widget-window ui-widget ui-widget-content ui-corner-all "><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">{ferme.ferNumero} : <span id="nom">{ferme.ferNom}</span><span class="com-btn-header-multiples ui-widget-content ui-corner-all com-cursor-pointer edt-info-ferme" id="btn-supp" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span><span class="com-btn-header-multiples ui-widget-content ui-corner-all com-cursor-pointer edt-info-ferme" id="btn-edt" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden edt-info-ferme" id="btn-edt-annuler" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="com-cursor-pointer com-btn-header-multiples ui-widget-content ui-corner-all ui-helper-hidden edt-info-ferme" id="btn-edt-valider" title="Valider"><span class="ui-icon ui-icon-check"></span></span></div><div class="edt-info-ferme"><div>Compte : {ferme.cptLabel}</div><div>SIREN : <span id="siren">{ferme.ferSiren}</span></div><div>Adhésion : <span id="dateAdhesion">{ferme.ferDateAdhesion}</span></div><div>Adresse : <span id="adresse">{ferme.ferAdresse}</span></div><div><span id="codePostal">{ferme.ferCodePostal}</span> <span id="ville">{ferme.ferVille}</span></div><div>Description : <span id="description">{ferme.ferDescription}</span></div></div><div class="edt-info-ferme ui-helper-hidden"><form><table><tr><td>Nom *</td><td><textarea class="com-input-text ui-widget-content ui-corner-all" name="nom" id="fer-nom"></textarea></td></tr><tr><td>SIREN</td><td><input class="com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="siren" maxlength="9" id="fer-siren" /></td></tr><tr><td>Adresse</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="adresse" maxlength="300" id="fer-adresse"/></td></tr><tr><td>Code Postal</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="code_postal" maxlength="10" id="fer-codePostal"/></td></tr><tr><td>Ville</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="ville" maxlength="100" id="fer-ville"/></td></tr><tr><td>Date d\'adhésion (jj/mm/aaaa) *</td><td><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="date_adhesion" maxlength="10" id="fer-dateAdhesion"/></td></tr><tr><td>Description</td><td><textarea class="com-input-text ui-widget-content ui-corner-all" name="description" id="fer-description"></textarea></td></tr></table></form></div></div><!-- END ferme --><div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Liste des Opérations</span></div>	<div><div id="content-nav-liste-operation" class="ui-helper-clearfix ui-state-default ui-corner-all"><form>	<span id="icone-nav-liste-operation-w" class="prev ui-helper-hidden ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-w"></span></span>	<span id="page-compteur">Page : <span type="text" class="pagedisplay"></span></span>	<span id="icone-nav-liste-operation-e" class="next ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-e"></span></span>	<input type="hidden" class="pagesize" value="10"></form></div><table id="table-operation" class="com-table"><thead><tr class="ui-widget ui-widget-header" ><th class="com-table-th">Date</th><th class="com-table-th">Libellé</th><th class="com-table-th">Type de paiement</th><th class="com-table-th">Débit</th><th class="com-table-th">Crédit</th></tr></thead><tbody><!-- BEGIN operationPassee --><tr><td class="com-table-td td-date ">{operationPassee.opeDate}</td><td class="com-table-td td-libelle">{operationPassee.opeLibelle}</td><td class="com-table-td td-type-paiement">{operationPassee.tppType}</td><td class="com-table-td td-montant">{operationPassee.debit}</td><td class="com-table-td td-montant">{operationPassee.credit}</td></tr><!-- END operationPassee --></tbody></table></div></div>';"</div></div></div>";this.dialogSuppressionFerme='<div id="dialog-supp-ferme" title="Supprimer la ferme {ferNumero}"><p class="ui-state-error ui-corner-all"><span class="ui-icon ui-icon-alert com-float-left"></span>ATTENTION : Voulez-vous réellement supprimer la ferme : {ferNumero}</p></div>';this.catalogue='<div id="contenu-ferme"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all com-float-left" id="categorie-produit"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Les catégories de produit<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-cat" title="Ajouter une catégorie"><span class="ui-icon ui-icon-plusthick"></span></span></div><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form-cat"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right filter" name="filter-cat" id="filter-cat" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table"><thead><tr class="ui-widget ui-state-hover" id-cat="0"><th class="ligne-cat com-table-td-debut com-underline-hover com-cursor-pointer">Toutes les catégories</th><th class="com-table-td-med com-underline-hover"></th><th class="com-table-td-fin com-underline-hover"></th></tr></thead></table><div id="div-table-cat"><table class="com-table" id="table-cat"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th><th class="com-table-th-med com-underline-hover td-edt"></th><th class="com-table-th-fin com-underline-hover td-edt"></th></tr></thead><tbody><!-- BEGIN listeCategorie --><tr class="com-cursor-pointer " id-cat="{listeCategorie.cproId}"><td class="ligne-cat com-table-td-debut com-underline-hover">{listeCategorie.cproNom}</td><td class="com-table-td-med com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-cat" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-cat" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END listeCategorie --></tbody></table></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all com-float-left" id="catalogue-produit"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Le catalogue de produit<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-nv-pro" title="Ajouter un produit"><span class="ui-icon ui-icon-plusthick"></span></span></div><div id="liste-adh-recherche" class="recherche com-widget-header ui-widget ui-widget-header ui-corner-all"><form id="filter-form-pro"><div><span class="conteneur-icon com-float-left ui-widget-content ui-corner-left" title="Chercher"><span class="ui-icon ui-icon-search"></span></span><input class="com-input-text ui-widget-content ui-corner-right filter" name="filter-pro" id="filter-pro" value="" maxlength="30" size="15" type="text" /></div></form></div><table class="com-table" id="table-pro"><tbody><!-- BEGIN listeProduit --><tr class="ui-widget-header"><th class="com-table-th-debut">{listeProduit.nom}</th><th class="com-table-th-med"></th><th class="com-table-th-fin"></th></tr><!-- BEGIN listeProduit.produits --><tr class="com-cursor-pointer" id-pro="{listeProduit.produits.nproId}"><td class="com-table-td-debut com-underline-hover liste-produit-nom">{listeProduit.produits.nproNom}</td><td class="com-table-td-med com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-produit" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-produit" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END listeProduit.produits --><!-- END listeProduit --></tbody></table></div></div>';this.listeToutProduitCatalogue='<table class="com-table" id="table-pro"><tbody><!-- BEGIN listeProduit --><tr class="ui-widget-header"><th class="com-table-th-debut">{listeProduit.nom}</th><th class="com-table-th-med"></th><th class="com-table-th-fin"></th></tr><!-- BEGIN listeProduit.produits --><tr class="com-cursor-pointer" id-pro="{listeProduit.produits.nproId}"><td class="com-table-td-debut com-underline-hover liste-produit-nom">{listeProduit.produits.nproNom}</td><td class="com-table-td-med com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-produit" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-produit" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END listeProduit.produits --><!-- END listeProduit --></tbody></table>';this.listeProduitCatalogue='<!-- BEGIN listeProduit --><table class="com-table" id="table-pro"><thead><tr class="ui-widget-header"><th class="com-table-th-debut">{listeProduit.nom}</th><th class="com-table-th-med"></th><th class="com-table-th-fin"></th></tr></thead><tbody><!-- BEGIN listeProduit.produits --><tr class="com-cursor-pointer" id-pro="{listeProduit.produits.nproId}"><td class="com-table-td-debut com-underline-hover liste-produit-nom">{listeProduit.produits.nproNom}</td><td class="com-table-td-med com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-produit" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-produit" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END listeProduit.produits --></tbody></table><!-- END listeProduit -->';this.listeProduitCategorieCatalogueVide='<div id="table-pro"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><p id="texte-liste-vide">Aucun produit dans la catégorie : {cproNom}.</p></div></div>';this.listeProduitCatalogueVide='<div id="table-pro"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><p id="texte-liste-vide">Aucun produit pour cette Ferme.</p></div></div>';this.listeCategorieVide='<div id="table-cat"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><p id="texte-liste-vide">Aucune catégorie.</p></div></div>';this.listeCategorie='<div id="div-table-cat"><table class="com-table" id="table-cat"><thead><tr class="ui-widget ui-widget-header"><th class="com-table-th-debut com-underline-hover com-cursor-pointer"><span class="ui-icon span-icon"></span>Nom</th><th class="com-table-th-med com-underline-hover td-edt"></th><th class="com-table-th-fin com-underline-hover td-edt"></th></tr></thead><tbody><!-- BEGIN listeCategorie --><tr class="com-cursor-pointer " id-cat="{listeCategorie.cproId}"><td class="ligne-cat com-table-td-debut com-underline-hover">{listeCategorie.cproNom}</td><td class="com-table-td-med com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-cat" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span></td><td class="com-table-td-fin com-underline-hover td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-cat" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr><!-- END listeCategorie --></tbody></table></div>';this.dialogAjoutCategorie='<div id="dialog-form-cat" title="Catégorie"><form><table><tr><td>Nom</td><td><input type="hidden" name="id" id="cat-id" value="{cproId}"/><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom" id="cat-nom" value="{cproNom}"/></td></tr><tr><td>Description</td><td><textarea class="com-input-text ui-widget-content ui-corner-all" name="description" id="cat-description">{cproDescription}</textarea></td></tr></table></form></div>';this.dialogSupprimerCategorie='<div id="dialog-cat" title="Catégorie"><p>Voulez-vous supprimer la catégorie : {cproNom}</p></div>';this.dialogRefusSupprimerCategorie='<div id="dialog-cat" title="Catégorie"><p>Il existe {nbProduit} produits liés à cette catégorie. Vous devez les supprimer ou les changer de catégorie pour pouvoir supprimer la catégorie : {cproNom}</p></div>';this.dialogAjoutProduit='<div id="dialog-form-pro" title="Produit"><form><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Informations</div><div class="com-widget-content"><table class="com-table-form"><tr><th class="com-table-form-th">Nom *</th><td class="com-table-form-td"><input type="hidden" name="id" id="pro-id" value="{idNomProduit}"/><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="nom" maxlength="50" id="pro-nom" value="{nom}"/></td></tr>{form_reference}<tr><th class="com-table-form-th">Catégorie *</th><td class="com-table-form-td"><select name="categorie" id="pro-idCategorie"><option value="0" >== Choisir une catégorie ==</option><!-- BEGIN listeCategorie --><option value="{listeCategorie.cproId}" >{listeCategorie.cproNom}</option><!-- END listeCategorie --></select></td></tr><tr><th class="com-table-form-th">Description</th><td class="com-table-form-td"><textarea class="com-input-text ui-widget-content ui-corner-all" name="description" id="pro-description">{description}</textarea></td></tr></table></div></div><div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Producteurs</div><div class="com-widget-content" id="pro-producteur"><table class="com-table-form"><!-- BEGIN listeProducteur --><tr><td class="com-table-form-td"><input type="checkbox" value="{listeProducteur.prdtId}" name="producteur" id="pro-prdt-{listeProducteur.prdtId}"/></td><td class="com-table-form-td">{listeProducteur.prdtPrenom} {listeProducteur.prdtNom}</td></tr><!-- END listeProducteur --></table></div></div><div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Caractéristiques</div><div class="com-widget-content" id="pro-caracteristique"><table class="com-table-form"><!-- BEGIN listeCaracteristique --><tr><td class="com-table-form-td"><input type="checkbox" value="{listeCaracteristique.carId}" name="caracteristique" id="pro-car-{listeCaracteristique.carId}"/></td><td class="com-table-form-td">{listeCaracteristique.carNom}</td></tr><!-- END listeCaracteristique --></table></div></div><div><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Prix</div><div class="com-widget-content" id="pro-prix"><table class="com-table-form" id="table-pro-prix"><tr><td class="catalogue-entete-lot">Quantité</td><td class="catalogue-entete-lot">Unité</td><td>Prix</td><td></td><td></td></tr><tr class="btn-lot"><td><input class="catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-quantite" maxlength="13" id="pro-lot-quantite"/></td><td><input class="catalogue-input-lot com-input-text ui-widget-content ui-corner-all" type="text" name="lot-unite" maxlength="20" id="pro-lot-unite"/></td><td><input class="catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric" type="text" name="lot-prix" maxlength="13" id="pro-lot-prix"/> {sigleMonetaire}</td><td colspan="2"><button type="button" id="btn-ajout-lot" class="ui-state-default ui-corner-all com-button com-center">Ajouter</button></td></tr></table><table class="com-table" id="lot-liste"></table></div></div></form></div>';this.ajoutProduitReference='<tr><th class="com-table-form-th">Référence</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="reference-choix" value="0" checked="checked"/>Automatique</td></tr><tr><th class="com-table-form-th"></th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="radio" name="reference-choix" value="1"/><input disabled="disabled" class="com-input-text ui-widget-content ui-corner-all" type="text" name="reference" maxlength="50" id="pro-numero" value="{numero}"/></td></tr>';this.modifProduitReference='<tr><th class="com-table-form-th">Référence</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="text" name="reference" maxlength="50" id="pro-numero" value="{numero}"/></td></tr>';this.produitListeProducteurVide='<div class="com-widget-content" id="pro-producteur"><p class="com-center">Aucun producteur.</p></div>';this.listeCaracteristiqueVide='<div class="com-widget-content" id="pro-caracteristique"><p class="com-center">Aucune caractéristique.</p></div>';this.dialogRefusAjoutProduit='<div id="dialog-pro" title="Produit"><p>Il n\'existe aucune catégorie de produit. Pour créer un produit il faut au préalable créer une catégorie.</p></div>';this.modeleLot='<tr class="ligne-lot" id="ligne-lot-{id}"><td class="ui-helper-hidden"><span class="ui-helper-hidden lot-id" id="id-lot">{id}</span></td><td class="com-table-td-debut catalogue-ligne-lot-quantite"><span class="champ-lot-{id} lot-quantite" id="lot-{id}-quantite">{quantite}</span><input class="champ-lot-{id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-quantite" maxlength="13" id="pro-lot-{id}-quantite"/></td><td class="com-table-td-med catalogue-ligne-lot-unite"><span class="champ-lot-{id} lot-unite" id="lot-{id}-unite">{unite}</span><input class="champ-lot-{id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all ui-helper-hidden" type="text" name="lot-{id}-unite" maxlength="20" id="pro-lot-{id}-unite"/></td><td class="com-table-td-med">à <span class="champ-lot-{id} lot-prix" id="lot-{id}-prix">{prix}</span><input class="champ-lot-{id} catalogue-input-lot com-input-text ui-widget-content ui-corner-all com-numeric ui-helper-hidden" type="text" name="lot-{id}-prix" maxlength="13" id="pro-lot-{id}-prix"/> {sigleMonetaire}</td><td class="com-table-td-med td-edt"><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-modifier-lot" title="Modifier"><span class="ui-icon ui-icon-pencil"></span></span><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-valider-lot" id="btn-valider-lot-{id}" title="Valider"><span class="ui-icon ui-icon-check"></span></span></td><td class="com-table-td-fin td-edt"><span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all ui-helper-hidden btn-annuler-lot" id="btn-annuler-lot-{id}" title="Annuler"><span class="ui-icon ui-icon-closethick"></span></span><span class="btn-lot com-cursor-pointer com-btn-header ui-widget-content ui-corner-all btn-supprimer-lot" title="Supprimer"><span class="ui-icon ui-icon-trash"></span></span></td></tr>';this.dialogSupprimerProduit='<div id="dialog-pro" title="Produit"><p>Voulez-vous supprimer le produit : {nom}</p></div>';this.dialogInfoProduit='<div id="dialog-info-pro" title="Produit"><div id="information-detail-producteur"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Informations</div><div class="com-widget-content"><table class="com-table-form"><tr><th class="com-table-form-th">Nom : </th><td class="com-table-form-td">{nom}</td></tr><tr><th class="com-table-form-th">Référence : </th><td class="com-table-form-td">{numero}</td></tr><tr><th class="com-table-form-th">Catégorie : </th><td class="com-table-form-td">{cproNom}</td></tr><tr><th class="com-table-form-th">Description : </th><td class="com-table-form-td">{description}</td></tr></table></div></div><div id="pro-prdt"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Producteurs</div><table class="com-table-form"><!-- BEGIN producteurs --><tr><td class="com-table-form-td">{producteurs.prdtPrenom} {producteurs.prdtNom}</td></tr><!-- END producteurs --></table></div><div id="pro-car"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Caractéristiques</div><table class="com-table-form"><!-- BEGIN caracteristiques --><tr><td class="com-table-form-td">{caracteristiques.carNom}</td></tr><!-- END caracteristiques --></table></div><div id="pro-prix"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Prix</div><table class="com-table"><!-- BEGIN modelesLot --><tr class="btn-lot"><td class="com-table-td-debut catalogue-ligne-lot-quantite">{modelesLot.mLotQuantite}</td><td class="com-table-td-med catalogue-ligne-lot-unite">{modelesLot.mLotUnite}</td><td class="com-table-td-fin">à {modelesLot.mLotPrix} {sigleMonetaire}</td></tr><!-- END modelesLot --></table></div></div>'}function ListeProducteurVue(a){this.mIdFerme=null;this.construct=function(b){$.history({vue:function(){ListeProducteurVue(b)}});var c=this;b.fonction="afficher";this.mIdFerme=b.id;$.post("./index.php?m=GestionProducteur&v=ListeProducteur","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var c=this;var b=new GestionProducteurTemplate();if(d.listeProducteur.length>0&&d.listeProducteur[0].prdtId!=null){var e=b.listeProducteur;$.each(d.listeProducteur,function(){this.prdtIdTri=this.prdtNumero.replace("P","")});$("#contenu-ferme").replaceWith(c.affect($(e.template(d))))}else{$("#contenu-ferme").replaceWith(c.affect($(b.listeProducteurVide)))}this.affectMenu()};this.affect=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectLienCompte(b);b=this.affectDialogCreerProducteur(b);b=this.affectDialogModifierProducteur(b);b=this.affectDialogSuppProducteur(b);b=this.affectLienRetour(b);b=gCommunVue.comHoverBtn(b);return b};this.affectMenu=function(){$("#btn-information,#btn-catalogue").removeClass("ui-state-active");$("#btn-liste-producteur").addClass("ui-state-active")};this.affectLienRetour=function(b){b.find("#btn-liste-ferme").click(function(){ListeFermeVue()});return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[0,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectLienCompte=function(b){var c=this;b.find(".compte-ligne").click(function(){var e=$(this).attr("id-producteur");var d={id:e,fonction:"detailProducteur"};$.post("./index.php?m=GestionProducteur&v=ListeProducteur","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g){if(g.valid){var f=new GestionProducteurTemplate();var h=f.dialogInfoCompteProducteur;g.producteur.prdtDateNaissance=g.producteur.prdtDateNaissance.extractDbDate().dateDbToFr();$(h.template(g.producteur)).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,close:function(i,j){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(g,"")}}},"json")});return b};this.affectDialogCreerProducteur=function(b){var c=this;b.find("#btn-nv-prdt").click(function(){var d=new GestionProducteurTemplate();var e=d.dialogAjoutProducteur;$(e.template({})).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,buttons:{"Créer le producteur":function(){c.CreerProducteur($(this))},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}}).submit(function(){c.CreerProducteur($(this));return false}).find("#prdt-dateNaissance").datepicker({changeMonth:true,changeYear:true,maxDate:"c+1",yearRange:"1900:c"})});return b};this.CreerProducteur=function(c){var e=this;var b=new ProducteurVO();b.nom=$(":input[name=nom]").val();b.prenom=$(":input[name=prenom]").val();b.dateNaissance=$(":input[name=date_naissance]").val().dateFrToDb();b.commentaire=$(":input[name=commentaire]").val();b.courrielPrincipal=$(":input[name=courriel_principal]").val();b.courrielSecondaire=$(":input[name=courriel_secondaire]").val();b.telephonePrincipal=$(":input[name=telephone_principal]").val();b.telephoneSecondaire=$(":input[name=telephone_secondaire]").val();b.adresse=$(":input[name=adresse]").val();b.codePostal=$(":input[name=code_postal]").val();b.ville=$(":input[name=ville]").val();b.idFerme=this.mIdFerme;var d=new ProducteurValid();var f=d.validAjout(b);if(f.valid){Infobulle.init();b.fonction="ajouter";$.post("./index.php?m=GestionProducteur&v=ListeProducteur","pParam="+$.toJSON(b),function(h){if(h){if(h.valid){Infobulle.init();$("#dialog-form-prdt").dialog("close");var i=new TemplateVR();i.valid=false;i.log.valid=false;var g=new VRerreur();g.code=ERR_323_CODE;g.message=ERR_323_MSG;i.log.erreurs.push(g);e.construct({vr:i,id:e.mIdFerme})}else{Infobulle.generer(h,"prdt-")}}},"json")}else{Infobulle.generer(f,"prdt-")}};this.affectDialogModifierProducteur=function(b){var c=this;b.find(".btn-modifier").click(function(){var e=$(this).attr("id-producteur");var d={id:e,fonction:"detailProducteur"};$.post("./index.php?m=GestionProducteur&v=ListeProducteur","pParam="+$.toJSON(d),function(g){Infobulle.init();if(g){if(g.valid){var f=new GestionProducteurTemplate();var h=f.dialogAjoutProducteur;g.producteur.prdtDateNaissance=g.producteur.prdtDateNaissance.extractDbDate().dateDbToFr();$(h.template(g.producteur)).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,buttons:{"Modifier le producteur":function(){c.modifierProducteur($(this))},Annuler:function(){$(this).dialog("close")}},close:function(i,j){$(this).remove();Infobulle.init()}}).submit(function(){c.modifierProducteur($(this));return false}).find("#prdt-dateNaissance").datepicker({changeMonth:true,changeYear:true,maxDate:"c+1",yearRange:"1900:c"})}else{Infobulle.generer(g,"")}}},"json")});return b};this.modifierProducteur=function(c){var e=this;var b=new ProducteurVO();b.id=$(":input[name=id]").val();b.nom=$(":input[name=nom]").val();b.prenom=$(":input[name=prenom]").val();b.dateNaissance=$(":input[name=date_naissance]").val().dateFrToDb();b.commentaire=$(":input[name=commentaire]").val();b.courrielPrincipal=$(":input[name=courriel_principal]").val();b.courrielSecondaire=$(":input[name=courriel_secondaire]").val();b.telephonePrincipal=$(":input[name=telephone_principal]").val();b.telephoneSecondaire=$(":input[name=telephone_secondaire]").val();b.adresse=$(":input[name=adresse]").val();b.codePostal=$(":input[name=code_postal]").val();b.ville=$(":input[name=ville]").val();b.idFerme=this.mIdFerme;var d=new ProducteurValid();var f=d.validUpdate(b);if(f.valid){Infobulle.init();b.fonction="modifier";$.post("./index.php?m=GestionProducteur&v=ListeProducteur","pParam="+$.toJSON(b),function(h){if(h){if(h.valid){Infobulle.init();$("#dialog-form-prdt").dialog("close");var i=new TemplateVR();i.valid=false;i.log.valid=false;var g=new VRerreur();g.code=ERR_324_CODE;g.message=ERR_324_MSG;i.log.erreurs.push(g);e.construct({vr:i,id:e.mIdFerme})}else{Infobulle.generer(h,"prdt-")}}},"json")}else{Infobulle.generer(f,"prdt-")}};this.affectDialogSuppProducteur=function(b){var c=this;b.find(".btn-supp").click(function(){var d=new GestionProducteurTemplate();var f=$(this).attr("id-producteur");var e=$(this).closest("tr").find(".numero-producteur").text();$(d.dialogSuppressionProducteur.template({prdtNumero:e})).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var g={id:f,fonction:"supprimer"};var h=this;$.post("./index.php?m=GestionProducteur&v=ListeProducteur","pParam="+$.toJSON(g),function(j){Infobulle.init();if(j){if(j.valid){var k=new TemplateVR();k.valid=false;k.log.valid=false;var i=new VRerreur();i.code=ERR_325_CODE;i.message=ERR_325_MSG;k.log.erreurs.push(i);c.construct({vr:k,id:c.mIdFerme});$(h).dialog("close")}else{Infobulle.generer(j,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove()}})});return b};this.construct(a)}function ListeFermeVue(a){this.construct=function(b){$.history({vue:function(){ListeFermeVue(b)}});var c=this;var d={fonction:"afficher"};$.post("./index.php?m=GestionProducteur&v=ListeFerme","pParam="+$.toJSON(d),function(e){Infobulle.init();if(e){if(e.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(e)}else{Infobulle.generer(e,"")}}},"json")};this.afficher=function(d){var c=this;var b=new GestionProducteurTemplate();if(d.listeFerme.length>0&&d.listeFerme[0].ferId!=null){var e=b.listeFerme;$.each(d.listeFerme,function(){this.ferIdTri=this.ferNumero.replace("F","")});$("#contenu").replaceWith(c.affect($(e.template(d))))}else{$("#contenu").replaceWith(c.affect($(b.listeFermeVide)))}};this.affect=function(b){b=this.affectTri(b);b=this.affectRecherche(b);b=this.affectDialogCreerFerme(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);b=this.affectDetailFerme(b);return b};this.affectTri=function(b){b.find(".com-table").tablesorter({sortList:[[0,0]]});return b};this.affectRecherche=function(b){b.find("#filter").keyup(function(){$.uiTableFilter($(".com-table"),this.value)});b.find("#filter-form").submit(function(){return false});return b};this.affectDetailFerme=function(b){var c=this;b.find(".compte-ligne").click(function(){InformationFermeVue({id:$(this).attr("id-ferme")})});return b};this.affectDialogCreerFerme=function(b){var c=this;b.find("#btn-nv-fer").click(function(){var e=new GestionProducteurTemplate();var f=e.dialogAjoutFerme;var d={dateAdhesion:getDateAujourdhuiDb().dateDbToFr()};d=gCommunVue.comNumeric($(f.template(d)));d.dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,buttons:{"Créer la ferme":function(){c.CreerFerme($(this))},Annuler:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}}).submit(function(){c.CreerFerme($(this));return false}).find("#fer-dateAdhesion").datepicker({changeMonth:true,changeYear:true,maxDate:"c+1",yearRange:"2009:c"})});return b};this.CreerFerme=function(c){var e=this;var b=new FermeVO();b.nom=c.find(":input[name=nom]").val();b.siren=c.find(":input[name=siren]").val();b.adresse=c.find(":input[name=adresse]").val();b.ville=c.find(":input[name=ville]").val();b.codePostal=c.find(":input[name=code_postal]").val();b.dateAdhesion=c.find(":input[name=date_adhesion]").val().dateFrToDb();b.description=c.find(":input[name=description]").val();var d=new FermeValid();var f=d.validAjout(b);if(f.valid){Infobulle.init();b.fonction="ajouter";$.post("./index.php?m=GestionProducteur&v=ListeFerme","pParam="+$.toJSON(b),function(h){if(h){if(h.valid){Infobulle.init();$("#dialog-form-fer").dialog("close");var i=new TemplateVR();i.valid=false;i.log.valid=false;var g=new VRerreur();g.code=ERR_320_CODE;g.message=ERR_320_MSG;i.log.erreurs.push(g);InformationFermeVue({vr:i,id:h.id})}else{Infobulle.generer(h,"fer-")}}},"json")}else{Infobulle.generer(f,"fer-")}};this.construct(a)}function InformationFermeVue(a){this.mFerme={};this.construct=function(b){$.history({vue:function(){InformationFermeVue(b)}});var c=this;b.fonction="afficher";$.post("./index.php?m=GestionProducteur&v=InformationFerme","pParam="+$.toJSON(b),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(d){var c=this;if(d.ferme[0].ferSiren==0){d.ferme[0].ferSiren=""}d.ferme[0].ferDateAdhesion=d.ferme[0].ferDateAdhesion.extractDbDate().dateDbToFr();this.mFerme=d.ferme[0];$(d.operationPassee).each(function(){this.opeDate=this.opeDate.extractDbDate().dateDbToFr();if(this.tppType==null){this.tppType=""}if(this.opeMontant<0){this.credit=(this.opeMontant*-1).nombreFormate(2,","," ")+" "+gSigleMonetaire;this.debit=""}else{this.credit="";this.debit=this.opeMontant.nombreFormate(2,","," ")+" "+gSigleMonetaire}});var b=new GestionProducteurTemplate();var e=new CommunTemplate();lHtml=$(b.informationFerme.template(d));if(d.operationPassee.length<11){lHtml=this.masquerPagination(lHtml)}else{lHtml=this.paginnation(lHtml)}if($("#contenu-ferme").length>0){$("#contenu-ferme").replaceWith(c.affectFerme(lHtml.find("#contenu-ferme")));this.affectMenuFerme()}else{$("#contenu").replaceWith(c.affect(lHtml))}};this.affect=function(b){b=this.affectHover(b);b=this.affectDialogSuppFerme(b);b=this.affectLienRetour(b);b=this.affectEditionFerme(b);b=this.affectDate(b);b=this.affectMenu(b);b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);return b};this.affectFerme=function(b){b=this.affectHover(b);b=this.affectDialogSuppFerme(b);b=this.affectEditionFerme(b);b=this.affectDate(b);b=gCommunVue.comHoverBtn(b);return b};this.paginnation=function(b){b.find("#table-operation").tablesorter({headers:{0:{sorter:false},1:{sorter:false},2:{sorter:false},3:{sorter:false},4:{sorter:false}}}).tablesorterPager({container:b.find("#content-nav-liste-operation"),positionFixed:false});return b};this.masquerPagination=function(b){b.find("#content-nav-liste-operation").hide();return b};this.affectHover=function(b){b.find("#icone-nav-liste-operation-w,#icone-nav-liste-operation-e").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});return b};this.affectLienRetour=function(b){b.find("#btn-liste-ferme").click(function(){ListeFermeVue()});return b};this.affectDate=function(b){b.find("#fer-dateAdhesion").datepicker({changeMonth:true,changeYear:true,maxDate:"c+1"});return b};this.affectMenu=function(b){var c=this;b.find("#btn-information").click(function(){InformationFermeVue({id:c.mFerme.ferId})});b.find("#btn-liste-producteur").click(function(){ListeProducteurVue({id:c.mFerme.ferId})});b.find("#btn-catalogue").click(function(){CatalogueFermeVue({id:c.mFerme.ferId})});b.find("#btn-liste-producteur,#btn-catalogue").removeClass("ui-state-active");b.find("#btn-information").addClass("ui-state-active");return b};this.affectMenuFerme=function(){$("#btn-liste-producteur,#btn-catalogue").removeClass("ui-state-active");$("#btn-information").addClass("ui-state-active")};this.affectEditionFerme=function(b){var c=this;b.find("#btn-edt").click(function(){$(":input[name=nom]").html(c.mFerme.ferNom);$(":input[name=siren]").val(htmlDecode(c.mFerme.ferSiren));$(":input[name=adresse]").val(htmlDecode(c.mFerme.ferAdresse));$(":input[name=ville]").val(htmlDecode(c.mFerme.ferVille));$(":input[name=code_postal]").val(htmlDecode(c.mFerme.ferCodePostal));$(":input[name=date_adhesion]").val(htmlDecode(c.mFerme.ferDateAdhesion));$(":input[name=description]").html(c.mFerme.ferDescription);$(".edt-info-ferme").toggle()});b.find("#btn-edt-annuler").click(function(){$(".edt-info-ferme").toggle()});b.find("#btn-edt-valider").click(function(){c.modifInformation()});return b};this.modifInformation=function(){var d=this;var b=new FermeVO();b.id=this.mFerme.ferId;b.nom=$(":input[name=nom]").val();b.siren=$(":input[name=siren]").val();b.adresse=$(":input[name=adresse]").val();b.ville=$(":input[name=ville]").val();b.codePostal=$(":input[name=code_postal]").val();b.dateAdhesion=$(":input[name=date_adhesion]").val().dateFrToDb();b.description=$(":input[name=description]").val();var c=new FermeValid();var e=c.validUpdate(b);if(e.valid){b.fonction="modifier";Infobulle.init();$.post("./index.php?m=GestionProducteur&v=InformationFerme","pParam="+$.toJSON(b),function(g){Infobulle.init();if(g){if(g.valid){d.mFerme.ferNom=b.nom;d.mFerme.ferSiren=b.siren;d.mFerme.ferAdresse=b.adresse;d.mFerme.ferVille=b.ville;d.mFerme.ferCodePostal=b.codePostal;d.mFerme.ferDateAdhesion=b.dateAdhesion.dateDbToFr();d.mFerme.ferDescription=b.description;var h=new TemplateVR();h.valid=false;h.log.valid=false;var f=new VRerreur();f.code=ERR_321_CODE;f.message=ERR_321_MSG;h.log.erreurs.push(f);Infobulle.generer(h,"");$("#nom").html(d.mFerme.ferNom);$("#siren").html(d.mFerme.ferSiren);$("#adresse").html(d.mFerme.ferAdresse);$("#ville").html(d.mFerme.ferVille);$("#codePostal").html(d.mFerme.ferCodePostal);$("#dateAdhesion").html(d.mFerme.ferDateAdhesion);$("#description").html(d.mFerme.ferDescription);$(".edt-info-ferme").toggle()}else{Infobulle.generer(g,"fer-")}}},"json")}else{Infobulle.generer(e,"fer-")}};this.affectDialogSuppFerme=function(b){var c=this;b.find("#btn-supp").click(function(){var d=new GestionProducteurTemplate();$(d.dialogSuppressionFerme.template({ferNumero:c.mFerme.ferNumero})).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){var e={id:c.mFerme.ferId,fonction:"supprimer"};var f=this;$.post("./index.php?m=GestionProducteur&v=InformationFerme","pParam="+$.toJSON(e),function(h){Infobulle.init();if(h){if(h.valid){var i=new TemplateVR();i.valid=false;i.log.valid=false;var g=new VRerreur();g.code=ERR_322_CODE;g.message=ERR_322_MSG;i.log.erreurs.push(g);ListeFermeVue({vr:i});$(f).dialog("close")}else{Infobulle.generer(h,"")}}},"json")},Annuler:function(){$(this).dialog("close")}},close:function(e,f){$(this).remove()}})});return b};this.construct(a)}function CatalogueFermeVue(a){this.mParam={};this.mCategories=[];this.mProduits=[];this.mFiltreIdCategorie=0;this.nbProduit=0;this.nbCategorie=0;this.mListeCategorie={};this.mListeProduit=[];this.mInfoFormulaireProduit=null;this.mIdLot=0;this.mIdFerme=0;this.construct=function(b){$.history({vue:function(){CatalogueFermeVue(b)}});var c=this;this.mParam=$.extend(this.mParam,b);this.mParam.fonction="afficher";$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(this.mParam),function(d){Infobulle.init();if(d){if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mCategories=[];c.mProduits=[];c.mFiltreIdCategorie=0;c.nbProduit=0;c.nbCategorie=0;c.mListeCategorie={};c.mListeProduit=[];c.mInfoFormulaireProduit=null;c.mIdLot=0;c.mIdFerme=b.id;c.afficher(d)}else{Infobulle.generer(d,"")}}},"json")};this.afficher=function(e){var d=this;this.mListeCategorie=e.listeCategorie;$.each(e.listeProduit,function(){if(d.mProduits[this.cproId]){d.mProduits[this.cproId].produits.push(this)}else{d.mProduits[this.cproId]={nom:this.cproNom,produits:[this]}}if(d.mListeProduit[this.cproNom]){d.mListeProduit[this.cproNom].produits.push(this)}else{d.mListeProduit[this.cproNom]={nom:this.cproNom,produits:[this]}}});var f=true;if(e.listeProduit.length>0&&e.listeProduit[0].nproId!=null){e.listeProduit=d.mListeProduit;f=false}$.each(e.listeCategorie,function(){d.mCategories[this.cproId]=this});var c=new GestionProducteurTemplate();var b=$(c.catalogue.template(e));if(f){b.find("#table-pro").replaceWith(c.listeProduitCatalogueVide);this.nbProduit=0}else{this.nbProduit=1}if(e.listeCategorie.length>0&&e.listeCategorie[0].cproId==null){b.find("#table-cat").replaceWith(c.listeCategorieVide);this.nbCategorie=0}else{this.nbCategorie=1}b=this.affectCategorie(b);$("#contenu-ferme").replaceWith(d.affect(b));this.affectMenu()};this.affect=function(b){b=this.affectRecherche(b);b=affectProduit(b);b=gCommunVue.comHoverBtn(b);return b};this.affectProduit=function(b){b=this.affectDialogCreerProduit(b);b=this.affectModifierProduit(b);b=this.affectDialogSupprimerProduit(b);b=this.affectDetailProduit(b);return b};this.affectCategorie=function(b){if(this.nbProduit>0){b=this.affectFlitreCategorie(b)}b=this.affectTri(b);b=this.affectRechercheCategorie(b);b=this.affectDialogCreerCategorie(b);b=this.affectDialogModifierCategorie(b);b=this.affectDialogSupprimerCategorie(b);return b};this.affectMenu=function(){$("#btn-information,#btn-liste-producteur").removeClass("ui-state-active");$("#btn-catalogue").addClass("ui-state-active")};this.affectTri=function(b){b.find("#table-cat").tablesorter({sortList:[[0,0]]});return b};this.affectRecherche=function(b){b.find("#filter-pro").keyup(function(){$.uiTableFilter($("#table-pro"),this.value)});b.find("#filter-form-pro").submit(function(){return false});return b};this.affectRechercheCategorie=function(b){b.find("#filter-cat").keyup(function(){$.uiTableFilter($("#table-cat"),this.value)});b.find("#filter-form-cat").submit(function(){return false});return b};this.affectFlitreCategorie=function(b){var c=this;b.find(".ligne-cat").click(function(){var d=$(this).closest("tr").attr("id-cat");c.FiltreCategorie(d)});return b};this.FiltreCategorie=function(b){if(this.nbProduit>0){if(this.mProduits[b]){var c={listeProduit:[]};c.listeProduit.push(this.mProduits[b]);var d=new GestionProducteurTemplate();$("#table-pro").replaceWith(this.affect($(d.listeProduitCatalogue.template(c))))}else{if(b==0){var c={listeProduit:this.mListeProduit};var d=new GestionProducteurTemplate();$("#table-pro").replaceWith(this.affect($(d.listeToutProduitCatalogue.template(c))))}else{var d=new GestionProducteurTemplate();var c=this.mCategories[b];$("#table-pro").replaceWith(d.listeProduitCategorieCatalogueVide.template(c))}}$(".ligne-cat").closest("tr").removeClass("ui-state-hover");$("[id-cat="+b+"]").closest("tr").addClass("ui-state-hover");this.mFiltreIdCategorie=b}};this.refreshCategorie=function(b){var c=this;b.fonction="listeCategorie";$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(b),function(f){Infobulle.init();if(f){if(f.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mListeCategorie=f.listeCategorie;c.mCategories=[];var e=false;$.each(f.listeCategorie,function(){c.mCategories[this.cproId]=this;if(this.cproId==c.mFiltreIdCategorie){e=true}});var d=new GestionProducteurTemplate();if(f.listeCategorie.length>0&&f.listeCategorie[0].cproId==null){$("#table-cat").replaceWith(d.listeCategorieVide);c.nbCategorie=0}else{$("#div-table-cat").replaceWith(c.affectCategorie($(d.listeCategorie.template(f))));c.nbCategorie=1}if(c.nbProduit>0){if(e){c.FiltreCategorie(c.mFiltreIdCategorie)}else{c.FiltreCategorie(0)}}}else{Infobulle.generer(f,"")}}},"json")};this.refreshProduit=function(b){var c=this;b.fonction="listeProduit";b.id=this.mParam.id;$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(b),function(e){Infobulle.init();if(e){if(e.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.mProduits=[];c.mListeProduit=[];$.each(e.listeProduit,function(){if(c.mProduits[this.cproId]){c.mProduits[this.cproId].produits.push(this)}else{c.mProduits[this.cproId]={nom:this.cproNom,produits:[this]}}if(c.mListeProduit[this.cproNom]){c.mListeProduit[this.cproNom].produits.push(this)}else{c.mListeProduit[this.cproNom]={nom:this.cproNom,produits:[this]}}});var d=new GestionProducteurTemplate();if(e.listeProduit.length>0&&e.listeProduit[0].nproId!=null){e.listeProduit=c.mProduits;c.nbProduit=1;c.FiltreCategorie(c.mFiltreIdCategorie)}else{$("#table-pro").replaceWith(d.listeProduitCatalogueVide);c.nbProduit=0}}else{Infobulle.generer(e,"")}}},"json")};this.affectDialogCreerCategorie=function(b){var c=this;b.find("#btn-nv-cat").click(function(){var d=new GestionProducteurTemplate();var e=d.dialogAjoutCategorie;$(e.template()).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{"Créer la categorie":function(){var f=$(this).children("form").first();c.CreerCategorie(f)},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}}).submit(function(){c.CreerCategorie($(this));return false})});return b};this.CreerCategorie=function(c){var e=this;var b=new CategorieProduitVO();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();var d=new CategorieProduitValid();var g=d.validAjout(b);if(g.valid){Infobulle.init();var f={fonction:"ajouterCategorie",categorieProduit:b};$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(f),function(i){if(i){if(i.valid){Infobulle.init();$("#dialog-form-cat").dialog("close");var k=new TemplateVR();k.valid=false;k.log.valid=false;var h=new VRerreur();h.code=ERR_317_CODE;h.message=ERR_317_MSG;k.log.erreurs.push(h);var j={vr:k};e.refreshCategorie(j)}else{Infobulle.generer(i,"cat-")}}},"json")}else{Infobulle.generer(g,"cat-")}};this.affectDialogModifierCategorie=function(b){var c=this;b.find(".btn-modifier-cat").click(function(){var d=new GestionProducteurTemplate();var g=d.dialogAjoutCategorie;var f=$(this).closest("tr").attr("id-cat");var e={id:f,fonction:"detailCategorie"};$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(e),function(h){Infobulle.init();if(h){if(h.valid){$(g.template(h.categorie)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,buttons:{"Modifier la categorie":function(){var i=$(this).children("form").first();c.ModifierCategorie(i)},Annuler:function(){$(this).dialog("close")}},close:function(i,j){$(this).remove();Infobulle.init()}}).submit(function(){c.ModifierCategorie($(this));return false})}else{Infobulle.generer(h,"")}}},"json")});return b};this.ModifierCategorie=function(c){var e=this;var b=new CategorieProduitVO();b.id=c.find(":input[name=id]").val();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();var d=new CategorieProduitValid();var g=d.validUpdate(b);if(g.valid){Infobulle.init();var f={fonction:"modifierCategorie",categorieProduit:b};$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(f),function(i){if(i){if(i.valid){Infobulle.init();$("#dialog-form-cat").dialog("close");var j=new TemplateVR();j.valid=false;j.log.valid=false;var h=new VRerreur();h.code=ERR_318_CODE;h.message=ERR_318_MSG;j.log.erreurs.push(h);e.construct({id:e.mIdFerme,vr:j})}else{Infobulle.generer(i,"cat-")}}},"json")}else{Infobulle.generer(g,"cat-")}};this.affectDialogSupprimerCategorie=function(b){var c=this;b.find(".btn-supprimer-cat").click(function(){var e=$(this).closest("tr").attr("id-cat");var d={fonction:"autorisationSupprimerCategorie",id:e};$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();if(f.autorisation){c.dialogSupprimerCategorie(e)}else{f.id=e;c.refusSupprimerCategorie(f)}}else{Infobulle.generer(f,"")}}},"json")});return b};this.dialogSupprimerCategorie=function(c){var e=this;var d=new GestionProducteurTemplate();var f=d.dialogSupprimerCategorie;var b=this.mCategories[c];$(f.template(b)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{"Supprimer la categorie":function(){e.supprimerCategorie(c)},Annuler:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})};this.supprimerCategorie=function(b){var c=this;var d={fonction:"supprimerCategorie",id:b};$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();$("#dialog-cat").dialog("close");var h=new TemplateVR();h.valid=false;h.log.valid=false;var e=new VRerreur();e.code=ERR_319_CODE;e.message=ERR_319_MSG;h.log.erreurs.push(e);var g={vr:h};c.refreshCategorie(g)}else{Infobulle.generer(f,"")}}},"json")};this.refusSupprimerCategorie=function(c){var e=this;var d=new GestionProducteurTemplate();var f=d.dialogRefusSupprimerCategorie;var b=this.mCategories[c.id];b.nbProduit=c.nbProduit;$(f.template(b)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{"Exporter la liste des produits":function(){var g={fonction:"exportProduitCategorie",id:c.id};$.download("./index.php?m=GestionProducteur&v=CatalogueFerme",g)},Fermer:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove();Infobulle.init()}})};this.affectDialogCreerProduit=function(b){var c=this;b.find("#btn-nv-pro").click(function(){if(c.nbCategorie==0){c.dialogProduitRefusCreation()}else{if(c.mInfoFormulaireProduit==null){lParam={fonction:"infoFomulaireProduit",id:c.mParam.id};$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(lParam),function(d){if(d){if(d.valid){c.mInfoFormulaireProduit={listeProducteur:d.listeProducteur,listeCaracteristique:d.listeCaracteristique,sigleMonetaire:gSigleMonetaire};c.dialogProduit()}else{Infobulle.generer(d,"pro-")}}},"json")}else{c.dialogProduit()}}});return b};this.dialogProduit=function(){var d=this;if(this.mInfoFormulaireProduit!=null){var c=new GestionProducteurTemplate();var e=c.dialogAjoutProduit;this.mInfoFormulaireProduit.listeCategorie=this.mListeCategorie;this.mInfoFormulaireProduit.form_reference=c.ajoutProduitReference;var b=$(e.template(this.mInfoFormulaireProduit));if(this.mInfoFormulaireProduit.listeProducteur.length>0&&this.mInfoFormulaireProduit.listeProducteur[0].prdtId==null){b.find("#pro-producteur").replaceWith(c.produitListeProducteurVide)}if(this.mInfoFormulaireProduit.listeCaracteristique.length>0&&this.mInfoFormulaireProduit.listeCaracteristique[0].carId==null){b.find("#pro-caracteristique").replaceWith(c.listeCaracteristiqueVide)}b=this.affectFormProduit(b);$(b).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,buttons:{"Créer":function(){var f=$(this).children("form").first();d.CreerProduit(f)},Annuler:function(){$(this).dialog("close")}},close:function(f,g){$(this).remove();Infobulle.init()}}).submit(function(){d.CreerProduit($(this));return false})}};this.affectFormProduit=function(b){b=this.affectAjoutLot(b);b=this.affectReference(b);b=gCommunVue.comNumeric(b);b=gCommunVue.comHoverBtn(b);return b};this.affectReference=function(b){b.find(":input[name=reference-choix]").change(function(){if($(":input[name=reference-choix]:checked").val()==1){$(":input[name=reference]").attr("disabled","").val("")}else{$(":input[name=reference]").attr("disabled","disabled").val("")}});return b};this.affectAjoutLot=function(b){var c=this;b.find("#btn-ajout-lot").click(function(){c.ajoutLot()});b.find("#table-pro-prix input").keyup(function(d){if(d.keyCode=="13"){c.ajoutLot()}});return b};this.ajoutLot=function(){var b=new ModeleLotVO();b.quantite=$(":input[name=lot-quantite]").val().numberFrToDb();b.unite=$(":input[name=lot-unite]").val();b.prix=$(":input[name=lot-prix]").val().numberFrToDb();var c=new ModeleLotValid();var f=c.validAjout(b);if(f.valid){Infobulle.init();var d=new GestionProducteurTemplate();var e=d.modeleLot;this.mIdLot--;b.id=this.mIdLot;b.sigleMonetaire=gSigleMonetaire;b.quantite=b.quantite.nombreFormate(2,","," ");b.prix=b.prix.nombreFormate(2,","," ");$("#lot-liste").append(this.affectLot($(e.template(b))));$(":input[name=lot-quantite], :input[name=lot-unite], :input[name=lot-prix]").val("")}else{Infobulle.generer(f,"pro-lot-")}};this.affectLot=function(b){b=gCommunVue.comHoverBtn(b);b=gCommunVue.comNumeric(b);b=this.affectAjoutLotGestion(b);return b};this.affectAjoutLotGestion=function(b){var c=this;b.find(".btn-modifier-lot").click(function(){c.ajoutLotModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-valider-lot").click(function(){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())});b.find(".catalogue-input-lot").keyup(function(d){if(d.keyCode=="13"){c.ajoutLotValiderModification($(this).closest("tr").find("#id-lot").text())}});b.find(".btn-annuler-lot").click(function(){c.ajoutLotAnnulerModification($(this).closest("tr").find("#id-lot").text())});b.find(".btn-supprimer-lot").click(function(){c.ajoutLotSupprimer($(this).closest("tr").find("#id-lot").text())});return b};this.ajoutLotSupprimer=function(b){$("#ligne-lot-"+b).remove()};this.ajoutLotModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle();$("#pro-lot-"+b+"-quantite").val($("#lot-"+b+"-quantite").text());$("#pro-lot-"+b+"-unite").val($("#lot-"+b+"-unite").text());$("#pro-lot-"+b+"-prix").val($("#lot-"+b+"-prix").text())};this.ajoutLotValiderModification=function(c){var b=new ModeleLotVO();b.quantite=$("#pro-lot-"+c+"-quantite").val().numberFrToDb();b.unite=$("#pro-lot-"+c+"-unite").val();b.prix=$("#pro-lot-"+c+"-prix").val().numberFrToDb();var d=new ModeleLotValid();var e=d.validAjout(b);if(e.valid){Infobulle.init();$("#lot-"+c+"-quantite").text(b.quantite.nombreFormate(2,","," "));$("#lot-"+c+"-unite").text(b.unite);$("#lot-"+c+"-prix").text(b.prix.nombreFormate(2,","," "));$(".btn-lot, #btn-annuler-lot-"+c+", #btn-valider-lot-"+c+", .champ-lot-"+c).toggle()}else{Infobulle.generer(e,"pro-lot-"+c+"-")}};this.ajoutLotAnnulerModification=function(b){$(".btn-lot, #btn-annuler-lot-"+b+", #btn-valider-lot-"+b+", .champ-lot-"+b).toggle()};this.dialogProduitRefusCreation=function(){var b=new GestionProducteurTemplate();var c=b.dialogRefusAjoutProduit;$(c).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:400,close:function(d,e){$(this).remove();Infobulle.init()}})};this.CreerProduit=function(c){var e=this;var b=new NomProduitCatalogueVO();b.numero=c.find(":input[name=reference]").val();b.idCategorie=c.find(":input[name=categorie]").val();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();c.find(":input[name=producteur]:checked").each(function(){b.producteurs.push($(this).val())});c.find(":input[name=caracteristique]:checked").each(function(){b.caracteristiques.push($(this).val())});c.find(".ligne-lot").each(function(){var g=new ModeleLotVO();g.quantite=$(this).find(".lot-quantite").text().numberFrToDb();g.unite=$(this).find(".lot-unite").text();g.prix=$(this).find(".lot-prix").text().numberFrToDb();b.modelesLot.push(g)});var d=new NomProduitCatalogueValid();var f=d.validAjout(b);if(f.valid){Infobulle.init();b.fonction="ajouterProduit";b.id=this.mParam.id;$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(b),function(h){if(h){if(h.valid){Infobulle.init();$("#dialog-form-pro").dialog("close");var j=new TemplateVR();j.valid=false;j.log.valid=false;var g=new VRerreur();g.code=ERR_329_CODE;g.message=ERR_329_MSG;j.log.erreurs.push(g);var i={vr:j};e.refreshProduit(i)}else{Infobulle.generer(h,"pro-")}}},"json")}else{Infobulle.generer(f,"pro-")}};this.affectDialogSupprimerProduit=function(b){var c=this;b.find(".btn-supprimer-produit").click(function(){var g=$(this).closest("tr").attr("id-pro");var d={nom:$(this).closest("tr").find(".liste-produit-nom").text()};var e=new GestionProducteurTemplate();var f=e.dialogSupprimerProduit;$(f.template(d)).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Supprimer:function(){c.supprimerProduit(g)},Annuler:function(){$(this).dialog("close")}},close:function(h,i){$(this).remove();Infobulle.init()}})});return b};this.supprimerProduit=function(b){var c=this;var d={fonction:"supprimerProduit",idNomProduit:b};$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(d),function(f){if(f){if(f.valid){Infobulle.init();$("#dialog-pro").dialog("close");var g=new TemplateVR();g.valid=false;g.log.valid=false;var e=new VRerreur();e.code=ERR_331_CODE;e.message=ERR_331_MSG;g.log.erreurs.push(e);c.refreshProduit({vr:g})}else{Infobulle.generer(f,"")}}},"json")};this.affectDetailProduit=function(b){var c=this;b.find(".liste-produit-nom").click(function(){var e=$(this).closest("tr").attr("id-pro");var d={idNomProduit:e,fonction:"detailProduit"};$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(d),function(h){Infobulle.init();if(h){if(h.valid){var g=new GestionProducteurTemplate();var i=g.dialogInfoProduit;$(h.produit.modelesLot).each(function(){if(this.mLotId!=null){this.mLotQuantite=this.mLotQuantite.nombreFormate(2,","," ");this.mLotPrix=this.mLotPrix.nombreFormate(2,","," ")}});h.produit.sigleMonetaire=gSigleMonetaire;var f=$(i.template(h.produit));if(h.produit.producteurs.length>0&&h.produit.producteurs[0].nPrdtIdNomProduit==null){f.find("#pro-prdt").remove()}if(h.produit.caracteristiques.length>0&&h.produit.caracteristiques[0].carProIdNomProduit==null){f.find("#pro-car").remove()}if(h.produit.modelesLot.length>0&&h.produit.modelesLot[0].mLotId==null){f.find("#pro-prix").remove()}$(f).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,close:function(j,k){$(this).remove();Infobulle.init()}})}else{Infobulle.generer(h,"")}}},"json")});return b};this.affectModifierProduit=function(b){var c=this;b.find(".btn-modifier-produit").click(function(){var d=$(this).closest("tr").attr("id-pro");c.dialogModifierProduit(d)});return b};this.dialogModifierProduit=function(b){var c=this;var d={idNomProduit:b,fonction:"infoFomulaireModifierProduit"};$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(d),function(h){Infobulle.init();if(h){if(h.valid){var f={listeProducteur:h.listeProducteur,listeCaracteristique:h.listeCaracteristique,sigleMonetaire:gSigleMonetaire,idNomProduit:h.produit.idNomProduit,nom:h.produit.nom,numero:h.produit.numero,description:h.produit.description};var g=new GestionProducteurTemplate();var i=g.dialogAjoutProduit;f.listeCategorie=c.mListeCategorie;f.form_reference=g.modifProduitReference.template(f);var e=$(i.template(f));if(f.listeProducteur.length>0&&f.listeProducteur[0].prdtId==null){e.find("#pro-producteur").replaceWith(g.produitListeProducteurVide)}if(f.listeCaracteristique.length>0&&f.listeCaracteristique[0].carId==null){e.find("#pro-caracteristique").replaceWith(g.listeCaracteristiqueVide)}e.find("#pro-idCategorie").selectOptions(h.produit.idCategorie);$(h.produit.producteurs).each(function(){e.find("#pro-prdt-"+this.prdtId).attr("checked","checked")});$(h.produit.caracteristiques).each(function(){e.find("#pro-car-"+this.carId).attr("checked","checked")});$(h.produit.modelesLot).each(function(){if(this.mLotId!=null){this.id=this.mLotId;this.quantite=this.mLotQuantite.nombreFormate(2,","," ");this.unite=this.mLotUnite;this.prix=this.mLotPrix.nombreFormate(2,","," ");this.sigleMonetaire=gSigleMonetaire;e.find("#lot-liste").append(c.affectLot($(g.modeleLot.template(this))))}});e=c.affectFormProduit(e);$(e).dialog({autoOpen:true,modal:true,draggable:true,resizable:false,width:600,buttons:{Modifier:function(){var j=$(this).children("form").first();c.modifierProduit(j)},Annuler:function(){$(this).dialog("close")}},close:function(j,k){$(this).remove();Infobulle.init()}}).submit(function(){c.modifierProduit($(this));return false})}else{Infobulle.generer(h,"")}}},"json")};this.modifierProduit=function(c){var e=this;var b=new NomProduitCatalogueVO();b.numero=c.find(":input[name=reference]").val();b.idNomProduit=c.find(":input[name=id]").val();b.idCategorie=c.find(":input[name=categorie]").val();b.nom=c.find(":input[name=nom]").val();b.description=c.find(":input[name=description]").val();c.find(":input[name=producteur]:checked").each(function(){b.producteurs.push($(this).val())});c.find(":input[name=caracteristique]:checked").each(function(){b.caracteristiques.push($(this).val())});c.find(".ligne-lot").each(function(){var g=new ModeleLotVO();var h=$(this).find(".lot-id").text();if(h>0){g.id=h}g.quantite=$(this).find(".lot-quantite").text().numberFrToDb();g.unite=$(this).find(".lot-unite").text();g.prix=$(this).find(".lot-prix").text().numberFrToDb();b.modelesLot.push(g)});var d=new NomProduitCatalogueValid();var f=d.validUpdate(b);if(f.valid){Infobulle.init();b.fonction="modifierProduit";b.id=this.mParam.id;$.post("./index.php?m=GestionProducteur&v=CatalogueFerme","pParam="+$.toJSON(b),function(h){if(h){if(h.valid){Infobulle.init();$("#dialog-form-pro").dialog("close");var j=new TemplateVR();j.valid=false;j.log.valid=false;var g=new VRerreur();g.code=ERR_330_CODE;g.message=ERR_330_MSG;j.log.erreurs.push(g);var i={vr:j};e.refreshProduit(i)}else{Infobulle.generer(h,"pro-")}}},"json")}else{Infobulle.generer(f,"pro-")}};this.construct(a)};