function MonCompteTemplate(){this.infoCompteAdherent='<div id="info_compte_solde_adherent_ext"><div id="info_compte_solde_adherent_int"><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Informations<span class="com-cursor-pointer com-btn-header ui-widget-content ui-corner-all" id="btn-edt-info" title="Changer le mot de passe"><span class="ui-icon ui-icon-pencil"></span></div><div class="com-widget-content"><div>Numéro d\'adhérent : {adhNumero}</div><div>Numéro de Compte : {cptLabel}</div><div>Nom : {adhNom}</div><div>Prénom : {adhPrenom}</div><div>Date de naissance : {adhDateNaissance}</div><div>Date d\'adhésion : {adhDateAdhesion}</div><div>Commentaire : {adhCommentaire}</div></div></div><div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Coordonnées</div><div class="com-widget-content"><div>Courriel Principal : {adhCourrielPrincipal}</div><div>Courriel Secondaire : {adhCourrielSecondaire}</div><div>Téléphone Principal : {adhTelephonePrincipal}</div><div>Téléphone Secondaire : {adhTelephoneSecondaire}</div><div>Adresse : {adhAdresse}</div><div>Ville : {adhVille}</div><div>Code Postal : {adhCodePostal}</div></div></div></div></div>';this.dialogEditionCompte='<div id="dialog-edt-info-cpt" title="Modifier mon mot de passe"><form><table><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Ancien mot de Passe *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="password" name="pass" maxlength="100" id="motPasse"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Nouveau mot de Passe *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="password" name="pass_nouveau" maxlength="100" id="motPasseNouveau"/></td></tr><tr><th class="com-table-form-th ui-widget-content ui-corner-all">Resaisir le mot de Passe *</th><td class="com-table-form-td"><input class="com-input-text ui-widget-content ui-corner-all" type="password" name="pass_confirm" maxlength="100" id="motPasseConfirm"/></td></tr></table></form></div>';this.listeOperationPassee='<div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Solde : <span id="solde">{cptSolde} {sigleMonetaire}</span></div>	<div><div id="content-nav-liste-operation" class="ui-helper-clearfix ui-state-default ui-corner-all"><form>	<span id="icone-nav-liste-operation-w" class="prev ui-helper-hidden ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-w"></span></span>	<span id="page-compteur">Page : <span type="text" class="pagedisplay"></span></span>	<span id="icone-nav-liste-operation-e" class="next ui-state-default ui-corner-all com-button" ><span class="ui-icon ui-icon-circle-arrow-e"></span></span>	<input type="hidden" class="pagesize" value="10"></form></div><table id="table-operation" class="com-table"><thead><tr class="ui-widget ui-widget-header" ><th class="com-table-th">Date</th><th class="com-table-th">Libellé</th><th class="com-table-th">Type de paiement</th><th class="com-table-th">Débit</th><th class="com-table-th">Crédit</th></tr></thead><tbody><!-- BEGIN operationPassee --><tr><td class="com-table-td td-date ">{operationPassee.opeDate}</td><td class="com-table-td td-libelle">{operationPassee.opeLibelle}</td><td class="com-table-td td-type-paiement">{operationPassee.tppType}</td><td class="com-table-td td-montant">{operationPassee.debit}</td><td class="com-table-td td-montant">{operationPassee.credit}</td></tr><!-- END operationPassee --></tbody></table></div></div>';this.listeOperationAdherentDebut='<div id="liste_operation_adherent_ext"><div id="liste_operation_adherent_int">';this.listeOperationAdherentFin="</div></div>";this.listeOperationAvenir='<div class="com-widget-window ui-widget ui-widget-content ui-corner-all"><div class="com-widget-header ui-widget ui-widget-header ui-corner-all">Achat(s) Futur(s)</div><div><table class="com-table"><tr class="ui-widget ui-widget-header" ><th class="com-table-th">Réservation</th><th class="com-table-th">Libellé</th><th class="com-table-th">Marché</th><th class="com-table-th">Prix</th><th class="com-table-th">Solde</th><th class="com-table-th">Recharger</th></tr><!-- BEGIN operationAvenir --><tr><td class="com-table-td td-date">{operationAvenir.opeDate}</td><td class="com-table-td td-libelle ">{operationAvenir.opeLibelle}</td><td class="com-table-td td-date">{operationAvenir.comDateMarche}</td><td class="com-table-td td-montant">{operationAvenir.opeMontant}  {sigleMonetaire}</td><td class="com-table-td td-montant"><span class="nouveau-solde"><span class="nouveau-solde-val">{operationAvenir.nouveauSolde}</span>  {sigleMonetaire}</span></td><td class="com-table-td td-montant">{operationAvenir.rechargement}  {sigleMonetaire}</td></tr><!-- END operationAvenir --></table></div></div>'}function MonCompteVue(a){this.construct=function(b){$.history({vue:function(){MonCompteVue(b)}});var c=this;$.post("./index.php?m=MonCompte&v=MonCompte",function(d){Infobulle.init();if(d.valid){if(b&&b.vr){Infobulle.generer(b.vr,"")}c.afficher(d);var e=new CommunVue();e.majMenu("MonCompte","MonCompte")}else{Infobulle.generer(d,"")}},"json")};this.afficher=function(g){var f=this;if(g.adherent.adhId==null){g.adherent.opeMontant=0;g.adherent.adhDateNaissance="0000-00-00";g.adherent.adhDateAdhesion="0000-00-00"}g.cptSolde=g.adherent.cptSolde.nombreFormate(2,","," ");g.sigleMonetaire=gSigleMonetaire;g.adherent.adhDateNaissance=g.adherent.adhDateNaissance.extractDbDate().dateDbToFr();g.adherent.adhDateAdhesion=g.adherent.adhDateAdhesion.extractDbDate().dateDbToFr();$(g.operationPassee).each(function(){if(this.opeDate!=null){this.opeDate=this.opeDate.extractDbDate().dateDbToFr();if(this.tppType==null){this.tppType=""}if(this.opeMontant<0){this.debit=(this.opeMontant*-1).nombreFormate(2,","," ")+" "+gSigleMonetaire;this.credit=""}else{this.debit="";this.credit=this.opeMontant.nombreFormate(2,","," ")+" "+gSigleMonetaire}}});var e=parseFloat(g.adherent.cptSolde);var d=0;$(g.operationAvenir).each(function(){if(this.opeDate!=null){e+=parseFloat(this.opeMontant);this.nouveauSolde=e.nombreFormate(2,","," ");this.rechargement=(0).nombreFormate(2,","," ");var i=5;if(e<i){this.rechargement=(Math.ceil((i-e)/i)*i)-d}d+=this.rechargement;this.rechargement=this.rechargement.nombreFormate(2,","," ");this.opeDate=this.opeDate.extractDbDate().dateDbToFr();this.comDateMarche=this.comDateMarche.extractDbDate().dateDbToFr();this.opeMontant=(this.opeMontant*-1).nombreFormate(2,","," ")}});var c=new MonCompteTemplate();var h=new CommunTemplate();var b=h.debutContenu;b+=c.infoCompteAdherent.template(g.adherent);b+=c.listeOperationAdherentDebut.template(g);b+=c.listeOperationPassee.template(g);if(isArray(g.operationAvenir)&&g.operationAvenir[0].opeLibelle!=null){b+=c.listeOperationAvenir.template(g)}b+=c.listeOperationAdherentFin.template(g);b+=h.finContenu;b=$(b);if(g.adherent.cptSolde<0){b=this.soldeNegatif(b)}if(g.operationPassee.length<11){b=this.masquerPagination(b)}else{b=this.paginnation(b)}$("#contenu").replaceWith(f.affect(b))};this.affect=function(b){b=this.nouveauSoldeNegatif(b);b=this.affectHover(b);b=this.affectEditionInfo(b);b=gCommunVue.comHoverBtn(b);return b};this.paginnation=function(b){b.find("#table-operation").tablesorter({headers:{0:{sorter:false},1:{sorter:false},2:{sorter:false},3:{sorter:false},4:{sorter:false}}}).tablesorterPager({container:b.find("#content-nav-liste-operation"),positionFixed:false});return b};this.nouveauSoldeNegatif=function(b){b.find(".nouveau-solde-val").each(function(){if(parseFloat($(this).text().numberFrToDb())<0){$(this).closest(".nouveau-solde").addClass("com-nombre-negatif")}});return b};this.soldeNegatif=function(b){b.find("#solde").addClass("com-nombre-negatif");return b};this.affectHover=function(b){b.find("#icone-nav-liste-operation-w,#icone-nav-liste-operation-e").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});return b};this.masquerPagination=function(b){b.find("#content-nav-liste-operation").hide();return b};this.affectEditionInfo=function(b){var c=this;b.find("#btn-edt-info").click(function(){var d=new MonCompteTemplate();var e=d.dialogEditionCompte;var f=$(e).dialog({autoOpen:true,modal:true,draggable:false,resizable:false,width:600,buttons:{Valider:function(){c.changerMotPasse(this)},Annuler:function(){$(this).dialog("close")}},close:function(g,h){$(this).remove()}});f.find(":input").keyup(function(g){if(g.keyCode=="13"){c.changerMotPasse(f)}})});return b};this.changerMotPasse=function(b){var d=new InfoAdherentVO();var c=$("#dialog-edt-info-cpt form");d.motPasse=c.find(":input[name=pass]").val();d.motPasseNouveau=c.find(":input[name=pass_nouveau]").val();d.motPasseConfirm=c.find(":input[name=pass_confirm]").val();var e=new InfoAdherentValid();var f=e.validAjout(d);if(f.valid){$.post("./index.php?m=MonCompte&v=ModifierMonCompte","pParam="+$.toJSON(d),function(h){Infobulle.init();if(h.valid){var i=new TemplateVR();i.valid=false;i.log.valid=false;var g=new VRerreur();g.code=ERR_302_CODE;g.message=ERR_302_MSG;i.log.erreurs.push(g);Infobulle.generer(i,"");$(b).dialog("close")}else{Infobulle.generer(h,"")}},"json")}else{Infobulle.generer(f,"")}};this.construct(a)};